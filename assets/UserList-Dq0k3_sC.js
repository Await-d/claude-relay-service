import{r as u,_ as z,c as F,q as N,x as r,z as e,L as U,O as p,K as f,aq as b,aW as j,Q as B,ac as T,P as i,Y as Q,y as o,C as v}from"./vue-vendor-CcFZMz-v.js";import{s as n}from"./toast-BvwA7Mwb.js";import{_ as A,b as y}from"./index-DCzasIW1.js";import"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";const I={class:"space-y-6"},K={class:"flex items-center justify-between"},O={class:"glass-strong rounded-xl p-4"},P={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},W={class:"flex-1"},Y={class:"relative"},G={class:"flex items-center gap-2"},H={class:"glass-strong overflow-hidden rounded-xl"},J={key:0,class:"p-8 text-center"},R={key:1,class:"overflow-x-auto"},X={class:"w-full"},Z={class:"divide-y divide-gray-200 dark:divide-gray-700"},ee={class:"px-6 py-4"},te={class:"flex items-center gap-3"},se={class:"font-medium text-gray-900 dark:text-gray-100"},le={class:"text-sm text-gray-500 dark:text-gray-400"},ae={class:"px-6 py-4"},re={class:"px-6 py-4"},oe={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400"},ne={class:"px-6 py-4"},ie={class:"flex items-center justify-end gap-2"},de=["onClick"],ue=["onClick"],ce=["onClick"],me=["onClick"],xe={key:2,class:"p-8 text-center"},fe={class:"mb-2 text-lg font-medium text-gray-900 dark:text-gray-100"},ge={class:"text-gray-500 dark:text-gray-400"},pe={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},ve={class:"modal-content w-full max-w-md"},ye={class:"mb-6 flex items-center justify-between"},be={class:"text-xl font-bold text-gray-900 dark:text-gray-100"},ke={key:0},we={class:"flex gap-3 pt-4"},he=["disabled"],_e={key:0,class:"loading-spinner mr-2"},Ce={__name:"UserList",setup(Ue){const k=u(!1),g=u(!1),$=u([]),m=u(""),x=u(""),w=u(!1),c=u(!1),h=u(null),a=z({username:"",email:"",password:"",role:""}),V=F(()=>{let l=$.value;if(m.value){const t=m.value.toLowerCase();l=l.filter(s=>s.username.toLowerCase().includes(t)||s.email&&s.email.toLowerCase().includes(t)||(s.role==="admin"?"管理员":"普通用户").includes(t))}return x.value&&(l=l.filter(t=>t.role===x.value)),l}),M=l=>l?new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未知",_=async()=>{k.value=!0;try{const l=await y.get("/admin/users");l.success?$.value=l.data||[]:n("加载用户列表失败","error")}catch(l){console.error("Error loading users:",l),n("加载用户列表失败","error")}finally{k.value=!1}},q=()=>{a.username="",a.email="",a.password="",a.role=""},C=()=>{w.value=!1,c.value=!1,h.value=null,q()},E=l=>{h.value=l,a.username=l.username,a.email=l.email||"",a.role=l.role,c.value=!0},D=async()=>{g.value=!0;try{let l;c.value?l=await y.put(`/admin/users/${h.value.id}`,{username:a.username,email:a.email||null,role:a.role}):l=await y.post("/admin/users",{username:a.username,email:a.email||null,password:a.password,role:a.role}),l.success?(n(c.value?"用户更新成功":"用户创建成功","success"),C(),_()):n(l.message||"操作失败","error")}catch(l){console.error("Error saving user:",l),n("操作失败","error")}finally{g.value=!1}},L=async l=>{const t=l.status==="active"?"disabled":"active",s=t==="active"?"启用":"禁用";if(confirm(`确定要${s}用户 "${l.username}" 吗？`))try{const d=await y.patch(`/admin/users/${l.id}/status`,{status:t});d.success?(n(`用户${s}成功`,"success"),l.status=t):n(d.message||`用户${s}失败`,"error")}catch(d){console.error(`Error ${s} user:`,d),n(`用户${s}失败`,"error")}},S=async l=>{if(confirm(`确定要删除用户 "${l.username}" 吗？此操作不可恢复。`))try{const t=await y.delete(`/admin/users/${l.id}`);t.success?(n("用户删除成功","success"),_()):n(t.message||"用户删除失败","error")}catch(t){console.error("Error deleting user:",t),n("用户删除失败","error")}};return N(()=>{_()}),(l,t)=>(o(),r("div",I,[e("div",K,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},[e("i",{class:"fas fa-user-friends mr-2 text-blue-500"}),p(" 用户管理 ")],-1)),e("button",{class:"btn btn-primary flex items-center gap-2",onClick:t[0]||(t[0]=s=>w.value=!0)},[...t[7]||(t[7]=[e("i",{class:"fas fa-plus text-sm"},null,-1),e("span",null,"添加用户",-1)])])]),e("div",O,[e("div",P,[e("div",W,[e("div",Y,[t[9]||(t[9]=e("i",{class:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),class:"form-input w-full pl-10",placeholder:"搜索用户名、邮箱或角色...",type:"text"},null,512),[[b,m.value]])])]),e("div",G,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"角色:",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),class:"form-select"},[...t[10]||(t[10]=[e("option",{value:""},"全部角色",-1),e("option",{value:"admin"},"管理员",-1),e("option",{value:"user"},"普通用户",-1)])],512),[[j,x.value]])])])]),e("div",H,[k.value?(o(),r("div",J,[...t[12]||(t[12]=[e("div",{class:"loading-spinner mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500 dark:text-gray-400"},"加载用户数据中...",-1)])])):V.value.length>0?(o(),r("div",R,[e("table",X,[t[18]||(t[18]=e("thead",{class:"bg-gray-50/50 dark:bg-gray-700/50"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"}," 用户信息 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"}," 角色 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"}," 状态 "),e("th",{class:"px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"}," 创建时间 "),e("th",{class:"px-6 py-4 text-right text-sm font-semibold text-gray-900 dark:text-gray-100"}," 操作 ")])],-1)),e("tbody",Z,[(o(!0),r(B,null,T(V.value,s=>(o(),r("tr",{key:s.id,class:"transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-800/50"},[e("td",ee,[e("div",te,[e("div",{class:v(["flex h-10 w-10 items-center justify-center rounded-full",s.role==="admin"?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[...t[13]||(t[13]=[e("i",{class:"fas fa-user text-sm text-white"},null,-1)])],2),e("div",null,[e("div",se,i(s.username),1),e("div",le,i(s.email||"未设置邮箱"),1)])])]),e("td",ae,[e("span",{class:v(["inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",s.role==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"])},[e("i",{class:v(s.role==="admin"?"fas fa-crown":"fas fa-user")},null,2),p(" "+i(s.role==="admin"?"管理员":"普通用户"),1)],2)]),e("td",re,[e("span",{class:v(["inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",s.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"])},[e("i",{class:v(s.status==="active"?"fas fa-check-circle":"fas fa-times-circle")},null,2),p(" "+i(s.status==="active"?"活跃":"禁用"),1)],2)]),e("td",oe,i(M(s.createdAt)),1),e("td",ne,[e("div",ie,[e("button",{class:"btn-icon text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20",title:"编辑用户",onClick:d=>E(s)},[...t[14]||(t[14]=[e("i",{class:"fas fa-edit"},null,-1)])],8,de),s.status==="active"?(o(),r("button",{key:0,class:"btn-icon text-orange-600 hover:bg-orange-50 dark:text-orange-400 dark:hover:bg-orange-900/20",title:"禁用用户",onClick:d=>L(s)},[...t[15]||(t[15]=[e("i",{class:"fas fa-ban"},null,-1)])],8,ue)):(o(),r("button",{key:1,class:"btn-icon text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-green-900/20",title:"启用用户",onClick:d=>L(s)},[...t[16]||(t[16]=[e("i",{class:"fas fa-check"},null,-1)])],8,ce)),e("button",{class:"btn-icon text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",title:"删除用户",onClick:d=>S(s)},[...t[17]||(t[17]=[e("i",{class:"fas fa-trash"},null,-1)])],8,me)])])]))),128))])])])):(o(),r("div",xe,[t[19]||(t[19]=e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700"},[e("i",{class:"fas fa-users text-2xl text-gray-400"})],-1)),e("h3",fe,i(m.value||x.value?"未找到匹配的用户":"暂无用户数据"),1),e("p",ge,i(m.value||x.value?"请尝试调整搜索条件":"点击上方按钮添加第一个用户"),1)]))]),w.value||c.value?(o(),r("div",pe,[e("div",ve,[e("div",ye,[e("h3",be,[t[20]||(t[20]=e("i",{class:"fas fa-user-plus mr-2 text-blue-500"},null,-1)),p(" "+i(c.value?"编辑用户":"添加用户"),1)]),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:C},[...t[21]||(t[21]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("form",{class:"space-y-4",onSubmit:Q(D,["prevent"])},[e("div",null,[t[22]||(t[22]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 用户名 * ",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.username=s),class:"form-input w-full",placeholder:"请输入用户名",required:"",type:"text"},null,512),[[b,a.username]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 邮箱 ",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.email=s),class:"form-input w-full",placeholder:"请输入邮箱地址",type:"email"},null,512),[[b,a.email]])]),c.value?U("",!0):(o(),r("div",ke,[t[24]||(t[24]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 密码 * ",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.password=s),class:"form-input w-full",placeholder:"请输入密码",required:"",type:"password"},null,512),[[b,a.password]])])),e("div",null,[t[26]||(t[26]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 角色 * ",-1)),f(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.role=s),class:"form-select w-full",required:""},[...t[25]||(t[25]=[e("option",{value:""},"选择角色",-1),e("option",{value:"admin"},"管理员",-1),e("option",{value:"user"},"普通用户",-1)])],512),[[j,a.role]])]),e("div",we,[e("button",{class:"btn btn-secondary flex-1",type:"button",onClick:C}," 取消 "),e("button",{class:"btn btn-primary flex-1",disabled:g.value,type:"submit"},[g.value?(o(),r("div",_e)):U("",!0),p(" "+i(g.value?"保存中...":"保存"),1)],8,he)])],32)])])):U("",!0)]))}},qe=A(Ce,[["__scopeId","data-v-2879ea1e"]]);export{qe as default};
