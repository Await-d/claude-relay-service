import{_ as M,u as _,a as I}from"./index-DCzasIW1.js";import{T as R}from"./ThemeToggle-DM1-KGIK.js";import{r as p,c as T,o as L,q as V,x as l,y as n,z as t,L as y,Q as A,P as v,K as k,aq as B,O as x,aV as C,C as D,aW as $,Y as q,R as S,u as g}from"./vue-vendor-CcFZMz-v.js";import{S as N}from"./SessionManager-lTc519vh.js";import"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";const U={class:"w-full max-w-md space-y-6"},E={class:"text-center"},P={class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-gray-300/30 bg-gradient-to-br from-blue-500/20 to-purple-500/20 backdrop-blur-sm"},j=["src"],z={key:1,class:"fas fa-cloud text-3xl text-gray-700 dark:text-gray-300"},O={key:1,class:"h-12 w-12 animate-pulse rounded bg-gray-300/50"},K={class:"header-title mb-2 text-3xl font-bold text-white"},Q=["disabled"],W={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400"},Y={class:"relative"},Z=["disabled","type"],G=["disabled"],H={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400"},J={key:0},X=["disabled"],ee=["disabled"],te={key:0,class:"loading-spinner mr-2"},se={key:1,class:"fas fa-sign-in-alt mr-2"},ae={key:0,class:"mt-6 rounded-xl border border-red-500/30 bg-red-500/20 p-4 text-center text-sm text-red-800 backdrop-blur-sm dark:text-red-400"},oe={class:"text-center"},re={__name:"LoginForm",props:{loading:{type:Boolean,default:!1},error:{type:String,default:""},oemSettings:{type:Object,default:()=>({siteName:"Claude Relay Service",siteIcon:"",siteIconData:""})},oemLoading:{type:Boolean,default:!1}},emits:["submit"],setup(o,{expose:r,emit:h}){const d=h,s=p({username:"",password:"",authMethod:"auto"}),c=p(!1),f=p(!1),a=p({username:"",password:""}),b=T(()=>s.value.username.length>=3&&s.value.password.length>=1&&!a.value.username&&!a.value.password),i=()=>(a.value.username="",s.value.username?s.value.username.length<3||s.value.username.length>50?(a.value.username="用户名长度必须在 3-50 个字符之间",!1):/^[a-zA-Z0-9_-]+$/.test(s.value.username)?!0:(a.value.username="用户名只能包含字母、数字、下划线和连字符",!1):(a.value.username="用户名不能为空",!1)),w=()=>(a.value.password="",s.value.password?!0:(a.value.password="密码不能为空",!1)),F=()=>{const m=i(),e=w();m&&e&&d("submit",{username:s.value.username.trim(),password:s.value.password,authMethod:s.value.authMethod})};return L(()=>s.value.username,()=>{a.value.username&&(a.value.username="")}),L(()=>s.value.password,()=>{a.value.password&&(a.value.password="")}),V(()=>{setTimeout(()=>{const m=document.querySelector('input[type="text"]');m&&m.focus()},100)}),r({resetForm:()=>{s.value={username:"",password:"",authMethod:"auto"},a.value={username:"",password:""},c.value=!1},focusUsername:()=>{const m=document.querySelector('input[type="text"]');m&&m.focus()}}),(m,e)=>(n(),l("div",U,[t("div",E,[t("div",P,[o.oemLoading?(n(),l("div",O)):(n(),l(A,{key:0},[o.oemSettings.siteIconData||o.oemSettings.siteIcon?(n(),l("img",{key:0,alt:"Logo",class:"h-12 w-12 object-contain",src:o.oemSettings.siteIconData||o.oemSettings.siteIcon,onError:e[0]||(e[0]=u=>u.target.style.display="none")},null,40,j)):(n(),l("i",z))],64))]),t("h1",K,v(o.oemSettings.siteName||"Claude Relay Service"),1),e[6]||(e[6]=t("p",{class:"text-lg text-gray-600 dark:text-gray-400"},"管理后台",-1))]),t("form",{class:"space-y-6",onSubmit:q(F,["prevent"])},[t("div",null,[e[8]||(e[8]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 用户名 ",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.username=u),class:"form-input w-full",disabled:o.loading,placeholder:"请输入用户名",required:"",type:"text",onBlur:i},null,40,Q),[[B,s.value.username]]),a.value.username?(n(),l("div",W,[e[7]||(e[7]=t("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),x(" "+v(a.value.username),1)])):y("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 密码 ",-1)),t("div",Y,[k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.password=u),class:"form-input w-full pr-12",disabled:o.loading,placeholder:"请输入密码",required:"",type:c.value?"text":"password",onBlur:w},null,40,Z),[[C,s.value.password]]),t("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",disabled:o.loading,type:"button",onClick:e[3]||(e[3]=u=>c.value=!c.value)},[t("i",{class:D(c.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,G)]),a.value.password?(n(),l("div",H,[e[9]||(e[9]=t("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),x(" "+v(a.value.password),1)])):y("",!0)]),f.value?(n(),l("div",J,[e[12]||(e[12]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 认证方式 ",-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=u=>s.value.authMethod=u),class:"form-input w-full",disabled:o.loading},[...e[11]||(e[11]=[t("option",{value:"auto"},"自动检测",-1),t("option",{value:"local"},"本地认证",-1),t("option",{value:"ldap"},"LDAP认证",-1)])],8,X),[[$,s.value.authMethod]])])):y("",!0),t("button",{class:"btn btn-primary w-full px-6 py-4 text-lg font-semibold",disabled:o.loading||!b.value,type:"submit"},[o.loading?(n(),l("div",te)):(n(),l("i",se)),x(" "+v(o.loading?"登录中...":"登录"),1)],8,ee)],32),o.error?(n(),l("div",ae,[e[13]||(e[13]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),x(" "+v(o.error),1)])):y("",!0),t("div",oe,[t("button",{class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",type:"button",onClick:e[5]||(e[5]=u=>f.value=!f.value)},[e[14]||(e[14]=t("i",{class:"fas fa-cog mr-1"},null,-1)),x(" "+v(f.value?"隐藏高级选项":"显示高级选项"),1)])])]))}},le=M(re,[["__scopeId","data-v-0eb3486d"]]),ne={class:"flex min-h-screen items-center justify-center p-4 sm:p-6"},ie={class:"fixed right-4 top-4 z-50"},de={class:"glass-strong w-full max-w-md rounded-xl p-6 shadow-2xl sm:rounded-2xl sm:p-8 md:rounded-3xl md:p-10"},ue={__name:"LoginView",setup(o){const r=_(),h=I(),d=p(null);V(()=>{h.initTheme(),r.loadOemSettings()});const s=async i=>{await r.login(i)},c=async()=>{try{await r.refreshSession()||console.warn("Session refresh failed")}catch(i){console.error("Session refresh error:",i)}},f=()=>{console.warn("Session expired"),r.clearAuthState(),d.value&&d.value.resetForm()},a=i=>{console.error("Session refresh failed:",i),r.clearAuthState(),d.value&&d.value.resetForm()},b=()=>{r.logout(),d.value&&d.value.resetForm()};return(i,w)=>(n(),l("div",ne,[t("div",ie,[S(R,{mode:"dropdown"})]),S(N,{"auto-refresh":!0,"expires-at":g(r).expiresAt,"session-token":g(r).sessionToken,"show-indicator":!1,onLogout:b,onRefreshFailed:a,onSessionExpired:f,onSessionRefreshed:c},null,8,["expires-at","session-token"]),t("div",de,[S(le,{ref_key:"loginFormRef",ref:d,error:g(r).loginError,loading:g(r).loginLoading,"oem-loading":g(r).oemLoading,"oem-settings":g(r).oemSettings,onSubmit:s},null,8,["error","loading","oem-loading","oem-settings"])])]))}},pe=M(ue,[["__scopeId","data-v-2082a71c"]]);export{pe as default};
