import{c as q,r as P,_ as G,q as J,V as H,x as r,y as o,z as e,L as T,R as k,J as j,P as x,C as N,Y as D,O as w,T as Y,K as M,aq as I,Q as R,aX as z,ac as V,o as Q,u as K,ax as X,aY as W,D as Z}from"./vue-vendor-CcFZMz-v.js";import{_ as L,u as $,b as O}from"./index-BRegghkI.js";import{s as _}from"./toast-BvwA7Mwb.js";import{L as ee}from"./LogoTitle-rAVmU2e6.js";import{T as te}from"./ThemeToggle-BluQxjSx.js";import{S as se}from"./SessionManager-C5ixTdYZ.js";import"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";const ae={class:"glass-strong mb-4 rounded-xl p-3 shadow-xl sm:mb-6 sm:rounded-2xl sm:p-4 md:mb-8 md:rounded-3xl md:p-6",style:{"z-index":"10",position:"relative"}},re={class:"flex flex-col items-center justify-between gap-3 sm:flex-row sm:gap-4"},oe={class:"flex w-full items-center justify-center gap-2 sm:w-auto sm:justify-start sm:gap-3 md:gap-4"},ne={class:"flex items-center gap-1 sm:gap-2"},le={class:"font-mono text-xs text-gray-400 dark:text-gray-500 sm:text-sm"},ie=["href"],de={class:"flex items-center gap-2 sm:gap-4"},ue={class:"flex items-center"},ce={class:"user-menu-container relative"},me={class:"hidden sm:inline"},ge={key:0,class:"hidden text-xs opacity-75 lg:inline"},pe={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},fe={class:"mb-3 flex items-center gap-3"},xe={class:"font-semibold text-gray-900 dark:text-gray-100"},ye={class:"text-xs text-gray-500 dark:text-gray-400"},ve={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},be={class:"flex items-center justify-between text-sm"},he={class:"font-mono text-gray-700 dark:text-gray-300"},ke={key:0,class:"mt-2"},we={class:"mb-2 flex items-center justify-between text-sm"},_e={class:"font-mono text-green-600 dark:text-green-400"},Ue=["href"],Ce={key:1,class:"mt-2 text-center text-xs text-gray-500 dark:text-gray-400"},Te={key:2,class:"mt-2 text-center"},Pe={key:"message",class:"inline-block rounded-lg border border-green-200 bg-green-100 px-3 py-1.5 dark:border-green-800 dark:bg-green-900/30"},Se={key:0,class:"border-b border-gray-200 dark:border-gray-700"},Me={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Ie={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-4 sm:p-6 md:p-8"},qe=["value"],Ne={class:"flex gap-3 pt-4"},Re=["disabled"],Le={key:0,class:"loading-spinner mr-2"},$e={key:1,class:"fas fa-save mr-2"},Ae={__name:"AppHeader",setup(S){const m=z(),y=$(),n=q(()=>y.user||{username:"Admin"}),l=q(()=>y.oemSettings||{}),u=q(()=>y.oemLoading),s=P({current:"...",latest:"",hasUpdate:!1,checkingUpdate:!1,lastChecked:null,releaseInfo:null,noUpdateMessage:!1}),c=P(!1),U=P(!1),b=P(!1),a=G({currentPassword:"",newPassword:"",confirmPassword:"",newUsername:""}),C=async()=>{if(!s.value.checkingUpdate){s.value.checkingUpdate=!0;try{const f=await O.get("/admin/check-updates");if(f.success){const t=f.data;s.value.current=t.current,s.value.latest=t.latest,s.value.hasUpdate=t.hasUpdate,s.value.releaseInfo=t.releaseInfo,s.value.lastChecked=new Date,localStorage.setItem("versionInfo",JSON.stringify({current:t.current,latest:t.latest,lastChecked:s.value.lastChecked,hasUpdate:t.hasUpdate,releaseInfo:t.releaseInfo})),t.hasUpdate||(s.value.noUpdateMessage=!0,setTimeout(()=>{s.value.noUpdateMessage=!1},3e3))}}catch(f){console.error("Error checking for updates:",f);const t=localStorage.getItem("versionInfo");if(t){const v=JSON.parse(t);s.value.current=v.current||s.value.current,s.value.latest=v.latest,s.value.hasUpdate=v.hasUpdate,s.value.releaseInfo=v.releaseInfo,s.value.lastChecked=new Date(v.lastChecked)}}finally{s.value.checkingUpdate=!1}}},i=()=>{a.currentPassword="",a.newPassword="",a.confirmPassword="",a.newUsername="",U.value=!0,c.value=!1},g=()=>{U.value=!1},d=async()=>{if(a.newPassword!==a.confirmPassword){_("两次输入的密码不一致","error");return}if(a.newPassword.length<8){_("新密码长度至少8位","error");return}b.value=!0;try{const f=await O.post("/web/auth/change-password",{currentPassword:a.currentPassword,newPassword:a.newPassword,newUsername:a.newUsername||void 0});if(f.success){const t=a.newUsername?"账户信息修改成功，请重新登录":"密码修改成功，请重新登录";_(t,"success"),g(),setTimeout(()=>{y.logout(),m.push("/login")},1500)}else _(f.message||"修改失败","error")}catch{_("修改密码失败","error")}finally{b.value=!1}},h=()=>{confirm("确定要退出登录吗？")&&(y.logout(),m.push("/login"),_("已安全退出","success")),c.value=!1},E=()=>{m.push("/users"),c.value=!1},B=()=>{m.push("/user-groups"),c.value=!1},F=()=>{m.push("/settings"),c.value=!1},A=f=>{!f.target.closest(".user-menu-container")&&c.value&&(c.value=!1)};return J(()=>{C(),setInterval(()=>{C()},36e5),document.addEventListener("click",A)}),H(()=>{document.removeEventListener("click",A)}),(f,t)=>{var v;return o(),r(R,null,[e("div",ae,[e("div",re,[e("div",oe,[k(ee,{loading:u.value,"logo-src":l.value.siteIconData||l.value.siteIcon,subtitle:"管理后台",title:l.value.siteName,"title-class":"text-white dark:text-gray-100"},{"after-title":j(()=>{var p;return[e("div",ne,[e("span",le,"v"+x(s.value.current||"..."),1),s.value.hasUpdate?(o(),r("a",{key:0,class:"inline-flex animate-pulse items-center gap-1 rounded-full border border-green-600 bg-green-500 px-2 py-0.5 text-xs text-white transition-colors hover:bg-green-600",href:((p=s.value.releaseInfo)==null?void 0:p.htmlUrl)||"#",target:"_blank",title:"有新版本可用"},[...t[7]||(t[7]=[e("i",{class:"fas fa-arrow-up text-[10px]"},null,-1),e("span",null,"新版本",-1)])],8,ie)):T("",!0)])]}),_:1},8,["loading","logo-src","title"])]),e("div",de,[e("div",ue,[k(te,{mode:"dropdown"})]),t[23]||(t[23]=e("div",{class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},null,-1)),e("div",ce,[e("button",{class:"user-menu-button flex items-center gap-2 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 sm:px-4 sm:py-2.5",onClick:t[0]||(t[0]=p=>c.value=!c.value)},[t[8]||(t[8]=e("i",{class:"fas fa-user-circle text-sm sm:text-base"},null,-1)),e("span",me,x(n.value.username||"Admin"),1),n.value.role?(o(),r("span",ge," ("+x(n.value.role==="admin"?"管理员":"用户")+") ",1)):T("",!0),e("i",{class:N(["fas fa-chevron-down ml-1 text-xs transition-transform duration-200",{"rotate-180":c.value}])},null,2)]),c.value?(o(),r("div",{key:0,class:"user-menu-dropdown absolute right-0 top-full mt-2 w-48 rounded-xl border border-gray-200 bg-white py-2 shadow-xl dark:border-gray-700 dark:bg-gray-800 sm:w-56",style:{"z-index":"999999"},onClick:t[2]||(t[2]=D(()=>{},["stop"]))},[e("div",pe,[e("div",fe,[e("div",{class:N(["flex h-10 w-10 items-center justify-center rounded-full",n.value.role==="admin"?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[...t[9]||(t[9]=[e("i",{class:"fas fa-user text-sm text-white"},null,-1)])],2),e("div",null,[e("div",xe,x(n.value.username||"Admin"),1),e("div",ye,x(n.value.role==="admin"?"系统管理员":"普通用户"),1)])])]),e("div",ve,[e("div",be,[t[10]||(t[10]=e("span",{class:"text-gray-500 dark:text-gray-400"},"当前版本",-1)),e("span",he,"v"+x(s.value.current||"..."),1)]),s.value.hasUpdate?(o(),r("div",ke,[e("div",we,[t[11]||(t[11]=e("span",{class:"font-medium text-green-600 dark:text-green-400"},[e("i",{class:"fas fa-arrow-up mr-1"}),w("有新版本 ")],-1)),e("span",_e,"v"+x(s.value.latest),1)]),e("a",{class:"block w-full rounded-lg bg-green-500 px-3 py-1.5 text-center text-sm text-white transition-colors hover:bg-green-600",href:((v=s.value.releaseInfo)==null?void 0:v.htmlUrl)||"#",target:"_blank"},[...t[12]||(t[12]=[e("i",{class:"fas fa-external-link-alt mr-1"},null,-1),w("查看更新 ",-1)])],8,Ue)])):s.value.checkingUpdate?(o(),r("div",Ce,[...t[13]||(t[13]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),w("检查更新中... ",-1)])])):(o(),r("div",Te,[k(Y,{mode:"out-in",name:"fade"},{default:j(()=>[s.value.noUpdateMessage?(o(),r("div",Pe,[...t[14]||(t[14]=[e("p",{class:"text-xs font-medium text-green-700 dark:text-green-400"},[e("i",{class:"fas fa-check-circle mr-1"}),w("当前已是最新版本 ")],-1)])])):(o(),r("button",{key:"button",class:"text-xs text-blue-500 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:t[1]||(t[1]=p=>C())},[...t[15]||(t[15]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),w("检查更新 ",-1)])]))]),_:1})]))]),n.value.role==="admin"?(o(),r("div",Se,[e("div",{class:"px-4 py-2"},[t[19]||(t[19]=e("p",{class:"mb-2 text-xs font-medium text-gray-500 dark:text-gray-400"},"管理功能",-1)),e("div",{class:"space-y-1"},[e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:E},[...t[16]||(t[16]=[e("i",{class:"fas fa-user-friends w-4 text-xs text-blue-500"},null,-1),e("span",null,"用户管理",-1)])]),e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:B},[...t[17]||(t[17]=[e("i",{class:"fas fa-users-cog w-4 text-xs text-purple-500"},null,-1),e("span",null,"用户组管理",-1)])]),e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:F},[...t[18]||(t[18]=[e("i",{class:"fas fa-cogs w-4 text-xs text-gray-500"},null,-1),e("span",null,"系统设置",-1)])])])])])):T("",!0),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:i},[...t[20]||(t[20]=[e("i",{class:"fas fa-key text-blue-500"},null,-1),e("span",null,"修改账户信息",-1)])]),t[22]||(t[22]=e("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1)),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:h},[...t[21]||(t[21]=[e("i",{class:"fas fa-sign-out-alt text-red-500"},null,-1),e("span",null,"退出登录",-1)])])])):T("",!0)])])])]),U.value?(o(),r("div",Me,[e("div",Ie,[e("div",{class:"mb-6 flex items-center justify-between"},[t[25]||(t[25]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改账户信息")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:g},[...t[24]||(t[24]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-6",onSubmit:D(d,["prevent"])},[e("div",null,[t[26]||(t[26]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前用户名",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 dark:bg-gray-700 dark:text-gray-300",disabled:"",type:"text",value:n.value.username||"Admin"},null,8,qe),t[27]||(t[27]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 当前用户名，输入新用户名以修改 ",-1))]),e("div",null,[t[28]||(t[28]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新用户名",-1)),M(e("input",{"onUpdate:modelValue":t[3]||(t[3]=p=>a.newUsername=p),class:"form-input w-full",placeholder:"输入新用户名（留空保持不变）",type:"text"},null,512),[[I,a.newUsername]]),t[29]||(t[29]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"留空表示不修改用户名",-1))]),e("div",null,[t[30]||(t[30]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前密码",-1)),M(e("input",{"onUpdate:modelValue":t[4]||(t[4]=p=>a.currentPassword=p),class:"form-input w-full",placeholder:"请输入当前密码",required:"",type:"password"},null,512),[[I,a.currentPassword]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新密码",-1)),M(e("input",{"onUpdate:modelValue":t[5]||(t[5]=p=>a.newPassword=p),class:"form-input w-full",placeholder:"请输入新密码",required:"",type:"password"},null,512),[[I,a.newPassword]]),t[32]||(t[32]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"密码长度至少8位",-1))]),e("div",null,[t[33]||(t[33]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"确认新密码",-1)),M(e("input",{"onUpdate:modelValue":t[6]||(t[6]=p=>a.confirmPassword=p),class:"form-input w-full",placeholder:"请再次输入新密码",required:"",type:"password"},null,512),[[I,a.confirmPassword]])]),e("div",Ne,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:g}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:b.value,type:"submit"},[b.value?(o(),r("div",Le)):(o(),r("i",$e)),w(" "+x(b.value?"保存中...":"保存修改"),1)],8,Re)])],32)])])):T("",!0)],64)}}},je=L(Ae,[["__scopeId","data-v-030a4848"]]),De={class:"mb-4 sm:mb-6"},Ve={class:"block rounded-xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:hidden"},Ke=["value"],Oe=["value"],ze={class:"hidden flex-wrap gap-2 rounded-2xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:flex"},Ee=["onClick"],Be={class:"hidden md:inline"},Fe={class:"md:hidden"},Ge={__name:"TabBar",props:{activeTab:{type:String,required:!0}},emits:["tab-change"],setup(S){const m=$(),y=[{key:"dashboard",name:"仪表板",shortName:"仪表板",icon:"fas fa-tachometer-alt",requiredRole:null},{key:"apiKeys",name:"API Keys",shortName:"API",icon:"fas fa-key",requiredRole:null},{key:"accounts",name:"账户管理",shortName:"账户",icon:"fas fa-user-circle",requiredRole:null},{key:"users",name:"用户管理",shortName:"用户",icon:"fas fa-user-friends",requiredRole:"admin"},{key:"groups",name:"用户组",shortName:"组",icon:"fas fa-users",requiredRole:"admin"},{key:"user-groups",name:"用户组管理",shortName:"组管理",icon:"fas fa-users-cog",requiredRole:"admin"},{key:"requestLogs",name:"请求日志",shortName:"日志",icon:"fas fa-file-alt",requiredRole:null},{key:"tutorial",name:"使用教程",shortName:"教程",icon:"fas fa-graduation-cap",requiredRole:null},{key:"settings",name:"系统设置",shortName:"设置",icon:"fas fa-cogs",requiredRole:"admin"}],n=q(()=>{const l=m.user,u=(l==null?void 0:l.role)||"user";return y.filter(s=>!s.requiredRole||u==="admin"?!0:u===s.requiredRole)});return(l,u)=>(o(),r("div",De,[e("div",Ve,[e("select",{class:"focus:ring-primary-color w-full rounded-lg bg-white/90 px-4 py-3 font-semibold text-gray-700 focus:outline-none focus:ring-2 dark:bg-gray-800/90 dark:text-gray-200 dark:focus:ring-indigo-400",value:S.activeTab,onChange:u[0]||(u[0]=s=>l.$emit("tab-change",s.target.value))},[(o(!0),r(R,null,V(n.value,s=>(o(),r("option",{key:s.key,value:s.key},x(s.name),9,Oe))),128))],40,Ke)]),e("div",ze,[(o(!0),r(R,null,V(n.value,s=>(o(),r("button",{key:s.key,class:N(["tab-btn flex-1 px-3 py-2 text-xs font-semibold transition-all duration-300 sm:px-4 sm:py-3 sm:text-sm md:px-6",S.activeTab===s.key?"active":"text-gray-700 hover:bg-white/10 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700/30 dark:hover:text-gray-100"]),onClick:c=>l.$emit("tab-change",s.key)},[e("i",{class:N(s.icon+" mr-1 sm:mr-2")},null,2),e("span",Be,x(s.name),1),e("span",Fe,x(s.shortName||s.name),1)],10,Ee))),128))])]))}},Je=L(Ge,[["__scopeId","data-v-67758799"]]),He={class:"min-h-screen p-3 sm:p-4 md:p-6"},Ye={class:"glass-strong rounded-xl p-3 shadow-xl sm:rounded-2xl sm:p-4 md:rounded-3xl md:p-6",style:{"z-index":"1","min-height":"calc(100vh - 120px)"}},Qe={class:"tab-content"},Xe={__name:"MainLayout",setup(S){const m=W(),y=z(),n=$(),l=P("dashboard"),u={dashboard:"/dashboard",apiKeys:"/api-keys",accounts:"/accounts",users:"/users",groups:"/groups","user-groups":"/user-groups",requestLogs:"/request-logs",tutorial:"/tutorial",settings:"/settings"},s=()=>{const i=m.path,g=Object.keys(u).find(d=>u[d]===i);if(g)l.value=g;else{const d=m.name,h={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Users:"users",Groups:"groups",UserGroups:"user-groups",DataManagement:"data-management",Tutorial:"tutorial",Settings:"settings"};d&&h[d]?l.value=h[d]:l.value="dashboard"}};s(),Q(()=>m.path,i=>{const g=Object.keys(u).find(d=>u[d]===i);if(g)l.value=g;else{const d=m.name,h={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Users:"users",Groups:"groups",UserGroups:"user-groups",DataManagement:"data-management",Tutorial:"tutorial",Settings:"settings"};d&&h[d]&&(l.value=h[d])}});const c=async i=>{if(u[i]!==m.path){l.value=i;try{await y.push(u[i]),await Z()}catch(g){g.name!=="NavigationDuplicated"&&(console.error("路由切换失败:",g),s())}}},U=async()=>{try{await n.refreshSession()||console.warn("Session refresh failed in MainLayout")}catch(i){console.error("Session refresh error in MainLayout:",i)}},b=()=>{console.warn("Session expired in MainLayout"),n.clearAuthState()},a=i=>{console.error("Session refresh failed in MainLayout:",i),n.clearAuthState()},C=()=>{n.logout()};return(i,g)=>{const d=X("router-view");return o(),r("div",He,[k(se,{"auto-refresh":!0,"expires-at":K(n).expiresAt,"session-token":K(n).sessionToken,"show-indicator":!0,"show-status-text":!1,onLogout:C,onRefreshFailed:a,onSessionExpired:b,onSessionRefreshed:U},null,8,["expires-at","session-token"]),k(je),e("div",Ye,[k(Je,{"active-tab":l.value,onTabChange:c},null,8,["active-tab"]),e("div",Qe,[k(d)])])])}}},nt=L(Xe,[["__scopeId","data-v-a9a27673"]]);export{nt as default};
