import{aV as xe,r as f,c as z,o as me,q as Xt,V as ye,x as d,z as e,L as y,O as x,u as l,C as m,P as r,K as N,aq as H,aW as B,Q as J,ac as W,aX as Z,Y as Yt,y as i}from"./vue-vendor-Ig-GgGwA.js";import{u as ce}from"./requestLogs-muQb1cyR.js";import{s as Q}from"./toast-BvwA7Mwb.js";import{_ as ge}from"./index-B-MsPTUL.js";import"./element-plus-Bq6mBxnk.js";import"./vendor-BDiMbLwQ.js";const ve={class:"request-logs-container"},fe={class:"mb-6 flex items-center justify-between"},be={key:0,class:"mt-2 flex items-center text-sm text-red-600 dark:text-red-400"},pe={class:"flex items-center space-x-3"},ke=["aria-label","disabled"],he={class:"relative"},we=["aria-label","disabled"],_e={key:0,"aria-label":"导出格式选择",class:"absolute right-0 top-full z-50 mt-2 w-48 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-gray-800",role:"menu"},Ce={class:"py-1"},De={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},Ae={class:"stat-card"},Te={class:"flex items-center justify-between"},Ne={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Ke={class:"stat-card"},Ie={class:"flex items-center justify-between"},$e={class:"text-2xl font-bold text-red-600 dark:text-red-400"},Le={class:"stat-card"},Se={class:"flex items-center justify-between"},Oe={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Pe={class:"stat-card"},Re={class:"flex items-center justify-between"},Ee={class:"text-2xl font-bold text-purple-600 dark:text-purple-400"},je={class:"card mb-6 p-4"},qe={class:"mb-4 flex items-center justify-between"},Ve={class:"flex items-center space-x-2"},Ue=["aria-label"],Me={class:"relative"},Fe={class:"relative"},ze=["aria-describedby"],Be={class:"absolute right-2 top-1/2 -translate-y-1/2"},Je={key:0,class:"loading-spinner h-4 w-4"},We={key:2,class:"fas fa-search text-sm text-gray-400"},Qe={key:0,id:"search-results-info",class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Xe={key:0},Ye={key:1},Ge={class:"relative"},He=["disabled"],Ze=["value"],ts={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2"},es={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},ss={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},as={key:0,class:"mt-4"},ls={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},rs={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},os={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ns={key:0,class:"card mb-6 p-6"},ds={class:"text-center"},is={class:"mb-4 text-sm text-gray-600 dark:text-gray-400"},us={class:"flex flex-col items-center space-y-2 sm:flex-row sm:justify-center sm:space-x-4 sm:space-y-0"},xs={key:1,class:"card"},ms={class:"flex flex-col space-y-3 border-b border-gray-200 p-4 dark:border-gray-700 sm:flex-row sm:items-center sm:justify-between sm:space-y-0"},ys={class:"flex items-center space-x-4"},cs={class:"text-sm text-gray-600 dark:text-gray-400"},gs={key:0,class:"flex items-center text-xs text-green-600 dark:text-green-400"},vs={class:"flex items-center space-x-2"},fs={class:"hidden items-center space-x-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-800 sm:flex"},bs={key:0,class:"p-8"},ps={class:"space-y-3"},ks={key:1,class:"py-12 text-center"},hs={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},ws={class:"space-y-2 text-sm text-gray-600 dark:text-gray-400"},_s={key:0},Cs={key:1},Ds={class:"mt-4 flex flex-col items-center space-y-2 sm:flex-row sm:justify-center sm:space-x-4 sm:space-y-0"},As={key:2,class:"hidden overflow-x-auto md:block"},Ts={"aria-label":"请求日志列表",class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",role:"table"},Ns={class:"bg-gray-50 dark:bg-gray-800"},Ks={class:"flex items-center space-x-1"},Is={class:"flex items-center space-x-1"},$s={class:"flex items-center space-x-1"},Ls={class:"flex items-center space-x-1"},Ss={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Os={class:"table-cell"},Ps={class:"text-sm text-gray-900 dark:text-gray-100"},Rs={class:"table-cell"},Es={class:"flex items-center space-x-2"},js={class:"table-cell"},qs={class:"table-cell"},Vs=["title"],Us={class:"table-cell"},Ms={class:"table-cell"},Fs={class:"flex items-center space-x-1"},zs={class:"text-sm text-gray-900 dark:text-gray-100"},Bs={key:0,class:"fas fa-exclamation-triangle text-xs text-yellow-500",title:"响应时间较慢"},Js={class:"table-cell"},Ws={class:"text-sm text-gray-600 dark:text-gray-400"},Qs={class:"table-cell"},Xs=["aria-label","onClick"],Ys={key:3,class:"divide-y divide-gray-200 dark:divide-gray-700 md:hidden"},Gs={class:"flex items-start justify-between"},Hs={class:"flex-1 space-y-2"},Zs={class:"flex items-center justify-between"},ta={class:"flex items-center space-x-3"},ea={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},sa={class:"flex items-center space-x-1"},aa=["onClick"],la={class:"flex items-center space-x-2"},ra={class:"truncate text-sm text-gray-900 dark:text-gray-100"},oa={class:"flex items-center justify-between text-sm"},na={class:"flex items-center space-x-3"},da={class:"text-gray-600 dark:text-gray-400"},ia={class:"text-gray-500 dark:text-gray-500"},ua={key:4,class:"flex items-center justify-between border-t border-gray-200 px-4 py-3 dark:border-gray-700"},xa={class:"flex items-center space-x-2"},ma=["disabled"],ya={class:"text-sm text-gray-600 dark:text-gray-400"},ca=["disabled"],ga={class:"max-h-[90vh] w-full max-w-4xl overflow-hidden rounded-lg bg-white shadow-xl dark:bg-gray-800"},va={class:"flex items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-gray-700"},fa={class:"max-h-[calc(90vh-120px)] overflow-y-auto p-6"},ba={class:"space-y-6"},pa={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ka={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ha={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},wa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},_a={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ca={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Da={class:"space-y-4"},Aa={class:"mt-1 rounded bg-gray-100 p-2 text-sm text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Ta={class:"mt-1 rounded bg-gray-100 p-2 text-sm text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Na={key:0},Ka={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Ia={key:1},$a={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},La={key:0},Sa={class:"space-y-4"},Oa={key:0},Pa={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Ra={key:1},Ea={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},ja={key:1},qa={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Va={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ua={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ma={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Fa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},za={class:"max-h-[90vh] w-full max-w-2xl overflow-hidden rounded-lg bg-white shadow-xl dark:bg-gray-800"},Ba={class:"flex items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-gray-700"},Ja={class:"max-h-[calc(90vh-120px)] overflow-y-auto p-6"},Wa={class:"space-y-4"},Qa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Xa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ya={key:0},Ga={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ha={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Za={class:"mt-1 space-y-2 text-sm text-gray-600 dark:text-gray-400"},tl={key:0},el={key:1},sl={key:2},al={key:3},ll={__name:"RequestLogsView",setup(rl){const tt=(s,t)=>{let n;return(...v)=>{clearTimeout(n),n=setTimeout(()=>s.apply(this,v),t)}},et=ce(),{logs:R,loading:K,exporting:E,stats:L,filters:o,pagination:g,filteredLogs:st,hasFilters:at,apiKeyLoading:X,apiKeyMap:Gt}=xe(et),{fetchLogs:lt,fetchStats:rt,exportLogs:Ht,updateFilters:C,clearFilters:Zt,refreshLogs:te,formatLogEntry:ot,getStatusClass:nt,getMethodClass:dt,formatDuration:ee,fetchApiKeys:Y}=et,S=f(!1),u=f(null),b=f("24h"),p=f(""),c=f(null),k=f(!1),h=f(null),j=f(!1),O=f(!1),P=f("table"),it=f(!1),q=f(!1),ut=f(0),I=s=>{var n;if(!s||s===null||s===void 0)return"Unknown";if(h.value)return`${s} (无法验证)`;if(X.value)return`${s} (加载中...)`;const t=(n=Gt.value)==null?void 0:n.get(s);return t!=null&&t.name?t.name:`${s} (已删除)`},se=z(()=>{var t;return(((t=L.value)==null?void 0:t.topApiKeys)||[]).map(n=>({id:n.keyId,name:I(n.keyId),count:n.count,displayText:`${I(n.keyId)} (${n.count}次使用)`}))}),$=z(()=>{const s=Array.isArray(R.value)?R.value:[];if(!o.search)return s;const t=String(o.search||"").toLowerCase();return t?s.filter(n=>{var v,_,D,A;return((v=n==null?void 0:n.keyName)==null?void 0:v.toLowerCase().includes(t))||((_=n==null?void 0:n.userAgent)==null?void 0:_.toLowerCase().includes(t))||((D=n==null?void 0:n.ipAddress)==null?void 0:D.includes(t))||((A=n==null?void 0:n.path)==null?void 0:A.toLowerCase().includes(t))}):s}),V=z(()=>{let s=[];return o.search?s=$.value:s=Array.isArray(st.value)?st.value:[],s.map(t=>({...t,formattedKeyName:t.keyName||I(t.keyId)}))}),xt=tt(async()=>{j.value=!0;try{await w()}finally{j.value=!1}},500),ae=z(()=>b.value!=="custom"?{"1h":"最近 1 小时","24h":"最近 24 小时","7d":"最近 7 天","30d":"最近 30 天"}[b.value]||"":o.startDate&&o.endDate?`${o.startDate} 至 ${o.endDate}`:"请设置时间范围");me(()=>[o.startDate,o.endDate],([s,t])=>{b.value==="custom"&&s&&t&&(p.value="",le())});const le=tt(async()=>{b.value==="custom"&&await ct()},1e3),re=()=>{var n;const s=(g==null?void 0:g.total)||0,t=((n=V.value)==null?void 0:n.length)||0;return o!=null&&o.search?`找到 ${$.value?$.value.length:0} 条匹配结果，共 ${s} 条记录`:`显示 ${t} 条记录，共 ${s} 条`},oe=s=>s?s.code==="NETWORK_ERROR"?"网络连接失败，请检查网络连接后重试":s.code==="TIMEOUT"?"请求超时，服务器响应缓慢":s.status===401?"认证失败，请重新登录":s.status===403?"没有权限访问此资源":s.status>=500?"服务器内部错误，请稍后重试或联系技术支持":s.message||"请求失败，请重试":"未知错误",ne=()=>{C({search:""}),w()},mt=()=>{Zt(),w()},yt=async()=>{c.value=null,k.value=!1,ut.value++;try{await G(),Q("数据加载成功","success")}catch(s){c.value=s,Q("重试失败，请检查网络连接","error")}},de=s=>`${(s*100).toFixed(1)}%`,w=async()=>{try{c.value=null,k.value=!1,b.value==="custom"?await ct():await lt()}catch(s){console.error("Apply filters failed:",s),c.value=s,k.value=!0}},ct=async()=>{const s=o.startDate,t=o.endDate;if(!s||!t){p.value="请设置完整的时间范围";return}const n=new Date(s),v=new Date(t);if(n>=v){p.value="结束时间必须大于开始时间";return}if((v-n)/(1e3*60*60*24)>90){p.value="时间范围不能超过90天";return}p.value="",await gt(n.toISOString(),v.toISOString())},gt=async(s,t)=>{const n=o.startDate,v=o.endDate;C({startDate:s,endDate:t}),await lt(),b.value!=="custom"&&C({startDate:n,endDate:v})},ie=(s,t)=>{const n=new Date(t);switch(s){case"1h":return new Date(n.getTime()-60*60*1e3);case"24h":return new Date(n.getTime()-24*60*60*1e3);case"7d":return new Date(n.getTime()-7*24*60*60*1e3);case"30d":return new Date(n.getTime()-30*24*60*60*1e3);default:return new Date(n.getTime()-24*60*60*1e3)}},vt=s=>{const t=new Date(s);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)},ft=()=>{if(p.value="",b.value!=="custom")try{const s=new Date,t=ie(b.value,s),n=s,v=t.toISOString(),_=n.toISOString(),D=vt(t),A=vt(n);C({startDate:D,endDate:A}),gt(v,_)}catch(s){console.error("时间范围设置错误:",s),p.value=s.message}},U=s=>{const t=o==null?void 0:o.sortBy,n=o==null?void 0:o.sortOrder;C(t===s?{sortOrder:n==="asc"?"desc":"asc"}:{sortBy:s,sortOrder:"desc"}),w()},M=s=>(o==null?void 0:o.sortBy)!==s?"fa-sort":(o==null?void 0:o.sortOrder)==="asc"?"fa-sort-up":"fa-sort-down",bt=s=>{const t=(g==null?void 0:g.totalPages)||1;s>=1&&s<=t&&(C({page:s}),w())},pt=s=>{u.value=s},kt=async s=>{S.value=!1,await Ht(s)},ue=async()=>{try{h.value=null,await Y(!0),Q("API Key数据重新加载成功","success")}catch(s){console.error("API Key重试失败:",s),h.value="重试失败，请稍后再试",Q("API Key重新加载失败","error")}},G=async()=>{try{c.value=null,k.value=!1,h.value=null;try{await Y(!0)}catch(s){console.warn("API Key加载失败，使用现有数据:",s),h.value="API Key数据加载失败"}await te()}catch(s){throw console.error("Refresh failed:",s),c.value=s,k.value=!0,s}};let F=null;Xt(async()=>{try{try{await Y()}catch(s){console.warn("API Key初始加载失败:",s),h.value="API Key数据加载失败，可能影响显示效果"}ft(),await rt(),it.value&&(F=setInterval(async()=>{try{await rt()}catch(s){console.warn("Auto refresh failed:",s),k.value=!0}},3e4))}catch(s){console.error("Initial load failed:",s),c.value=s}});const ht=s=>{s.target.closest(".relative")||(S.value=!1)},wt=()=>{k.value=!1,c.value&&yt()},_t=()=>{k.value=!0};return Xt(()=>{document.addEventListener("click",ht),window.addEventListener("online",wt),window.addEventListener("offline",_t),navigator.onLine||(k.value=!0)}),ye(()=>{F&&(clearInterval(F),F=null),document.removeEventListener("click",ht),window.removeEventListener("online",wt),window.removeEventListener("offline",_t)}),(s,t)=>{var n,v,_,D,A,Ct,Dt,At,Tt,Nt,Kt,It,$t,Lt,St,Ot,Pt,Rt,Et,jt,qt,Vt,Ut,Mt,Ft,zt,Bt,Jt,Wt,Qt;return i(),d("div",ve,[e("div",fe,[e("div",null,[t[26]||(t[26]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"请求日志",-1)),t[27]||(t[27]=e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"查看和管理 API 请求日志记录",-1)),k.value?(i(),d("div",be,t[25]||(t[25]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),x(" 连接异常，数据可能不是最新的 ",-1)]))):y("",!0)]),e("div",pe,[e("button",{"aria-label":l(K)?"正在刷新数据":"刷新日志数据",class:"btn btn-secondary",disabled:l(K),onClick:G},[e("i",{class:m(["fas fa-sync-alt mr-2",{"animate-spin":l(K)}])},null,2),x(" "+r(l(K)?"刷新中...":"刷新"),1)],8,ke),e("div",he,[e("button",{"aria-label":l(E)?"正在导出数据":"导出日志数据",class:"btn btn-primary",disabled:l(E)||(Array.isArray(l(R))?l(R).length:0)===0,onClick:t[0]||(t[0]=a=>S.value=!S.value)},[e("i",{class:m(["fas fa-download mr-2",{"animate-spin":l(E)}])},null,2),x(" "+r(l(E)?"导出中...":"导出"),1)],8,we),S.value?(i(),d("div",_e,[e("div",Ce,[e("button",{class:"block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",role:"menuitem",onClick:t[1]||(t[1]=a=>kt("json"))},t[28]||(t[28]=[e("i",{class:"fas fa-file-code mr-2"},null,-1),x(" 导出为 JSON ",-1)])),e("button",{class:"block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",role:"menuitem",onClick:t[2]||(t[2]=a=>kt("csv"))},t[29]||(t[29]=[e("i",{class:"fas fa-file-csv mr-2"},null,-1),x(" 导出为 CSV ",-1)]))])])):y("",!0)])])]),e("div",De,[e("div",Ae,[e("div",Te,[e("div",null,[t[30]||(t[30]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"总请求数",-1)),e("p",Ne,r(((n=l(L))==null?void 0:n.totalRequests)||((v=l(g))==null?void 0:v.total)||0),1)]),t[31]||(t[31]=e("i",{class:"fas fa-chart-line text-2xl text-blue-500"},null,-1))])]),e("div",Ke,[e("div",Ie,[e("div",null,[t[32]||(t[32]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"错误率",-1)),e("p",$e,r(de(((_=l(L))==null?void 0:_.errorRate)||0)),1)]),t[33]||(t[33]=e("i",{class:"fas fa-exclamation-triangle text-2xl text-red-500"},null,-1))])]),e("div",Le,[e("div",Se,[e("div",null,[t[34]||(t[34]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"平均响应时间",-1)),e("p",Oe,r(l(ee)(((D=l(L))==null?void 0:D.averageResponseTime)||0)),1)]),t[35]||(t[35]=e("i",{class:"fas fa-clock text-2xl text-green-500"},null,-1))])]),e("div",Pe,[e("div",Re,[e("div",null,[t[36]||(t[36]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"活跃 API Keys",-1)),e("p",Ee,r(((Ct=(A=l(L))==null?void 0:A.topApiKeys)==null?void 0:Ct.length)||0),1)]),t[37]||(t[37]=e("i",{class:"fas fa-key text-2xl text-purple-500"},null,-1))])])]),e("div",je,[e("div",qe,[e("div",Ve,[t[38]||(t[38]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"筛选条件",-1)),e("button",{"aria-label":O.value?"收起筛选面板":"展开筛选面板",class:"rounded-md bg-gray-100 px-2 py-1 text-xs text-gray-600 dark:bg-gray-700 dark:text-gray-300 md:hidden",onClick:t[3]||(t[3]=a=>O.value=!O.value)},[e("i",{class:m(["fas",O.value?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Ue)]),l(at)?(i(),d("button",{key:0,class:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:mt},t[39]||(t[39]=[e("i",{class:"fas fa-times mr-1"},null,-1),x(" 清除筛选 ",-1)]))):y("",!0)]),e("div",{class:m(["grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",{"hidden md:grid":!O.value}])},[e("div",Me,[t[42]||(t[42]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 搜索 ",-1)),e("div",Fe,[N(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l(o).search=a),"aria-describedby":l(o).search&&($.value||[]).length>0?"search-results-info":void 0,"aria-label":"搜索日志记录",class:"form-input w-full pr-8",placeholder:"API Key、IP、路径...",onInput:t[5]||(t[5]=(...a)=>l(xt)&&l(xt)(...a))},null,40,ze),[[H,l(o).search]]),e("div",Be,[j.value?(i(),d("div",Je)):l(o).search?(i(),d("button",{key:1,"aria-label":"清除搜索",class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:ne},t[40]||(t[40]=[e("i",{class:"fas fa-times text-sm"},null,-1)]))):(i(),d("i",We))])]),l(o).search&&!j.value?(i(),d("div",Qe,[l(o).search&&((Dt=$.value)==null?void 0:Dt.length)>0?(i(),d("span",Xe,"找到 "+r(((At=$.value)==null?void 0:At.length)||0)+" 条结果",1)):(i(),d("span",Ye,"未找到匹配结果")),t[41]||(t[41]=e("span",{class:"ml-2"},"💡 试试搜索IP地址或完整路径",-1))])):y("",!0)]),e("div",null,[t[46]||(t[46]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),e("div",Ge,[N(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>l(o).apiKeyId=a),class:"form-select w-full",disabled:l(X),onChange:w},[t[43]||(t[43]=e("option",{value:""},"全部",-1)),(i(!0),d(J,null,W(se.value,a=>(i(),d("option",{key:a.id,value:a.id},r(a.displayText),9,Ze))),128))],40,He),[[B,l(o).apiKeyId]]),l(X)?(i(),d("div",ts,t[44]||(t[44]=[e("div",{class:"loading-spinner h-4 w-4"},null,-1)]))):y("",!0)]),h.value?(i(),d("div",es,[t[45]||(t[45]=e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),x(" "+r(h.value)+" ",1),e("button",{class:"ml-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:ue}," 重试 ")])):y("",!0)]),e("div",null,[t[48]||(t[48]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态码 ",-1)),N(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>l(o).statusCode=a),class:"form-select w-full",onChange:w},t[47]||(t[47]=[Z('<option value="" data-v-02f94286>全部</option><option value="200" data-v-02f94286>200 (成功)</option><option value="400" data-v-02f94286>400 (请求错误)</option><option value="401" data-v-02f94286>401 (未授权)</option><option value="403" data-v-02f94286>403 (禁止访问)</option><option value="429" data-v-02f94286>429 (限流)</option><option value="500" data-v-02f94286>500 (服务器错误)</option>',7)]),544),[[B,l(o).statusCode]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 时间范围 ",-1)),N(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>b.value=a),class:"form-select w-full",onChange:ft},t[49]||(t[49]=[Z('<option value="1h" data-v-02f94286>最近 1 小时</option><option value="24h" data-v-02f94286>最近 24 小时</option><option value="7d" data-v-02f94286>最近 7 天</option><option value="30d" data-v-02f94286>最近 30 天</option><option value="custom" data-v-02f94286>自定义</option>',5)]),544),[[B,b.value]]),e("p",ss,r(ae.value),1)])],2),b.value==="custom"?(i(),d("div",as,[e("div",ls,[e("div",null,[t[51]||(t[51]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 开始时间 ",-1)),N(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>l(o).startDate=a),class:m(["form-input w-full",{"border-red-300 focus:border-red-500 focus:ring-red-500":p.value}]),placeholder:"选择开始时间",type:"datetime-local"},null,2),[[H,l(o).startDate]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 结束时间 ",-1)),N(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>l(o).endDate=a),class:m(["form-input w-full",{"border-red-300 focus:border-red-500 focus:ring-red-500":p.value}]),placeholder:"选择结束时间",type:"datetime-local"},null,2),[[H,l(o).endDate]])])]),p.value?(i(),d("div",rs,[t[53]||(t[53]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),x(" "+r(p.value),1)])):(i(),d("div",os,t[54]||(t[54]=[e("i",{class:"fas fa-info-circle mr-1"},null,-1),x(" 支持最长90天的时间范围查询。修改时间后将自动查询。 ",-1)])))])):y("",!0)]),c.value&&!l(K)?(i(),d("div",ns,[e("div",ds,[t[57]||(t[57]=e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-100 dark:bg-red-900"},[e("i",{class:"fas fa-exclamation-triangle text-2xl text-red-600 dark:text-red-400"})],-1)),t[58]||(t[58]=e("h3",{class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},"加载失败",-1)),e("p",is,r(oe(c.value)),1),e("div",us,[e("button",{class:"btn btn-primary",onClick:yt},t[55]||(t[55]=[e("i",{class:"fas fa-redo mr-2"},null,-1),x(" 重试 ",-1)])),e("button",{class:"btn btn-secondary",onClick:t[11]||(t[11]=a=>q.value=!0)},t[56]||(t[56]=[e("i",{class:"fas fa-info-circle mr-2"},null,-1),x(" 查看详情 ",-1)]))])])])):(i(),d("div",xs,[e("div",ms,[e("div",ys,[e("span",cs,r(re()),1),it.value?(i(),d("div",gs,t[59]||(t[59]=[e("div",{class:"mr-1 h-2 w-2 animate-pulse rounded-full bg-green-500"},null,-1),x(" 实时更新 ",-1)]))):y("",!0)]),e("div",vs,[e("div",fs,[e("button",{class:m(["rounded px-2 py-1 text-xs font-medium transition-colors",P.value==="table"?"bg-white text-blue-600 shadow-sm dark:bg-gray-700 dark:text-blue-400":"text-gray-600 dark:text-gray-400"]),onClick:t[12]||(t[12]=a=>P.value="table")},t[60]||(t[60]=[e("i",{class:"fas fa-table mr-1"},null,-1),x(" 表格 ",-1)]),2),e("button",{class:m(["rounded px-2 py-1 text-xs font-medium transition-colors",P.value==="cards"?"bg-white text-blue-600 shadow-sm dark:bg-gray-700 dark:text-blue-400":"text-gray-600 dark:text-gray-400"]),onClick:t[13]||(t[13]=a=>P.value="cards")},t[61]||(t[61]=[e("i",{class:"fas fa-th-large mr-1"},null,-1),x(" 卡片 ",-1)]),2)]),N(e("select",{"onUpdate:modelValue":t[14]||(t[14]=a=>l(o).limit=a),"aria-label":"每页显示条数",class:"form-select text-sm",onChange:w},t[62]||(t[62]=[e("option",{value:"25"},"25 条/页",-1),e("option",{value:"50"},"50 条/页",-1),e("option",{value:"100"},"100 条/页",-1)]),544),[[B,l(o).limit]])])]),l(K)?(i(),d("div",bs,[e("div",ps,[(i(),d(J,null,W(5,a=>e("div",{key:a,class:"animate-pulse"},t[63]||(t[63]=[Z('<div class="flex items-center space-x-4" data-v-02f94286><div class="h-4 w-20 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div><div class="h-4 w-16 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div><div class="h-4 w-12 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div><div class="h-4 flex-1 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div><div class="h-4 w-16 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div><div class="h-4 w-12 rounded bg-gray-200 dark:bg-gray-700" data-v-02f94286></div></div>',1)]))),64)),t[64]||(t[64]=e("div",{class:"mt-4 text-center"},[e("div",{class:"inline-flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400"},[e("div",{class:"loading-spinner"}),e("span",null,"正在加载日志数据...")])],-1))])])):V.value.length===0?(i(),d("div",ks,[t[67]||(t[67]=e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800"},[e("i",{class:"fas fa-inbox text-2xl text-gray-400"})],-1)),e("h3",hs,r(l(o).search?"未找到匹配的日志":"暂无日志记录"),1),e("div",ws,[l(o).search?(i(),d("p",_s,'未找到包含 "'+r(l(o).search)+'" 的日志记录',1)):(i(),d("p",Cs,"当前时间范围内没有日志记录")),e("div",Ds,[l(at)?(i(),d("button",{key:0,class:"btn btn-primary",onClick:mt},t[65]||(t[65]=[e("i",{class:"fas fa-filter mr-2"},null,-1),x(" 清除所有筛选 ",-1)]))):y("",!0),e("button",{class:"btn btn-secondary",onClick:G},t[66]||(t[66]=[e("i",{class:"fas fa-sync-alt mr-2"},null,-1),x(" 刷新数据 ",-1)]))])])])):P.value==="table"?(i(),d("div",As,[e("table",Ts,[e("thead",Ns,[e("tr",null,[e("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:t[15]||(t[15]=a=>U("timestamp"))},[e("div",Ks,[t[68]||(t[68]=e("span",null,"时间",-1)),e("i",{class:m(["fas fa-sort text-gray-400",M("timestamp")])},null,2)])]),t[72]||(t[72]=e("th",{class:"table-header",role:"columnheader"},"API Key",-1)),e("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:t[16]||(t[16]=a=>U("request.method"))},[e("div",Is,[t[69]||(t[69]=e("span",null,"方法",-1)),e("i",{class:m(["fas fa-sort text-gray-400",M("request.method")])},null,2)])]),t[73]||(t[73]=e("th",{class:"table-header",role:"columnheader"},"路径",-1)),e("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:t[17]||(t[17]=a=>U("response.statusCode"))},[e("div",$s,[t[70]||(t[70]=e("span",null,"状态码",-1)),e("i",{class:m(["fas fa-sort text-gray-400",M("response.statusCode")])},null,2)])]),e("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:t[18]||(t[18]=a=>U("response.duration"))},[e("div",Ls,[t[71]||(t[71]=e("span",null,"响应时间",-1)),e("i",{class:m(["fas fa-sort text-gray-400",M("response.duration")])},null,2)])]),t[74]||(t[74]=e("th",{class:"table-header",role:"columnheader"},"IP 地址",-1)),t[75]||(t[75]=e("th",{class:"table-header",role:"columnheader"},"操作",-1))])]),e("tbody",Ss,[(i(!0),d(J,null,W(V.value,a=>(i(),d("tr",{key:a.logId||a.timestamp,class:m(["transition-colors hover:bg-gray-50 dark:hover:bg-gray-800",{"animate-pulse bg-green-50 dark:bg-green-900/20":a._isNew}])},[e("td",Os,[e("div",Ps,r(new Date(a.timestamp).toLocaleString("zh-CN")),1)]),e("td",Rs,[e("div",Es,[t[76]||(t[76]=e("div",{"aria-label":"API Key 活跃",class:"h-2 w-2 rounded-full bg-green-500"},null,-1)),e("span",{class:m(["text-sm font-medium",a.formattedKeyName&&a.formattedKeyName.includes("(已删除)")?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"])},r(a.formattedKeyName),3)])]),e("td",js,[e("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(dt)(a.method)])},r(a.method||"N/A"),3)]),e("td",qs,[e("span",{class:"max-w-32 truncate text-sm text-gray-900 dark:text-gray-100",title:a.path},r(a.path||"/"),9,Vs)]),e("td",Us,[e("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(nt)(a.statusCode)])},r(a.statusCode||"N/A"),3)]),e("td",Ms,[e("div",Fs,[e("span",zs,r(a.responseTime?`${a.responseTime}ms`:"N/A"),1),parseInt(a.responseTime)>5e3?(i(),d("i",Bs)):y("",!0)])]),e("td",Js,[e("span",Ws,r(a.ipAddress||"N/A"),1)]),e("td",Qs,[e("button",{"aria-label":`查看日志详情: ${a.formattedKeyName||"Unknown"} ${a.method} ${a.path}`,class:"rounded p-1 text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-300",onClick:T=>pt(a)},t[77]||(t[77]=[e("i",{class:"fas fa-eye"},null,-1)]),8,Xs)])],2))),128))])])])):(i(),d("div",Ys,[(i(!0),d(J,null,W(V.value,a=>(i(),d("div",{key:a.logId||a.timestamp,class:m(["p-4 transition-colors hover:bg-gray-50 dark:hover:bg-gray-800",{"animate-pulse bg-green-50 dark:bg-green-900/20":a._isNew}])},[e("div",Gs,[e("div",Hs,[e("div",Zs,[e("div",ta,[e("span",ea,r(new Date(a.timestamp).toLocaleString("zh-CN").split(" ")[1]),1),e("div",sa,[t[78]||(t[78]=e("div",{class:"h-2 w-2 rounded-full bg-green-500"},null,-1)),e("span",{class:m(["text-sm",a.formattedKeyName&&a.formattedKeyName.includes("(已删除)")?"text-gray-500 dark:text-gray-400":"text-gray-600 dark:text-gray-400"])},r(a.formattedKeyName),3)])]),e("button",{"aria-label":"查看详情",class:"rounded p-2 text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-300",onClick:T=>pt(a)},t[79]||(t[79]=[e("i",{class:"fas fa-eye"},null,-1)]),8,aa)]),e("div",la,[e("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(dt)(a.method)])},r(a.method||"N/A"),3),e("span",ra,r(a.path||"/"),1)]),e("div",oa,[e("div",na,[e("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(nt)(a.statusCode)])},r(a.statusCode||"N/A"),3),e("span",da," ⏱️ "+r(a.responseTime?`${a.responseTime}ms`:"N/A"),1)]),e("span",ia," 🌐 "+r(a.ipAddress||"N/A"),1)])])])],2))),128))])),(((Tt=l(g))==null?void 0:Tt.totalPages)||0)>1?(i(),d("div",ua,[e("div",xa,[e("button",{class:"btn btn-secondary btn-sm",disabled:(((Nt=l(g))==null?void 0:Nt.page)||1)<=1,onClick:t[19]||(t[19]=a=>{var T;return bt((((T=l(g))==null?void 0:T.page)||1)-1)})},t[80]||(t[80]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),8,ma),e("span",ya," 第 "+r(((Kt=l(g))==null?void 0:Kt.page)||1)+" 页，共 "+r(((It=l(g))==null?void 0:It.totalPages)||1)+" 页 ",1),e("button",{class:"btn btn-secondary btn-sm",disabled:((($t=l(g))==null?void 0:$t.page)||1)>=(((Lt=l(g))==null?void 0:Lt.totalPages)||1),onClick:t[20]||(t[20]=a=>{var T;return bt((((T=l(g))==null?void 0:T.page)||1)+1)})},t[81]||(t[81]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),8,ca)])])):y("",!0)])),u.value?(i(),d("div",{key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:t[22]||(t[22]=Yt(a=>u.value=null,["self"]))},[e("div",ga,[e("div",va,[t[83]||(t[83]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"日志详情",-1)),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:t[21]||(t[21]=a=>u.value=null)},t[82]||(t[82]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",fa,[e("div",ba,[e("div",null,[t[90]||(t[90]=e("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"基本信息",-1)),e("div",pa,[e("div",null,[t[84]||(t[84]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"时间",-1)),e("p",ka,r(l(ot)(u.value).timestamp),1)]),e("div",null,[t[85]||(t[85]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"API Key",-1)),e("p",{class:m(["mt-1 text-sm",(u.value.formattedKeyName||I(u.value.keyId)||(St=u.value.apiKey)!=null&&St.name||!0)&&(u.value.formattedKeyName||I(u.value.keyId)||((Ot=u.value.apiKey)==null?void 0:Ot.name)||"Unknown").includes("(已删除)")?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"])},r(u.value.formattedKeyName||I(u.value.keyId)||((Pt=u.value.apiKey)==null?void 0:Pt.name)||"Unknown"),3)]),e("div",null,[t[86]||(t[86]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求方法",-1)),e("p",ha,r(((Rt=u.value.request)==null?void 0:Rt.method)||"N/A"),1)]),e("div",null,[t[87]||(t[87]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"状态码",-1)),e("p",wa,r(((Et=u.value.response)==null?void 0:Et.statusCode)||"N/A"),1)]),e("div",null,[t[88]||(t[88]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应时间",-1)),e("p",_a,r(l(ot)(u.value).duration),1)]),e("div",null,[t[89]||(t[89]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"IP 地址",-1)),e("p",Ca,r(((jt=u.value.request)==null?void 0:jt.ip)||"N/A"),1)])])]),e("div",null,[t[95]||(t[95]=e("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"请求信息",-1)),e("div",Da,[e("div",null,[t[91]||(t[91]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求路径",-1)),e("p",Aa,r(((qt=u.value.request)==null?void 0:qt.path)||"/"),1)]),e("div",null,[t[92]||(t[92]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"User Agent",-1)),e("p",Ta,r(((Vt=u.value.request)==null?void 0:Vt.userAgent)||"N/A"),1)]),(Ut=u.value.request)!=null&&Ut.headers?(i(),d("div",Na,[t[93]||(t[93]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求头",-1)),e("pre",Ka,r(JSON.stringify(u.value.request.headers,null,2)),1)])):y("",!0),(Mt=u.value.request)!=null&&Mt.body?(i(),d("div",Ia,[t[94]||(t[94]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求体",-1)),e("pre",$a,r(JSON.stringify(u.value.request.body,null,2)),1)])):y("",!0)])]),u.value.response?(i(),d("div",La,[t[98]||(t[98]=e("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"响应信息",-1)),e("div",Sa,[u.value.response.headers?(i(),d("div",Oa,[t[96]||(t[96]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应头",-1)),e("pre",Pa,r(JSON.stringify(u.value.response.headers,null,2)),1)])):y("",!0),u.value.response.body?(i(),d("div",Ra,[t[97]||(t[97]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应体",-1)),e("pre",Ea,r(JSON.stringify(u.value.response.body,null,2)),1)])):y("",!0)])])):y("",!0),u.value.usage?(i(),d("div",ja,[t[103]||(t[103]=e("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"使用统计",-1)),e("div",qa,[e("div",null,[t[99]||(t[99]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"输入 Tokens",-1)),e("p",Va,r(u.value.usage.inputTokens||0),1)]),e("div",null,[t[100]||(t[100]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"输出 Tokens",-1)),e("p",Ua,r(u.value.usage.outputTokens||0),1)]),e("div",null,[t[101]||(t[101]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"总 Tokens",-1)),e("p",Ma,r(u.value.usage.totalTokens||0),1)]),e("div",null,[t[102]||(t[102]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"模型",-1)),e("p",Fa,r(u.value.usage.model||"N/A"),1)])])])):y("",!0)])])])])):y("",!0),q.value?(i(),d("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:t[24]||(t[24]=Yt(a=>q.value=!1,["self"]))},[e("div",za,[e("div",Ba,[t[105]||(t[105]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"错误详情",-1)),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:t[23]||(t[23]=a=>q.value=!1)},t[104]||(t[104]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",Ja,[e("div",Wa,[e("div",null,[t[106]||(t[106]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"错误类型",-1)),e("p",Qa,r(((Ft=c.value)==null?void 0:Ft.code)||"未知错误"),1)]),e("div",null,[t[107]||(t[107]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"错误信息",-1)),e("p",Xa,r(((zt=c.value)==null?void 0:zt.message)||"无详细信息"),1)]),(Bt=c.value)!=null&&Bt.status?(i(),d("div",Ya,[t[108]||(t[108]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"状态码",-1)),e("p",Ga,r(c.value.status),1)])):y("",!0),e("div",null,[t[109]||(t[109]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"重试次数",-1)),e("p",Ha,r(ut.value),1)]),e("div",null,[t[114]||(t[114]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"建议操作",-1)),e("div",Za,[((Jt=c.value)==null?void 0:Jt.code)==="NETWORK_ERROR"?(i(),d("p",tl,t[110]||(t[110]=[x(" • 检查网络连接是否正常",-1),e("br",null,null,-1),x(" • 检查VPN或代理设置",-1),e("br",null,null,-1),x(" • 尝试刷新页面 ",-1)]))):((Wt=c.value)==null?void 0:Wt.status)===401?(i(),d("p",el,t[111]||(t[111]=[x(" • 重新登录系统",-1),e("br",null,null,-1),x(" • 检查登录凭据是否过期 ",-1)]))):((Qt=c.value)==null?void 0:Qt.status)>=500?(i(),d("p",sl,t[112]||(t[112]=[x(" • 稍后再试",-1),e("br",null,null,-1),x(" • 如问题持续，请联系技术支持 ",-1)]))):(i(),d("p",al,t[113]||(t[113]=[x(" • 检查网络连接",-1),e("br",null,null,-1),x(" • 刷新页面后重试 ",-1)])))])])])])])])):y("",!0)])}}},ml=ge(ll,[["__scopeId","data-v-02f94286"]]);export{ml as default};
