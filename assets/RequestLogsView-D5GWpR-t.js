import{r as v,c as rt,o as le,q as zt,V as re,x as o,z as t,L as y,O as x,u as l,C as m,P as r,K as T,aq as ot,aW as tt,Q as et,ac as st,aX as nt,Y as Bt,y as n}from"./vue-vendor-Ig-GgGwA.js";import{u as oe}from"./requestLogs-BoCMn3Ym.js";import{s as Jt}from"./toast-BvwA7Mwb.js";import{_ as ne}from"./index-Dk-v_r93.js";import"./element-plus-Bq6mBxnk.js";import"./vendor-BDiMbLwQ.js";const de={class:"request-logs-container"},ie={class:"mb-6 flex items-center justify-between"},ue={key:0,class:"mt-2 flex items-center text-sm text-red-600 dark:text-red-400"},xe={class:"flex items-center space-x-3"},me=["aria-label","disabled"],ye={class:"relative"},ce=["aria-label","disabled"],ge={key:0,"aria-label":"导出格式选择",class:"absolute right-0 top-full z-50 mt-2 w-48 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-gray-800",role:"menu"},ve={class:"py-1"},fe={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},be={class:"stat-card"},pe={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},he={class:"stat-card"},we={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-red-600 dark:text-red-400"},Ce={class:"stat-card"},De={class:"flex items-center justify-between"},Te={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Ae={class:"stat-card"},qe={class:"flex items-center justify-between"},Le={class:"text-2xl font-bold text-purple-600 dark:text-purple-400"},Se={class:"card mb-6 p-4"},Ie={class:"mb-4 flex items-center justify-between"},$e={class:"flex items-center space-x-2"},Oe=["aria-label"],Ne={class:"relative"},Re={class:"relative"},je=["aria-describedby"],Ee={class:"absolute right-2 top-1/2 -translate-y-1/2"},Ke={key:0,class:"loading-spinner h-4 w-4"},Pe={key:2,class:"fas fa-search text-sm text-gray-400"},Ve={key:0,id:"search-results-info",class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ue={key:0},Me={key:1},Fe=["value"],ze={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Be={key:0,class:"mt-4"},Je={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},We={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},Qe={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Xe={key:0,class:"card mb-6 p-6"},Ye={class:"text-center"},Ge={class:"mb-4 text-sm text-gray-600 dark:text-gray-400"},He={class:"flex flex-col items-center space-y-2 sm:flex-row sm:justify-center sm:space-x-4 sm:space-y-0"},Ze={key:1,class:"card"},ts={class:"flex flex-col space-y-3 border-b border-gray-200 p-4 dark:border-gray-700 sm:flex-row sm:items-center sm:justify-between sm:space-y-0"},es={class:"flex items-center space-x-4"},ss={class:"text-sm text-gray-600 dark:text-gray-400"},as={key:0,class:"flex items-center text-xs text-green-600 dark:text-green-400"},ls={class:"flex items-center space-x-2"},rs={class:"hidden items-center space-x-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-800 sm:flex"},os={key:0,class:"p-8"},ns={class:"space-y-3"},ds={key:1,class:"py-12 text-center"},is={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},us={class:"space-y-2 text-sm text-gray-600 dark:text-gray-400"},xs={key:0},ms={key:1},ys={class:"mt-4 flex flex-col items-center space-y-2 sm:flex-row sm:justify-center sm:space-x-4 sm:space-y-0"},cs={key:2,class:"hidden overflow-x-auto md:block"},gs={"aria-label":"请求日志列表",class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",role:"table"},vs={class:"bg-gray-50 dark:bg-gray-800"},fs={class:"flex items-center space-x-1"},bs={class:"flex items-center space-x-1"},ps={class:"flex items-center space-x-1"},ks={class:"flex items-center space-x-1"},hs={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},ws={class:"table-cell"},_s={class:"text-sm text-gray-900 dark:text-gray-100"},Cs={class:"table-cell"},Ds={class:"flex items-center space-x-2"},Ts=["aria-label"],As={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},qs={class:"table-cell"},Ls={class:"table-cell"},Ss=["title"],Is={class:"table-cell"},$s={class:"table-cell"},Os={class:"flex items-center space-x-1"},Ns={class:"text-sm text-gray-900 dark:text-gray-100"},Rs={key:0,class:"fas fa-exclamation-triangle text-xs text-yellow-500",title:"响应时间较慢"},js={class:"table-cell"},Es={class:"text-sm text-gray-600 dark:text-gray-400"},Ks={class:"table-cell"},Ps=["aria-label","onClick"],Vs={key:3,class:"divide-y divide-gray-200 dark:divide-gray-700 md:hidden"},Us={class:"flex items-start justify-between"},Ms={class:"flex-1 space-y-2"},Fs={class:"flex items-center justify-between"},zs={class:"flex items-center space-x-3"},Bs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Js={class:"flex items-center space-x-1"},Ws={class:"text-sm text-gray-600 dark:text-gray-400"},Qs=["onClick"],Xs={class:"flex items-center space-x-2"},Ys={class:"truncate text-sm text-gray-900 dark:text-gray-100"},Gs={class:"flex items-center justify-between text-sm"},Hs={class:"flex items-center space-x-3"},Zs={class:"text-gray-600 dark:text-gray-400"},ta={class:"text-gray-500 dark:text-gray-500"},ea={key:4,class:"flex items-center justify-between border-t border-gray-200 px-4 py-3 dark:border-gray-700"},sa={class:"flex items-center space-x-2"},aa=["disabled"],la={class:"text-sm text-gray-600 dark:text-gray-400"},ra=["disabled"],oa={class:"max-h-[90vh] w-full max-w-4xl overflow-hidden rounded-lg bg-white shadow-xl dark:bg-gray-800"},na={class:"flex items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-gray-700"},da={class:"max-h-[calc(90vh-120px)] overflow-y-auto p-6"},ia={class:"space-y-6"},ua={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},xa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ma={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ya={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ca={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ga={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},va={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},fa={class:"space-y-4"},ba={class:"mt-1 rounded bg-gray-100 p-2 text-sm text-gray-900 dark:bg-gray-700 dark:text-gray-100"},pa={class:"mt-1 rounded bg-gray-100 p-2 text-sm text-gray-900 dark:bg-gray-700 dark:text-gray-100"},ka={key:0},ha={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},wa={key:1},_a={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Ca={key:0},Da={class:"space-y-4"},Ta={key:0},Aa={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},qa={key:1},La={class:"mt-1 max-h-40 overflow-y-auto rounded bg-gray-100 p-2 text-xs text-gray-900 dark:bg-gray-700 dark:text-gray-100"},Sa={key:1},Ia={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},$a={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Oa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Na={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ra={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},ja={class:"max-h-[90vh] w-full max-w-2xl overflow-hidden rounded-lg bg-white shadow-xl dark:bg-gray-800"},Ea={class:"flex items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-gray-700"},Ka={class:"max-h-[calc(90vh-120px)] overflow-y-auto p-6"},Pa={class:"space-y-4"},Va={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ua={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ma={key:0},Fa={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},za={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ba={class:"mt-1 space-y-2 text-sm text-gray-600 dark:text-gray-400"},Ja={key:0},Wa={key:1},Qa={key:2},Xa={key:3},Ya={__name:"RequestLogsView",setup(Ga){const dt=(a,e)=>{let i;return(...g)=>{clearTimeout(i),i=setTimeout(()=>a.apply(this,g),e)}},it=oe(),S=v(!1),u=v(null),f=v("24h"),b=v(""),c=v(null),p=v(!1),J=v(!1),I=v(!1),$=v("table"),ut=v(!1),W=v(!1),xt=v(0),{logs:Q,loading:A,exporting:X,stats:O,filters:d,pagination:k,filteredLogs:mt,hasFilters:yt}=it,{fetchLogs:ct,fetchStats:gt,exportLogs:Wt,updateFilters:_,clearFilters:Qt,refreshLogs:Xt,formatLogEntry:q,getStatusClass:vt,getMethodClass:ft,formatDuration:Yt}=it,L=rt(()=>{const a=Array.isArray(Q.value)?Q.value:[];if(!d.search)return a;const e=String(d.search||"").toLowerCase();return e?a.filter(i=>{var g,w,C,D,N,R,j,E;return((w=(g=i==null?void 0:i.apiKey)==null?void 0:g.name)==null?void 0:w.toLowerCase().includes(e))||((D=(C=i==null?void 0:i.request)==null?void 0:C.userAgent)==null?void 0:D.toLowerCase().includes(e))||((R=(N=i==null?void 0:i.request)==null?void 0:N.ip)==null?void 0:R.includes(e))||((E=(j=i==null?void 0:i.request)==null?void 0:j.path)==null?void 0:E.toLowerCase().includes(e))}):a}),Y=rt(()=>d.search?L.value:Array.isArray(mt.value)?mt.value:[]),bt=dt(async()=>{J.value=!0;try{await h()}finally{J.value=!1}},500),Gt=rt(()=>f.value!=="custom"?{"1h":"最近 1 小时","24h":"最近 24 小时","7d":"最近 7 天","30d":"最近 30 天"}[f.value]||"":d.startDate&&d.endDate?`${d.startDate} 至 ${d.endDate}`:"请设置时间范围");le(()=>[d.startDate,d.endDate],([a,e])=>{f.value==="custom"&&a&&e&&(b.value="",Ht())});const Ht=dt(async()=>{f.value==="custom"&&await ht()},1e3),Zt=()=>{const a=k.total,e=Y.value.length;return d.search?`找到 ${L.value?L.value.length:0} 条匹配结果，共 ${a} 条记录`:`显示 ${e} 条记录，共 ${a} 条`},te=a=>a?a.code==="NETWORK_ERROR"?"网络连接失败，请检查网络连接后重试":a.code==="TIMEOUT"?"请求超时，服务器响应缓慢":a.status===401?"认证失败，请重新登录":a.status===403?"没有权限访问此资源":a.status>=500?"服务器内部错误，请稍后重试或联系技术支持":a.message||"请求失败，请重试":"未知错误",ee=()=>{_({search:""}),h()},pt=()=>{Qt(),h()},kt=async()=>{c.value=null,p.value=!1,xt.value++;try{await at(),Jt("数据加载成功","success")}catch(a){c.value=a,Jt("重试失败，请检查网络连接","error")}},se=a=>`${(a*100).toFixed(1)}%`,h=async()=>{try{c.value=null,p.value=!1,f.value==="custom"?await ht():await ct()}catch(a){console.error("Apply filters failed:",a),c.value=a,p.value=!0}},ht=async()=>{const a=d.startDate,e=d.endDate;if(!a||!e){b.value="请设置完整的时间范围";return}const i=new Date(a),g=new Date(e);if(i>=g){b.value="结束时间必须大于开始时间";return}if((g-i)/(1e3*60*60*24)>90){b.value="时间范围不能超过90天";return}b.value="",await wt(i.toISOString(),g.toISOString())},wt=async(a,e)=>{const i=d.startDate,g=d.endDate;_({startDate:a,endDate:e}),await ct(),f.value!=="custom"&&_({startDate:i,endDate:g})},ae=(a,e)=>{const i=new Date(e);switch(a){case"1h":return new Date(i.getTime()-60*60*1e3);case"24h":return new Date(i.getTime()-24*60*60*1e3);case"7d":return new Date(i.getTime()-7*24*60*60*1e3);case"30d":return new Date(i.getTime()-30*24*60*60*1e3);default:return new Date(i.getTime()-24*60*60*1e3)}},_t=a=>{const e=new Date(a);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().slice(0,16)},Ct=()=>{if(b.value="",f.value!=="custom")try{const a=new Date,e=ae(f.value,a),i=a,g=e.toISOString(),w=i.toISOString(),C=_t(e),D=_t(i);_({startDate:C,endDate:D}),wt(g,w)}catch(a){console.error("时间范围设置错误:",a),b.value=a.message}},G=a=>{const e=d.sortBy,i=d.sortOrder;_(e===a?{sortOrder:i==="asc"?"desc":"asc"}:{sortBy:a,sortOrder:"desc"}),h()},H=a=>d.sortBy!==a?"fa-sort":d.sortOrder==="asc"?"fa-sort-up":"fa-sort-down",Dt=a=>{a>=1&&a<=k.totalPages&&(_({page:a}),h())},Tt=a=>{u.value=a},At=async a=>{S.value=!1,await Wt(a)},at=async()=>{try{c.value=null,p.value=!1,await Xt()}catch(a){throw console.error("Refresh failed:",a),c.value=a,p.value=!0,a}};let Z=null;zt(async()=>{try{Ct(),await gt(),ut.value&&(Z=setInterval(async()=>{try{await gt()}catch(a){console.warn("Auto refresh failed:",a),p.value=!0}},3e4))}catch(a){console.error("Initial load failed:",a),c.value=a}});const qt=a=>{a.target.closest(".relative")||(S.value=!1)},Lt=()=>{p.value=!1,c.value&&kt()},St=()=>{p.value=!0};return zt(()=>{document.addEventListener("click",qt),window.addEventListener("online",Lt),window.addEventListener("offline",St),navigator.onLine||(p.value=!0)}),re(()=>{Z&&(clearInterval(Z),Z=null),document.removeEventListener("click",qt),window.removeEventListener("online",Lt),window.removeEventListener("offline",St)}),(a,e)=>{var i,g,w,C,D,N,R,j,E,It,$t,Ot,Nt,Rt,jt,Et,Kt;return n(),o("div",de,[t("div",ie,[t("div",null,[e[26]||(e[26]=t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"请求日志",-1)),e[27]||(e[27]=t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"查看和管理 API 请求日志记录",-1)),p.value?(n(),o("div",ue,e[25]||(e[25]=[t("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),x(" 连接异常，数据可能不是最新的 ",-1)]))):y("",!0)]),t("div",xe,[t("button",{"aria-label":l(A)?"正在刷新数据":"刷新日志数据",class:"btn btn-secondary",disabled:l(A),onClick:at},[t("i",{class:m(["fas fa-sync-alt mr-2",{"animate-spin":l(A)}])},null,2),x(" "+r(l(A)?"刷新中...":"刷新"),1)],8,me),t("div",ye,[t("button",{"aria-label":l(X)?"正在导出数据":"导出日志数据",class:"btn btn-primary",disabled:l(X)||(Array.isArray(l(Q))?l(Q).length:0)===0,onClick:e[0]||(e[0]=s=>S.value=!S.value)},[t("i",{class:m(["fas fa-download mr-2",{"animate-spin":l(X)}])},null,2),x(" "+r(l(X)?"导出中...":"导出"),1)],8,ce),S.value?(n(),o("div",ge,[t("div",ve,[t("button",{class:"block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",role:"menuitem",onClick:e[1]||(e[1]=s=>At("json"))},e[28]||(e[28]=[t("i",{class:"fas fa-file-code mr-2"},null,-1),x(" 导出为 JSON ",-1)])),t("button",{class:"block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",role:"menuitem",onClick:e[2]||(e[2]=s=>At("csv"))},e[29]||(e[29]=[t("i",{class:"fas fa-file-csv mr-2"},null,-1),x(" 导出为 CSV ",-1)]))])])):y("",!0)])])]),t("div",fe,[t("div",be,[t("div",pe,[t("div",null,[e[30]||(e[30]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"总请求数",-1)),t("p",ke,r(l(O).totalRequests||0),1)]),e[31]||(e[31]=t("i",{class:"fas fa-chart-line text-2xl text-blue-500"},null,-1))])]),t("div",he,[t("div",we,[t("div",null,[e[32]||(e[32]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"错误率",-1)),t("p",_e,r(se(l(O).errorRate||0)),1)]),e[33]||(e[33]=t("i",{class:"fas fa-exclamation-triangle text-2xl text-red-500"},null,-1))])]),t("div",Ce,[t("div",De,[t("div",null,[e[34]||(e[34]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"平均响应时间",-1)),t("p",Te,r(l(Yt)(l(O).averageResponseTime||0)),1)]),e[35]||(e[35]=t("i",{class:"fas fa-clock text-2xl text-green-500"},null,-1))])]),t("div",Ae,[t("div",qe,[t("div",null,[e[36]||(e[36]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"活跃 API Keys",-1)),t("p",Le,r(((i=l(O).topApiKeys)==null?void 0:i.length)||0),1)]),e[37]||(e[37]=t("i",{class:"fas fa-key text-2xl text-purple-500"},null,-1))])])]),t("div",Se,[t("div",Ie,[t("div",$e,[e[38]||(e[38]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"筛选条件",-1)),t("button",{"aria-label":I.value?"收起筛选面板":"展开筛选面板",class:"rounded-md bg-gray-100 px-2 py-1 text-xs text-gray-600 dark:bg-gray-700 dark:text-gray-300 md:hidden",onClick:e[3]||(e[3]=s=>I.value=!I.value)},[t("i",{class:m(["fas",I.value?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Oe)]),l(yt)?(n(),o("button",{key:0,class:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:pt},e[39]||(e[39]=[t("i",{class:"fas fa-times mr-1"},null,-1),x(" 清除筛选 ",-1)]))):y("",!0)]),t("div",{class:m(["grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",{"hidden md:grid":!I.value}])},[t("div",Ne,[e[42]||(e[42]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 搜索 ",-1)),t("div",Re,[T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l(d).search=s),"aria-describedby":l(d).search&&(L.value||[]).length>0?"search-results-info":void 0,"aria-label":"搜索日志记录",class:"form-input w-full pr-8",placeholder:"API Key、IP、路径...",onInput:e[5]||(e[5]=(...s)=>l(bt)&&l(bt)(...s))},null,40,je),[[ot,l(d).search]]),t("div",Ee,[J.value?(n(),o("div",Ke)):l(d).search?(n(),o("button",{key:1,"aria-label":"清除搜索",class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:ee},e[40]||(e[40]=[t("i",{class:"fas fa-times text-sm"},null,-1)]))):(n(),o("i",Pe))])]),l(d).search&&!J.value?(n(),o("div",Ve,[l(d).search&&((g=L.value)==null?void 0:g.length)>0?(n(),o("span",Ue,"找到 "+r(((w=L.value)==null?void 0:w.length)||0)+" 条结果",1)):(n(),o("span",Me,"未找到匹配结果")),e[41]||(e[41]=t("span",{class:"ml-2"},"💡 试试搜索IP地址或完整路径",-1))])):y("",!0)]),t("div",null,[e[44]||(e[44]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),T(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>l(d).apiKeyId=s),class:"form-select w-full",onChange:h},[e[43]||(e[43]=t("option",{value:""},"全部",-1)),(n(!0),o(et,null,st(l(O).topApiKeys,s=>(n(),o("option",{key:s.id,value:s.id},r(s.name),9,Fe))),128))],544),[[tt,l(d).apiKeyId]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态码 ",-1)),T(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l(d).statusCode=s),class:"form-select w-full",onChange:h},e[45]||(e[45]=[nt('<option value="" data-v-60500cf0>全部</option><option value="200" data-v-60500cf0>200 (成功)</option><option value="400" data-v-60500cf0>400 (请求错误)</option><option value="401" data-v-60500cf0>401 (未授权)</option><option value="403" data-v-60500cf0>403 (禁止访问)</option><option value="429" data-v-60500cf0>429 (限流)</option><option value="500" data-v-60500cf0>500 (服务器错误)</option>',7)]),544),[[tt,l(d).statusCode]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 时间范围 ",-1)),T(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),class:"form-select w-full",onChange:Ct},e[47]||(e[47]=[nt('<option value="1h" data-v-60500cf0>最近 1 小时</option><option value="24h" data-v-60500cf0>最近 24 小时</option><option value="7d" data-v-60500cf0>最近 7 天</option><option value="30d" data-v-60500cf0>最近 30 天</option><option value="custom" data-v-60500cf0>自定义</option>',5)]),544),[[tt,f.value]]),t("p",ze,r(Gt.value),1)])],2),f.value==="custom"?(n(),o("div",Be,[t("div",Je,[t("div",null,[e[49]||(e[49]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 开始时间 ",-1)),T(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l(d).startDate=s),class:m(["form-input w-full",{"border-red-300 focus:border-red-500 focus:ring-red-500":b.value}]),placeholder:"选择开始时间",type:"datetime-local"},null,2),[[ot,l(d).startDate]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 结束时间 ",-1)),T(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l(d).endDate=s),class:m(["form-input w-full",{"border-red-300 focus:border-red-500 focus:ring-red-500":b.value}]),placeholder:"选择结束时间",type:"datetime-local"},null,2),[[ot,l(d).endDate]])])]),b.value?(n(),o("div",We,[e[51]||(e[51]=t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),x(" "+r(b.value),1)])):(n(),o("div",Qe,e[52]||(e[52]=[t("i",{class:"fas fa-info-circle mr-1"},null,-1),x(" 支持最长90天的时间范围查询。修改时间后将自动查询。 ",-1)])))])):y("",!0)]),c.value&&!l(A)?(n(),o("div",Xe,[t("div",Ye,[e[55]||(e[55]=t("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-100 dark:bg-red-900"},[t("i",{class:"fas fa-exclamation-triangle text-2xl text-red-600 dark:text-red-400"})],-1)),e[56]||(e[56]=t("h3",{class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},"加载失败",-1)),t("p",Ge,r(te(c.value)),1),t("div",He,[t("button",{class:"btn btn-primary",onClick:kt},e[53]||(e[53]=[t("i",{class:"fas fa-redo mr-2"},null,-1),x(" 重试 ",-1)])),t("button",{class:"btn btn-secondary",onClick:e[11]||(e[11]=s=>W.value=!0)},e[54]||(e[54]=[t("i",{class:"fas fa-info-circle mr-2"},null,-1),x(" 查看详情 ",-1)]))])])])):(n(),o("div",Ze,[t("div",ts,[t("div",es,[t("span",ss,r(Zt()),1),ut.value?(n(),o("div",as,e[57]||(e[57]=[t("div",{class:"mr-1 h-2 w-2 animate-pulse rounded-full bg-green-500"},null,-1),x(" 实时更新 ",-1)]))):y("",!0)]),t("div",ls,[t("div",rs,[t("button",{class:m(["rounded px-2 py-1 text-xs font-medium transition-colors",$.value==="table"?"bg-white text-blue-600 shadow-sm dark:bg-gray-700 dark:text-blue-400":"text-gray-600 dark:text-gray-400"]),onClick:e[12]||(e[12]=s=>$.value="table")},e[58]||(e[58]=[t("i",{class:"fas fa-table mr-1"},null,-1),x(" 表格 ",-1)]),2),t("button",{class:m(["rounded px-2 py-1 text-xs font-medium transition-colors",$.value==="cards"?"bg-white text-blue-600 shadow-sm dark:bg-gray-700 dark:text-blue-400":"text-gray-600 dark:text-gray-400"]),onClick:e[13]||(e[13]=s=>$.value="cards")},e[59]||(e[59]=[t("i",{class:"fas fa-th-large mr-1"},null,-1),x(" 卡片 ",-1)]),2)]),T(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>l(d).limit=s),"aria-label":"每页显示条数",class:"form-select text-sm",onChange:h},e[60]||(e[60]=[t("option",{value:"25"},"25 条/页",-1),t("option",{value:"50"},"50 条/页",-1),t("option",{value:"100"},"100 条/页",-1)]),544),[[tt,l(d).limit]])])]),l(A)?(n(),o("div",os,[t("div",ns,[(n(),o(et,null,st(5,s=>t("div",{key:s,class:"animate-pulse"},e[61]||(e[61]=[nt('<div class="flex items-center space-x-4" data-v-60500cf0><div class="h-4 w-20 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div><div class="h-4 w-16 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div><div class="h-4 w-12 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div><div class="h-4 flex-1 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div><div class="h-4 w-16 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div><div class="h-4 w-12 rounded bg-gray-200 dark:bg-gray-700" data-v-60500cf0></div></div>',1)]))),64)),e[62]||(e[62]=t("div",{class:"mt-4 text-center"},[t("div",{class:"inline-flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400"},[t("div",{class:"loading-spinner"}),t("span",null,"正在加载日志数据...")])],-1))])])):Y.value.length===0?(n(),o("div",ds,[e[65]||(e[65]=t("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800"},[t("i",{class:"fas fa-inbox text-2xl text-gray-400"})],-1)),t("h3",is,r(l(d).search?"未找到匹配的日志":"暂无日志记录"),1),t("div",us,[l(d).search?(n(),o("p",xs,'未找到包含 "'+r(l(d).search)+'" 的日志记录',1)):(n(),o("p",ms,"当前时间范围内没有日志记录")),t("div",ys,[l(yt)?(n(),o("button",{key:0,class:"btn btn-primary",onClick:pt},e[63]||(e[63]=[t("i",{class:"fas fa-filter mr-2"},null,-1),x(" 清除所有筛选 ",-1)]))):y("",!0),t("button",{class:"btn btn-secondary",onClick:at},e[64]||(e[64]=[t("i",{class:"fas fa-sync-alt mr-2"},null,-1),x(" 刷新数据 ",-1)]))])])])):$.value==="table"?(n(),o("div",cs,[t("table",gs,[t("thead",vs,[t("tr",null,[t("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:e[15]||(e[15]=s=>G("timestamp"))},[t("div",fs,[e[66]||(e[66]=t("span",null,"时间",-1)),t("i",{class:m(["fas fa-sort text-gray-400",H("timestamp")])},null,2)])]),e[70]||(e[70]=t("th",{class:"table-header",role:"columnheader"},"API Key",-1)),t("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:e[16]||(e[16]=s=>G("request.method"))},[t("div",bs,[e[67]||(e[67]=t("span",null,"方法",-1)),t("i",{class:m(["fas fa-sort text-gray-400",H("request.method")])},null,2)])]),e[71]||(e[71]=t("th",{class:"table-header",role:"columnheader"},"路径",-1)),t("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:e[17]||(e[17]=s=>G("response.statusCode"))},[t("div",ps,[e[68]||(e[68]=t("span",null,"状态码",-1)),t("i",{class:m(["fas fa-sort text-gray-400",H("response.statusCode")])},null,2)])]),t("th",{class:"table-header cursor-pointer",role:"columnheader",onClick:e[18]||(e[18]=s=>G("response.duration"))},[t("div",ks,[e[69]||(e[69]=t("span",null,"响应时间",-1)),t("i",{class:m(["fas fa-sort text-gray-400",H("response.duration")])},null,2)])]),e[72]||(e[72]=t("th",{class:"table-header",role:"columnheader"},"IP 地址",-1)),e[73]||(e[73]=t("th",{class:"table-header",role:"columnheader"},"操作",-1))])]),t("tbody",hs,[(n(!0),o(et,null,st(Y.value,s=>{var K,P,V,U,M,F,z,B,lt,Pt,Vt,Ut,Mt,Ft;return n(),o("tr",{key:s.id,class:m(["transition-colors hover:bg-gray-50 dark:hover:bg-gray-800",{"animate-pulse bg-green-50 dark:bg-green-900/20":s._isNew}])},[t("td",ws,[t("div",_s,r(l(q)(s).timestamp),1)]),t("td",Cs,[t("div",Ds,[t("div",{"aria-label":(K=s.apiKey)!=null&&K.active?"API Key 活跃":"API Key 未活跃",class:m(["h-2 w-2 rounded-full",(P=s.apiKey)!=null&&P.active?"bg-green-500":"bg-gray-400"])},null,10,Ts),t("span",As,r(((V=s.apiKey)==null?void 0:V.name)||"Unknown"),1)])]),t("td",qs,[t("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(ft)((U=s.request)==null?void 0:U.method)])},r(((M=s.request)==null?void 0:M.method)||"N/A"),3)]),t("td",Ls,[t("span",{class:"max-w-32 truncate text-sm text-gray-900 dark:text-gray-100",title:(F=s.request)==null?void 0:F.path},r(((z=s.request)==null?void 0:z.path)||"/"),9,Ss)]),t("td",Is,[t("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(vt)((B=s.response)==null?void 0:B.statusCode)])},r(((lt=s.response)==null?void 0:lt.statusCode)||"N/A"),3)]),t("td",$s,[t("div",Os,[t("span",Ns,r(l(q)(s).duration),1),((Pt=s.response)==null?void 0:Pt.duration)>5e3?(n(),o("i",Rs)):y("",!0)])]),t("td",js,[t("span",Es,r(((Vt=s.request)==null?void 0:Vt.ip)||"N/A"),1)]),t("td",Ks,[t("button",{"aria-label":`查看日志详情: ${((Ut=s.apiKey)==null?void 0:Ut.name)||"Unknown"} ${(Mt=s.request)==null?void 0:Mt.method} ${(Ft=s.request)==null?void 0:Ft.path}`,class:"rounded p-1 text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-300",onClick:Ha=>Tt(s)},e[74]||(e[74]=[t("i",{class:"fas fa-eye"},null,-1)]),8,Ps)])],2)}),128))])])])):(n(),o("div",Vs,[(n(!0),o(et,null,st(Y.value,s=>{var K,P,V,U,M,F,z,B;return n(),o("div",{key:s.id,class:m(["p-4 transition-colors hover:bg-gray-50 dark:hover:bg-gray-800",{"animate-pulse bg-green-50 dark:bg-green-900/20":s._isNew}])},[t("div",Us,[t("div",Ms,[t("div",Fs,[t("div",zs,[t("span",Bs,r(l(q)(s).timestamp.split(" ")[1]),1),t("div",Js,[t("div",{class:m(["h-2 w-2 rounded-full",(K=s.apiKey)!=null&&K.active?"bg-green-500":"bg-gray-400"])},null,2),t("span",Ws,r(((P=s.apiKey)==null?void 0:P.name)||"Unknown"),1)])]),t("button",{"aria-label":"查看详情",class:"rounded p-2 text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-300",onClick:lt=>Tt(s)},e[75]||(e[75]=[t("i",{class:"fas fa-eye"},null,-1)]),8,Qs)]),t("div",Xs,[t("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(ft)((V=s.request)==null?void 0:V.method)])},r(((U=s.request)==null?void 0:U.method)||"N/A"),3),t("span",Ys,r(((M=s.request)==null?void 0:M.path)||"/"),1)]),t("div",Gs,[t("div",Hs,[t("span",{class:m(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(vt)((F=s.response)==null?void 0:F.statusCode)])},r(((z=s.response)==null?void 0:z.statusCode)||"N/A"),3),t("span",Zs," ⏱️ "+r(l(q)(s).duration),1)]),t("span",ta," 🌐 "+r(((B=s.request)==null?void 0:B.ip)||"N/A"),1)])])])],2)}),128))])),l(k).totalPages>1?(n(),o("div",ea,[t("div",sa,[t("button",{class:"btn btn-secondary btn-sm",disabled:l(k).page<=1,onClick:e[19]||(e[19]=s=>Dt(l(k).page-1))},e[76]||(e[76]=[t("i",{class:"fas fa-chevron-left"},null,-1)]),8,aa),t("span",la," 第 "+r(l(k).page)+" 页，共 "+r(l(k).totalPages)+" 页 ",1),t("button",{class:"btn btn-secondary btn-sm",disabled:l(k).page>=l(k).totalPages,onClick:e[20]||(e[20]=s=>Dt(l(k).page+1))},e[77]||(e[77]=[t("i",{class:"fas fa-chevron-right"},null,-1)]),8,ra)])])):y("",!0)])),u.value?(n(),o("div",{key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e[22]||(e[22]=Bt(s=>u.value=null,["self"]))},[t("div",oa,[t("div",na,[e[79]||(e[79]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"日志详情",-1)),t("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:e[21]||(e[21]=s=>u.value=null)},e[78]||(e[78]=[t("i",{class:"fas fa-times text-xl"},null,-1)]))]),t("div",da,[t("div",ia,[t("div",null,[e[86]||(e[86]=t("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"基本信息",-1)),t("div",ua,[t("div",null,[e[80]||(e[80]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"时间",-1)),t("p",xa,r(l(q)(u.value).timestamp),1)]),t("div",null,[e[81]||(e[81]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"API Key",-1)),t("p",ma,r(((C=u.value.apiKey)==null?void 0:C.name)||"Unknown"),1)]),t("div",null,[e[82]||(e[82]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求方法",-1)),t("p",ya,r(((D=u.value.request)==null?void 0:D.method)||"N/A"),1)]),t("div",null,[e[83]||(e[83]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"状态码",-1)),t("p",ca,r(((N=u.value.response)==null?void 0:N.statusCode)||"N/A"),1)]),t("div",null,[e[84]||(e[84]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应时间",-1)),t("p",ga,r(l(q)(u.value).duration),1)]),t("div",null,[e[85]||(e[85]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"IP 地址",-1)),t("p",va,r(((R=u.value.request)==null?void 0:R.ip)||"N/A"),1)])])]),t("div",null,[e[91]||(e[91]=t("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"请求信息",-1)),t("div",fa,[t("div",null,[e[87]||(e[87]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求路径",-1)),t("p",ba,r(((j=u.value.request)==null?void 0:j.path)||"/"),1)]),t("div",null,[e[88]||(e[88]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"User Agent",-1)),t("p",pa,r(((E=u.value.request)==null?void 0:E.userAgent)||"N/A"),1)]),(It=u.value.request)!=null&&It.headers?(n(),o("div",ka,[e[89]||(e[89]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求头",-1)),t("pre",ha,r(JSON.stringify(u.value.request.headers,null,2)),1)])):y("",!0),($t=u.value.request)!=null&&$t.body?(n(),o("div",wa,[e[90]||(e[90]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"请求体",-1)),t("pre",_a,r(JSON.stringify(u.value.request.body,null,2)),1)])):y("",!0)])]),u.value.response?(n(),o("div",Ca,[e[94]||(e[94]=t("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"响应信息",-1)),t("div",Da,[u.value.response.headers?(n(),o("div",Ta,[e[92]||(e[92]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应头",-1)),t("pre",Aa,r(JSON.stringify(u.value.response.headers,null,2)),1)])):y("",!0),u.value.response.body?(n(),o("div",qa,[e[93]||(e[93]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"响应体",-1)),t("pre",La,r(JSON.stringify(u.value.response.body,null,2)),1)])):y("",!0)])])):y("",!0),u.value.usage?(n(),o("div",Sa,[e[99]||(e[99]=t("h4",{class:"text-md mb-3 font-semibold text-gray-900 dark:text-gray-100"},"使用统计",-1)),t("div",Ia,[t("div",null,[e[95]||(e[95]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"输入 Tokens",-1)),t("p",$a,r(u.value.usage.inputTokens||0),1)]),t("div",null,[e[96]||(e[96]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"输出 Tokens",-1)),t("p",Oa,r(u.value.usage.outputTokens||0),1)]),t("div",null,[e[97]||(e[97]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"总 Tokens",-1)),t("p",Na,r(u.value.usage.totalTokens||0),1)]),t("div",null,[e[98]||(e[98]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"模型",-1)),t("p",Ra,r(u.value.usage.model||"N/A"),1)])])])):y("",!0)])])])])):y("",!0),W.value?(n(),o("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e[24]||(e[24]=Bt(s=>W.value=!1,["self"]))},[t("div",ja,[t("div",Ea,[e[101]||(e[101]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"错误详情",-1)),t("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:e[23]||(e[23]=s=>W.value=!1)},e[100]||(e[100]=[t("i",{class:"fas fa-times text-xl"},null,-1)]))]),t("div",Ka,[t("div",Pa,[t("div",null,[e[102]||(e[102]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"错误类型",-1)),t("p",Va,r(((Ot=c.value)==null?void 0:Ot.code)||"未知错误"),1)]),t("div",null,[e[103]||(e[103]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"错误信息",-1)),t("p",Ua,r(((Nt=c.value)==null?void 0:Nt.message)||"无详细信息"),1)]),(Rt=c.value)!=null&&Rt.status?(n(),o("div",Ma,[e[104]||(e[104]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"状态码",-1)),t("p",Fa,r(c.value.status),1)])):y("",!0),t("div",null,[e[105]||(e[105]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"重试次数",-1)),t("p",za,r(xt.value),1)]),t("div",null,[e[110]||(e[110]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"建议操作",-1)),t("div",Ba,[((jt=c.value)==null?void 0:jt.code)==="NETWORK_ERROR"?(n(),o("p",Ja,e[106]||(e[106]=[x(" • 检查网络连接是否正常",-1),t("br",null,null,-1),x(" • 检查VPN或代理设置",-1),t("br",null,null,-1),x(" • 尝试刷新页面 ",-1)]))):((Et=c.value)==null?void 0:Et.status)===401?(n(),o("p",Wa,e[107]||(e[107]=[x(" • 重新登录系统",-1),t("br",null,null,-1),x(" • 检查登录凭据是否过期 ",-1)]))):((Kt=c.value)==null?void 0:Kt.status)>=500?(n(),o("p",Qa,e[108]||(e[108]=[x(" • 稍后再试",-1),t("br",null,null,-1),x(" • 如问题持续，请联系技术支持 ",-1)]))):(n(),o("p",Xa,e[109]||(e[109]=[x(" • 检查网络连接",-1),t("br",null,null,-1),x(" • 刷新页面后重试 ",-1)])))])])])])])])):y("",!0)])}}},rl=ne(Ya,[["__scopeId","data-v-60500cf0"]]);export{rl as default};
