const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginView-CV3q-8V0.js","assets/ThemeToggle-Q8gLMqOh.js","assets/vue-vendor-CcFZMz-v.js","assets/ThemeToggle-CzQ-uydY.css","assets/SessionManager-Bx5ksk-O.js","assets/SessionManager-CtfuafU8.css","assets/element-plus-C-1FTG0y.js","assets/vendor-B90ziCBp.js","assets/element-plus-6gb5osKz.css","assets/LoginView-tn0RQdqM.css","assets/MainLayout-CF50wZ35.js","assets/toast-BvwA7Mwb.js","assets/LogoTitle-mDAnRYBX.js","assets/LogoTitle-DXipqypn.css","assets/MainLayout-xhoe0q5F.css","assets/DashboardView-4lpmgE_m.js","assets/chart-DOIXA9jv.js","assets/DashboardView-CXNlSYti.css","assets/ApiKeysView-BR_qbw1L.js","assets/WindowCountdown-DEPTPq8A.js","assets/CustomDropdown-VwkXJFSt.js","assets/CustomDropdown-jjrvIxsf.css","assets/ApiKeysView-jqC7DjJ8.css","assets/AccountsView-CtRbPmiN.js","assets/AccountsView-BKLzj83i.css","assets/GroupList-iYCygtLB.js","assets/GroupList-CgYvtwHy.css","assets/UserList-CpaAh_wj.js","assets/UserList-tK2DzrgU.css","assets/UserGroups-D96s4Jd6.js","assets/UserGroups-CP6mVbNo.css","assets/TutorialView-B6wr-ude.js","assets/TutorialView-Bnd6c_gD.css","assets/SettingsView-_Pc6vO62.js","assets/requestLogs-BP6R09mC.js","assets/SettingsView-BY7xk7UM.css","assets/ApiStatsView-ChXU18kf.js","assets/ApiStatsView-CXCjOsh4.css","assets/RequestLogsView-D8Pvjz7M.js","assets/RequestLogsView-D4Du3yY-.css"])))=>i.map(i=>d[i]);
import{aR as oe,aS as ne,aT as B,r as g,c as P,o as K,q as M,V as H,I as W,z as v,x as E,ac as ae,Q as re,a5 as F,y as I,C as N,L as D,P as x,Y as J,B as ie,R as C,J as ce,T as le,O as ue,ax as de,aO as he,aU as me}from"./vue-vendor-CcFZMz-v.js";import{i as fe,z as pe}from"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const ge="modulepreload",ve=function(o){return"/admin-next/"+o},z={},y=function(t,e,r){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));n=Promise.allSettled(e.map(i=>{if(i=ve(i),i in z)return;z[i]=!0;const d=i.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${h}`))return;const s=document.createElement("link");if(s.rel=d?"stylesheet":ge,d||(s.as="script"),s.crossOrigin="",s.href=i,u&&s.setAttribute("nonce",u),document.head.appendChild(s),d)return new Promise((m,p)=>{s.addEventListener("load",m),s.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})}))}function a(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return n.then(c=>{for(const u of c||[])u.status==="rejected"&&a(u.reason);return t().catch(a)})},V={basePath:"/admin-next/",apiPrefix:""};function _e(o=""){return o&&!o.startsWith("/")&&(o="/"+o),V.basePath+(o.startsWith("#")?o:"#"+o)}function we(){return _e("/login")}const ye=()=>y(()=>import("./LoginView-CV3q-8V0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),A=()=>y(()=>import("./MainLayout-CF50wZ35.js"),__vite__mapDeps([10,2,11,12,13,1,3,4,5,6,7,8,14])),Te=()=>y(()=>import("./DashboardView-4lpmgE_m.js"),__vite__mapDeps([15,6,2,7,8,11,16,17])),Ae=()=>y(()=>import("./ApiKeysView-BR_qbw1L.js"),__vite__mapDeps([18,6,2,7,8,11,19,20,21,22])),Ie=()=>y(()=>import("./AccountsView-CtRbPmiN.js"),__vite__mapDeps([23,2,11,20,21,6,7,8,24])),be=()=>y(()=>import("./GroupList-iYCygtLB.js"),__vite__mapDeps([25,2,6,7,8,26])),Ee=()=>y(()=>import("./UserList-CpaAh_wj.js"),__vite__mapDeps([27,2,11,6,7,8,28])),ke=()=>y(()=>import("./UserGroups-D96s4Jd6.js"),__vite__mapDeps([29,2,11,6,7,8,30])),Se=()=>y(()=>import("./TutorialView-B6wr-ude.js"),__vite__mapDeps([31,2,6,7,8,32])),Pe=()=>y(()=>import("./SettingsView-_Pc6vO62.js"),__vite__mapDeps([33,2,11,34,6,7,8,35])),xe=()=>y(()=>import("./ApiStatsView-ChXU18kf.js"),__vite__mapDeps([36,2,12,13,1,3,7,19,31,6,8,32,37])),Le=()=>y(()=>import("./RequestLogsView-D8Pvjz7M.js"),__vite__mapDeps([38,2,34,11,16,7,6,8,39])),Oe=[{path:"/",redirect:()=>{const o=window.location.pathname,t=V.basePath.replace(/\/$/,"");return o===t||o===t+"/","/api-stats"}},{path:"/login",name:"Login",component:ye,meta:{requiresAuth:!1}},{path:"/api-stats",name:"ApiStats",component:xe,meta:{requiresAuth:!1}},{path:"/dashboard",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:Te}]},{path:"/api-keys",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"ApiKeys",component:Ae}]},{path:"/accounts",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Accounts",component:Ie}]},{path:"/groups",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Groups",component:be}]},{path:"/users",component:A,meta:{requiresAuth:!0,requiresRole:"admin"},children:[{path:"",name:"Users",component:Ee}]},{path:"/user-groups",component:A,meta:{requiresAuth:!0,requiresRole:"admin"},children:[{path:"",name:"UserGroups",component:ke}]},{path:"/tutorial",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Tutorial",component:Se}]},{path:"/settings",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Settings",component:Pe}]},{path:"/request-logs",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"RequestLogs",component:Le}]},{path:"/:pathMatch(.*)*",redirect:"/api-stats"}],L=oe({history:ne(V.basePath),routes:Oe});L.beforeEach((o,t,e)=>{var n,a;const r=X();if(console.log("路由导航:",{to:o.path,from:t.path,fullPath:o.fullPath,requiresAuth:o.meta.requiresAuth,requiresRole:o.meta.requiresRole,isAuthenticated:r.isAuthenticated,userRole:(n=r.user)==null?void 0:n.role}),o.path===t.path&&o.fullPath===t.fullPath)return e();if(o.path==="/api-stats"||o.path.startsWith("/api-stats"))e();else if(o.meta.requiresAuth&&!r.isAuthenticated)e("/login");else if(o.path==="/login"&&r.isAuthenticated)e("/dashboard");else if(o.meta.requiresRole){if((((a=r.user)==null?void 0:a.role)||"user")!==o.meta.requiresRole){e("/dashboard");return}e()}else e()});const Q=V.apiPrefix;function R(o){return o.startsWith("/")||(o="/"+o),Q+o}class Re{constructor(){this.baseURL=Q}getAuthToken(){return localStorage.getItem("authToken")||null}buildConfig(t={}){const e={headers:{"Content-Type":"application/json",...t.headers},...t},r=this.getAuthToken();return r&&(e.headers.Authorization=`Bearer ${r}`),e}async handleResponse(t,e="json"){if(t.status===401){const n=window.location.pathname+window.location.hash;throw n.includes("/login")||n.endsWith("/")||(localStorage.removeItem("authToken"),window.location.href=we()),new Error("Unauthorized")}if(!t.ok){const n=t.headers.get("content-type");if(n&&n.includes("application/json"))try{const a=await t.json();throw new Error(a.error||a.message||`HTTP ${t.status}`)}catch{}throw new Error(`HTTP ${t.status}: ${t.statusText}`)}if(e==="blob")return{data:await t.blob(),headers:t.headers,status:t.status,statusText:t.statusText};const r=t.headers.get("content-type");return r&&r.includes("application/json")?await t.json():t}async get(t,e={}){let r=R(t);const{responseType:n,params:a,...c}=e;if(a&&Object.keys(a).length>0){const i=new URLSearchParams;Object.entries(a).forEach(([h,s])=>{s!=null&&s!==""&&i.append(h,s)});const d=i.toString();d&&(r+=(r.includes("?")?"&":"?")+d)}const u=this.buildConfig({...c,method:"GET"});try{console.log("🌐 API GET请求:",{fullUrl:r,params:a,config:u});const i=await fetch(r,u);return await this.handleResponse(i,n)}catch(i){throw console.error("API GET Error:",i),i}}async post(t,e=null,r={}){const n=R(t),{responseType:a,...c}=r;let u,i={};e&&(e instanceof FormData?u=e:(u=JSON.stringify(e),i["Content-Type"]="application/json"));const d=this.buildConfig({...c,method:"POST",body:u,headers:{...i,...c.headers}});try{const h=await fetch(n,d);return await this.handleResponse(h,a)}catch(h){throw console.error("API POST Error:",h),h}}async put(t,e=null,r={}){const n=R(t),{responseType:a,...c}=r,u=this.buildConfig({...c,method:"PUT",body:e?JSON.stringify(e):void 0});try{const i=await fetch(n,u);return await this.handleResponse(i,a)}catch(i){throw console.error("API PUT Error:",i),i}}async delete(t,e={}){const r=R(t),{data:n,responseType:a,...c}=e,u=this.buildConfig({...c,method:"DELETE",body:n?JSON.stringify(n):void 0});try{const i=await fetch(r,u);return await this.handleResponse(i,a)}catch(i){throw console.error("API DELETE Error:",i),i}}}const S=new Re,X=B("auth",()=>{const o=g(!1),t=g(localStorage.getItem("authToken")||""),e=g(localStorage.getItem("sessionToken")||""),r=g(""),n=g(null),a=g(null),c=g(""),u=g(!1),i=g(!1),d=g({siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",faviconData:""}),h=g(!0),s=P(()=>{var l;return((l=a.value)==null?void 0:l.username)||""}),m=P(()=>!!e.value&&!!a.value),p=P(()=>e.value),T=P(()=>t.value);async function U(l){u.value=!0,c.value="";try{const f=await S.post("/web/auth/login",l);if(f.success&&f.token){const _=f.token,k=f.token,O=f.expiresIn?new Date(Date.now()+f.expiresIn).toISOString():null,se={username:f.username,id:f.username,role:"admin"};e.value=_,r.value=k,n.value=O,a.value=se,o.value=!0,localStorage.setItem("sessionToken",_),localStorage.setItem("sessionId",k),O&&localStorage.setItem("expiresAt",O),t.value=_,localStorage.setItem("authToken",_),await L.push("/dashboard")}else c.value=f.message||"登录失败"}catch(f){c.value=f.message||"登录失败，请检查用户名和密码"}finally{u.value=!1}}async function $(){try{e.value&&await S.post("/auth/logout")}catch(l){console.warn("Logout API call failed:",l.message)}b(),L.push("/login")}function b(){o.value=!1,t.value="",e.value="",r.value="",n.value=null,a.value=null,localStorage.removeItem("authToken"),localStorage.removeItem("sessionToken"),localStorage.removeItem("sessionId"),localStorage.removeItem("expiresAt")}function Y(){const l=localStorage.getItem("sessionToken"),f=localStorage.getItem("sessionId"),_=localStorage.getItem("expiresAt");if(l){if(e.value=l,r.value=f||"",n.value=_,t.value=l,_&&new Date(_)<=new Date){b();return}o.value=!0,j()}else t.value&&(e.value=t.value,o.value=!0,j())}async function j(){try{const l=await S.get("/auth/validate");if(l.success&&l.data)a.value=l.data.user,o.value=!0;else throw new Error("Session validation failed")}catch(l){console.warn("Session validation failed:",l.message),b(),L.push("/login")}}async function Z(){if(i.value||!e.value)return!1;i.value=!0;try{const l=await S.post("/auth/refresh");if(l.success&&l.data){const{sessionToken:f,sessionId:_,expiresAt:k,user:O}=l.data;return e.value=f,r.value=_,n.value=k,a.value=O,localStorage.setItem("sessionToken",f),localStorage.setItem("sessionId",_),k&&localStorage.setItem("expiresAt",k),t.value=f,localStorage.setItem("authToken",f),!0}else throw new Error(l.message||"Session refresh failed")}catch(l){return console.error("Session refresh failed:",l.message),b(),L.push("/login"),!1}finally{i.value=!1}}async function ee(l,f){try{const _=await S.post("/auth/change-password",{oldPassword:l,newPassword:f});if(_.success)return{success:!0,message:_.message};throw new Error(_.message||"Password change failed")}catch(_){throw new Error(_.message||"Password change failed")}}async function te(){h.value=!0;try{const l=await S.get("/admin/oem-settings");if(l.success&&l.data){if(d.value={...d.value,...l.data},l.data.siteIconData||l.data.siteIcon){const f=document.querySelector("link[rel*='icon']")||document.createElement("link");f.type="image/x-icon",f.rel="shortcut icon",f.href=l.data.siteIconData||l.data.siteIcon,document.getElementsByTagName("head")[0].appendChild(f)}l.data.siteName&&(document.title=`${l.data.siteName} - 管理后台`)}}catch(l){console.error("加载OEM设置失败:",l)}finally{h.value=!1}}return{isLoggedIn:o,authToken:t,sessionToken:e,sessionId:r,expiresAt:n,user:a,username:s,loginError:c,loginLoading:u,refreshing:i,oemSettings:d,oemLoading:h,isAuthenticated:m,token:p,legacyToken:T,login:U,logout:$,checkAuth:Y,verifySession:j,refreshSession:Z,changePassword:ee,clearAuthState:b,loadOemSettings:te}}),w={LIGHT:"light",DARK:"dark",AUTO:"auto"},Ce=B("theme",()=>{const o=g(w.AUTO),t=g(!1),e=P(()=>o.value===w.DARK?!0:o.value===w.LIGHT?!1:t.value),r=P(()=>e.value?w.DARK:w.LIGHT),n=()=>{const s=window.matchMedia("(prefers-color-scheme: dark)");t.value=s.matches;const m=localStorage.getItem("themeMode");m&&Object.values(w).includes(m)?o.value=m:o.value=w.AUTO,a(),i()},a=()=>{const s=document.documentElement;e.value?s.classList.add("dark"):s.classList.remove("dark")},c=s=>{Object.values(w).includes(s)&&(o.value=s)},u=()=>{const s=[w.LIGHT,w.DARK,w.AUTO],p=(s.indexOf(o.value)+1)%s.length;o.value=s[p]};K(o,s=>{localStorage.setItem("themeMode",s),a()}),K(t,()=>{o.value===w.AUTO&&a()});const i=()=>{const s=window.matchMedia("(prefers-color-scheme: dark)"),m=p=>{t.value=p.matches};return t.value=s.matches,s.addEventListener("change",m),()=>{s.removeEventListener("change",m)}};return{themeMode:o,isDarkMode:e,currentTheme:r,systemPrefersDark:t,ThemeMode:w,initTheme:n,setThemeMode:c,cycleThemeMode:u,watchSystemTheme:i,toggleTheme:()=>{u()},setTheme:s=>{s==="dark"?c(w.DARK):s==="light"&&c(w.LIGHT)}}}),G=(o,t)=>{const e=o.__vccOpts||o;for(const[r,n]of t)e[r]=n;return e},De={class:"toast-container"},Ve=["onClick"],qe={class:"toast-content"},Ue={class:"toast-icon"},$e={class:"toast-body"},je={key:0,class:"toast-title"},Ne={class:"toast-message"},Me=["onClick"],Ge={__name:"ToastNotification",setup(o,{expose:t}){const e=g([]);let r=0;const n=d=>{const h={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return h[d]||h.info},a=(d,h="info",s=null,m=5e3)=>{const p=++r,T={id:p,message:d,type:h,title:s,duration:m,isVisible:!1};return e.value.push(T),setTimeout(()=>{T.isVisible=!0},10),m>0&&setTimeout(()=>{c(p)},m),p},c=d=>{const h=e.value.findIndex(s=>s.id===d);if(h>-1){const s=e.value[h];s.isVisible=!1,setTimeout(()=>{const m=e.value.findIndex(p=>p.id===d);m>-1&&e.value.splice(m,1)},300)}},u=()=>{e.value.forEach(d=>{d.isVisible=!1}),setTimeout(()=>{e.value.length=0},300)},i=(d,h="info",s=null,m=5e3)=>a(d,h,s,m);return M(()=>{window.showToast=i}),H(()=>{window.showToast===i&&delete window.showToast}),t({showToast:i,removeToast:c,clearAllToasts:u}),(d,h)=>(I(),W(F,{to:"body"},[v("div",De,[(I(!0),E(re,null,ae(e.value,s=>(I(),E("div",{key:s.id,class:N(["toast",`toast-${s.type}`,s.isVisible?"toast-show":"toast-hide"]),onClick:m=>c(s.id)},[v("div",qe,[v("div",Ue,[v("i",{class:N(n(s.type))},null,2)]),v("div",$e,[s.title?(I(),E("div",je,x(s.title),1)):D("",!0),v("div",Ne,x(s.message),1)]),v("button",{class:"toast-close",onClick:J(m=>c(s.id),["stop"])},[...h[0]||(h[0]=[v("i",{class:"fas fa-times"},null,-1)])],8,Me)]),s.duration>0?(I(),E("div",{key:0,class:"toast-progress",style:ie({animationDuration:`${s.duration}ms`})},null,4)):D("",!0)],10,Ve))),128))])]))}},Ke=G(Ge,[["__scopeId","data-v-c8b24ff5"]]),ze={class:"modal-content mx-auto w-full max-w-md p-6"},Be={class:"mb-6 flex items-start gap-4"},He={class:"flex-1"},We={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-white"},Fe={class:"whitespace-pre-line leading-relaxed text-gray-700 dark:text-gray-400"},Je={class:"flex items-center justify-end gap-3"},Qe=["disabled"],Xe=["disabled"],Ye={key:0,class:"loading-spinner mr-2"},Ze={__name:"ConfirmDialog",setup(o,{expose:t}){const e=g(!1),r=g(!1),n=g(""),a=g(""),c=g("确认"),u=g("取消");let i=null;const d=(p,T,U="确认",$="取消")=>new Promise(b=>{n.value=p,a.value=T,c.value=U,u.value=$,e.value=!0,r.value=!1,i=b}),h=()=>{r.value||(r.value=!0,setTimeout(()=>{e.value=!1,r.value=!1,i&&(i(!0),i=null)},200))},s=()=>{r.value||(e.value=!1,i&&(i(!1),i=null))},m=p=>{e.value&&(p.key==="Escape"?s():p.key==="Enter"&&!p.shiftKey&&!p.ctrlKey&&!p.altKey&&h())};return M(()=>{window.showConfirm=d,document.addEventListener("keydown",m)}),H(()=>{window.showConfirm===d&&delete window.showConfirm,document.removeEventListener("keydown",m)}),t({showConfirm:d}),(p,T)=>(I(),W(F,{to:"body"},[C(le,{appear:"",name:"modal"},{default:ce(()=>[e.value?(I(),E("div",{key:0,class:"modal fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:J(s,["self"])},[v("div",ze,[v("div",Be,[T[0]||(T[0]=v("div",{class:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-amber-600"},[v("i",{class:"fas fa-exclamation-triangle text-lg text-white"})],-1)),v("div",He,[v("h3",We,x(n.value),1),v("div",Fe,x(a.value),1)])]),v("div",Je,[v("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:r.value,onClick:s},x(u.value),9,Qe),v("button",{class:N(["btn btn-warning px-6 py-3",{"cursor-not-allowed opacity-50":r.value}]),disabled:r.value,onClick:h},[r.value?(I(),E("div",Ye)):D("",!0),ue(" "+x(c.value),1)],10,Xe)])])])):D("",!0)]),_:1})]))}},et=G(Ze,[["__scopeId","data-v-6b3390a6"]]),tt={id:"app"},st={__name:"App",setup(o){const t=X(),e=Ce(),r=g(),n=g();return M(()=>{e.initTheme(),e.watchSystemTheme(),t.checkAuth(),t.loadOemSettings()}),(a,c)=>{const u=de("router-view");return I(),E("div",tt,[C(u),C(Ke,{ref_key:"toastRef",ref:r},null,512),C(et,{ref_key:"confirmRef",ref:n},null,512)])}}},ot=G(st,[["__scopeId","data-v-dab04b7e"]]),q=he(ot),nt=me();q.use(nt);q.use(L);q.use(fe,{locale:pe});q.mount("#app");export{G as _,Ce as a,S as b,X as u};
