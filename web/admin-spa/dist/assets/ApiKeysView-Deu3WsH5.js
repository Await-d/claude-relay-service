import{E as Lt}from"./element-plus-5SvmA99H.js";import{aT as ut,r as K,c as Y,q as Te,V as Dt,o as Ae,x as n,y as l,z as e,I as le,C as O,P as g,R as ne,J as _t,L as f,B as _e,K as T,aq as ee,Q as z,ac as X,T as Mt,a5 as ve,D as Tt,_ as Se,Y as xe,an as re,O as L,aa as Me,aY as Ce,al as fe}from"./vue-vendor-C9wZz30M.js";import{s as W}from"./toast-BvwA7Mwb.js";import{b as B,_ as be}from"./index-CQZgE5sL.js";import{_ as Oe}from"./WindowCountdown-Dvs-5H5J.js";import{C as dt}from"./CustomDropdown-IG5jjVM4.js";import"./vendor-DeB155zE.js";const Ge=ut("clients",{state:()=>({supportedClients:[],loading:!1,error:null}),actions:{async loadSupportedClients(){if(this.supportedClients.length>0)return this.supportedClients;this.loading=!0,this.error=null;try{const C=await B.get("/admin/supported-clients");return C.success?this.supportedClients=C.data||[]:(this.error=C.message||"加载支持的客户端失败",console.error("Failed to load supported clients:",this.error)),this.supportedClients}catch(C){return this.error=C.message||"加载支持的客户端失败",console.error("Error loading supported clients:",C),[]}finally{this.loading=!1}}}}),qe=ut("apiKeys",()=>{const C=K([]),Q=K(!1),m=K(null),R=K("all"),G=K(""),D=K("asc"),_=async()=>{Q.value=!0,m.value=null;try{const S=await B.get("/admin/api-keys");if(S.success)C.value=S.data||[];else throw new Error(S.message||"获取API Keys失败")}catch(S){throw m.value=S.message,S}finally{Q.value=!1}};return{apiKeys:C,loading:Q,error:m,statsTimeRange:R,sortBy:G,sortOrder:D,fetchApiKeys:_,createApiKey:async S=>{Q.value=!0,m.value=null;try{const I=await B.post("/admin/api-keys",S);if(I.success)return await _(),I.data;throw new Error(I.message||"创建API Key失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},updateApiKey:async(S,I)=>{Q.value=!0,m.value=null;try{const v=await B.put(`/admin/api-keys/${S}`,I);if(v.success)return await _(),v;throw new Error(v.message||"更新API Key失败")}catch(v){throw m.value=v.message,v}finally{Q.value=!1}},toggleApiKey:async S=>{Q.value=!0,m.value=null;try{const I=await B.put(`/admin/api-keys/${S}/toggle`);if(I.success)return await _(),I;throw new Error(I.message||"切换状态失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},renewApiKey:async(S,I)=>{Q.value=!0,m.value=null;try{const v=await B.put(`/admin/api-keys/${S}`,I);if(v.success)return await _(),v;throw new Error(v.message||"续期失败")}catch(v){throw m.value=v.message,v}finally{Q.value=!1}},deleteApiKey:async S=>{Q.value=!0,m.value=null;try{const I=await B.delete(`/admin/api-keys/${S}`);if(I.success)return await _(),I;throw new Error(I.message||"删除失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},fetchApiKeyStats:async(S,I="all")=>{try{const v=await B.get(`/admin/api-keys/${S}/stats`,{params:{timeRange:I}});if(v.success)return v.stats;throw new Error(v.message||"获取统计失败")}catch(v){return console.error("获取API Key统计失败:",v),null}},fetchTags:async()=>{try{const S=await B.get("/admin/api-keys/tags");if(S.success)return S.data||[];throw new Error(S.message||"获取标签失败")}catch(S){return console.error("获取标签失败:",S),[]}},sortApiKeys:S=>{G.value===S?D.value=D.value==="asc"?"desc":"asc":(G.value=S,D.value="asc")},reset:()=>{C.value=[],Q.value=!1,m.value=null,R.value="all",G.value="",D.value="asc"}}}),St={class:"flex-shrink-0 border-b border-gray-200 p-3 dark:border-gray-600"},jt={class:"relative"},Rt={class:"custom-scrollbar flex-1 overflow-y-auto"},Vt={class:"text-gray-700 dark:text-gray-300"},Pt={key:0},Et=["onClick"],Ut={class:"flex items-center justify-between"},Ot={class:"text-gray-700 dark:text-gray-300"},Gt={class:"text-xs text-gray-500 dark:text-gray-400"},qt={key:1},Wt={class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"},Bt=["onClick"],Ft={class:"flex items-center justify-between"},Ht={class:"text-gray-700 dark:text-gray-300"},zt={class:"text-xs text-gray-400 dark:text-gray-500"},Nt={key:2},Yt=["onClick"],Qt={class:"flex items-center justify-between"},Jt={class:"text-gray-700 dark:text-gray-300"},Xt={class:"text-xs text-gray-400 dark:text-gray-500"},Zt={key:3,class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},es={__name:"AccountSelector",props:{modelValue:{type:String,default:""},platform:{type:String,required:!0,validator:C=>["claude","gemini"].includes(C)},accounts:{type:Array,default:()=>[]},groups:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择账号"},defaultOptionText:{type:String,default:"使用共享账号池"}},emits:["update:modelValue"],setup(C,{emit:Q}){const m=C,R=Q,G=K(!1),D=K(""),_=K(null),U=K(null),M=K({}),F=K(null),V=K(""),h=Y(()=>{if(!m.modelValue)return m.defaultOptionText;if(m.modelValue.startsWith("group:")){const x=m.modelValue.substring(6),k=m.groups.find(N=>N.id===x);return k?`${k.name} (${k.memberCount||0} 个成员)`:""}if(m.modelValue.startsWith("console:")){const x=m.modelValue.substring(8),k=m.accounts.find(N=>N.id===x&&N.platform==="claude-console");return k?`${k.name} (${E(k)})`:""}const r=m.accounts.find(x=>x.id===m.modelValue);return r?`${r.name} (${E(r)})`:""}),E=r=>{if(!r)return"未知";if(r.isActive===!1)switch(r.status){case"unauthorized":return"未授权";case"error":return"Token错误";case"created":return"待验证";case"rate_limited":return"限流中";default:return"异常"}return"正常"},p=Y(()=>[...m.accounts].sort((r,x)=>{const k=new Date(r.createdAt||0);return new Date(x.createdAt||0)-k})),a=Y(()=>{if(!D.value)return m.groups;const r=D.value.toLowerCase();return m.groups.filter(x=>x.name.toLowerCase().includes(r))}),i=Y(()=>{let r=p.value.filter(x=>x.accountType==="dedicated"&&(m.platform==="claude"?x.platform==="claude-oauth":x.platform!=="claude-console"));if(D.value){const x=D.value.toLowerCase();r=r.filter(k=>k.name.toLowerCase().includes(x))}return r}),S=Y(()=>{if(m.platform!=="claude")return[];let r=p.value.filter(x=>x.accountType==="dedicated"&&x.platform==="claude-console");if(D.value){const x=D.value.toLowerCase();r=r.filter(k=>k.name.toLowerCase().includes(x))}return r}),I=Y(()=>a.value.length>0||i.value.length>0||S.value.length>0),v=r=>{if(!r)return"";const x=new Date(r),N=(new Date-x)/(1e3*60*60);return N<24?"今天创建":N<48?"昨天创建":N<168?`${Math.floor(N/24)} 天前`:x.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},$=()=>{if(!G.value||!U.value||!F.value)return;const r=F.value;if(!r)return;const x=r.getBoundingClientRect(),k=window.innerHeight,N=window.innerWidth,P=k-x.bottom,o=x.top,y=8,Z=P-y,J=o-y;let ae=!1,pe=Z;V.value==="above"&&J>=150?(ae=!0,pe=J):V.value==="below"&&Z>=150?(ae=!1,pe=Z):J>Z&&Z<200&&(ae=!0,pe=J),V.value=ae?"above":"below";let ge=x.left;const ce=x.width;ge+ce>N-y&&(ge=N-ce-y),ge<y&&(ge=y),M.value={position:"fixed",left:`${ge}px`,width:`${x.width}px`,maxHeight:`${Math.min(pe,400)}px`,...ae?{bottom:`${k-x.top}px`}:{top:`${x.bottom}px`}}},u=()=>{if(!G.value&&F.value){const r=F.value.getBoundingClientRect(),k=window.innerHeight-r.bottom,N=8;M.value={position:"fixed",left:`${r.left}px`,width:`${r.width}px`,maxHeight:`${Math.min(k-N,400)}px`,top:`${r.bottom}px`}}G.value=!G.value,G.value&&Tt(()=>{var r;$(),(r=_.value)==null||r.focus()})},c=r=>{R("update:modelValue",r||""),G.value=!1,D.value=""},w=()=>{},ue=()=>{var r;D.value="",(r=_.value)==null||r.focus()},ie=r=>{var x,k;!((x=F.value)!=null&&x.contains(r.target))&&!((k=U.value)!=null&&k.contains(r.target))&&(G.value=!1)},A=()=>{G.value&&$()};return Te(()=>{document.addEventListener("click",ie),window.addEventListener("scroll",A,!0),window.addEventListener("resize",$)}),Dt(()=>{document.removeEventListener("click",ie),window.removeEventListener("scroll",A,!0),window.removeEventListener("resize",$)}),Ae(G,r=>{r||(D.value="",V.value="")}),(r,x)=>(l(),n("div",{ref_key:"triggerRef",ref:F,class:"relative"},[e("div",{class:O(["form-input flex w-full cursor-pointer items-center justify-between dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",{"opacity-50":C.disabled}]),onClick:x[0]||(x[0]=k=>!C.disabled&&u())},[e("span",{class:O(C.modelValue?"text-gray-900 dark:text-gray-200":"text-gray-500 dark:text-gray-400")},g(h.value),3),e("i",{class:O(["fas fa-chevron-down text-gray-400 transition-transform duration-200 dark:text-gray-500",{"rotate-180":G.value}])},null,2)],2),(l(),le(ve,{to:"body"},[ne(Mt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:_t(()=>[G.value?(l(),n("div",{key:0,ref_key:"dropdownRef",ref:U,class:"absolute z-50 flex flex-col rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-600 dark:bg-gray-800",style:_e(M.value)},[e("div",St,[e("div",jt,[T(e("input",{ref_key:"searchInput",ref:_,"onUpdate:modelValue":x[1]||(x[1]=k=>D.value=k),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"搜索账号名称...",style:{"padding-left":"40px","padding-right":"36px"},type:"text",onInput:w},null,544),[[ee,D.value]]),x[4]||(x[4]=e("i",{class:"fas fa-search pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-gray-400 dark:text-gray-500"},null,-1)),D.value?(l(),n("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400",type:"button",onClick:ue},[...x[3]||(x[3]=[e("i",{class:"fas fa-times text-sm"},null,-1)])])):f("",!0)])]),e("div",Rt,[e("div",{class:O(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":!C.modelValue}]),onClick:x[2]||(x[2]=k=>c(null))},[e("span",Vt,g(C.defaultOptionText),1)],2),a.value.length>0?(l(),n("div",Pt,[x[5]||(x[5]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," 调度分组 ",-1)),(l(!0),n(z,null,X(a.value,k=>(l(),n("div",{key:`group:${k.id}`,class:O(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===`group:${k.id}`}]),onClick:N=>c(`group:${k.id}`)},[e("div",Ut,[e("span",Ot,g(k.name),1),e("span",Gt,g(k.memberCount||0)+" 个成员",1)])],10,Et))),128))])):f("",!0),i.value.length>0?(l(),n("div",qt,[e("div",Wt,g(C.platform==="claude"?"Claude OAuth 专属账号":"OAuth 专属账号"),1),(l(!0),n(z,null,X(i.value,k=>(l(),n("div",{key:k.id,class:O(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===k.id}]),onClick:N=>c(k.id)},[e("div",Ft,[e("div",null,[e("span",Ht,g(k.name),1),e("span",{class:O(["ml-2 rounded-full px-2 py-0.5 text-xs",k.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":k.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},g(E(k)),3)]),e("span",zt,g(v(k.createdAt)),1)])],10,Bt))),128))])):f("",!0),C.platform==="claude"&&S.value.length>0?(l(),n("div",Nt,[x[6]||(x[6]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," Claude Console 专属账号 ",-1)),(l(!0),n(z,null,X(S.value,k=>(l(),n("div",{key:k.id,class:O(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===`console:${k.id}`}]),onClick:N=>c(`console:${k.id}`)},[e("div",Qt,[e("div",null,[e("span",Jt,g(k.name),1),e("span",{class:O(["ml-2 rounded-full px-2 py-0.5 text-xs",k.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":k.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},g(E(k)),3)]),e("span",Xt,g(v(k.createdAt)),1)])],10,Yt))),128))])):f("",!0),D.value&&!I.value?(l(),n("div",Zt,[...x[7]||(x[7]=[e("i",{class:"fas fa-search mb-2 text-2xl"},null,-1),e("p",{class:"text-sm"},"没有找到匹配的账号",-1)])])):f("",!0)])],4)):f("",!0)]),_:1})]))],512))}},he=be(es,[["__scopeId","data-v-7e9dcf0d"]]),ts={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},ss={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6"},as={class:"mb-4 flex items-center justify-between"},rs={class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-3 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20 sm:p-4"},ls={class:"flex items-center gap-3 sm:gap-4"},os={class:"flex cursor-pointer items-center"},ns={class:"flex cursor-pointer items-center"},is={key:0,class:"mt-3"},ds={class:"flex items-center gap-4"},us={class:"flex-1"},cs={class:"flex items-center gap-2"},gs={class:"mt-2 flex items-start text-xs text-amber-600 dark:text-amber-400"},ms=["placeholder"],xs={key:0,class:"mt-1 text-xs text-red-500 dark:text-red-400"},ps={class:"space-y-4"},ys={key:0},fs={class:"flex flex-wrap gap-2"},bs=["onClick"],vs={key:1},ks={class:"flex flex-wrap gap-2"},ws=["onClick"],hs={class:"flex gap-2"},$s=["onKeypress"],As={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},Cs={class:"space-y-2"},Is={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Ks={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-3 dark:border-green-700 dark:from-green-900/20 dark:to-emerald-900/20 sm:p-4"},Ls={class:"space-y-3"},Ds={class:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-6"},_s=["onClick"],Ms={class:"flex items-center gap-1"},Ts={class:"text-xs font-bold sm:text-sm"},Ss={key:0,class:"fas fa-check text-xs text-green-600 dark:text-green-400"},js={class:"text-xs text-gray-500 dark:text-gray-400"},Rs={class:"flex items-center gap-1"},Vs={key:0,class:"fas fa-check text-xs text-blue-600 dark:text-blue-400"},Ps={class:"flex items-center gap-1"},Es={key:0,class:"fas fa-check text-xs text-gray-600 dark:text-gray-400"},Us={class:"relative"},Os={key:0,class:"mt-3"},Gs=["min"],qs={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ws={class:"flex gap-4"},Bs={class:"flex cursor-pointer items-center"},Fs={class:"flex cursor-pointer items-center"},Hs={class:"flex cursor-pointer items-center"},zs={class:"flex cursor-pointer items-center"},Ns={class:"mb-2 flex items-center justify-between"},Ys=["disabled"],Qs={class:"grid grid-cols-1 gap-3"},Js={class:"mb-2 flex items-center"},Xs={key:0,class:"space-y-3"},Zs={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2"},ea=["onClick"],ta={key:0,class:"text-sm text-gray-400"},sa={class:"space-y-3"},aa={class:"flex flex-wrap gap-2"},ra=["onClick"],la={key:0,class:"text-sm italic text-gray-400"},oa={class:"flex gap-2"},na=["onKeydown"],ia={class:"mb-2 flex items-center"},da={key:0,class:"rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-700 dark:bg-green-900/20"},ua={class:"space-y-1"},ca=["id","value"],ga=["for"],ma={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},xa={class:"block text-xs text-gray-500 dark:text-gray-400"},pa={class:"flex gap-3 pt-2"},ya=["disabled"],fa={key:0,class:"loading-spinner mr-2"},ba={key:1,class:"fas fa-plus mr-2"},va={__name:"CreateApiKeyModal",props:{accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success","batch-success"],setup(C,{emit:Q}){const m=C,R=Q,G=Ge(),D=qe(),_=K(!1),U=K(!1),M=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),F=K({name:""}),V=K(""),h=K([]),E=Y(()=>h.value.filter(P=>!i.tags.includes(P))),p=K([]),a=K([{value:"10",label:"轻度使用"},{value:"50",label:"中度使用"},{value:"100",label:"重度使用"},{value:"200",label:"企业级"}]),i=Se({createType:"single",batchCount:10,name:"",description:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",expireDuration:"",customExpireDate:"",expiresAt:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[]});Te(async()=>{p.value=await G.loadSupportedClients(),h.value=await D.fetchTags(),m.accounts&&(M.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]})});const S=async()=>{var P,o;U.value=!0;try{const[y,Z,J,ae,pe,ge]=await Promise.all([B.get("/admin/claude-accounts"),B.get("/admin/claude-console-accounts"),B.get("/admin/gemini-accounts"),B.get("/admin/openai-accounts"),B.get("/admin/bedrock-accounts"),B.get("/admin/account-groups")]),ce=[];if(y.success&&((P=y.data)==null||P.forEach(te=>{ce.push({...te,platform:"claude-oauth",isDedicated:te.accountType==="dedicated"})})),Z.success&&((o=Z.data)==null||o.forEach(te=>{ce.push({...te,platform:"claude-console",isDedicated:te.accountType==="dedicated"})})),M.value.claude=ce,J.success&&(M.value.gemini=(J.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),ae.success&&(M.value.openai=(ae.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),pe.success&&(M.value.bedrock=(pe.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),ge.success){const te=ge.data||[];M.value.claudeGroups=te.filter($e=>$e.platform==="claude"),M.value.geminiGroups=te.filter($e=>$e.platform==="gemini"),M.value.openaiGroups=te.filter($e=>$e.platform==="openai")}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{U.value=!1}},I=Y(()=>{const P=new Date;return P.setMinutes(P.getMinutes()+1),P.toISOString().slice(0,16)}),v=()=>{if(!i.expireDuration){i.expiresAt=null;return}if(i.expireDuration==="custom")return;const P=new Date,y=i.expireDuration.match(/(\d+)([dhmy])/);if(y){const[,Z,J]=y,ae=parseInt(Z);switch(J){case"d":P.setDate(P.getDate()+ae);break;case"h":P.setHours(P.getHours()+ae);break;case"m":P.setMonth(P.getMonth()+ae);break;case"y":P.setFullYear(P.getFullYear()+ae);break}i.expiresAt=P.toISOString()}},$=()=>{i.customExpireDate&&(i.expiresAt=new Date(i.customExpireDate).toISOString())},u=P=>new Date(P).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),c=()=>{i.modelInput&&!i.restrictedModels.includes(i.modelInput)&&(i.restrictedModels.push(i.modelInput),i.modelInput="")},w=P=>{i.restrictedModels.splice(P,1)},ue=K(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),ie=Y(()=>ue.value.filter(P=>!i.restrictedModels.includes(P))),A=P=>{i.restrictedModels.includes(P)||i.restrictedModels.push(P)},r=()=>{if(V.value&&V.value.trim()){const P=V.value.trim();i.tags.includes(P)||i.tags.push(P),V.value=""}},x=P=>{i.tags.includes(P)||i.tags.push(P)},k=P=>{i.tags.splice(P,1)},N=async()=>{if(F.value.name="",!i.name||!i.name.trim()){F.value.name="请输入API Key名称";return}if(i.createType==="batch"&&(!i.batchCount||i.batchCount<2||i.batchCount>500)){W("批量创建数量必须在 2-500 之间","error");return}_.value=!0;try{const P={description:i.description||void 0,tokenLimit:i.tokenLimit!==""&&i.tokenLimit!==null?parseInt(i.tokenLimit):null,rateLimitWindow:i.rateLimitWindow!==""&&i.rateLimitWindow!==null?parseInt(i.rateLimitWindow):null,rateLimitRequests:i.rateLimitRequests!==""&&i.rateLimitRequests!==null?parseInt(i.rateLimitRequests):null,concurrencyLimit:i.concurrencyLimit!==""&&i.concurrencyLimit!==null?parseInt(i.concurrencyLimit):0,dailyCostLimit:i.dailyCostLimit!==""&&i.dailyCostLimit!==null?parseFloat(i.dailyCostLimit):0,expiresAt:i.expiresAt||void 0,permissions:i.permissions,tags:i.tags.length>0?i.tags:void 0,enableModelRestriction:i.enableModelRestriction,restrictedModels:i.restrictedModels,enableClientRestriction:i.enableClientRestriction,allowedClients:i.allowedClients};if(i.claudeAccountId&&(i.claudeAccountId.startsWith("console:")?(P.claudeConsoleAccountId=i.claudeAccountId.substring(8),delete P.claudeAccountId):(P.claudeAccountId=i.claudeAccountId,delete P.claudeConsoleAccountId)),i.geminiAccountId&&(P.geminiAccountId=i.geminiAccountId),i.openaiAccountId&&(P.openaiAccountId=i.openaiAccountId),i.bedrockAccountId&&(P.bedrockAccountId=i.bedrockAccountId),i.createType==="single"){const o={...P,name:i.name},y=await B.post("/admin/api-keys",o);y.success?(W("API Key 创建成功","success"),R("success",y.data),R("close")):W(y.message||"创建失败","error")}else{const o={...P,createType:"batch",baseName:i.name,count:i.batchCount},y=await B.post("/admin/api-keys/batch",o);y.success?(W(`成功创建 ${y.data.length} 个 API Key`,"success"),R("batch-success",y.data),R("close")):W(y.message||"批量创建失败","error")}}catch{W("创建失败","error")}finally{_.value=!1}};return(P,o)=>(l(),le(ve,{to:"body"},[e("div",ts,[e("div",ss,[e("div",as,[o[31]||(o[31]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-key text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 创建新的 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:o[0]||(o[0]=y=>P.$emit("close"))},[...o[30]||(o[30]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4",onSubmit:xe(N,["prevent"])},[e("div",rs,[e("div",{class:O(["flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",i.createType==="batch"?"mb-3":""])},[o[34]||(o[34]=e("label",{class:"flex h-full items-center text-xs font-semibold text-gray-700 dark:text-gray-300 sm:text-sm"},"创建类型",-1)),e("div",ls,[e("label",os,[T(e("input",{"onUpdate:modelValue":o[1]||(o[1]=y=>i.createType=y),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"single"},null,512),[[re,i.createType]]),o[32]||(o[32]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-key mr-1 text-xs"}),L(" 单个创建 ")],-1))]),e("label",ns,[T(e("input",{"onUpdate:modelValue":o[2]||(o[2]=y=>i.createType=y),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"batch"},null,512),[[re,i.createType]]),o[33]||(o[33]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-layer-group mr-1 text-xs"}),L(" 批量创建 ")],-1))])])],2),i.createType==="batch"?(l(),n("div",is,[e("div",ds,[e("div",us,[o[36]||(o[36]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"创建数量",-1)),e("div",cs,[T(e("input",{"onUpdate:modelValue":o[3]||(o[3]=y=>i.batchCount=y),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",max:"500",min:"2",placeholder:"输入数量 (2-500)",required:"",type:"number"},null,512),[[ee,i.batchCount,void 0,{number:!0}]]),o[35]||(o[35]=e("div",{class:"whitespace-nowrap text-xs text-gray-500 dark:text-gray-400"}," 最大支持 500 个 ",-1))])])]),e("p",gs,[o[37]||(o[37]=e("i",{class:"fas fa-info-circle mr-1 mt-0.5 flex-shrink-0"},null,-1)),e("span",null,"批量创建时，每个 Key 的名称会自动添加序号后缀，例如："+g(i.name||"MyKey")+"_1, "+g(i.name||"MyKey")+"_2 ...",1)])])):f("",!0)]),e("div",null,[o[38]||(o[38]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-2 sm:text-sm"},[L("名称 "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{"onUpdate:modelValue":o[4]||(o[4]=y=>i.name=y),class:O(["form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",{"border-red-500":F.value.name}]),placeholder:i.createType==="batch"?"输入基础名称（将自动添加序号）":"为您的 API Key 取一个名称",required:"",type:"text",onInput:o[5]||(o[5]=y=>F.value.name="")},null,42,ms),[[ee,i.name]]),F.value.name?(l(),n("p",xs,g(F.value.name),1)):f("",!0)]),e("div",null,[o[46]||(o[46]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"标签",-1)),e("div",ps,[i.tags.length>0?(l(),n("div",ys,[o[40]||(o[40]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",fs,[(l(!0),n(z,null,X(i.tags,(y,Z)=>(l(),n("span",{key:"selected-"+Z,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[L(g(y)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:J=>k(Z)},[...o[39]||(o[39]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,bs)]))),128))])])):f("",!0),E.value.length>0?(l(),n("div",vs,[o[42]||(o[42]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",ks,[(l(!0),n(z,null,X(E.value,y=>(l(),n("button",{key:"available-"+y,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:Z=>x(y)},[o[41]||(o[41]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(y),1)],8,ws))),128))])])):f("",!0),e("div",null,[o[44]||(o[44]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",hs,[T(e("input",{"onUpdate:modelValue":o[6]||(o[6]=y=>V.value=y),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:Me(xe(r,["prevent"]),["enter"])},null,40,$s),[[ee,V.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:r},[...o[43]||(o[43]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),o[45]||(o[45]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",As,[o[54]||(o[54]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",Cs,[e("div",Is,[e("div",null,[o[47]||(o[47]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),T(e("input",{"onUpdate:modelValue":o[7]||(o[7]=y=>i.rateLimitWindow=y),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,i.rateLimitWindow]]),o[48]||(o[48]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[o[49]||(o[49]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":o[8]||(o[8]=y=>i.rateLimitRequests=y),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,i.rateLimitRequests]]),o[50]||(o[50]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[o[51]||(o[51]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":o[9]||(o[9]=y=>i.tokenLimit=y),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"无限制",type:"number"},null,512),[[ee,i.tokenLimit]]),o[52]||(o[52]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"}," 窗口内最大Token ",-1))])]),o[53]||(o[53]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),L(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),L(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),L(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",Ks,[o[63]||(o[63]=e("div",{class:"mb-3 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-green-500"},[e("i",{class:"fas fa-dollar-sign text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 每日费用限制 (可选) ")],-1)),e("div",Ls,[e("div",null,[o[59]||(o[59]=e("label",{class:"mb-2 block text-xs font-medium text-gray-600 dark:text-gray-400"},"选择预设限额",-1)),e("div",Ds,[(l(!0),n(z,null,X(a.value,y=>(l(),n("button",{key:y.value,class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",i.dailyCostLimit==y.value?"border-green-500 bg-green-100 text-green-800 dark:border-green-400 dark:bg-green-900/30 dark:text-green-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:Z=>i.dailyCostLimit=y.value},[e("div",Ms,[e("span",Ts,"$"+g(y.value),1),i.dailyCostLimit==y.value?(l(),n("i",Ss)):f("",!0)]),e("span",js,g(y.label),1)],10,_s))),128)),e("button",{class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",!a.value.find(y=>y.value==i.dailyCostLimit)&&i.dailyCostLimit&&i.dailyCostLimit!="0"?"border-blue-500 bg-blue-100 text-blue-800 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:o[10]||(o[10]=y=>i.dailyCostLimit="")},[e("div",Rs,[o[55]||(o[55]=e("i",{class:"fas fa-edit text-xs sm:text-sm"},null,-1)),!a.value.find(y=>y.value==i.dailyCostLimit)&&i.dailyCostLimit&&i.dailyCostLimit!="0"?(l(),n("i",Vs)):f("",!0)]),o[56]||(o[56]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"自定义",-1))],2),e("button",{class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",!i.dailyCostLimit||i.dailyCostLimit=="0"?"border-gray-500 bg-gray-100 text-gray-800 dark:border-gray-400 dark:bg-gray-700 dark:text-gray-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:o[11]||(o[11]=y=>i.dailyCostLimit="0")},[e("div",Ps,[o[57]||(o[57]=e("i",{class:"fas fa-infinity text-xs sm:text-sm"},null,-1)),!i.dailyCostLimit||i.dailyCostLimit=="0"?(l(),n("i",Es)):f("",!0)]),o[58]||(o[58]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"无限制",-1))],2)])]),e("div",null,[o[61]||(o[61]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"自定义金额 (美元)",-1)),e("div",Us,[o[60]||(o[60]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 dark:text-gray-400"},"$")],-1)),T(e("input",{"onUpdate:modelValue":o[12]||(o[12]=y=>i.dailyCostLimit=y),class:"form-input w-full pl-8 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"输入自定义金额或0表示无限制",step:"0.01",type:"number"},null,512),[[ee,i.dailyCostLimit]])])]),o[62]||(o[62]=e("div",{class:"rounded-lg bg-green-100 p-3 dark:bg-green-900/30"},[e("div",{class:"mb-2 flex items-start gap-2"},[e("i",{class:"fas fa-lightbulb mt-0.5 text-xs text-green-600 dark:text-green-400"}),e("div",{class:"flex-1"},[e("h5",{class:"text-xs font-semibold text-green-800 dark:text-green-300"}," 费用控制说明 "),e("div",{class:"mt-1 space-y-1 text-xs text-green-700 dark:text-green-300"},[e("p",null,"• 达到限制后，新请求将被拒绝并返回 402 错误"),e("p",null,"• 费用统计每分钟更新一次，可能存在轻微延迟"),e("p",null,"• 建议根据使用场景设置合理的限制金额")])])]),e("div",{class:"mt-2 border-t border-green-200 pt-2 dark:border-green-800"},[e("div",{class:"text-xs font-medium text-green-800 dark:text-green-300"}," 参考费用 (Claude)： "),e("div",{class:"mt-1 grid grid-cols-1 gap-x-4 text-xs text-green-700 dark:text-green-300 sm:grid-cols-2"},[e("div",null,"• Haiku: ~$0.25/1M tokens"),e("div",null,"• Sonnet: ~$3/1M tokens"),e("div",null,"• Opus: ~$15/1M tokens"),e("div",null,"• 1万字约1.5K tokens")])])],-1))])]),e("div",null,[o[64]||(o[64]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制 (可选)",-1)),T(e("input",{"onUpdate:modelValue":o[13]||(o[13]=y=>i.concurrencyLimit=y),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[ee,i.concurrencyLimit]]),o[65]||(o[65]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数，0 或留空表示无限制 ",-1))]),e("div",null,[o[66]||(o[66]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注 (可选)",-1)),T(e("textarea",{"onUpdate:modelValue":o[14]||(o[14]=y=>i.description=y),class:"form-input w-full resize-none text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"描述此 API Key 的用途...",rows:"2"},null,512),[[ee,i.description]])]),e("div",null,[o[68]||(o[68]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"有效期限",-1)),T(e("select",{"onUpdate:modelValue":o[15]||(o[15]=y=>i.expireDuration=y),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",onChange:v},[...o[67]||(o[67]=[e("option",{value:""},"永不过期",-1),e("option",{value:"1d"},"1 天",-1),e("option",{value:"7d"},"7 天",-1),e("option",{value:"30d"},"30 天",-1),e("option",{value:"90d"},"90 天",-1),e("option",{value:"180d"},"180 天",-1),e("option",{value:"365d"},"365 天",-1),e("option",{value:"custom"},"自定义日期",-1)])],544),[[Ce,i.expireDuration]]),i.expireDuration==="custom"?(l(),n("div",Os,[T(e("input",{"onUpdate:modelValue":o[16]||(o[16]=y=>i.customExpireDate=y),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:I.value,type:"datetime-local",onChange:$},null,40,Gs),[[ee,i.customExpireDate]])])):f("",!0),i.expiresAt?(l(),n("p",qs," 将于 "+g(u(i.expiresAt))+" 过期 ",1)):f("",!0)]),e("div",null,[o[73]||(o[73]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",Ws,[e("label",Bs,[T(e("input",{"onUpdate:modelValue":o[17]||(o[17]=y=>i.permissions=y),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[re,i.permissions]]),o[69]||(o[69]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",Fs,[T(e("input",{"onUpdate:modelValue":o[18]||(o[18]=y=>i.permissions=y),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[re,i.permissions]]),o[70]||(o[70]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",Hs,[T(e("input",{"onUpdate:modelValue":o[19]||(o[19]=y=>i.permissions=y),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[re,i.permissions]]),o[71]||(o[71]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",zs,[T(e("input",{"onUpdate:modelValue":o[20]||(o[20]=y=>i.permissions=y),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[re,i.permissions]]),o[72]||(o[72]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))])]),o[74]||(o[74]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",Ns,[o[75]||(o[75]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定 (可选)",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:U.value,title:"刷新账号列表",type:"button",onClick:S},[e("i",{class:O(["fas",U.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(U.value?"刷新中...":"刷新账号"),1)],8,Ys)]),e("div",Qs,[e("div",null,[o[76]||(o[76]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),ne(he,{modelValue:i.claudeAccountId,"onUpdate:modelValue":o[21]||(o[21]=y=>i.claudeAccountId=y),accounts:M.value.claude,"default-option-text":"使用共享账号池",disabled:i.permissions==="gemini"||i.permissions==="openai",groups:M.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[o[77]||(o[77]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),ne(he,{modelValue:i.geminiAccountId,"onUpdate:modelValue":o[22]||(o[22]=y=>i.geminiAccountId=y),accounts:M.value.gemini,"default-option-text":"使用共享账号池",disabled:i.permissions==="claude"||i.permissions==="openai",groups:M.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[o[78]||(o[78]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),ne(he,{modelValue:i.openaiAccountId,"onUpdate:modelValue":o[23]||(o[23]=y=>i.openaiAccountId=y),accounts:M.value.openai,"default-option-text":"使用共享账号池",disabled:i.permissions==="claude"||i.permissions==="gemini",groups:M.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[o[79]||(o[79]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),ne(he,{modelValue:i.bedrockAccountId,"onUpdate:modelValue":o[24]||(o[24]=y=>i.bedrockAccountId=y),accounts:M.value.bedrock,"default-option-text":"使用共享账号池",disabled:i.permissions==="gemini"||i.permissions==="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])])]),o[80]||(o[80]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择专属账号后，此API Key将只使用该账号，不选择则使用共享账号池 ",-1))]),e("div",null,[e("div",Js,[T(e("input",{id:"enableModelRestriction","onUpdate:modelValue":o[25]||(o[25]=y=>i.enableModelRestriction=y),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[fe,i.enableModelRestriction]]),o[81]||(o[81]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableModelRestriction"}," 启用模型限制 ",-1))]),i.enableModelRestriction?(l(),n("div",Xs,[e("div",null,[o[84]||(o[84]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600"},"限制的模型列表",-1)),e("div",Zs,[(l(!0),n(z,null,X(i.restrictedModels,(y,Z)=>(l(),n("span",{key:Z,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800"},[L(g(y)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800",type:"button",onClick:J=>w(Z)},[...o[82]||(o[82]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,ea)]))),128)),i.restrictedModels.length===0?(l(),n("span",ta," 暂无限制的模型 ")):f("",!0)]),e("div",sa,[e("div",aa,[(l(!0),n(z,null,X(ie.value,y=>(l(),n("button",{key:y,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 sm:text-sm",type:"button",onClick:Z=>A(y)},g(y),9,ra))),128)),ie.value.length===0?(l(),n("span",la," 所有常用模型已在限制列表中 ")):f("",!0)]),e("div",oa,[T(e("input",{"onUpdate:modelValue":o[26]||(o[26]=y=>i.modelInput=y),class:"form-input flex-1",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:Me(xe(c,["prevent"]),["enter"])},null,40,na),[[ee,i.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:c},[...o[83]||(o[83]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),o[85]||(o[85]=e("p",{class:"mt-2 text-xs text-gray-500"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):f("",!0)]),e("div",null,[e("div",ia,[T(e("input",{id:"enableClientRestriction","onUpdate:modelValue":o[27]||(o[27]=y=>i.enableClientRestriction=y),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[fe,i.enableClientRestriction]]),o[86]||(o[86]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableClientRestriction"}," 启用客户端限制 ",-1))]),i.enableClientRestriction?(l(),n("div",da,[e("div",null,[o[87]||(o[87]=e("label",{class:"mb-2 block text-xs font-medium text-gray-700 dark:text-gray-300"},"允许的客户端",-1)),e("div",ua,[(l(!0),n(z,null,X(p.value,y=>(l(),n("div",{key:y.id,class:"flex items-start"},[T(e("input",{id:`client_${y.id}`,"onUpdate:modelValue":o[28]||(o[28]=Z=>i.allowedClients=Z),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:y.id},null,8,ca),[[fe,i.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`client_${y.id}`},[e("span",ma,g(y.name),1),e("span",xa,g(y.description),1)],8,ga)]))),128))])])])):f("",!0)]),e("div",pa,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:o[29]||(o[29]=y=>P.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 text-sm font-semibold",disabled:_.value,type:"submit"},[_.value?(l(),n("div",fa)):(l(),n("i",ba)),L(" "+g(_.value?"创建中...":"创建"),1)],8,ya)])],32)])])]))}},ka=be(va,[["__scopeId","data-v-46e27c90"]]),wa={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},ha={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},$a={class:"mb-4 flex items-center justify-between sm:mb-6"},Aa=["value"],Ca={class:"space-y-4"},Ia={key:0},Ka={class:"flex flex-wrap gap-2"},La=["onClick"],Da={key:1},_a={class:"flex flex-wrap gap-2"},Ma=["onClick"],Ta={class:"flex gap-2"},Sa=["onKeypress"],ja={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},Ra={class:"space-y-2"},Va={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Pa={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:border-green-700 dark:from-green-900/20 dark:to-emerald-900/20"},Ea={class:"space-y-3"},Ua={class:"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:flex lg:gap-2"},Oa=["onClick"],Ga={class:"flex items-center gap-1"},qa={class:"text-sm font-bold"},Wa={key:0,class:"fas fa-check text-xs text-green-600 dark:text-green-400"},Ba={class:"text-xs text-gray-500 dark:text-gray-400"},Fa={class:"flex items-center gap-1"},Ha={key:0,class:"fas fa-check text-xs text-blue-600 dark:text-blue-400"},za={class:"flex items-center gap-1"},Na={key:0,class:"fas fa-check text-xs text-gray-600 dark:text-gray-400"},Ya={class:"relative"},Qa={class:"mb-3 flex items-center"},Ja={class:"flex gap-4"},Xa={class:"flex cursor-pointer items-center"},Za={class:"flex cursor-pointer items-center"},er={class:"flex cursor-pointer items-center"},tr={class:"flex cursor-pointer items-center"},sr={class:"mb-3 flex items-center justify-between"},ar=["disabled"],rr={class:"grid grid-cols-1 gap-3"},lr={class:"mb-3 flex items-center"},or={key:0,class:"space-y-3"},nr={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2 dark:border-gray-600 dark:bg-gray-700"},ir=["onClick"],dr={key:0,class:"text-sm text-gray-400 dark:text-gray-500"},ur={class:"space-y-3"},cr={class:"flex flex-wrap gap-2"},gr=["onClick"],mr={key:0,class:"text-sm italic text-gray-400 dark:text-gray-500"},xr={class:"flex gap-2"},pr=["onKeydown"],yr={class:"mb-3 flex items-center"},fr={key:0,class:"space-y-3"},br={class:"space-y-2"},vr=["id","value"],kr=["for"],wr={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},hr={class:"block text-xs text-gray-500 dark:text-gray-400"},$r={class:"flex gap-3 pt-4"},Ar=["disabled"],Cr={key:0,class:"loading-spinner mr-2"},Ir={key:1,class:"fas fa-save mr-2"},Kr={__name:"EditApiKeyModal",props:{apiKey:{type:Object,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success"],setup(C,{emit:Q}){const m=C,R=Q,G=Ge(),D=qe(),_=K(!1),U=K(!1),M=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),F=K([]),V=K([{value:"10",label:"轻度使用"},{value:"50",label:"中度使用"},{value:"100",label:"重度使用"},{value:"200",label:"企业级"}]),h=K(""),E=K([]),p=Y(()=>E.value.filter(A=>!a.tags.includes(A))),a=Se({name:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[],isActive:!0}),i=()=>{a.modelInput&&!a.restrictedModels.includes(a.modelInput)&&(a.restrictedModels.push(a.modelInput),a.modelInput="")},S=A=>{a.restrictedModels.splice(A,1)},I=K(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),v=Y(()=>I.value.filter(A=>!a.restrictedModels.includes(A))),$=A=>{a.restrictedModels.includes(A)||a.restrictedModels.push(A)},u=()=>{if(h.value&&h.value.trim()){const A=h.value.trim();a.tags.includes(A)||a.tags.push(A),h.value=""}},c=A=>{a.tags.includes(A)||a.tags.push(A)},w=A=>{a.tags.splice(A,1)},ue=async()=>{_.value=!0;try{const A={tokenLimit:a.tokenLimit!==""&&a.tokenLimit!==null?parseInt(a.tokenLimit):0,rateLimitWindow:a.rateLimitWindow!==""&&a.rateLimitWindow!==null?parseInt(a.rateLimitWindow):0,rateLimitRequests:a.rateLimitRequests!==""&&a.rateLimitRequests!==null?parseInt(a.rateLimitRequests):0,concurrencyLimit:a.concurrencyLimit!==""&&a.concurrencyLimit!==null?parseInt(a.concurrencyLimit):0,dailyCostLimit:a.dailyCostLimit!==""&&a.dailyCostLimit!==null?parseFloat(a.dailyCostLimit):0,permissions:a.permissions,tags:a.tags};a.claudeAccountId?a.claudeAccountId.startsWith("console:")?(A.claudeConsoleAccountId=a.claudeAccountId.substring(8),A.claudeAccountId=null):(a.claudeAccountId.startsWith("group:"),A.claudeAccountId=a.claudeAccountId,A.claudeConsoleAccountId=null):(A.claudeAccountId=null,A.claudeConsoleAccountId=null),a.geminiAccountId?A.geminiAccountId=a.geminiAccountId:A.geminiAccountId=null,a.openaiAccountId?A.openaiAccountId=a.openaiAccountId:A.openaiAccountId=null,a.bedrockAccountId?A.bedrockAccountId=a.bedrockAccountId:A.bedrockAccountId=null,A.enableModelRestriction=a.enableModelRestriction,A.restrictedModels=a.restrictedModels,A.enableClientRestriction=a.enableClientRestriction,A.allowedClients=a.allowedClients,A.isActive=a.isActive;const r=await B.put(`/admin/api-keys/${m.apiKey.id}`,A);r.success?(R("success"),R("close")):W(r.message||"更新失败","error")}catch{W("更新失败","error")}finally{_.value=!1}},ie=async()=>{var A,r;U.value=!0;try{const[x,k,N,P,o,y]=await Promise.all([B.get("/admin/claude-accounts"),B.get("/admin/claude-console-accounts"),B.get("/admin/gemini-accounts"),B.get("/admin/openai-accounts"),B.get("/admin/bedrock-accounts"),B.get("/admin/account-groups")]),Z=[];if(x.success&&((A=x.data)==null||A.forEach(J=>{Z.push({...J,platform:"claude-oauth",isDedicated:J.accountType==="dedicated"})})),k.success&&((r=k.data)==null||r.forEach(J=>{Z.push({...J,platform:"claude-console",isDedicated:J.accountType==="dedicated"})})),M.value.claude=Z,N.success&&(M.value.gemini=(N.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),P.success&&(M.value.openai=(P.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),o.success&&(M.value.bedrock=(o.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),y.success){const J=y.data||[];M.value.claudeGroups=J.filter(ae=>ae.platform==="claude"),M.value.geminiGroups=J.filter(ae=>ae.platform==="gemini"),M.value.openaiGroups=J.filter(ae=>ae.platform==="openai")}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{U.value=!1}};return Te(async()=>{F.value=await G.loadSupportedClients(),E.value=await D.fetchTags(),m.accounts&&(M.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]}),a.name=m.apiKey.name,a.tokenLimit=m.apiKey.tokenLimit||"",a.rateLimitWindow=m.apiKey.rateLimitWindow||"",a.rateLimitRequests=m.apiKey.rateLimitRequests||"",a.concurrencyLimit=m.apiKey.concurrencyLimit||"",a.dailyCostLimit=m.apiKey.dailyCostLimit||"",a.permissions=m.apiKey.permissions||"all",m.apiKey.claudeConsoleAccountId?a.claudeAccountId=`console:${m.apiKey.claudeConsoleAccountId}`:a.claudeAccountId=m.apiKey.claudeAccountId||"",a.geminiAccountId=m.apiKey.geminiAccountId||"",a.openaiAccountId=m.apiKey.openaiAccountId||"",a.bedrockAccountId=m.apiKey.bedrockAccountId||"",a.restrictedModels=m.apiKey.restrictedModels||[],a.allowedClients=m.apiKey.allowedClients||[],a.tags=m.apiKey.tags||[],a.enableModelRestriction=m.apiKey.enableModelRestriction||!1,a.enableClientRestriction=m.apiKey.enableClientRestriction||!1,a.isActive=m.apiKey.isActive!==void 0?m.apiKey.isActive:!0}),(A,r)=>(l(),le(ve,{to:"body"},[e("div",wa,[e("div",ha,[e("div",$a,[r[24]||(r[24]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 编辑 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:r[0]||(r[0]=x=>A.$emit("close"))},[...r[23]||(r[23]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:xe(ue,["prevent"])},[e("div",null,[r[25]||(r[25]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"名称",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400",disabled:"",type:"text",value:a.name},null,8,Aa),r[26]||(r[26]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400 sm:mt-2"},"名称不可修改",-1))]),e("div",null,[r[34]||(r[34]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"标签",-1)),e("div",Ca,[a.tags.length>0?(l(),n("div",Ia,[r[28]||(r[28]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",Ka,[(l(!0),n(z,null,X(a.tags,(x,k)=>(l(),n("span",{key:"selected-"+k,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[L(g(x)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:N=>w(k)},[...r[27]||(r[27]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,La)]))),128))])])):f("",!0),p.value.length>0?(l(),n("div",Da,[r[30]||(r[30]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",_a,[(l(!0),n(z,null,X(p.value,x=>(l(),n("button",{key:"available-"+x,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:k=>c(x)},[r[29]||(r[29]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(x),1)],8,Ma))),128))])])):f("",!0),e("div",null,[r[32]||(r[32]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Ta,[T(e("input",{"onUpdate:modelValue":r[1]||(r[1]=x=>h.value=x),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:Me(xe(u,["prevent"]),["enter"])},null,40,Sa),[[ee,h.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:u},[...r[31]||(r[31]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),r[33]||(r[33]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",ja,[r[42]||(r[42]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",Ra,[e("div",Va,[e("div",null,[r[35]||(r[35]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),T(e("input",{"onUpdate:modelValue":r[2]||(r[2]=x=>a.rateLimitWindow=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,a.rateLimitWindow]]),r[36]||(r[36]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[r[37]||(r[37]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":r[3]||(r[3]=x=>a.rateLimitRequests=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,a.rateLimitRequests]]),r[38]||(r[38]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[r[39]||(r[39]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":r[4]||(r[4]=x=>a.tokenLimit=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"无限制",type:"number"},null,512),[[ee,a.tokenLimit]]),r[40]||(r[40]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"}," 窗口内最大Token ",-1))])]),r[41]||(r[41]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),L(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),L(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),L(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",Pa,[r[51]||(r[51]=e("div",{class:"mb-3 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-green-500"},[e("i",{class:"fas fa-dollar-sign text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 每日费用限制 (可选) ")],-1)),e("div",Ea,[e("div",null,[r[47]||(r[47]=e("label",{class:"mb-2 block text-xs font-medium text-gray-600 dark:text-gray-400"},"选择预设限额",-1)),e("div",Ua,[(l(!0),n(z,null,X(V.value,x=>(l(),n("button",{key:x.value,class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",a.dailyCostLimit==x.value?"border-green-500 bg-green-100 text-green-800 dark:border-green-400 dark:bg-green-900/30 dark:text-green-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:k=>a.dailyCostLimit=x.value},[e("div",Ga,[e("span",qa,"$"+g(x.value),1),a.dailyCostLimit==x.value?(l(),n("i",Wa)):f("",!0)]),e("span",Ba,g(x.label),1)],10,Oa))),128)),e("button",{class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",!V.value.find(x=>x.value==a.dailyCostLimit)&&a.dailyCostLimit?"border-blue-500 bg-blue-100 text-blue-800 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:r[5]||(r[5]=x=>a.dailyCostLimit="")},[e("div",Fa,[r[43]||(r[43]=e("i",{class:"fas fa-edit text-sm"},null,-1)),!V.value.find(x=>x.value==a.dailyCostLimit)&&a.dailyCostLimit?(l(),n("i",Ha)):f("",!0)]),r[44]||(r[44]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"自定义",-1))],2),e("button",{class:O(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",!a.dailyCostLimit||a.dailyCostLimit=="0"?"border-gray-500 bg-gray-100 text-gray-800 dark:border-gray-400 dark:bg-gray-700 dark:text-gray-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:r[6]||(r[6]=x=>a.dailyCostLimit="0")},[e("div",za,[r[45]||(r[45]=e("i",{class:"fas fa-infinity text-sm"},null,-1)),!a.dailyCostLimit||a.dailyCostLimit=="0"?(l(),n("i",Na)):f("",!0)]),r[46]||(r[46]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"无限制",-1))],2)])]),e("div",null,[r[49]||(r[49]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"自定义金额 (美元)",-1)),e("div",Ya,[r[48]||(r[48]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 dark:text-gray-400"},"$")],-1)),T(e("input",{"onUpdate:modelValue":r[7]||(r[7]=x=>a.dailyCostLimit=x),class:"form-input w-full pl-8 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"输入自定义金额或0表示无限制",step:"0.01",type:"number"},null,512),[[ee,a.dailyCostLimit]])])]),r[50]||(r[50]=e("div",{class:"rounded-lg bg-green-100 p-3 dark:bg-green-900/30"},[e("div",{class:"mb-2 flex items-start gap-2"},[e("i",{class:"fas fa-lightbulb mt-0.5 text-xs text-green-600 dark:text-green-400"}),e("div",{class:"flex-1"},[e("h5",{class:"text-xs font-semibold text-green-800 dark:text-green-300"}," 费用控制说明 "),e("div",{class:"mt-1 space-y-1 text-xs text-green-700 dark:text-green-300"},[e("p",null,"• 达到限制后，新请求将被拒绝并返回 402 错误"),e("p",null,"• 费用统计每分钟更新一次，可能存在轻微延迟"),e("p",null,"• 建议根据使用场景设置合理的限制金额")])])]),e("div",{class:"mt-2 border-t border-green-200 pt-2 dark:border-green-800"},[e("div",{class:"text-xs font-medium text-green-800 dark:text-green-300"}," 参考费用 (Claude)： "),e("div",{class:"mt-1 grid grid-cols-2 gap-x-4 text-xs text-green-700 dark:text-green-300"},[e("div",null,"• Haiku: ~$0.25/1M tokens"),e("div",null,"• Sonnet: ~$3/1M tokens"),e("div",null,"• Opus: ~$15/1M tokens"),e("div",null,"• 1万字约1.5K tokens")])])],-1))])]),e("div",null,[r[52]||(r[52]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),T(e("input",{"onUpdate:modelValue":r[8]||(r[8]=x=>a.concurrencyLimit=x),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[ee,a.concurrencyLimit]]),r[53]||(r[53]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数 ",-1))]),e("div",null,[e("div",Qa,[T(e("input",{id:"editIsActive","onUpdate:modelValue":r[9]||(r[9]=x=>a.isActive=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[fe,a.isActive]]),r[54]||(r[54]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editIsActive"}," 激活账号 ",-1))]),r[55]||(r[55]=e("p",{class:"mb-4 text-xs text-gray-500 dark:text-gray-400"}," 取消勾选将禁用此 API Key，暂停所有请求，客户端返回 401 错误 ",-1))]),e("div",null,[r[60]||(r[60]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",Ja,[e("label",Xa,[T(e("input",{"onUpdate:modelValue":r[10]||(r[10]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[re,a.permissions]]),r[56]||(r[56]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",Za,[T(e("input",{"onUpdate:modelValue":r[11]||(r[11]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[re,a.permissions]]),r[57]||(r[57]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",er,[T(e("input",{"onUpdate:modelValue":r[12]||(r[12]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[re,a.permissions]]),r[58]||(r[58]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",tr,[T(e("input",{"onUpdate:modelValue":r[13]||(r[13]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[re,a.permissions]]),r[59]||(r[59]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))])]),r[61]||(r[61]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",sr,[r[62]||(r[62]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:U.value,title:"刷新账号列表",type:"button",onClick:ie},[e("i",{class:O(["fas",U.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(U.value?"刷新中...":"刷新账号"),1)],8,ar)]),e("div",rr,[e("div",null,[r[63]||(r[63]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),ne(he,{modelValue:a.claudeAccountId,"onUpdate:modelValue":r[14]||(r[14]=x=>a.claudeAccountId=x),accounts:M.value.claude,"default-option-text":"使用共享账号池",disabled:a.permissions==="gemini"||a.permissions==="openai",groups:M.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[64]||(r[64]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),ne(he,{modelValue:a.geminiAccountId,"onUpdate:modelValue":r[15]||(r[15]=x=>a.geminiAccountId=x),accounts:M.value.gemini,"default-option-text":"使用共享账号池",disabled:a.permissions==="claude"||a.permissions==="openai",groups:M.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[65]||(r[65]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),ne(he,{modelValue:a.openaiAccountId,"onUpdate:modelValue":r[16]||(r[16]=x=>a.openaiAccountId=x),accounts:M.value.openai,"default-option-text":"使用共享账号池",disabled:a.permissions==="claude"||a.permissions==="gemini",groups:M.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[66]||(r[66]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),ne(he,{modelValue:a.bedrockAccountId,"onUpdate:modelValue":r[17]||(r[17]=x=>a.bedrockAccountId=x),accounts:M.value.bedrock,"default-option-text":"使用共享账号池",disabled:a.permissions==="gemini"||a.permissions==="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])])]),r[67]||(r[67]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 修改绑定账号将影响此API Key的请求路由 ",-1))]),e("div",null,[e("div",lr,[T(e("input",{id:"editEnableModelRestriction","onUpdate:modelValue":r[18]||(r[18]=x=>a.enableModelRestriction=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[fe,a.enableModelRestriction]]),r[68]||(r[68]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableModelRestriction"}," 启用模型限制 ",-1))]),a.enableModelRestriction?(l(),n("div",or,[e("div",null,[r[71]||(r[71]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"限制的模型列表",-1)),e("div",nr,[(l(!0),n(z,null,X(a.restrictedModels,(x,k)=>(l(),n("span",{key:k,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800 dark:bg-red-900/30 dark:text-red-400"},[L(g(x)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",type:"button",onClick:N=>S(k)},[...r[69]||(r[69]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,ir)]))),128)),a.restrictedModels.length===0?(l(),n("span",dr," 暂无限制的模型 ")):f("",!0)]),e("div",ur,[e("div",cr,[(l(!0),n(z,null,X(v.value,x=>(l(),n("button",{key:x,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 sm:text-sm",type:"button",onClick:k=>$(x)},g(x),9,gr))),128)),v.value.length===0?(l(),n("span",mr," 所有常用模型已在限制列表中 ")):f("",!0)]),e("div",xr,[T(e("input",{"onUpdate:modelValue":r[19]||(r[19]=x=>a.modelInput=x),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:Me(xe(i,["prevent"]),["enter"])},null,40,pr),[[ee,a.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:i},[...r[70]||(r[70]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),r[72]||(r[72]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):f("",!0)]),e("div",null,[e("div",yr,[T(e("input",{id:"editEnableClientRestriction","onUpdate:modelValue":r[20]||(r[20]=x=>a.enableClientRestriction=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[fe,a.enableClientRestriction]]),r[73]||(r[73]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableClientRestriction"}," 启用客户端限制 ",-1))]),a.enableClientRestriction?(l(),n("div",fr,[e("div",null,[r[74]||(r[74]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"允许的客户端",-1)),r[75]||(r[75]=e("p",{class:"mb-3 text-xs text-gray-500 dark:text-gray-400"}," 勾选允许使用此API Key的客户端 ",-1)),e("div",br,[(l(!0),n(z,null,X(F.value,x=>(l(),n("div",{key:x.id,class:"flex items-start"},[T(e("input",{id:`edit_client_${x.id}`,"onUpdate:modelValue":r[21]||(r[21]=k=>a.allowedClients=k),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:x.id},null,8,vr),[[fe,a.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`edit_client_${x.id}`},[e("span",wr,g(x.name),1),e("span",hr,g(x.description),1)],8,kr)]))),128))])])])):f("",!0)]),e("div",$r,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:r[22]||(r[22]=x=>A.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:_.value,type:"submit"},[_.value?(l(),n("div",Cr)):(l(),n("i",Ir)),L(" "+g(_.value?"保存中...":"保存修改"),1)],8,Ar)])],32)])])]))}},Lr=be(Kr,[["__scopeId","data-v-0c07e640"]]),Dr={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},_r={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-8"},Mr={class:"mb-6 flex items-center justify-between"},Tr={class:"modal-scroll-content custom-scrollbar flex-1 space-y-6"},Sr={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},jr={class:"flex items-start gap-3"},Rr={class:"text-sm text-gray-700"},Vr={class:"mt-1 text-xs text-gray-600"},Pr={key:0,class:"mt-3"},Er=["min"],Ur={key:1,class:"mt-2 text-xs text-gray-500"},Or={class:"flex gap-3 pt-4"},Gr=["disabled"],qr={key:0,class:"loading-spinner mr-2"},Wr={key:1,class:"fas fa-clock mr-2"},Br={__name:"RenewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close","success"],setup(C,{emit:Q}){const m=C,R=Q,G=K(!1),D=Se({renewDuration:"30d",customExpireDate:"",newExpiresAt:null}),_=Y(()=>{const h=new Date;return m.apiKey.expiresAt&&new Date(m.apiKey.expiresAt)>h?new Date(m.apiKey.expiresAt).toISOString().slice(0,16):(h.setMinutes(h.getMinutes()+1),h.toISOString().slice(0,16))}),U=h=>new Date(h).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),M=()=>{if(!D.renewDuration){D.newExpiresAt=null;return}if(D.renewDuration==="permanent"){D.newExpiresAt=null;return}if(D.renewDuration==="custom")return;const h=m.apiKey.expiresAt&&new Date(m.apiKey.expiresAt)>new Date?new Date(m.apiKey.expiresAt):new Date,p=D.renewDuration.match(/(\d+)([dhmy])/);if(p){const[,a,i]=p,S=parseInt(a);switch(i){case"d":h.setDate(h.getDate()+S);break;case"h":h.setHours(h.getHours()+S);break;case"m":h.setMonth(h.getMonth()+S);break;case"y":h.setFullYear(h.getFullYear()+S);break}D.newExpiresAt=h.toISOString()}},F=()=>{D.customExpireDate&&(D.newExpiresAt=new Date(D.customExpireDate).toISOString())},V=async()=>{G.value=!0;try{const h={expiresAt:D.renewDuration==="permanent"?null:D.newExpiresAt},E=await B.put(`/admin/api-keys/${m.apiKey.id}`,h);E.success?(W("API Key 续期成功","success"),R("success"),R("close")):W(E.message||"续期失败","error")}catch{W("续期失败","error")}finally{G.value=!1}};return M(),(h,E)=>(l(),le(ve,{to:"body"},[e("div",Dr,[e("div",_r,[e("div",Mr,[E[5]||(E[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-clock text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900"},"续期 API Key")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",onClick:E[0]||(E[0]=p=>h.$emit("close"))},[...E[4]||(E[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",Tr,[e("div",Sr,[e("div",jr,[E[7]||(E[7]=e("div",{class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-blue-500"},[e("i",{class:"fas fa-info text-sm text-white"})],-1)),e("div",null,[E[6]||(E[6]=e("h4",{class:"mb-1 font-semibold text-gray-800"},"API Key 信息",-1)),e("p",Rr,g(C.apiKey.name),1),e("p",Vr," 当前过期时间："+g(C.apiKey.expiresAt?U(C.apiKey.expiresAt):"永不过期"),1)])])]),e("div",null,[E[9]||(E[9]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"续期时长",-1)),T(e("select",{"onUpdate:modelValue":E[1]||(E[1]=p=>D.renewDuration=p),class:"form-input w-full",onChange:M},[...E[8]||(E[8]=[e("option",{value:"7d"},"延长 7 天",-1),e("option",{value:"30d"},"延长 30 天",-1),e("option",{value:"90d"},"延长 90 天",-1),e("option",{value:"180d"},"延长 180 天",-1),e("option",{value:"365d"},"延长 365 天",-1),e("option",{value:"custom"},"自定义日期",-1),e("option",{value:"permanent"},"设为永不过期",-1)])],544),[[Ce,D.renewDuration]]),D.renewDuration==="custom"?(l(),n("div",Pr,[T(e("input",{"onUpdate:modelValue":E[2]||(E[2]=p=>D.customExpireDate=p),class:"form-input w-full",min:_.value,type:"datetime-local",onChange:F},null,40,Er),[[ee,D.customExpireDate]])])):f("",!0),D.newExpiresAt?(l(),n("p",Ur," 新的过期时间："+g(U(D.newExpiresAt)),1)):f("",!0)])]),e("div",Or,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:E[3]||(E[3]=p=>h.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:G.value||!D.renewDuration,type:"button",onClick:V},[G.value?(l(),n("div",qr)):(l(),n("i",Wr)),L(" "+g(G.value?"续期中...":"确认续期"),1)],8,Gr)])])])]))}},Fr=be(Br,[["__scopeId","data-v-2fba52a3"]]),Hr={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},zr={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-lg overflow-y-auto p-8"},Nr={class:"mb-6 space-y-4"},Yr={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},Qr={class:"font-medium text-gray-900 dark:text-gray-100"},Jr={key:0},Xr={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},Zr={class:"text-gray-700 dark:text-gray-300"},el={class:"relative"},tl={class:"flex min-h-[60px] items-center break-all rounded-lg border border-gray-700 bg-gray-900 p-4 pr-14 font-mono text-sm text-white dark:border-gray-600 dark:bg-gray-900"},sl={class:"absolute right-3 top-3"},al=["title"],rl={__name:"NewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,R=Q,G=K(!1),D=()=>{G.value=!G.value},_=()=>{const V=m.apiKey.apiKey||m.apiKey.key||"";return V?G.value||V.length<=12?V:V.substring(0,8)+"●".repeat(Math.max(0,V.length-12))+V.substring(V.length-4):""},U=async()=>{const V=m.apiKey.apiKey||m.apiKey.key||"";if(!V){W("API Key 不存在","error");return}try{await navigator.clipboard.writeText(V),W("API Key 已复制到剪贴板","success")}catch(h){console.error("Failed to copy:",h);const E=document.createElement("textarea");E.value=V,document.body.appendChild(E),E.select();try{document.execCommand("copy"),W("API Key 已复制到剪贴板","success")}catch{W("复制失败，请手动复制","error")}finally{document.body.removeChild(E)}}},M=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`,"确定关闭","取消")&&R("close"):confirm(`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`)&&R("close")},F=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有保存API Key，关闭后将无法再次查看。

建议您先复制API Key再关闭。`,"仍然关闭","返回复制")&&R("close"):confirm(`您还没有保存API Key，关闭后将无法再次查看。

确定要关闭吗？`)&&R("close")};return(V,h)=>(l(),le(ve,{to:"body"},[e("div",Hr,[e("div",zr,[e("div",{class:"mb-6 flex items-center justify-between"},[h[1]||(h[1]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-check text-lg text-white"})]),e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"API Key 创建成功"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"请妥善保存您的 API Key")])],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"直接关闭（不推荐）",onClick:F},[...h[0]||(h[0]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),h[7]||(h[7]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4 dark:border-amber-500 dark:bg-amber-900/20"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400 dark:bg-amber-500"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900 dark:text-amber-400"},"重要提醒"),e("p",{class:"text-sm text-amber-800 dark:text-amber-300"}," 这是您唯一能看到完整 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即复制并妥善保存。 ")])])],-1)),e("div",Nr,[e("div",null,[h[2]||(h[2]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key 名称",-1)),e("div",Yr,[e("span",Qr,g(C.apiKey.name),1)])]),C.apiKey.description?(l(),n("div",Jr,[h[3]||(h[3]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注",-1)),e("div",Xr,[e("span",Zr,g(C.apiKey.description||"无描述"),1)])])):f("",!0),e("div",null,[h[4]||(h[4]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key",-1)),e("div",el,[e("div",tl,g(_()),1),e("div",sl,[e("button",{class:"btn-icon-sm bg-gray-700 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",title:G.value?"隐藏API Key":"显示完整API Key",type:"button",onClick:D},[e("i",{class:O(["fas",G.value?"fa-eye-slash":"fa-eye","text-gray-300"])},null,2)],8,al)])]),h[5]||(h[5]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 点击眼睛图标切换显示模式，使用下方按钮复制完整 API Key ",-1))])]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:U},[...h[6]||(h[6]=[e("i",{class:"fas fa-copy"},null,-1),L(" 复制 API Key ",-1)])]),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:M}," 我已保存 ")])])])]))}},ll=be(rl,[["__scopeId","data-v-aa36c8d5"]]),ol={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},nl={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-2xl overflow-y-auto p-8"},il={class:"mb-6 flex items-center justify-between"},dl={class:"flex items-center gap-3"},ul={class:"text-sm text-gray-600"},cl={class:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4"},gl={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},ml={class:"flex items-center justify-between"},xl={class:"mt-1 text-2xl font-bold text-blue-900"},pl={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},yl={class:"flex items-center justify-between"},fl={class:"mt-1 truncate text-lg font-bold text-green-900"},bl={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},vl={class:"flex items-center justify-between"},kl={class:"mt-1 text-lg font-bold text-purple-900"},wl={class:"rounded-lg border border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 p-4"},hl={class:"flex items-center justify-between"},$l={class:"mt-1 text-lg font-bold text-orange-900"},Al={class:"mb-6"},Cl={class:"mb-3 flex items-center justify-between"},Il={class:"flex items-center gap-2"},Kl={key:0,class:"custom-scrollbar max-h-48 overflow-y-auto rounded-lg bg-gray-900 p-4"},Ll={class:"font-mono text-xs text-gray-300"},Dl={__name:"BatchApiKeyModal",props:{apiKeys:{type:Array,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,R=Q,G=K(!1),D=Y(()=>{if(m.apiKeys.length>0){const p=m.apiKeys[0],a=p.name.match(/^(.+)_\d+$/);return a?a[1]:p.name}return""}),_=()=>{if(m.apiKeys.length===0)return"未知";const p=m.apiKeys[0].permissions;return{all:"全部服务",claude:"仅 Claude",gemini:"仅 Gemini"}[p]||p},U=()=>{if(m.apiKeys.length===0)return"未知";const p=m.apiKeys[0].expiresAt;if(!p)return"永不过期";const a=new Date(p),S=Math.ceil((a-new Date)/(1e3*60*60*24));return S<=7?`${S}天`:S<=30?`${Math.ceil(S/7)}周`:S<=365?`${Math.ceil(S/30)}个月`:`${Math.ceil(S/365)}年`},M=()=>{G.value=!G.value},F=()=>{const a=m.apiKeys.slice(0,10).map(i=>`${i.name}: ${i.apiKey||i.key||""}`);return m.apiKeys.length>10&&a.push(`... 还有 ${m.apiKeys.length-10} 个 API Key`),a.join(`
`)},V=()=>{const p=m.apiKeys.map(v=>`${v.name}: ${v.apiKey||v.key||""}`).join(`
`),a=new Blob([p],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(a),S=document.createElement("a");S.href=i;const I=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);S.download=`api-keys-${D.value}-${I}.txt`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(i),W("API Keys 文件已下载","success")},h=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`,"确定关闭","返回下载")&&R("close"):confirm(`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`)&&R("close")},E=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有下载 API Keys，关闭后将无法再次查看。

强烈建议您先下载保存。`,"仍然关闭","返回下载")&&R("close"):confirm(`您还没有下载 API Keys，关闭后将无法再次查看。

确定要关闭吗？`)&&R("close")};return(p,a)=>(l(),le(ve,{to:"body"},[e("div",ol,[e("div",nl,[e("div",il,[e("div",dl,[a[1]||(a[1]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-layer-group text-lg text-white"})],-1)),e("div",null,[a[0]||(a[0]=e("h3",{class:"text-xl font-bold text-gray-900"},"批量创建成功",-1)),e("p",ul,"成功创建 "+g(C.apiKeys.length)+" 个 API Key",1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"直接关闭（不推荐）",onClick:E},[...a[2]||(a[2]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),a[14]||(a[14]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900"},"重要提醒"),e("p",{class:"text-sm text-amber-800"}," 这是您唯一能看到所有 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即下载并妥善保存。 ")])])],-1)),e("div",cl,[e("div",gl,[e("div",ml,[e("div",null,[a[3]||(a[3]=e("p",{class:"text-xs font-medium text-blue-600"},"创建数量",-1)),e("p",xl,g(C.apiKeys.length),1)]),a[4]||(a[4]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500 bg-opacity-20"},[e("i",{class:"fas fa-key text-blue-600"})],-1))])]),e("div",pl,[e("div",yl,[e("div",null,[a[5]||(a[5]=e("p",{class:"text-xs font-medium text-green-600"},"基础名称",-1)),e("p",fl,g(D.value),1)]),a[6]||(a[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500 bg-opacity-20"},[e("i",{class:"fas fa-tag text-green-600"})],-1))])]),e("div",bl,[e("div",vl,[e("div",null,[a[7]||(a[7]=e("p",{class:"text-xs font-medium text-purple-600"},"权限范围",-1)),e("p",kl,g(_()),1)]),a[8]||(a[8]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500 bg-opacity-20"},[e("i",{class:"fas fa-shield-alt text-purple-600"})],-1))])]),e("div",wl,[e("div",hl,[e("div",null,[a[9]||(a[9]=e("p",{class:"text-xs font-medium text-orange-600"},"过期时间",-1)),e("p",$l,g(U()),1)]),a[10]||(a[10]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-500 bg-opacity-20"},[e("i",{class:"fas fa-clock text-orange-600"})],-1))])])]),e("div",Al,[e("div",Cl,[a[12]||(a[12]=e("label",{class:"text-sm font-semibold text-gray-700"},"API Keys 预览",-1)),e("div",Il,[e("button",{class:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",type:"button",onClick:M},[e("i",{class:O(["fas",G.value?"fa-eye-slash":"fa-eye"])},null,2),L(" "+g(G.value?"隐藏":"显示")+"预览 ",1)]),a[11]||(a[11]=e("span",{class:"text-xs text-gray-500"},"（最多显示前10个）",-1))])]),G.value?(l(),n("div",Kl,[e("pre",Ll,g(F()),1)])):f("",!0)]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:V},[...a[13]||(a[13]=[e("i",{class:"fas fa-download"},null,-1),L(" 下载所有 API Keys ",-1)])]),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:h}," 我已保存 ")]),a[15]||(a[15]=e("div",{class:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-3"},[e("p",{class:"flex items-start text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-2 mt-0.5 flex-shrink-0"}),e("span",null," 下载的文件格式为文本文件（.txt），每行包含一个 API Key。 请将文件保存在安全的位置，避免泄露。 ")])],-1))])])]))}},_l=be(Dl,[["__scopeId","data-v-b0b904b9"]]),Ml={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Tl={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},Sl={class:"mb-4 flex items-center justify-between sm:mb-6"},jl={class:"flex items-center gap-2 sm:gap-3"},Rl={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},Vl={class:"rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20"},Pl={class:"flex items-start gap-3"},El={class:"mt-1 text-sm text-blue-700 dark:text-blue-400"},Ul={class:"space-y-4"},Ol={class:"flex flex-wrap gap-4"},Gl={class:"flex cursor-pointer items-center"},ql={class:"flex cursor-pointer items-center"},Wl={class:"flex cursor-pointer items-center"},Bl={class:"flex cursor-pointer items-center"},Fl={key:0,class:"space-y-3"},Hl={key:0},zl={class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"},Nl={class:"flex flex-wrap gap-2"},Yl=["onClick"],Ql={key:1},Jl={class:"flex flex-wrap gap-2"},Xl=["onClick"],Zl={class:"flex gap-2"},eo=["onKeypress"],to={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},so={class:"space-y-2"},ao={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},ro={class:"mb-3 flex items-center gap-4"},lo={class:"flex gap-4"},oo={class:"flex cursor-pointer items-center"},no={class:"flex cursor-pointer items-center"},io={class:"flex cursor-pointer items-center"},uo={class:"flex flex-wrap gap-4"},co={class:"flex cursor-pointer items-center"},go={class:"flex cursor-pointer items-center"},mo={class:"flex cursor-pointer items-center"},xo={class:"flex cursor-pointer items-center"},po={class:"flex cursor-pointer items-center"},yo={class:"mb-3 flex items-center justify-between"},fo=["disabled"],bo={class:"grid grid-cols-1 gap-3"},vo=["disabled"],ko={key:0,label:"账号分组"},wo=["value"],ho={key:1,label:"专属账号"},$o=["value"],Ao=["disabled"],Co={key:0,label:"账号分组"},Io=["value"],Ko={key:1,label:"专属账号"},Lo=["value"],Do=["disabled"],_o={key:0,label:"账号分组"},Mo=["value"],To={key:1,label:"专属账号"},So=["value"],jo=["disabled"],Ro={key:0,label:"专属账号"},Vo=["value"],Po={class:"flex gap-3 pt-4"},Eo=["disabled"],Uo={key:0,class:"loading-spinner mr-2"},Oo={key:1,class:"fas fa-save mr-2"},Go={__name:"BatchEditApiKeyModal",props:{selectedKeys:{type:Array,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[]})}},emits:["close","success"],setup(C,{emit:Q}){const m=C,R=Q,G=qe(),D=K(!1),_=K(!1),U=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),M=K(""),F=K([]),V=K("none"),h=Y(()=>m.selectedKeys.length),E=Y(()=>F.value.filter($=>!p.tags.includes($))),p=Se({tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",permissions:"",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",tags:[],isActive:null}),a=()=>{if(M.value&&M.value.trim()){const $=M.value.trim();p.tags.includes($)||p.tags.push($),M.value=""}},i=$=>{p.tags.includes($)||p.tags.push($)},S=$=>{p.tags.splice($,1)},I=async()=>{var $,u;_.value=!0;try{const[c,w,ue,ie,A,r]=await Promise.all([B.get("/admin/claude-accounts"),B.get("/admin/claude-console-accounts"),B.get("/admin/gemini-accounts"),B.get("/admin/openai-accounts"),B.get("/admin/bedrock-accounts"),B.get("/admin/account-groups")]),x=[];if(c.success&&(($=c.data)==null||$.forEach(k=>{x.push({...k,platform:"claude-oauth",isDedicated:k.accountType==="dedicated"})})),w.success&&((u=w.data)==null||u.forEach(k=>{x.push({...k,platform:"claude-console",isDedicated:k.accountType==="dedicated"})})),U.value.claude=x,ue.success&&(U.value.gemini=(ue.data||[]).map(k=>({...k,isDedicated:k.accountType==="dedicated"}))),ie.success&&(U.value.openai=(ie.data||[]).map(k=>({...k,isDedicated:k.accountType==="dedicated"}))),A.success&&(U.value.bedrock=(A.data||[]).map(k=>({...k,isDedicated:k.accountType==="dedicated"}))),r.success){const k=r.data||[];U.value.claudeGroups=k.filter(N=>N.platform==="claude"),U.value.geminiGroups=k.filter(N=>N.platform==="gemini"),U.value.openaiGroups=k.filter(N=>N.platform==="openai")}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{_.value=!1}},v=async()=>{D.value=!0;try{const $={};p.tokenLimit!==""&&p.tokenLimit!==null&&($.tokenLimit=parseInt(p.tokenLimit)),p.rateLimitWindow!==""&&p.rateLimitWindow!==null&&($.rateLimitWindow=parseInt(p.rateLimitWindow)),p.rateLimitRequests!==""&&p.rateLimitRequests!==null&&($.rateLimitRequests=parseInt(p.rateLimitRequests)),p.concurrencyLimit!==""&&p.concurrencyLimit!==null&&($.concurrencyLimit=parseInt(p.concurrencyLimit)),p.dailyCostLimit!==""&&p.dailyCostLimit!==null&&($.dailyCostLimit=parseFloat(p.dailyCostLimit)),p.permissions!==""&&($.permissions=p.permissions),p.claudeAccountId!==""&&(p.claudeAccountId==="SHARED_POOL"?($.claudeAccountId=null,$.claudeConsoleAccountId=null):p.claudeAccountId.startsWith("console:")?($.claudeConsoleAccountId=p.claudeAccountId.substring(8),$.claudeAccountId=null):(p.claudeAccountId.startsWith("group:"),$.claudeAccountId=p.claudeAccountId,$.claudeConsoleAccountId=null)),p.geminiAccountId!==""&&(p.geminiAccountId==="SHARED_POOL"?$.geminiAccountId=null:$.geminiAccountId=p.geminiAccountId),p.openaiAccountId!==""&&(p.openaiAccountId==="SHARED_POOL"?$.openaiAccountId=null:$.openaiAccountId=p.openaiAccountId),p.bedrockAccountId!==""&&(p.bedrockAccountId==="SHARED_POOL"?$.bedrockAccountId=null:$.bedrockAccountId=p.bedrockAccountId),p.isActive!==null&&($.isActive=p.isActive),V.value!=="none"&&($.tags=p.tags,$.tagOperation=V.value);const u=await B.put("/admin/api-keys/batch",{keyIds:m.selectedKeys,updates:$});if(u.success){const{successCount:c,failedCount:w,errors:ue}=u.data;if(c>0){if(W(`成功批量编辑 ${c} 个 API Keys`,"success"),w>0){const ie=ue.map(A=>`${A.keyId}: ${A.error}`).join(`
`);W(`${w} 个编辑失败:
${ie}`,"warning")}}else W("所有 API Keys 编辑失败","error");R("success"),R("close")}else W(u.message||"批量编辑失败","error")}catch($){W("批量编辑失败","error"),console.error("批量编辑 API Keys 失败:",$)}finally{D.value=!1}};return Te(async()=>{F.value=await G.fetchTags(),m.accounts&&(U.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]})}),($,u)=>(l(),le(ve,{to:"body"},[e("div",Ml,[e("div",Tl,[e("div",Sl,[e("div",jl,[u[24]||(u[24]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})],-1)),e("h3",Rl," 批量编辑 API Keys ("+g(h.value)+" 个) ",1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:u[0]||(u[0]=c=>$.$emit("close"))},[...u[25]||(u[25]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:xe(v,["prevent"])},[e("div",Vl,[e("div",Pl,[u[27]||(u[27]=e("i",{class:"fas fa-info-circle mt-1 text-blue-500"},null,-1)),e("div",null,[u[26]||(u[26]=e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-300"},"批量编辑说明",-1)),e("p",El," 以下设置将应用到所选的 "+g(h.value)+" 个 API Key。只有填写或修改的字段才会被更新，空白字段将保持原值不变。 ",1)])])]),e("div",null,[u[37]||(u[37]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"}," 标签 (批量操作) ",-1)),e("div",Ul,[e("div",Ol,[e("label",Gl,[T(e("input",{"onUpdate:modelValue":u[1]||(u[1]=c=>V.value=c),class:"mr-2",type:"radio",value:"replace"},null,512),[[re,V.value]]),u[28]||(u[28]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"替换标签",-1))]),e("label",ql,[T(e("input",{"onUpdate:modelValue":u[2]||(u[2]=c=>V.value=c),class:"mr-2",type:"radio",value:"add"},null,512),[[re,V.value]]),u[29]||(u[29]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"添加标签",-1))]),e("label",Wl,[T(e("input",{"onUpdate:modelValue":u[3]||(u[3]=c=>V.value=c),class:"mr-2",type:"radio",value:"remove"},null,512),[[re,V.value]]),u[30]||(u[30]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"移除标签",-1))]),e("label",Bl,[T(e("input",{"onUpdate:modelValue":u[4]||(u[4]=c=>V.value=c),class:"mr-2",type:"radio",value:"none"},null,512),[[re,V.value]]),u[31]||(u[31]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改标签",-1))])]),V.value!=="none"?(l(),n("div",Fl,[p.tags.length>0?(l(),n("div",Hl,[e("div",zl,g(V.value==="replace"?"新标签列表:":V.value==="add"?"要添加的标签:":"要移除的标签:"),1),e("div",Nl,[(l(!0),n(z,null,X(p.tags,(c,w)=>(l(),n("span",{key:"selected-"+w,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},[L(g(c)+" ",1),e("button",{class:"ml-1 hover:text-blue-900",type:"button",onClick:ue=>S(w)},[...u[32]||(u[32]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,Yl)]))),128))])])):f("",!0),E.value.length>0?(l(),n("div",Ql,[u[34]||(u[34]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",Jl,[(l(!0),n(z,null,X(E.value,c=>(l(),n("button",{key:"available-"+c,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-300",type:"button",onClick:w=>i(c)},[u[33]||(u[33]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(c),1)],8,Xl))),128))])])):f("",!0),e("div",null,[u[36]||(u[36]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Zl,[T(e("input",{"onUpdate:modelValue":u[5]||(u[5]=c=>M.value=c),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"输入新标签名称",type:"text",onKeypress:Me(xe(a,["prevent"]),["enter"])},null,40,eo),[[ee,M.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",type:"button",onClick:a},[...u[35]||(u[35]=[e("i",{class:"fas fa-plus"},null,-1)])])])])])):f("",!0)])]),e("div",to,[u[41]||(u[41]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},"速率限制设置")],-1)),e("div",so,[e("div",ao,[e("div",null,[u[38]||(u[38]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 时间窗口 (分钟) ",-1)),T(e("input",{"onUpdate:modelValue":u[6]||(u[6]=c=>p.rateLimitWindow=c),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[ee,p.rateLimitWindow]])]),e("div",null,[u[39]||(u[39]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":u[7]||(u[7]=c=>p.rateLimitRequests=c),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[ee,p.rateLimitRequests]])]),e("div",null,[u[40]||(u[40]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":u[8]||(u[8]=c=>p.tokenLimit=c),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"不修改",type:"number"},null,512),[[ee,p.tokenLimit]])])])])]),e("div",null,[u[42]||(u[42]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"}," 每日费用限制 (美元) ",-1)),T(e("input",{"onUpdate:modelValue":u[9]||(u[9]=c=>p.dailyCostLimit=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",step:"0.01",type:"number"},null,512),[[ee,p.dailyCostLimit]])]),e("div",null,[u[43]||(u[43]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),T(e("input",{"onUpdate:modelValue":u[10]||(u[10]=c=>p.concurrencyLimit=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",type:"number"},null,512),[[ee,p.concurrencyLimit]])]),e("div",null,[e("div",ro,[u[47]||(u[47]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"激活状态",-1)),e("div",lo,[e("label",oo,[T(e("input",{"onUpdate:modelValue":u[11]||(u[11]=c=>p.isActive=c),class:"mr-2",type:"radio",value:!0},null,512),[[re,p.isActive]]),u[44]||(u[44]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"激活",-1))]),e("label",no,[T(e("input",{"onUpdate:modelValue":u[12]||(u[12]=c=>p.isActive=c),class:"mr-2",type:"radio",value:!1},null,512),[[re,p.isActive]]),u[45]||(u[45]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"禁用",-1))]),e("label",io,[T(e("input",{"onUpdate:modelValue":u[13]||(u[13]=c=>p.isActive=c),class:"mr-2",type:"radio",value:null},null,512),[[re,p.isActive]]),u[46]||(u[46]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改",-1))])])])]),e("div",null,[u[53]||(u[53]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",uo,[e("label",co,[T(e("input",{"onUpdate:modelValue":u[14]||(u[14]=c=>p.permissions=c),class:"mr-2",type:"radio",value:""},null,512),[[re,p.permissions]]),u[48]||(u[48]=e("span",{class:"text-sm text-gray-700"},"不修改",-1))]),e("label",go,[T(e("input",{"onUpdate:modelValue":u[15]||(u[15]=c=>p.permissions=c),class:"mr-2",type:"radio",value:"all"},null,512),[[re,p.permissions]]),u[49]||(u[49]=e("span",{class:"text-sm text-gray-700"},"全部服务",-1))]),e("label",mo,[T(e("input",{"onUpdate:modelValue":u[16]||(u[16]=c=>p.permissions=c),class:"mr-2",type:"radio",value:"claude"},null,512),[[re,p.permissions]]),u[50]||(u[50]=e("span",{class:"text-sm text-gray-700"},"仅 Claude",-1))]),e("label",xo,[T(e("input",{"onUpdate:modelValue":u[17]||(u[17]=c=>p.permissions=c),class:"mr-2",type:"radio",value:"gemini"},null,512),[[re,p.permissions]]),u[51]||(u[51]=e("span",{class:"text-sm text-gray-700"},"仅 Gemini",-1))]),e("label",po,[T(e("input",{"onUpdate:modelValue":u[18]||(u[18]=c=>p.permissions=c),class:"mr-2",type:"radio",value:"openai"},null,512),[[re,p.permissions]]),u[52]||(u[52]=e("span",{class:"text-sm text-gray-700"},"仅 OpenAI",-1))])])]),e("div",null,[e("div",yo,[u[54]||(u[54]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:_.value,title:"刷新账号列表",type:"button",onClick:I},[e("i",{class:O(["fas",_.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(_.value?"刷新中...":"刷新账号"),1)],8,fo)]),e("div",bo,[e("div",null,[u[57]||(u[57]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),T(e("select",{"onUpdate:modelValue":u[19]||(u[19]=c=>p.claudeAccountId=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="gemini"||p.permissions==="openai"},[u[55]||(u[55]=e("option",{value:""},"不修改",-1)),u[56]||(u[56]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.claudeGroups.length>0?(l(),n("optgroup",ko,[(l(!0),n(z,null,X(U.value.claudeGroups,c=>(l(),n("option",{key:c.id,value:`group:${c.id}`}," 分组 - "+g(c.name),9,wo))),128))])):f("",!0),U.value.claude.length>0?(l(),n("optgroup",ho,[(l(!0),n(z,null,X(U.value.claude,c=>(l(),n("option",{key:c.id,value:c.platform==="claude-console"?`console:${c.id}`:c.id},g(c.name)+" ("+g(c.platform==="claude-console"?"Console":"OAuth")+") ",9,$o))),128))])):f("",!0)],8,vo),[[Ce,p.claudeAccountId]])]),e("div",null,[u[60]||(u[60]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),T(e("select",{"onUpdate:modelValue":u[20]||(u[20]=c=>p.geminiAccountId=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="claude"||p.permissions==="openai"},[u[58]||(u[58]=e("option",{value:""},"不修改",-1)),u[59]||(u[59]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.geminiGroups.length>0?(l(),n("optgroup",Co,[(l(!0),n(z,null,X(U.value.geminiGroups,c=>(l(),n("option",{key:c.id,value:`group:${c.id}`}," 分组 - "+g(c.name),9,Io))),128))])):f("",!0),U.value.gemini.length>0?(l(),n("optgroup",Ko,[(l(!0),n(z,null,X(U.value.gemini,c=>(l(),n("option",{key:c.id,value:c.id},g(c.name),9,Lo))),128))])):f("",!0)],8,Ao),[[Ce,p.geminiAccountId]])]),e("div",null,[u[63]||(u[63]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),T(e("select",{"onUpdate:modelValue":u[21]||(u[21]=c=>p.openaiAccountId=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="claude"||p.permissions==="gemini"},[u[61]||(u[61]=e("option",{value:""},"不修改",-1)),u[62]||(u[62]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.openaiGroups.length>0?(l(),n("optgroup",_o,[(l(!0),n(z,null,X(U.value.openaiGroups,c=>(l(),n("option",{key:c.id,value:`group:${c.id}`}," 分组 - "+g(c.name),9,Mo))),128))])):f("",!0),U.value.openai.length>0?(l(),n("optgroup",To,[(l(!0),n(z,null,X(U.value.openai,c=>(l(),n("option",{key:c.id,value:c.id},g(c.name),9,So))),128))])):f("",!0)],8,Do),[[Ce,p.openaiAccountId]])]),e("div",null,[u[66]||(u[66]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),T(e("select",{"onUpdate:modelValue":u[22]||(u[22]=c=>p.bedrockAccountId=c),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="gemini"||p.permissions==="openai"},[u[64]||(u[64]=e("option",{value:""},"不修改",-1)),u[65]||(u[65]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.bedrock.length>0?(l(),n("optgroup",Ro,[(l(!0),n(z,null,X(U.value.bedrock,c=>(l(),n("option",{key:c.id,value:c.id},g(c.name),9,Vo))),128))])):f("",!0)],8,jo),[[Ce,p.bedrockAccountId]])])])]),e("div",Po,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:u[23]||(u[23]=c=>$.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:D.value,type:"submit"},[D.value?(l(),n("div",Uo)):(l(),n("i",Oo)),L(" "+g(D.value?"保存中...":"批量保存"),1)],8,Eo)])],32)])])]))}},qo=be(Go,[["__scopeId","data-v-be660ab9"]]),Wo={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Bo={class:"modal-content relative mx-auto w-full max-w-lg p-8"},Fo={class:"mb-6 flex items-center justify-between"},Ho={class:"flex items-center gap-3"},zo={class:"text-sm text-gray-600 dark:text-gray-400"},No={class:"space-y-6"},Yo={class:"rounded-lg border border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 p-4 dark:border-gray-600 dark:from-gray-700 dark:to-gray-800"},Qo={class:"flex items-center justify-between"},Jo={class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},Xo={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},Zo={class:"mb-3 grid grid-cols-3 gap-2"},en=["onClick"],tn={key:0,class:"animate-fadeIn"},sn=["min"],an={key:1,class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20"},rn={class:"flex items-center justify-between"},ln={class:"text-sm font-semibold text-blue-900 dark:text-blue-200"},on={class:"flex gap-3 pt-2"},nn=["disabled"],dn={key:0,class:"loading-spinner mr-2"},un={key:1,class:"fas fa-save mr-2"},cn={__name:"ExpiryEditModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close","save"],setup(C,{expose:Q,emit:m}){const R=C,G=m,D=K(!1),_=Se({expireDuration:"",customExpireDate:"",expiresAt:null}),U=[{value:"",label:"永不过期"},{value:"1d",label:"1 天"},{value:"7d",label:"7 天"},{value:"30d",label:"30 天"},{value:"90d",label:"90 天"},{value:"180d",label:"180 天"},{value:"365d",label:"1 年"},{value:"730d",label:"2 年"}],M=Y(()=>{const I=new Date;return I.setMinutes(I.getMinutes()+1),I.toISOString().slice(0,16)});Ae(()=>R.show,I=>{I&&F()}),Ae(()=>{var I;return(I=R.apiKey)==null?void 0:I.id},I=>{I&&R.show&&F()});const F=()=>{D.value=!1,R.apiKey.expiresAt?(_.expireDuration="custom",_.customExpireDate=new Date(R.apiKey.expiresAt).toISOString().slice(0,16),_.expiresAt=R.apiKey.expiresAt):(_.expireDuration="",_.customExpireDate="",_.expiresAt=null)},V=I=>{if(_.expireDuration=I,!I){_.expiresAt=null;return}if(I==="custom")return;const v=new Date,$=I.match(/(\d+)([dhmy])/);if($){const[,u,c]=$,w=parseInt(u);switch(c){case"d":v.setDate(v.getDate()+w);break;case"h":v.setHours(v.getHours()+w);break;case"m":v.setMonth(v.getMonth()+w);break;case"y":v.setFullYear(v.getFullYear()+w);break}_.expiresAt=v.toISOString()}},h=()=>{_.customExpireDate&&(_.expiresAt=new Date(_.customExpireDate).toISOString())},E=I=>I?new Date(I).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",p=I=>I?new Date(I)<new Date:!1,a=I=>{if(!I)return null;const v=new Date,u=new Date(I)-v,c=Math.ceil(u/(1e3*60*60*24));return u<0?{text:"已过期",class:"text-red-600"}:c<=7?{text:`${c} 天后过期`,class:"text-orange-600"}:c<=30?{text:`${c} 天后过期`,class:"text-yellow-600"}:{text:`${Math.ceil(c/30)} 个月后过期`,class:"text-green-600"}},i=()=>{D.value=!0,G("save",{keyId:R.apiKey.id,expiresAt:_.expiresAt})};return Q({resetSaving:()=>{D.value=!1}}),(I,v)=>(l(),le(ve,{to:"body"},[C.show?(l(),n("div",Wo,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:v[0]||(v[0]=$=>I.$emit("close"))}),e("div",Bo,[e("div",Fo,[e("div",Ho,[v[6]||(v[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-orange-600"},[e("i",{class:"fas fa-clock text-white"})],-1)),e("div",null,[v[5]||(v[5]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改过期时间",-1)),e("p",zo,' 为 "'+g(C.apiKey.name||"API Key")+'" 设置新的过期时间 ',1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:v[1]||(v[1]=$=>I.$emit("close"))},[...v[7]||(v[7]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",No,[e("div",Yo,[e("div",Qo,[e("div",null,[v[10]||(v[10]=e("p",{class:"mb-1 text-xs font-medium text-gray-600 dark:text-gray-400"}," 当前过期时间 ",-1)),e("p",Jo,[C.apiKey.expiresAt?(l(),n(z,{key:0},[L(g(E(C.apiKey.expiresAt))+" ",1),a(C.apiKey.expiresAt)?(l(),n("span",{key:0,class:O(["ml-2 text-xs font-normal",a(C.apiKey.expiresAt).class])}," ("+g(a(C.apiKey.expiresAt).text)+") ",3)):f("",!0)],64)):(l(),n(z,{key:1},[v[8]||(v[8]=e("i",{class:"fas fa-infinity mr-1 text-gray-500"},null,-1)),v[9]||(v[9]=L(" 永不过期 ",-1))],64))])]),e("div",Xo,[e("i",{class:O(["fas fa-hourglass-half text-lg",C.apiKey.expiresAt&&p(C.apiKey.expiresAt)?"text-red-500":"text-gray-400"])},null,2)])])]),e("div",null,[v[12]||(v[12]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择新的期限",-1)),e("div",Zo,[(l(),n(z,null,X(U,$=>e("button",{key:$.value,class:O(["rounded-lg px-3 py-2 text-sm font-medium transition-all",_.expireDuration===$.value?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:u=>V($.value)},g($.label),11,en)),64)),e("button",{class:O(["rounded-lg px-3 py-2 text-sm font-medium transition-all",_.expireDuration==="custom"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:v[2]||(v[2]=$=>V("custom"))},[...v[11]||(v[11]=[e("i",{class:"fas fa-calendar-alt mr-1"},null,-1),L(" 自定义 ",-1)])],2)])]),_.expireDuration==="custom"?(l(),n("div",tn,[v[13]||(v[13]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择日期和时间",-1)),T(e("input",{"onUpdate:modelValue":v[3]||(v[3]=$=>_.customExpireDate=$),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:M.value,type:"datetime-local",onChange:h},null,40,sn),[[ee,_.customExpireDate]]),v[14]||(v[14]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择一个未来的日期和时间作为过期时间 ",-1))])):f("",!0),_.expiresAt!==C.apiKey.expiresAt?(l(),n("div",an,[e("div",rn,[e("div",null,[v[17]||(v[17]=e("p",{class:"mb-1 text-xs font-medium text-blue-700 dark:text-blue-400"},[e("i",{class:"fas fa-arrow-right mr-1"}),L(" 新的过期时间 ")],-1)),e("p",ln,[_.expiresAt?(l(),n(z,{key:0},[L(g(E(_.expiresAt))+" ",1),a(_.expiresAt)?(l(),n("span",{key:0,class:O(["ml-2 text-xs font-normal",a(_.expiresAt).class])}," ("+g(a(_.expiresAt).text)+") ",3)):f("",!0)],64)):(l(),n(z,{key:1},[v[15]||(v[15]=e("i",{class:"fas fa-infinity mr-1"},null,-1)),v[16]||(v[16]=L(" 永不过期 ",-1))],64))])]),v[18]||(v[18]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},[e("i",{class:"fas fa-check text-lg text-green-500"})],-1))])])):f("",!0),e("div",on,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",onClick:v[4]||(v[4]=$=>I.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 font-semibold",disabled:D.value||_.expiresAt===C.apiKey.expiresAt,onClick:i},[D.value?(l(),n("div",dn)):(l(),n("i",un)),L(" "+g(D.value?"保存中...":"保存更改"),1)],8,nn)])])])])):f("",!0)]))}},gn=be(cn,[["__scopeId","data-v-ce7524cf"]]),mn={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},xn={class:"modal-content relative mx-auto flex max-h-[90vh] w-[95%] max-w-2xl flex-col p-4 sm:w-full sm:max-w-3xl sm:p-6 md:p-8"},pn={class:"mb-4 flex items-center justify-between sm:mb-6"},yn={class:"flex items-center gap-2 sm:gap-3"},fn={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},bn={class:"modal-scroll-content custom-scrollbar flex-1 overflow-y-auto"},vn={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2"},kn={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-blue-800/20"},wn={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},hn={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},$n={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4 dark:border-green-700 dark:from-green-900/20 dark:to-green-800/20"},An={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Cn={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},In={class:"rounded-lg border border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 dark:border-yellow-700 dark:from-yellow-900/20 dark:to-yellow-800/20"},Kn={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Ln={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Dn={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4 dark:border-purple-700 dark:from-purple-900/20 dark:to-purple-800/20"},_n={class:"space-y-1 text-sm"},Mn={class:"flex justify-between"},Tn={class:"font-semibold text-gray-900 dark:text-gray-100"},Sn={class:"flex justify-between"},jn={class:"font-semibold text-gray-900 dark:text-gray-100"},Rn={class:"mb-6"},Vn={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},Pn={class:"flex items-center justify-between"},En={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Un={class:"flex items-center justify-between"},On={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Gn={key:0,class:"flex items-center justify-between"},qn={class:"text-sm font-semibold text-purple-600"},Wn={key:1,class:"flex items-center justify-between"},Bn={class:"text-sm font-semibold text-purple-600"},Fn={key:0,class:"mb-6"},Hn={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},zn={key:0,class:"space-y-2"},Nn={class:"flex items-center justify-between text-sm"},Yn={class:"font-semibold text-gray-900 dark:text-gray-100"},Qn={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-600"},Jn={class:"text-right text-xs text-gray-500 dark:text-gray-400"},Xn={key:1,class:"flex items-center justify-between text-sm"},Zn={class:"font-semibold text-purple-600"},ei={key:2,class:"space-y-2"},ti={__name:"UsageDetailModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,R=Q,G=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.requests)||0}),D=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.daily)==null?void 0:w.requests)||0}),_=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.tokens)||0}),U=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.daily)==null?void 0:w.tokens)||0}),M=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.cost)||0}),F=Y(()=>m.apiKey.dailyCost||0),V=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.inputTokens)||0}),h=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.outputTokens)||0}),E=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.cacheCreateTokens)||0}),p=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.total)==null?void 0:w.cacheReadTokens)||0}),a=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.averages)==null?void 0:w.rpm)||0}),i=Y(()=>{var c,w;return((w=(c=m.apiKey.usage)==null?void 0:c.averages)==null?void 0:w.tpm)||0}),S=Y(()=>m.apiKey.dailyCostLimit>0||m.apiKey.concurrencyLimit>0||m.apiKey.rateLimitWindow>0||m.apiKey.tokenLimit>0),I=Y(()=>!m.apiKey.dailyCostLimit||m.apiKey.dailyCostLimit===0?0:F.value/m.apiKey.dailyCostLimit*100),v=c=>!c&&c!==0?"0":c.toLocaleString("zh-CN"),$=c=>c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(1)+"K":c.toString(),u=()=>{R("close")};return(c,w)=>(l(),le(ve,{to:"body"},[C.show?(l(),n("div",mn,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:u}),e("div",xn,[e("div",pn,[e("div",yn,[w[0]||(w[0]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-chart-line text-sm text-white sm:text-base"})],-1)),e("h3",fn," 使用统计详情 - "+g(C.apiKey.name),1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:u},[...w[1]||(w[1]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("div",bn,[e("div",vn,[e("div",kn,[w[2]||(w[2]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总请求数"),e("i",{class:"fas fa-paper-plane text-blue-500"})],-1)),e("div",wn,g(v(G.value)),1),e("div",hn," 今日: "+g(v(D.value))+" 次 ",1)]),e("div",$n,[w[3]||(w[3]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总Token数"),e("i",{class:"fas fa-coins text-green-500"})],-1)),e("div",An,g($(_.value)),1),e("div",Cn," 今日: "+g($(U.value)),1)]),e("div",In,[w[4]||(w[4]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总费用"),e("i",{class:"fas fa-dollar-sign text-yellow-600"})],-1)),e("div",Kn," $"+g(M.value.toFixed(4)),1),e("div",Ln," 今日: $"+g(F.value.toFixed(4)),1)]),e("div",Dn,[w[7]||(w[7]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"平均速率"),e("i",{class:"fas fa-tachometer-alt text-purple-500"})],-1)),e("div",_n,[e("div",Mn,[w[5]||(w[5]=e("span",{class:"text-gray-600 dark:text-gray-400"},"RPM:",-1)),e("span",Tn,g(a.value),1)]),e("div",Sn,[w[6]||(w[6]=e("span",{class:"text-gray-600 dark:text-gray-400"},"TPM:",-1)),e("span",jn,g(i.value),1)])])])]),e("div",Rn,[w[12]||(w[12]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),L(" Token 使用分布 ")],-1)),e("div",Vn,[e("div",Pn,[w[8]||(w[8]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-2 text-green-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入 Token")],-1)),e("span",En,g($(V.value)),1)]),e("div",Un,[w[9]||(w[9]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-2 text-blue-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出 Token")],-1)),e("span",On,g($(h.value)),1)]),E.value>0?(l(),n("div",Gn,[w[10]||(w[10]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存创建 Token")],-1)),e("span",qn,g($(E.value)),1)])):f("",!0),p.value>0?(l(),n("div",Wn,[w[11]||(w[11]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存读取 Token")],-1)),e("span",Bn,g($(p.value)),1)])):f("",!0)])]),S.value?(l(),n("div",Fn,[w[16]||(w[16]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-red-500"}),L(" 限制设置 ")],-1)),e("div",Hn,[C.apiKey.dailyCostLimit>0?(l(),n("div",zn,[e("div",Nn,[w[13]||(w[13]=e("span",{class:"text-gray-600 dark:text-gray-400"},"每日费用限制",-1)),e("span",Yn," $"+g(C.apiKey.dailyCostLimit.toFixed(2)),1)]),e("div",Qn,[e("div",{class:O(["h-2 rounded-full transition-all duration-300",I.value>=100?"bg-red-500":I.value>=80?"bg-yellow-500":"bg-green-500"]),style:_e({width:Math.min(I.value,100)+"%"})},null,6)]),e("div",Jn," 已使用 "+g(I.value.toFixed(1))+"% ",1)])):f("",!0),C.apiKey.concurrencyLimit>0?(l(),n("div",Xn,[w[14]||(w[14]=e("span",{class:"text-gray-600 dark:text-gray-400"},"并发限制",-1)),e("span",Zn,g(C.apiKey.currentConcurrency||0)+" / "+g(C.apiKey.concurrencyLimit),1)])):f("",!0),C.apiKey.rateLimitWindow>0?(l(),n("div",ei,[w[15]||(w[15]=e("h5",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-clock mr-1 text-blue-500"}),L(" 时间窗口限制 ")],-1)),ne(Oe,{"current-requests":C.apiKey.currentWindowRequests,"current-tokens":C.apiKey.currentWindowTokens,label:"窗口状态","rate-limit-window":C.apiKey.rateLimitWindow,"request-limit":C.apiKey.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":C.apiKey.tokenLimit,"window-end-time":C.apiKey.windowEndTime,"window-remaining-seconds":C.apiKey.windowRemainingSeconds,"window-start-time":C.apiKey.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])])):f("",!0)])])):f("",!0)]),e("div",{class:"mt-4 flex justify-end gap-2 sm:mt-6 sm:gap-3"},[e("button",{class:"btn btn-secondary px-4 py-2 text-sm",type:"button",onClick:u}," 关闭 ")])])])):f("",!0)]))}},si=be(ti,[["__scopeId","data-v-6679d647"]]),ai={class:"tab-content"},ri={class:"card p-4 sm:p-6"},li={class:"mb-4 flex flex-col gap-4 sm:mb-6"},oi={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ni={class:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center sm:gap-3"},ii={class:"group relative min-w-[140px]"},di={class:"group relative min-w-[140px]"},ui={class:"relative"},ci={key:0,class:"absolute -right-2 -top-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-purple-500 text-xs text-white shadow-sm"},gi={class:"group relative min-w-[200px]"},mi={class:"relative flex items-center"},xi=["disabled"],pi={class:"relative"},yi={class:"relative"},fi={key:0,class:"py-12 text-center"},bi={key:1,class:"py-12 text-center"},vi={key:2,class:"table-container hidden md:block"},ki={class:"w-full table-fixed"},wi={class:"bg-gray-50/80 backdrop-blur-sm dark:bg-gray-700/80"},hi={class:"w-[50px] px-3 py-4 text-left"},$i={class:"flex items-center"},Ai=["indeterminate"],Ci={key:1,class:"fas fa-sort ml-1 text-gray-400"},Ii={key:1,class:"fas fa-sort ml-1 text-gray-400"},Ki={class:"w-[17%] min-w-[140px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"},Li={key:1,class:"fas fa-sort ml-1 text-gray-400"},Di={key:1,class:"fas fa-sort ml-1 text-gray-400"},_i={key:1,class:"fas fa-sort ml-1 text-gray-400"},Mi={class:"divide-y divide-gray-200/50 dark:divide-gray-600/50"},Ti={class:"table-row"},Si={class:"px-3 py-4"},ji={class:"flex items-center"},Ri=["value"],Vi={class:"px-3 py-4"},Pi={class:"flex items-center"},Ei={class:"min-w-0"},Ui=["title"],Oi=["title"],Gi={class:"mt-1.5 space-y-1"},qi={key:0,class:"flex items-center gap-1 text-xs"},Wi={class:"truncate text-gray-600 dark:text-gray-400"},Bi={key:1,class:"flex items-center gap-1 text-xs"},Fi={class:"truncate text-gray-600 dark:text-gray-400"},Hi={key:2,class:"flex items-center gap-1 text-xs"},zi={class:"truncate text-gray-600 dark:text-gray-400"},Ni={key:3,class:"flex items-center gap-1 text-xs"},Yi={class:"truncate text-gray-600"},Qi={key:4,class:"text-xs text-gray-500"},Ji={class:"px-3 py-4"},Xi={class:"flex flex-wrap gap-1"},Zi={key:0,class:"text-xs text-gray-400"},ed={class:"whitespace-nowrap px-3 py-4"},td={class:"px-3 py-4"},sd={class:"space-y-2"},ad={class:"mb-2"},rd={class:"mb-1 flex items-center justify-between text-sm"},ld={class:"font-semibold text-gray-900 dark:text-gray-100"},od={class:"flex items-center justify-between text-sm"},nd={class:"font-semibold text-green-600"},id={class:"flex items-center justify-between text-sm"},dd={class:"font-medium text-gray-700 dark:text-gray-300"},ud={key:0,class:"space-y-2"},cd={class:"rounded-lg border border-green-200 bg-green-50 p-2 dark:border-green-700 dark:bg-green-900/20"},gd={class:"mb-1 flex items-center justify-between"},md={class:"relative"},xd={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-600"},pd={class:"absolute inset-0 flex items-center justify-center"},yd={class:"text-xs font-medium text-white drop-shadow-sm"},fd={key:0,class:"mt-1 flex items-center gap-1"},bd={class:"pt-1"},vd=["onClick"],kd={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},wd={class:"whitespace-nowrap px-3 py-4 text-sm"},hd={class:"inline-flex items-center gap-1.5"},$d={key:0},Ad={key:0,class:"inline-flex items-center text-red-600"},Cd={key:1,class:"inline-flex items-center text-orange-600"},Id={key:2,class:"text-gray-600"},Kd={key:1,class:"inline-flex items-center text-gray-400"},Ld=["onClick"],Dd={class:"whitespace-nowrap px-3 py-4 text-sm"},_d={class:"flex gap-1"},Md=["onClick"],Td=["onClick"],Sd=["onClick"],jd=["onClick"],Rd=["title","onClick"],Vd={class:"ml-1 hidden xl:inline"},Pd=["onClick"],Ed={key:0},Ud={class:"bg-gray-50 px-3 py-4 dark:bg-gray-700",colspan:"8"},Od={key:0,class:"py-4 text-center"},Gd={class:"space-y-4"},qd={class:"mb-4 flex items-center justify-between"},Wd={class:"flex items-center gap-2"},Bd={key:0,class:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-500 dark:bg-gray-700 dark:text-gray-400"},Fd={class:"flex items-center gap-1"},Hd={class:"flex gap-1 rounded bg-gray-100 p-1 dark:bg-gray-700"},zd=["onClick"],Nd={key:0,class:"py-8 text-center"},Yd={class:"mb-3 flex items-center justify-center gap-2"},Qd=["onClick"],Jd={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},Xd={class:"mb-3 flex items-start justify-between"},Zd={class:"flex-1"},e0={class:"mb-1 block text-sm font-semibold text-gray-800 dark:text-gray-200"},t0={class:"rounded-full bg-blue-50 px-2 py-1 text-xs text-gray-500 dark:bg-blue-900/30 dark:text-gray-400"},s0={class:"mb-3 space-y-2"},a0={class:"flex items-center justify-between text-sm"},r0={class:"font-semibold text-gray-900 dark:text-gray-100"},l0={class:"flex items-center justify-between text-sm"},o0={class:"font-semibold text-green-600"},n0={class:"mt-2 border-t border-gray-100 pt-2 dark:border-gray-600"},i0={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},d0={class:"font-medium"},u0={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},c0={class:"font-medium"},g0={key:0,class:"flex items-center justify-between text-xs text-purple-600"},m0={class:"font-medium"},x0={key:1,class:"flex items-center justify-between text-xs text-purple-600"},p0={class:"font-medium"},y0={class:"mt-3 h-2 w-full rounded-full bg-gray-200"},f0={class:"mt-1 text-right"},b0={class:"text-xs font-medium text-indigo-600"},v0={key:2,class:"mt-4 rounded-lg border border-indigo-100 bg-gradient-to-r from-indigo-50 to-purple-50 p-3 dark:border-indigo-700 dark:from-indigo-900/20 dark:to-purple-900/20"},k0={class:"flex items-center justify-between text-sm"},w0={class:"flex gap-4 text-xs"},h0={class:"text-gray-600 dark:text-gray-400"},$0={class:"font-semibold text-gray-800 dark:text-gray-200"},A0={class:"text-gray-600 dark:text-gray-400"},C0={class:"font-semibold text-gray-800 dark:text-gray-200"},I0={key:3,class:"space-y-3 md:hidden"},K0={class:"mb-3 flex items-start justify-between"},L0={class:"flex items-center gap-3"},D0=["value"],_0={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},M0={class:"mt-0.5 text-xs text-gray-500 dark:text-gray-400"},T0={class:"mb-3 space-y-1.5"},S0={key:0,class:"flex flex-wrap items-center gap-1 text-xs"},j0={class:"text-gray-600"},R0={key:1,class:"flex flex-wrap items-center gap-1 text-xs"},V0={class:"text-gray-600"},P0={key:2,class:"flex flex-wrap items-center gap-1 text-xs"},E0={class:"text-gray-600"},U0={key:3,class:"flex flex-wrap items-center gap-1 text-xs"},O0={class:"text-gray-600"},G0={key:4,class:"text-xs text-gray-500"},q0={class:"mb-3 space-y-2"},W0={class:"rounded-lg bg-gray-50 p-3"},B0={class:"mb-2 flex items-center justify-between"},F0=["onClick"],H0={class:"grid grid-cols-2 gap-3"},z0={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},N0={class:"text-sm font-semibold text-green-600"},Y0={class:"mt-2 flex items-center justify-between"},Q0={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},J0={key:0,class:"space-y-2"},X0={class:"rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-700 dark:bg-green-900/20"},Z0={class:"mb-2 flex items-center justify-between"},eu={class:"relative"},tu={class:"h-2.5 w-full rounded-full bg-gray-200 dark:bg-gray-600"},su={class:"absolute inset-0 flex items-center justify-center"},au={class:"text-xs font-medium text-white drop-shadow-sm"},ru={key:0,class:"mt-2 flex items-start gap-1"},lu={class:"mb-3 text-xs text-gray-500"},ou={class:"mb-1 flex justify-between"},nu={class:"flex items-center justify-between"},iu={class:"flex items-center gap-1"},du=["onClick"],uu={key:0,class:"mb-3 flex flex-wrap gap-1"},cu={class:"mt-3 flex gap-2 border-t border-gray-100 pt-3"},gu=["onClick"],mu=["onClick"],xu=["onClick"],pu=["onClick"],yu=["onClick"],fu={key:4,class:"mt-4 flex flex-col items-center justify-between gap-4 sm:mt-6 sm:flex-row"},bu={class:"flex w-full flex-col items-center gap-3 sm:w-auto sm:flex-row"},vu={class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},ku={class:"flex items-center gap-2"},wu=["value"],hu={class:"flex items-center gap-2"},$u=["disabled"],Au={class:"flex items-center gap-1"},Cu={key:1,class:"hidden px-2 text-gray-500 dark:text-gray-400 sm:inline"},Iu=["onClick"],Ku={key:2,class:"hidden px-2 text-gray-500 dark:text-gray-400 sm:inline"},Lu=["disabled"],Du={__name:"ApiKeysView",setup(C){const Q=Ge(),m=K([]),R=K([]),G=K(!1),D=K(!1),_=K(!1),U=K("today"),M=K(""),F=K("asc"),V=K({}),h=K({}),E=K({}),p=K([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),a=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),i=K(null),S=K(null),I=K(!1),v=K(null),$=K(""),u=K([]),c=K(""),w=K([{value:"today",label:"今日",icon:"fa-clock"},{value:"7days",label:"最近7天",icon:"fa-calendar-week"},{value:"monthly",label:"本月",icon:"fa-calendar"},{value:"all",label:"全部时间",icon:"fa-infinity"}]),ue=Y(()=>{const d=[{value:"",label:"所有标签",icon:"fa-asterisk"}];return u.value.forEach(t=>{d.push({value:t,label:t,icon:"fa-tag"})}),d}),ie=Y(()=>$.value?m.value.filter(d=>d.tags&&d.tags.includes($.value)).length:0),A=K(1),r=K(10),x=[10,20,50,100],k=K(!1),N=K(!1),P=K(!1),o=K(!1),y=K(!1),Z=K(!1),J=K(null),ae=K(null),pe=K(null),ge=K([]),ce=Y(()=>{let d=m.value;if($.value&&(d=m.value.filter(b=>b.tags&&b.tags.includes($.value))),c.value){const b=c.value.toLowerCase().trim();d=d.filter(s=>s.name&&s.name.toLowerCase().includes(b))}return M.value?[...d].sort((b,s)=>{let q=b[M.value],H=s[M.value];return M.value==="status"?(q=b.isActive?1:0,H=s.isActive?1:0):M.value==="cost"?(q=parseFloat(Be(b.usage).replace("$","")),H=parseFloat(Be(s.usage).replace("$",""))):(M.value==="createdAt"||M.value==="expiresAt")&&(q=q?new Date(q).getTime():0,H=H?new Date(H).getTime():0),q<H?F.value==="asc"?-1:1:q>H?F.value==="asc"?1:-1:0}):d}),te=Y(()=>{const d=ce.value.length;return Math.ceil(d/r.value)||0}),$e=Y(()=>{const d=[],t=A.value,b=te.value;if(b<=7)for(let s=1;s<=b;s++)d.push(s);else{let s=Math.max(1,t-2),q=Math.min(b,t+2);t<=3?q=5:t>=b-2&&(s=b-4);for(let H=s;H<=q;H++)d.push(H)}return d}),Ie=Y(()=>{const d=(A.value-1)*r.value,t=d+r.value;return ce.value.slice(d,t)}),je=async()=>{var d,t;try{const[b,s,q,H,j,oe]=await Promise.all([B.get("/admin/claude-accounts"),B.get("/admin/claude-console-accounts"),B.get("/admin/gemini-accounts"),B.get("/admin/openai-accounts"),B.get("/admin/bedrock-accounts"),B.get("/admin/account-groups")]),we=[];if(b.success&&((d=b.data)==null||d.forEach(se=>{we.push({...se,platform:"claude-oauth",isDedicated:se.accountType==="dedicated"})})),s.success&&((t=s.data)==null||t.forEach(se=>{we.push({...se,platform:"claude-console",isDedicated:se.accountType==="dedicated"})})),a.value.claude=we,q.success&&(a.value.gemini=(q.data||[]).map(se=>({...se,isDedicated:se.accountType==="dedicated"}))),H.success&&(a.value.openai=(H.data||[]).map(se=>({...se,isDedicated:se.accountType==="dedicated"}))),j.success&&(a.value.bedrock=(j.data||[]).map(se=>({...se,isDedicated:se.accountType==="dedicated"}))),oe.success){const se=oe.data||[];a.value.claudeGroups=se.filter(De=>De.platform==="claude"),a.value.geminiGroups=se.filter(De=>De.platform==="gemini"),a.value.openaiGroups=se.filter(De=>De.platform==="openai")}}catch(b){console.error("加载账户列表失败:",b)}},ye=async()=>{_.value=!0;try{const d=await B.get(`/admin/api-keys?timeRange=${U.value}`);if(d.success){m.value=d.data||[];const t=new Set;m.value.forEach(b=>{b.tags&&Array.isArray(b.tags)&&b.tags.forEach(s=>t.add(s))}),u.value=Array.from(t).sort()}}catch{W("加载 API Keys 失败","error")}finally{_.value=!1}},Le=d=>{M.value===d?F.value=F.value==="asc"?"desc":"asc":(M.value=d,F.value="asc")},We=d=>!d&&d!==0?"0":d.toLocaleString("zh-CN"),Be=d=>!d||!d.total?"$0.0000":`$${(d.total.cost||0).toFixed(4)}`,Re=d=>{if(!d)return"未知账户";if(d.startsWith("group:")){const H=d.substring(6),j=a.value.claudeGroups.find(se=>se.id===H);if(j)return`分组-${j.name}`;const oe=a.value.geminiGroups.find(se=>se.id===H);if(oe)return`分组-${oe.name}`;const we=a.value.openaiGroups.find(se=>se.id===H);return we?`分组-${we.name}`:`分组-${H.substring(0,8)}`}const t=a.value.claude.find(H=>H.id===d);if(t)return`${t.name}`;const b=a.value.gemini.find(H=>H.id===d);if(b)return`${b.name}`;const s=a.value.openai.find(H=>H.id===d);if(s)return`${s.name}`;const q=a.value.bedrock.find(H=>H.id===d);return q?`${q.name}`:`${d.substring(0,8)}`},Fe=d=>{if(d.claudeAccountId){const t=Re(d.claudeAccountId);if(d.claudeAccountId.startsWith("group:"))return t;const b=a.value.claude.find(s=>s.id===d.claudeAccountId);return b?b.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}if(d.claudeConsoleAccountId){const t=a.value.claude.find(b=>b.id===d.claudeConsoleAccountId&&b.platform==="claude-console");return t?`Console-${t.name}`:"⚠️ Console账户不存在"}return""},He=d=>{if(d.geminiAccountId){const t=Re(d.geminiAccountId);if(d.geminiAccountId.startsWith("group:"))return t;const b=a.value.gemini.find(s=>s.id===d.geminiAccountId);return b?b.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},ze=d=>{if(d.openaiAccountId){const t=Re(d.openaiAccountId);if(d.openaiAccountId.startsWith("group:"))return t;const b=a.value.openai.find(s=>s.id===d.openaiAccountId);return b?b.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},Ne=d=>{if(d.bedrockAccountId){const t=Re(d.bedrockAccountId);if(d.bedrockAccountId.startsWith("group:"))return t;const b=a.value.bedrock.find(s=>s.id===d.bedrockAccountId);return b?b.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},Ve=d=>d?new Date(d)<new Date:!1,Pe=d=>!d||Ve(d)?!1:(new Date(d)-new Date)/(1e3*60*60*24)<=7,Ye=d=>d?new Date(d).toLocaleDateString("zh-CN"):"",ct=async d=>{V.value[d]?V.value[d]=!1:(V.value[d]=!0,E.value[d]||Je(d),await Ee(d,!0))},Ee=async(d,t=!1)=>{if(!t&&h.value[d]&&h.value[d].length>0)return;const b=ke(d);try{let s=`/admin/api-keys/${d}/model-stats`;const q=new URLSearchParams;if(b.customStart&&b.customEnd)q.append("startDate",b.customStart),q.append("endDate",b.customEnd),q.append("period","custom");else{const j=b.preset==="today"||b.preset==="7days"?"daily":"monthly";q.append("period",j)}s+="?"+q.toString();const H=await B.get(s);H.success&&(h.value[d]=H.data||[])}catch{W("加载模型统计失败","error"),h.value[d]=[]}},Qe=(d,t)=>{const b=t.reduce((s,q)=>s+(q.allTokens||0),0);return b===0?0:Math.round(d/b*100)},gt=d=>d.formatted&&d.formatted.total?d.formatted.total:d.cost!==void 0?`$${d.cost.toFixed(6)}`:"$0.000000",Je=d=>{const t=new Date,b=new Date(t);b.setDate(t.getDate()-6),E.value[d]={type:"preset",preset:"7days",customStart:b.toISOString().split("T")[0],customEnd:t.toISOString().split("T")[0],customRange:null,presetOptions:[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}]}},ke=d=>(E.value[d]||Je(d),E.value[d]),Xe=(d,t)=>{const b=ke(t);b.type="preset",b.preset=d;const s=b.presetOptions.find(q=>q.value===d);if(s){const q=new Date,H=new Date(q);H.setDate(q.getDate()-(s.days-1)),b.customStart=H.toISOString().split("T")[0],b.customEnd=q.toISOString().split("T")[0];const j=oe=>oe.getFullYear()+"-"+String(oe.getMonth()+1).padStart(2,"0")+"-"+String(oe.getDate()).padStart(2,"0")+" 00:00:00";b.customRange=[j(H),j(q)]}Ee(t,!0)},mt=(d,t)=>{const b=ke(d);t&&t.length===2?(b.type="custom",b.preset="",b.customRange=t,b.customStart=t[0].split(" ")[0],b.customEnd=t[1].split(" ")[0],Ee(d,!0)):t===null&&Xe("7days",d)},xt=d=>d>new Date,pt=d=>{const t=ke(d);t.type="preset",t.preset="7days";const b=new Date,s=new Date(b);s.setDate(b.getDate()-6),t.customStart=s.toISOString().split("T")[0],t.customEnd=b.toISOString().split("T")[0],t.customRange=null,Ee(d,!0),W("已重置筛选条件并刷新数据","info")},yt=async()=>{await je(),k.value=!0},Ze=async d=>{await je(),J.value=d,N.value=!0},et=d=>{ae.value=d,P.value=!0},ft=d=>{k.value=!1,pe.value=d,o.value=!0,ye()},bt=d=>{k.value=!1,ge.value=d,y.value=!0,ye()},vt=async()=>{if(R.value.length===0){W("请先选择要编辑的 API Keys","warning");return}await je(),Z.value=!0},kt=()=>{Z.value=!1,R.value=[],me(),ye()},wt=()=>{N.value=!1,W("API Key 更新成功","success"),ye()},ht=()=>{P.value=!1,W("API Key 续期成功","success"),ye()},tt=async d=>{let t=!0;if(d.isActive&&(window.showConfirm?t=await window.showConfirm("禁用 API Key",`确定要禁用 API Key "${d.name}" 吗？禁用后所有使用此 Key 的请求将返回 401 错误。`,"确定禁用","取消"):t=confirm(`确定要禁用 API Key "${d.name}" 吗？禁用后所有使用此 Key 的请求将返回 401 错误。`)),!!t)try{const b=await B.put(`/admin/api-keys/${d.id}`,{isActive:!d.isActive});if(b.success){W(`API Key 已${d.isActive?"禁用":"激活"}`,"success");const s=m.value.find(q=>q.id===d.id);s&&(s.isActive=!d.isActive)}else W(b.message||"操作失败","error")}catch{W("操作失败","error")}},st=async d=>{let t=!1;if(window.showConfirm?t=await window.showConfirm("删除 API Key","确定要删除这个 API Key 吗？此操作不可恢复。","确定删除","取消"):t=confirm("确定要删除这个 API Key 吗？此操作不可恢复。"),!!t)try{const b=await B.delete(`/admin/api-keys/${d}`);if(b.success){W("API Key 已删除","success");const s=R.value.indexOf(d);s>-1&&R.value.splice(s,1),me(),ye()}else W(b.message||"删除失败","error")}catch{W("删除失败","error")}},$t=async()=>{const d=R.value.length;if(d===0){W("请先选择要删除的 API Keys","warning");return}let t=!1;const b=`确定要删除选中的 ${d} 个 API Key 吗？此操作不可恢复。`;if(window.showConfirm?t=await window.showConfirm("批量删除 API Keys",b,"确定删除","取消"):t=confirm(b),!t)return;const s=[...R.value];try{const q=await B.delete("/admin/api-keys/batch",{data:{keyIds:s}});if(q.success){const{successCount:H,failedCount:j,errors:oe}=q.data;if(H>0){if(W(`成功删除 ${H} 个 API Keys`,"success"),j>0){const we=oe.map(se=>`${se.keyId}: ${se.error}`).join(`
`);W(`${j} 个删除失败:
${we}`,"warning")}}else W("所有 API Keys 删除失败","error");R.value=[],me(),ye()}else W(q.message||"批量删除失败","error")}catch(q){W("批量删除失败","error"),console.error("批量删除 API Keys 失败:",q)}},At=()=>{if(G.value)Ie.value.forEach(d=>{R.value.includes(d.id)||R.value.push(d.id)});else{const d=new Set(Ie.value.map(t=>t.id));R.value=R.value.filter(t=>!d.has(t))}me()},me=()=>{const d=Ie.value.length,t=Ie.value.filter(b=>R.value.includes(b.id)).length;t===0?(G.value=!1,D.value=!1):t===d?(G.value=!0,D.value=!1):(G.value=!1,D.value=!0)},Ct=d=>{const b=`${window.location.origin}/admin-next/api-stats?apiId=${d.id}`,s=document.createElement("textarea");s.value=b,s.style.position="fixed",s.style.opacity="0",s.style.left="-9999px",document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999);try{document.execCommand("copy")?W("已复制统计页面链接","success"):(W("复制失败，请手动复制","error"),console.log("统计页面链接:",b))}catch(q){W("复制失败，请手动复制","error"),console.error("复制错误:",q),console.log("统计页面链接:",b)}finally{document.body.removeChild(s)}},at=d=>{i.value=d},rt=()=>{i.value=null},It=async({keyId:d,expiresAt:t})=>{try{const b=await B.put(`/admin/api-keys/${d}`,{expiresAt:t||null});if(b.success){W("过期时间已更新","success");const s=m.value.find(q=>q.id===d);s&&(s.expiresAt=t||null),rt()}else W(b.message||"更新失败","error"),S.value&&S.value.resetSaving()}catch{W("更新失败","error"),S.value&&S.value.resetSaving()}},lt=d=>d?new Date(d).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"):"",de=d=>{if(!d.dailyCostLimit||d.dailyCostLimit===0)return 0;const t=(d.dailyCost||0)/d.dailyCostLimit*100;return Math.min(t,100)},ot=d=>{const t=de(d);return t>=100?"bg-gradient-to-r from-red-500 to-red-600":t>=90?"bg-gradient-to-r from-red-400 to-red-500":t>=80?"bg-gradient-to-r from-yellow-400 to-orange-500":t>=60?"bg-gradient-to-r from-yellow-400 to-yellow-500":"bg-gradient-to-r from-green-400 to-green-500"},nt=d=>{const t=de(d);return t>=100?"text-red-600 dark:text-red-400":t>=80?"text-yellow-600 dark:text-yellow-400":"text-gray-700 dark:text-gray-300"},Ue=d=>{v.value=d,I.value=!0},Ke=d=>d>=1e6?(d/1e6).toFixed(1)+"M":d>=1e3?(d/1e3).toFixed(1)+"K":d.toString(),it=d=>{if(!d)return"从未使用";const t=new Date(d),s=new Date-t;return s<6e4?"刚刚":s<36e5?`${Math.floor(s/6e4)} 分钟前`:s<864e5?`${Math.floor(s/36e5)} 小时前`:s<6048e5?`${Math.floor(s/864e5)} 天前`:t.toLocaleDateString("zh-CN")},Kt=()=>{c.value="",A.value=1};return Ae([$,U],()=>{A.value=1,R.value=[],me()}),Ae(c,()=>{A.value=1,me()}),Ae([A,r],()=>{me()}),Ae(m,()=>{const d=new Set(m.value.map(t=>t.id));R.value=R.value.filter(t=>d.has(t)),me()}),Te(async()=>{await Promise.all([Q.loadSupportedClients(),je(),ye()]),me()}),(d,t)=>{const b=Lt;return l(),n("div",ai,[e("div",ri,[e("div",li,[t[42]||(t[42]=e("div",null,[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," API Keys 管理 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"}," 管理和监控您的 API 密钥 ")],-1)),e("div",oi,[e("div",ni,[e("div",ii,[t[30]||(t[30]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),ne(dt,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=s=>U.value=s),icon:"fa-calendar-alt","icon-color":"text-blue-500",options:w.value,placeholder:"选择时间范围",onChange:t[1]||(t[1]=s=>ye())},null,8,["modelValue","options"])]),e("div",di,[t[31]||(t[31]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("div",ui,[ne(dt,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=s=>$.value=s),icon:"fa-tags","icon-color":"text-purple-500",options:ue.value,placeholder:"所有标签",onChange:t[3]||(t[3]=s=>A.value=1)},null,8,["modelValue","options"]),$.value?(l(),n("span",ci,g(ie.value),1)):f("",!0)])]),e("div",gi,[t[34]||(t[34]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-cyan-500 to-teal-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("div",mi,[T(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.value=s),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 pl-9 text-sm text-gray-700 placeholder-gray-400 shadow-sm transition-all duration-200 hover:border-gray-300 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 dark:placeholder-gray-500 dark:hover:border-gray-500",placeholder:"搜索名称...",type:"text",onInput:t[5]||(t[5]=s=>A.value=1)},null,544),[[ee,c.value]]),t[33]||(t[33]=e("i",{class:"fas fa-search absolute left-3 text-sm text-cyan-500"},null,-1)),c.value?(l(),n("button",{key:0,class:"absolute right-2 flex h-5 w-5 items-center justify-center rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:Kt},[...t[32]||(t[32]=[e("i",{class:"fas fa-times text-xs"},null,-1)])])):f("",!0)])]),e("button",{class:"group relative flex items-center justify-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition-all duration-200 hover:border-gray-300 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 dark:hover:border-gray-500 sm:w-auto",disabled:_.value,onClick:t[6]||(t[6]=s=>ye())},[t[35]||(t[35]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-green-500 to-teal-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("i",{class:O(["fas relative text-green-500",_.value?"fa-spinner fa-spin":"fa-sync-alt"])},null,2),t[36]||(t[36]=e("span",{class:"relative"},"刷新",-1))],8,xi),R.value.length>0?(l(),n("button",{key:0,class:"group relative flex items-center justify-center gap-2 rounded-lg border border-blue-200 bg-blue-50 px-4 py-2 text-sm font-medium text-blue-700 shadow-sm transition-all duration-200 hover:border-blue-300 hover:bg-blue-100 hover:shadow-md sm:w-auto",onClick:t[7]||(t[7]=s=>vt())},[t[37]||(t[37]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),t[38]||(t[38]=e("i",{class:"fas fa-edit relative text-blue-600"},null,-1)),e("span",pi,"编辑选中 ("+g(R.value.length)+")",1)])):f("",!0),R.value.length>0?(l(),n("button",{key:1,class:"group relative flex items-center justify-center gap-2 rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-sm font-medium text-red-700 shadow-sm transition-all duration-200 hover:border-red-300 hover:bg-red-100 hover:shadow-md sm:w-auto",onClick:t[8]||(t[8]=s=>$t())},[t[39]||(t[39]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),t[40]||(t[40]=e("i",{class:"fas fa-trash relative text-red-600"},null,-1)),e("span",yi,"删除选中 ("+g(R.value.length)+")",1)])):f("",!0)]),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 px-5 py-2.5 text-sm font-medium text-white shadow-md transition-all duration-200 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg sm:w-auto",onClick:xe(yt,["stop"])},[...t[41]||(t[41]=[e("i",{class:"fas fa-plus"},null,-1),e("span",null,"创建新 Key",-1)])])])]),_.value?(l(),n("div",fi,[...t[43]||(t[43]=[e("div",{class:"loading-spinner mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500"},"正在加载 API Keys...",-1)])])):m.value.length===0?(l(),n("div",bi,[...t[44]||(t[44]=[e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100"},[e("i",{class:"fas fa-key text-xl text-gray-400"})],-1),e("p",{class:"text-lg text-gray-500"},"暂无 API Keys",-1),e("p",{class:"mt-2 text-sm text-gray-400"},"点击上方按钮创建您的第一个 API Key",-1)])])):(l(),n("div",vi,[e("table",ki,[e("thead",wi,[e("tr",null,[e("th",hi,[e("div",$i,[T(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>G.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",indeterminate:D.value,type:"checkbox",onChange:At},null,40,Ai),[[fe,G.value]])])]),e("th",{class:"w-[25%] min-w-[200px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[10]||(t[10]=s=>Le("name"))},[t[45]||(t[45]=L(" 名称 ",-1)),M.value==="name"?(l(),n("i",{key:0,class:O(["fas",F.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),n("i",Ci))]),t[52]||(t[52]=e("th",{class:"w-[10%] min-w-[80px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 标签 ",-1)),e("th",{class:"w-[8%] min-w-[70px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[11]||(t[11]=s=>Le("status"))},[t[46]||(t[46]=L(" 状态 ",-1)),M.value==="status"?(l(),n("i",{key:0,class:O(["fas",F.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),n("i",Ii))]),e("th",Ki,[t[49]||(t[49]=L(" 使用统计 ",-1)),e("span",{class:"cursor-pointer rounded px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-600",onClick:t[12]||(t[12]=s=>Le("cost"))},[t[47]||(t[47]=L(" (费用 ",-1)),M.value==="cost"?(l(),n("i",{key:0,class:O(["fas",F.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),n("i",Li)),t[48]||(t[48]=L(") ",-1))])]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[13]||(t[13]=s=>Le("createdAt"))},[t[50]||(t[50]=L(" 创建时间 ",-1)),M.value==="createdAt"?(l(),n("i",{key:0,class:O(["fas",F.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),n("i",Di))]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[14]||(t[14]=s=>Le("expiresAt"))},[t[51]||(t[51]=L(" 过期时间 ",-1)),M.value==="expiresAt"?(l(),n("i",{key:0,class:O(["fas",F.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),n("i",_i))]),t[53]||(t[53]=e("th",{class:"w-[20%] min-w-[180px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 操作 ",-1))])]),e("tbody",Mi,[(l(!0),n(z,null,X(Ie.value,s=>{var q,H;return l(),n(z,{key:s.id},[e("tr",Ti,[e("td",Si,[e("div",ji,[T(e("input",{"onUpdate:modelValue":t[15]||(t[15]=j=>R.value=j),class:"mr-3 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox",value:s.id,onChange:me},null,40,Ri),[[fe,R.value]])])]),e("td",Vi,[e("div",Pi,[t[59]||(t[59]=e("div",{class:"mr-2 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-xs text-white"})],-1)),e("div",Ei,[e("div",{class:"truncate text-sm font-semibold text-gray-900 dark:text-gray-100",title:s.name},g(s.name),9,Ui),e("div",{class:"truncate text-xs text-gray-500 dark:text-gray-400",title:s.id},g(s.id),9,Oi),e("div",Gi,[s.claudeAccountId||s.claudeConsoleAccountId?(l(),n("div",qi,[t[54]||(t[54]=e("span",{class:"inline-flex items-center rounded bg-indigo-100 px-1.5 py-0.5 text-indigo-700"},[e("i",{class:"fas fa-brain mr-1 text-[10px]"}),L(" Claude ")],-1)),e("span",Wi,g(Fe(s)),1)])):f("",!0),s.geminiAccountId?(l(),n("div",Bi,[t[55]||(t[55]=e("span",{class:"inline-flex items-center rounded bg-yellow-100 px-1.5 py-0.5 text-yellow-700"},[e("i",{class:"fas fa-robot mr-1 text-[10px]"}),L(" Gemini ")],-1)),e("span",Fi,g(He(s)),1)])):f("",!0),s.openaiAccountId?(l(),n("div",Hi,[t[56]||(t[56]=e("span",{class:"inline-flex items-center rounded bg-gray-100 px-1.5 py-0.5 text-gray-700"},[e("i",{class:"fa-openai mr-1 text-[10px]"}),L(" OpenAI ")],-1)),e("span",zi,g(ze(s)),1)])):f("",!0),s.bedrockAccountId?(l(),n("div",Ni,[t[57]||(t[57]=e("span",{class:"inline-flex items-center rounded bg-orange-100 px-1.5 py-0.5 text-orange-700"},[e("i",{class:"fas fa-cloud mr-1 text-[10px]"}),L(" Bedrock ")],-1)),e("span",Yi,g(Ne(s)),1)])):f("",!0),!s.claudeAccountId&&!s.claudeConsoleAccountId&&!s.geminiAccountId&&!s.openaiAccountId&&!s.bedrockAccountId?(l(),n("div",Qi,[...t[58]||(t[58]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),L(" 使用共享池 ",-1)])])):f("",!0)])])])]),e("td",Ji,[e("div",Xi,[(l(!0),n(z,null,X(s.tags||[],j=>(l(),n("span",{key:j,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},g(j),1))),128)),!s.tags||s.tags.length===0?(l(),n("span",Zi,"无标签")):f("",!0)])]),e("td",ed,[e("span",{class:O(["inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:O(["mr-2 h-2 w-2 rounded-full",s.isActive?"bg-green-500":"bg-red-500"])},null,2),L(" "+g(s.isActive?"活跃":"禁用"),1)],2)]),e("td",td,[e("div",sd,[e("div",ad,[e("div",rd,[t[60]||(t[60]=e("span",{class:"text-gray-600 dark:text-gray-400"},"今日请求",-1)),e("span",ld,g(We(((H=(q=s.usage)==null?void 0:q.daily)==null?void 0:H.requests)||0))+"次",1)]),e("div",od,[t[61]||(t[61]=e("span",{class:"text-gray-600 dark:text-gray-400"},"今日费用",-1)),e("span",nd,"$"+g((s.dailyCost||0).toFixed(4)),1)]),e("div",id,[t[62]||(t[62]=e("span",{class:"text-gray-600 dark:text-gray-400"},"最后使用",-1)),e("span",dd,g(it(s.lastUsedAt)),1)])]),s.dailyCostLimit>0?(l(),n("div",ud,[e("div",cd,[e("div",gd,[t[63]||(t[63]=e("div",{class:"flex items-center gap-1"},[e("i",{class:"fas fa-dollar-sign text-xs text-green-600 dark:text-green-400"}),e("span",{class:"text-xs font-medium text-green-700 dark:text-green-300"},"费用限额")],-1)),e("span",{class:O(["text-xs font-semibold",nt(s)])}," $"+g((s.dailyCost||0).toFixed(2))+" / $"+g(s.dailyCostLimit.toFixed(2)),3)]),e("div",md,[e("div",xd,[e("div",{class:O(["h-2 rounded-full transition-all duration-300 ease-in-out",ot(s)]),style:_e({width:de(s)+"%"})},null,6)]),e("div",pd,[e("span",yd,g(Math.round(de(s)))+"% ",1)])]),de(s)>=80?(l(),n("div",fd,[e("i",{class:O(["fas fa-exclamation-triangle text-xs",de(s)>=100?"text-red-500":"text-yellow-500"])},null,2),e("span",{class:O(["text-xs",de(s)>=100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},g(de(s)>=100?"已超过限额":"接近限额"),3)])):f("",!0)])])):f("",!0),s.rateLimitWindow>0?(l(),le(Oe,{key:1,"current-requests":s.currentWindowRequests,"current-tokens":s.currentWindowTokens,"rate-limit-window":s.rateLimitWindow,"request-limit":s.rateLimitRequests,"show-progress":!0,"show-tooltip":!1,"token-limit":s.tokenLimit,"window-end-time":s.windowEndTime,"window-remaining-seconds":s.windowRemainingSeconds,"window-start-time":s.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])):f("",!0),e("div",bd,[e("button",{class:"flex w-full items-center justify-center gap-1 rounded py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:hover:bg-blue-900/20 dark:hover:text-blue-400",onClick:j=>Ue(s)},[...t[64]||(t[64]=[e("i",{class:"fas fa-chart-line"},null,-1),L(" 查看详细统计 ",-1)])],8,vd)])])]),e("td",kd,g(new Date(s.createdAt).toLocaleDateString()),1),e("td",wd,[e("div",hd,[s.expiresAt?(l(),n("span",$d,[Ve(s.expiresAt)?(l(),n("span",Ad,[...t[65]||(t[65]=[e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),L(" 已过期 ",-1)])])):Pe(s.expiresAt)?(l(),n("span",Cd,[t[66]||(t[66]=e("i",{class:"fas fa-clock mr-1"},null,-1)),L(" "+g(Ye(s.expiresAt)),1)])):(l(),n("span",Id,g(Ye(s.expiresAt)),1))])):(l(),n("span",Kd,[...t[67]||(t[67]=[e("i",{class:"fas fa-infinity mr-1"},null,-1),L(" 永不过期 ",-1)])])),e("button",{class:"inline-flex h-6 w-6 items-center justify-center rounded-md text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:xe(j=>at(s),["stop"])},[...t[68]||(t[68]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])],8,Ld)])]),e("td",Dd,[e("div",_d,[s&&s.id?(l(),n("button",{key:0,class:"rounded px-2 py-1 text-xs font-medium text-indigo-600 transition-colors hover:bg-indigo-50 hover:text-indigo-900",title:"模型使用分布",onClick:j=>ct(s.id)},[e("i",{class:O(["fas",V.value[s.id]?"fa-chevron-up":"fa-chevron-down"])},null,2),t[69]||(t[69]=e("span",{class:"ml-1 hidden xl:inline"},"模型",-1))],8,Md)):f("",!0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-purple-600 transition-colors hover:bg-purple-50 hover:text-purple-900",title:"复制统计页面链接",onClick:j=>Ct(s)},[...t[70]||(t[70]=[e("i",{class:"fas fa-chart-bar"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"统计",-1)])],8,Td),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-900",title:"编辑",onClick:j=>Ze(s)},[...t[71]||(t[71]=[e("i",{class:"fas fa-edit"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"编辑",-1)])],8,Sd),s.expiresAt&&(Ve(s.expiresAt)||Pe(s.expiresAt))?(l(),n("button",{key:1,class:"rounded px-2 py-1 text-xs font-medium text-green-600 transition-colors hover:bg-green-50 hover:text-green-900",title:"续期",onClick:j=>et(s)},[...t[72]||(t[72]=[e("i",{class:"fas fa-clock"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"续期",-1)])],8,jd)):f("",!0),e("button",{class:O([s.isActive?"text-orange-600 hover:bg-orange-50 hover:text-orange-900":"text-green-600 hover:bg-green-50 hover:text-green-900","rounded px-2 py-1 text-xs font-medium transition-colors"]),title:s.isActive?"禁用":"激活",onClick:j=>tt(s)},[e("i",{class:O(["fas",s.isActive?"fa-ban":"fa-check-circle"])},null,2),e("span",Vd,g(s.isActive?"禁用":"激活"),1)],10,Rd),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",title:"删除",onClick:j=>st(s.id)},[...t[73]||(t[73]=[e("i",{class:"fas fa-trash"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"删除",-1)])],8,Pd)])])]),s&&s.id&&V.value[s.id]?(l(),n("tr",Ed,[e("td",Ud,[h.value[s.id]?f("",!0):(l(),n("div",Od,[...t[74]||(t[74]=[e("div",{class:"loading-spinner mx-auto"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500"},"加载模型统计...",-1)])])),e("div",Gd,[e("div",qd,[t[75]||(t[75]=e("h5",{class:"flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),L(" 模型使用分布 ")],-1)),e("div",Wd,[h.value[s.id]&&h.value[s.id].length>0?(l(),n("span",Bd,g(h.value[s.id].length)+" 个模型 ",1)):f("",!0),e("div",Fd,[e("div",Hd,[(l(!0),n(z,null,X(ke(s.id).presetOptions,j=>(l(),n("button",{key:j.value,class:O(["rounded px-2 py-1 text-xs font-medium transition-colors",ke(s.id).preset===j.value&&ke(s.id).type==="preset"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200"]),onClick:oe=>Xe(j.value,s.id)},g(j.label),11,zd))),128))]),ne(b,{class:"api-key-date-picker",clearable:!0,"default-time":p.value,"disabled-date":xt,"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","model-value":ke(s.id).customRange,"range-separator":"至",size:"small","start-placeholder":"开始日期",style:{width:"280px"},type:"datetimerange","unlink-panels":!1,"value-format":"YYYY-MM-DD HH:mm:ss","onUpdate:modelValue":j=>mt(s.id,j)},null,8,["default-time","model-value","onUpdate:modelValue"])])])]),h.value[s.id]&&h.value[s.id].length===0?(l(),n("div",Nd,[e("div",Yd,[t[77]||(t[77]=e("i",{class:"fas fa-chart-line text-lg text-gray-400"},null,-1)),t[78]||(t[78]=e("p",{class:"text-sm text-gray-500"},"暂无模型使用数据",-1)),e("button",{class:"ml-2 flex items-center gap-1 text-sm text-blue-500 transition-colors hover:text-blue-700",title:"重置筛选条件并刷新",onClick:j=>pt(s.id)},[...t[76]||(t[76]=[e("i",{class:"fas fa-sync-alt text-xs"},null,-1),e("span",{class:"text-xs"},"刷新",-1)])],8,Qd)]),t[79]||(t[79]=e("p",{class:"text-xs text-gray-400"},"尝试调整时间范围或点击刷新重新加载数据",-1))])):h.value[s.id]&&h.value[s.id].length>0?(l(),n("div",Jd,[(l(!0),n(z,null,X(h.value[s.id],j=>(l(),n("div",{key:j.model,class:"rounded-xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-4 transition-all duration-200 hover:border-indigo-300 hover:shadow-lg dark:border-gray-600 dark:from-gray-800 dark:to-gray-700 dark:hover:border-indigo-500"},[e("div",Xd,[e("div",Zd,[e("span",e0,g(j.model),1),e("span",t0,g(j.requests)+" 次请求",1)])]),e("div",s0,[e("div",a0,[t[80]||(t[80]=e("span",{class:"flex items-center text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-coins mr-1 text-xs text-yellow-500"}),L(" 总Token: ")],-1)),e("span",r0,g(Ke(j.allTokens)),1)]),e("div",l0,[t[81]||(t[81]=e("span",{class:"flex items-center text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-dollar-sign mr-1 text-xs text-green-500"}),L(" 费用: ")],-1)),e("span",o0,g(gt(j)),1)]),e("div",n0,[e("div",i0,[t[82]||(t[82]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-1 text-green-500"}),L(" 输入: ")],-1)),e("span",d0,g(Ke(j.inputTokens)),1)]),e("div",u0,[t[83]||(t[83]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-1 text-blue-500"}),L(" 输出: ")],-1)),e("span",c0,g(Ke(j.outputTokens)),1)]),j.cacheCreateTokens>0?(l(),n("div",g0,[t[84]||(t[84]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-1"}),L(" 缓存创建: ")],-1)),e("span",m0,g(Ke(j.cacheCreateTokens)),1)])):f("",!0),j.cacheReadTokens>0?(l(),n("div",x0,[t[85]||(t[85]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-1"}),L(" 缓存读取: ")],-1)),e("span",p0,g(Ke(j.cacheReadTokens)),1)])):f("",!0)])]),e("div",y0,[e("div",{class:"h-2 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-500",style:_e({width:Qe(j.allTokens,h.value[s.id])+"%"})},null,4)]),e("div",f0,[e("span",b0,g(Qe(j.allTokens,h.value[s.id]))+"% ",1)])]))),128))])):f("",!0),h.value[s.id]&&h.value[s.id].length>0?(l(),n("div",v0,[e("div",k0,[t[88]||(t[88]=e("span",{class:"flex items-center font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-calculator mr-2 text-indigo-500"}),L(" 总计统计 ")],-1)),e("div",w0,[e("span",h0,[t[86]||(t[86]=L(" 总请求: ",-1)),e("span",$0,g(h.value[s.id].reduce((j,oe)=>j+oe.requests,0)),1)]),e("span",A0,[t[87]||(t[87]=L(" 总Token: ",-1)),e("span",C0,g(Ke(h.value[s.id].reduce((j,oe)=>j+oe.allTokens,0))),1)])])])])):f("",!0)])])])):f("",!0)],64)}),128))])])])),!_.value&&ce.value.length>0?(l(),n("div",I0,[(l(!0),n(z,null,X(Ie.value,s=>{var q,H;return l(),n("div",{key:s.id,class:"card p-4 transition-shadow hover:shadow-lg"},[e("div",K0,[e("div",L0,[T(e("input",{"onUpdate:modelValue":t[16]||(t[16]=j=>R.value=j),class:"mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox",value:s.id,onChange:me},null,40,D0),[[fe,R.value]]),t[89]||(t[89]=e("div",{class:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-sm text-white"})],-1)),e("div",null,[e("h4",_0,g(s.name),1),e("p",M0,g(s.id),1)])]),e("span",{class:O(["inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold",s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:O(["mr-1.5 h-1.5 w-1.5 rounded-full",s.isActive?"bg-green-500":"bg-red-500"])},null,2),L(" "+g(s.isActive?"活跃":"已停用"),1)],2)]),e("div",T0,[s.claudeAccountId||s.claudeConsoleAccountId?(l(),n("div",S0,[t[90]||(t[90]=e("span",{class:"inline-flex items-center rounded bg-indigo-100 px-2 py-0.5 text-indigo-700"},[e("i",{class:"fas fa-brain mr-1"}),L(" Claude ")],-1)),e("span",j0,g(Fe(s)),1)])):f("",!0),s.geminiAccountId?(l(),n("div",R0,[t[91]||(t[91]=e("span",{class:"inline-flex items-center rounded bg-yellow-100 px-2 py-0.5 text-yellow-700"},[e("i",{class:"fas fa-robot mr-1"}),L(" Gemini ")],-1)),e("span",V0,g(He(s)),1)])):f("",!0),s.openaiAccountId?(l(),n("div",P0,[t[92]||(t[92]=e("span",{class:"inline-flex items-center rounded bg-gray-100 px-2 py-0.5 text-gray-700"},[e("i",{class:"fa-openai mr-1"}),L(" OpenAI ")],-1)),e("span",E0,g(ze(s)),1)])):f("",!0),s.bedrockAccountId?(l(),n("div",U0,[t[93]||(t[93]=e("span",{class:"inline-flex items-center rounded bg-orange-100 px-2 py-0.5 text-orange-700"},[e("i",{class:"fas fa-cloud mr-1"}),L(" Bedrock ")],-1)),e("span",O0,g(Ne(s)),1)])):f("",!0),!s.claudeAccountId&&!s.claudeConsoleAccountId&&!s.geminiAccountId&&!s.openaiAccountId&&!s.bedrockAccountId?(l(),n("div",G0,[...t[94]||(t[94]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),L(" 使用共享池 ",-1)])])):f("",!0)]),e("div",q0,[e("div",W0,[e("div",B0,[t[96]||(t[96]=e("span",{class:"text-xs text-gray-600"},"今日使用",-1)),e("button",{class:"text-xs text-blue-600 hover:text-blue-800",onClick:j=>Ue(s)},[...t[95]||(t[95]=[e("i",{class:"fas fa-chart-line mr-1"},null,-1),L("详情 ",-1)])],8,F0)]),e("div",H0,[e("div",null,[e("p",z0,g(We(((H=(q=s.usage)==null?void 0:q.daily)==null?void 0:H.requests)||0))+" 次 ",1),t[97]||(t[97]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"请求",-1))]),e("div",null,[e("p",N0," $"+g((s.dailyCost||0).toFixed(4)),1),t[98]||(t[98]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"费用",-1))])]),e("div",Y0,[t[99]||(t[99]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"最后使用",-1)),e("span",Q0,g(it(s.lastUsedAt)),1)])]),s.dailyCostLimit>0?(l(),n("div",J0,[e("div",X0,[e("div",Z0,[t[100]||(t[100]=e("div",{class:"flex items-center gap-1"},[e("i",{class:"fas fa-dollar-sign text-xs text-green-600 dark:text-green-400"}),e("span",{class:"text-xs font-medium text-green-700 dark:text-green-300"},"每日费用限额")],-1)),e("span",{class:O(["text-xs font-semibold",nt(s)])}," $"+g((s.dailyCost||0).toFixed(2))+" / $"+g(s.dailyCostLimit.toFixed(2)),3)]),e("div",eu,[e("div",tu,[e("div",{class:O(["h-2.5 rounded-full transition-all duration-300 ease-in-out",ot(s)]),style:_e({width:de(s)+"%"})},null,6)]),e("div",su,[e("span",au,g(Math.round(de(s)))+"% ",1)])]),de(s)>=80?(l(),n("div",ru,[e("i",{class:O(["fas fa-exclamation-triangle mt-0.5 text-xs",de(s)>=100?"text-red-500":"text-yellow-500"])},null,2),e("span",{class:O(["text-xs",de(s)>=100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},g(de(s)>=100?"已超过费用限额，新请求将被拒绝":"费用即将达到限额，请注意控制"),3)])):f("",!0)])])):f("",!0),s.rateLimitWindow>0&&(s.rateLimitRequests>0||s.tokenLimit>0)?(l(),le(Oe,{key:1,"current-requests":s.currentWindowRequests,"current-tokens":s.currentWindowTokens,"rate-limit-window":s.rateLimitWindow,"request-limit":s.rateLimitRequests,"show-progress":!0,"show-tooltip":!1,"token-limit":s.tokenLimit,"window-end-time":s.windowEndTime,"window-remaining-seconds":s.windowRemainingSeconds,"window-start-time":s.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])):f("",!0)]),e("div",lu,[e("div",ou,[t[101]||(t[101]=e("span",null,"创建时间",-1)),e("span",null,g(lt(s.createdAt)),1)]),e("div",nu,[t[103]||(t[103]=e("span",null,"过期时间",-1)),e("div",iu,[e("span",{class:O(Pe(s.expiresAt)?"font-semibold text-orange-600":"")},g(s.expiresAt?lt(s.expiresAt):"永不过期"),3),e("button",{class:"inline-flex h-5 w-5 items-center justify-center rounded text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:xe(j=>at(s),["stop"])},[...t[102]||(t[102]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])],8,du)])])]),s.tags&&s.tags.length>0?(l(),n("div",uu,[(l(!0),n(z,null,X(s.tags,j=>(l(),n("span",{key:j,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},g(j),1))),128))])):f("",!0),e("div",cu,[e("button",{class:"flex flex-1 items-center justify-center gap-1 rounded-lg bg-blue-50 px-3 py-2 text-xs text-blue-600 transition-colors hover:bg-blue-100",onClick:j=>Ue(s)},[...t[104]||(t[104]=[e("i",{class:"fas fa-chart-line"},null,-1),L(" 查看详情 ",-1)])],8,gu),e("button",{class:"flex-1 rounded-lg bg-gray-50 px-3 py-2 text-xs text-gray-600 transition-colors hover:bg-gray-100",onClick:j=>Ze(s)},[...t[105]||(t[105]=[e("i",{class:"fas fa-edit mr-1"},null,-1),L(" 编辑 ",-1)])],8,mu),s.expiresAt&&(Ve(s.expiresAt)||Pe(s.expiresAt))?(l(),n("button",{key:0,class:"flex-1 rounded-lg bg-orange-50 px-3 py-2 text-xs text-orange-600 transition-colors hover:bg-orange-100",onClick:j=>et(s)},[...t[106]||(t[106]=[e("i",{class:"fas fa-clock mr-1"},null,-1),L(" 续期 ",-1)])],8,xu)):f("",!0),e("button",{class:O([s.isActive?"bg-orange-50 text-orange-600 hover:bg-orange-100":"bg-green-50 text-green-600 hover:bg-green-100","rounded-lg px-3 py-2 text-xs transition-colors"]),onClick:j=>tt(s)},[e("i",{class:O(["fas",s.isActive?"fa-ban":"fa-check-circle","mr-1"])},null,2),L(" "+g(s.isActive?"禁用":"激活"),1)],10,pu),e("button",{class:"rounded-lg bg-red-50 px-3 py-2 text-xs text-red-600 transition-colors hover:bg-red-100",onClick:j=>st(s.id)},[...t[107]||(t[107]=[e("i",{class:"fas fa-trash"},null,-1)])],8,yu)])])}),128))])):f("",!0),ce.value.length>0?(l(),n("div",fu,[e("div",bu,[e("span",vu," 共 "+g(ce.value.length)+" 条记录 ",1),e("div",ku,[t[108]||(t[108]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},"每页显示",-1)),T(e("select",{"onUpdate:modelValue":t[17]||(t[17]=s=>r.value=s),class:"rounded-md border border-gray-200 bg-white px-2 py-1 text-xs text-gray-700 transition-colors hover:border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-gray-500 sm:text-sm",onChange:t[18]||(t[18]=s=>A.value=1)},[(l(),n(z,null,X(x,s=>e("option",{key:s,value:s},g(s),9,wu)),64))],544),[[Ce,r.value]]),t[109]||(t[109]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},"条",-1))])]),e("div",hu,[e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:py-1 sm:text-sm",disabled:A.value===1,onClick:t[19]||(t[19]=s=>A.value--)},[...t[110]||(t[110]=[e("i",{class:"fas fa-chevron-left"},null,-1)])],8,$u),e("div",Au,[A.value>3?(l(),n("button",{key:0,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:block",onClick:t[20]||(t[20]=s=>A.value=1)}," 1 ")):f("",!0),A.value>4?(l(),n("span",Cu,"...")):f("",!0),(l(!0),n(z,null,X($e.value,s=>(l(),n("button",{key:s,class:O(["rounded-md px-2 py-1 text-xs font-medium sm:px-3 sm:text-sm",s===A.value?"bg-blue-600 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"]),onClick:q=>A.value=s},g(s),11,Iu))),128)),A.value<te.value-3?(l(),n("span",Ku,"...")):f("",!0),te.value>1&&A.value<te.value-2?(l(),n("button",{key:3,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:block",onClick:t[21]||(t[21]=s=>A.value=te.value)},g(te.value),1)):f("",!0)]),e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:py-1 sm:text-sm",disabled:A.value===te.value||te.value===0,onClick:t[22]||(t[22]=s=>A.value++)},[...t[111]||(t[111]=[e("i",{class:"fas fa-chevron-right"},null,-1)])],8,Lu)])])):f("",!0)]),k.value?(l(),le(ka,{key:0,accounts:a.value,onBatchSuccess:bt,onClose:t[23]||(t[23]=s=>k.value=!1),onSuccess:ft},null,8,["accounts"])):f("",!0),N.value?(l(),le(Lr,{key:1,accounts:a.value,"api-key":J.value,onClose:t[24]||(t[24]=s=>N.value=!1),onSuccess:wt},null,8,["accounts","api-key"])):f("",!0),P.value?(l(),le(Fr,{key:2,"api-key":ae.value,onClose:t[25]||(t[25]=s=>P.value=!1),onSuccess:ht},null,8,["api-key"])):f("",!0),o.value?(l(),le(ll,{key:3,"api-key":pe.value,onClose:t[26]||(t[26]=s=>o.value=!1)},null,8,["api-key"])):f("",!0),y.value?(l(),le(_l,{key:4,"api-keys":ge.value,onClose:t[27]||(t[27]=s=>y.value=!1)},null,8,["api-keys"])):f("",!0),Z.value?(l(),le(qo,{key:5,accounts:a.value,"selected-keys":R.value,onClose:t[28]||(t[28]=s=>Z.value=!1),onSuccess:kt},null,8,["accounts","selected-keys"])):f("",!0),ne(gn,{ref_key:"expiryEditModalRef",ref:S,"api-key":i.value||{id:null,expiresAt:null,name:""},show:!!i.value,onClose:rt,onSave:It},null,8,["api-key","show"]),ne(si,{"api-key":v.value||{},show:I.value,onClose:t[29]||(t[29]=s=>I.value=!1)},null,8,["api-key","show"])])}}},Pu=be(Du,[["__scopeId","data-v-a7f3261c"]]);export{Pu as default};
