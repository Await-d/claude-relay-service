const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginView-Mn_fPnQo.js","assets/ThemeToggle-BcTA-B5u.js","assets/vue-vendor-CcFZMz-v.js","assets/ThemeToggle-CzQ-uydY.css","assets/SessionManager-CGjojPXB.js","assets/SessionManager-CtfuafU8.css","assets/element-plus-C-1FTG0y.js","assets/vendor-B90ziCBp.js","assets/element-plus-6gb5osKz.css","assets/LoginView-tn0RQdqM.css","assets/MainLayout-D5iMmLCF.js","assets/toast-BvwA7Mwb.js","assets/LogoTitle-DoIrVfjl.js","assets/LogoTitle-DXipqypn.css","assets/MainLayout-xhoe0q5F.css","assets/DashboardView-YcX-MHEO.js","assets/chart-DOIXA9jv.js","assets/DashboardView-CXNlSYti.css","assets/ApiKeysView-CqHjgHc0.js","assets/WindowCountdown-DEPTPq8A.js","assets/CustomDropdown-Z2UFcJyh.js","assets/CustomDropdown-jjrvIxsf.css","assets/ApiKeysView-CHPNUnZN.css","assets/AccountsView-DymrT1eg.js","assets/AccountsView-jzbaieYd.css","assets/GroupList-D4CLExTH.js","assets/GroupList-BoHLLst4.css","assets/UserList-MhpEnWNu.js","assets/UserList-tK2DzrgU.css","assets/UserGroups-k7JZYLLG.js","assets/UserGroups-qMWRCRbH.css","assets/TutorialView-DyZBVsf_.js","assets/TutorialView-Bnd6c_gD.css","assets/SettingsView-fa1P_Jdc.js","assets/requestLogs-DBAWe0S0.js","assets/SettingsView-BY7xk7UM.css","assets/ApiStatsView-C9NIn5YD.js","assets/ApiStatsView-CXCjOsh4.css","assets/RequestLogsView-BYmGwbY7.js","assets/RequestLogsView-CmEg5-Gg.css"])))=>i.map(i=>d[i]);
import{aR as oe,aS as ae,aT as B,r as p,c as P,o as K,q as M,V as H,I as W,z as v,x as b,ac as ne,Q as re,a5 as F,y as I,C as N,L as D,P as x,Y as J,B as ie,R as C,J as ce,T as le,O as ue,ax as de,aO as he,aU as me}from"./vue-vendor-CcFZMz-v.js";import{i as fe,z as pe}from"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();const ge="modulepreload",ve=function(o){return"/admin-next/"+o},z={},w=function(t,e,r){let a=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=Promise.allSettled(e.map(i=>{if(i=ve(i),i in z)return;z[i]=!0;const d=i.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${h}`))return;const s=document.createElement("link");if(s.rel=d?"stylesheet":ge,d||(s.as="script"),s.crossOrigin="",s.href=i,u&&s.setAttribute("nonce",u),document.head.appendChild(s),d)return new Promise((m,f)=>{s.addEventListener("load",m),s.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})}))}function n(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return a.then(c=>{for(const u of c||[])u.status==="rejected"&&n(u.reason);return t().catch(n)})},V={basePath:"/admin-next/",apiPrefix:""};function _e(o=""){return o&&!o.startsWith("/")&&(o="/"+o),V.basePath+(o.startsWith("#")?o:"#"+o)}function ye(){return _e("/login")}const we=()=>w(()=>import("./LoginView-Mn_fPnQo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),A=()=>w(()=>import("./MainLayout-D5iMmLCF.js"),__vite__mapDeps([10,2,11,12,13,1,3,4,5,6,7,8,14])),Te=()=>w(()=>import("./DashboardView-YcX-MHEO.js"),__vite__mapDeps([15,6,2,7,8,11,16,17])),Ae=()=>w(()=>import("./ApiKeysView-CqHjgHc0.js"),__vite__mapDeps([18,6,2,7,8,11,19,20,21,22])),Ie=()=>w(()=>import("./AccountsView-DymrT1eg.js"),__vite__mapDeps([23,6,2,7,8,11,20,21,24])),Ee=()=>w(()=>import("./GroupList-D4CLExTH.js"),__vite__mapDeps([25,2,6,7,8,26])),be=()=>w(()=>import("./UserList-MhpEnWNu.js"),__vite__mapDeps([27,2,11,6,7,8,28])),ke=()=>w(()=>import("./UserGroups-k7JZYLLG.js"),__vite__mapDeps([29,2,11,6,7,8,30])),Se=()=>w(()=>import("./TutorialView-DyZBVsf_.js"),__vite__mapDeps([31,2,6,7,8,32])),Pe=()=>w(()=>import("./SettingsView-fa1P_Jdc.js"),__vite__mapDeps([33,2,11,34,6,7,8,35])),xe=()=>w(()=>import("./ApiStatsView-C9NIn5YD.js"),__vite__mapDeps([36,2,12,13,1,3,7,19,31,6,8,32,37])),Le=()=>w(()=>import("./RequestLogsView-BYmGwbY7.js"),__vite__mapDeps([38,2,34,11,16,7,6,8,39])),Re=[{path:"/",redirect:()=>{const o=window.location.pathname,t=V.basePath.replace(/\/$/,"");return o===t||o===t+"/","/api-stats"}},{path:"/login",name:"Login",component:we,meta:{requiresAuth:!1}},{path:"/api-stats",name:"ApiStats",component:xe,meta:{requiresAuth:!1}},{path:"/dashboard",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:Te}]},{path:"/api-keys",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"ApiKeys",component:Ae}]},{path:"/accounts",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Accounts",component:Ie}]},{path:"/groups",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Groups",component:Ee}]},{path:"/users",component:A,meta:{requiresAuth:!0,requiresRole:"admin"},children:[{path:"",name:"Users",component:be}]},{path:"/user-groups",component:A,meta:{requiresAuth:!0,requiresRole:"admin"},children:[{path:"",name:"UserGroups",component:ke}]},{path:"/tutorial",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Tutorial",component:Se}]},{path:"/settings",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"Settings",component:Pe}]},{path:"/request-logs",component:A,meta:{requiresAuth:!0},children:[{path:"",name:"RequestLogs",component:Le}]},{path:"/:pathMatch(.*)*",redirect:"/api-stats"}],L=oe({history:ae(V.basePath),routes:Re});L.beforeEach((o,t,e)=>{var a,n;const r=X();if(console.log("路由导航:",{to:o.path,from:t.path,fullPath:o.fullPath,requiresAuth:o.meta.requiresAuth,requiresRole:o.meta.requiresRole,isAuthenticated:r.isAuthenticated,userRole:(a=r.user)==null?void 0:a.role}),o.path===t.path&&o.fullPath===t.fullPath)return e();if(o.path==="/api-stats"||o.path.startsWith("/api-stats"))e();else if(o.meta.requiresAuth&&!r.isAuthenticated)e("/login");else if(o.path==="/login"&&r.isAuthenticated)e("/dashboard");else if(o.meta.requiresRole){if((((n=r.user)==null?void 0:n.role)||"user")!==o.meta.requiresRole){e("/dashboard");return}e()}else e()});const Q=V.apiPrefix;function O(o){return o.startsWith("/")||(o="/"+o),Q+o}class Oe{constructor(){this.baseURL=Q}getAuthToken(){return localStorage.getItem("authToken")||null}buildConfig(t={}){const e={headers:{"Content-Type":"application/json",...t.headers},...t},r=this.getAuthToken();return r&&(e.headers.Authorization=`Bearer ${r}`),e}async handleResponse(t,e="json"){if(t.status===401){const a=window.location.pathname+window.location.hash;throw a.includes("/login")||a.endsWith("/")||(localStorage.removeItem("authToken"),window.location.href=ye()),new Error("Unauthorized")}if(!t.ok){const a=t.headers.get("content-type");if(a&&a.includes("application/json"))try{const n=await t.json();throw new Error(n.error||n.message||`HTTP ${t.status}`)}catch{}throw new Error(`HTTP ${t.status}: ${t.statusText}`)}if(e==="blob")return{data:await t.blob(),headers:t.headers,status:t.status,statusText:t.statusText};const r=t.headers.get("content-type");return r&&r.includes("application/json")?await t.json():t}async get(t,e={}){let r=O(t);const{responseType:a,params:n,...c}=e;if(n&&Object.keys(n).length>0){const i=new URLSearchParams;Object.entries(n).forEach(([h,s])=>{s!=null&&s!==""&&i.append(h,s)});const d=i.toString();d&&(r+=(r.includes("?")?"&":"?")+d)}const u=this.buildConfig({...c,method:"GET"});try{console.log("🌐 API GET请求:",{fullUrl:r,params:n,config:u});const i=await fetch(r,u);return await this.handleResponse(i,a)}catch(i){throw console.error("API GET Error:",i),i}}async post(t,e=null,r={}){const a=O(t),{responseType:n,...c}=r;let u,i={};e&&(e instanceof FormData?u=e:(u=JSON.stringify(e),i["Content-Type"]="application/json"));const d=this.buildConfig({...c,method:"POST",body:u,headers:{...i,...c.headers}});try{const h=await fetch(a,d);return await this.handleResponse(h,n)}catch(h){throw console.error("API POST Error:",h),h}}async put(t,e=null,r={}){const a=O(t),{responseType:n,...c}=r,u=this.buildConfig({...c,method:"PUT",body:e?JSON.stringify(e):void 0});try{const i=await fetch(a,u);return await this.handleResponse(i,n)}catch(i){throw console.error("API PUT Error:",i),i}}async delete(t,e={}){const r=O(t),{data:a,responseType:n,...c}=e,u=this.buildConfig({...c,method:"DELETE",body:a?JSON.stringify(a):void 0});try{const i=await fetch(r,u);return await this.handleResponse(i,n)}catch(i){throw console.error("API DELETE Error:",i),i}}}const S=new Oe,X=B("auth",()=>{const o=p(!1),t=p(localStorage.getItem("authToken")||""),e=p(localStorage.getItem("sessionToken")||""),r=p(""),a=p(null),n=p(null),c=p(""),u=p(!1),i=p(!1),d=p({siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",faviconData:""}),h=p(!0),s=P(()=>{var l;return((l=n.value)==null?void 0:l.username)||""}),m=P(()=>!!e.value&&!!n.value),f=P(()=>e.value),T=P(()=>t.value);async function U(l){u.value=!0,c.value="";try{const g=await S.post("/auth/login",l);if(g.success&&g.data){const{sessionToken:_,sessionId:k,expiresAt:R,user:se}=g.data;e.value=_,r.value=k,a.value=R,n.value=se,o.value=!0,localStorage.setItem("sessionToken",_),localStorage.setItem("sessionId",k),R&&localStorage.setItem("expiresAt",R),t.value=_,localStorage.setItem("authToken",_),await L.push("/dashboard")}else c.value=g.message||"登录失败"}catch(g){c.value=g.message||"登录失败，请检查用户名和密码"}finally{u.value=!1}}async function $(){try{e.value&&await S.post("/auth/logout")}catch(l){console.warn("Logout API call failed:",l.message)}E(),L.push("/login")}function E(){o.value=!1,t.value="",e.value="",r.value="",a.value=null,n.value=null,localStorage.removeItem("authToken"),localStorage.removeItem("sessionToken"),localStorage.removeItem("sessionId"),localStorage.removeItem("expiresAt")}function Y(){const l=localStorage.getItem("sessionToken"),g=localStorage.getItem("sessionId"),_=localStorage.getItem("expiresAt");if(l){if(e.value=l,r.value=g||"",a.value=_,t.value=l,_&&new Date(_)<=new Date){E();return}o.value=!0,j()}else t.value&&(e.value=t.value,o.value=!0,j())}async function j(){try{const l=await S.get("/auth/validate");if(l.success&&l.data)n.value=l.data.user,o.value=!0;else throw new Error("Session validation failed")}catch(l){console.warn("Session validation failed:",l.message),E(),L.push("/login")}}async function Z(){if(i.value||!e.value)return!1;i.value=!0;try{const l=await S.post("/auth/refresh");if(l.success&&l.data){const{sessionToken:g,sessionId:_,expiresAt:k,user:R}=l.data;return e.value=g,r.value=_,a.value=k,n.value=R,localStorage.setItem("sessionToken",g),localStorage.setItem("sessionId",_),k&&localStorage.setItem("expiresAt",k),t.value=g,localStorage.setItem("authToken",g),!0}else throw new Error(l.message||"Session refresh failed")}catch(l){return console.error("Session refresh failed:",l.message),E(),L.push("/login"),!1}finally{i.value=!1}}async function ee(l,g){try{const _=await S.post("/auth/change-password",{oldPassword:l,newPassword:g});if(_.success)return{success:!0,message:_.message};throw new Error(_.message||"Password change failed")}catch(_){throw new Error(_.message||"Password change failed")}}async function te(){h.value=!0;try{const l=await S.get("/admin/oem-settings");if(l.success&&l.data){if(d.value={...d.value,...l.data},l.data.siteIconData||l.data.siteIcon){const g=document.querySelector("link[rel*='icon']")||document.createElement("link");g.type="image/x-icon",g.rel="shortcut icon",g.href=l.data.siteIconData||l.data.siteIcon,document.getElementsByTagName("head")[0].appendChild(g)}l.data.siteName&&(document.title=`${l.data.siteName} - 管理后台`)}}catch(l){console.error("加载OEM设置失败:",l)}finally{h.value=!1}}return{isLoggedIn:o,authToken:t,sessionToken:e,sessionId:r,expiresAt:a,user:n,username:s,loginError:c,loginLoading:u,refreshing:i,oemSettings:d,oemLoading:h,isAuthenticated:m,token:f,legacyToken:T,login:U,logout:$,checkAuth:Y,verifySession:j,refreshSession:Z,changePassword:ee,clearAuthState:E,loadOemSettings:te}}),y={LIGHT:"light",DARK:"dark",AUTO:"auto"},Ce=B("theme",()=>{const o=p(y.AUTO),t=p(!1),e=P(()=>o.value===y.DARK?!0:o.value===y.LIGHT?!1:t.value),r=P(()=>e.value?y.DARK:y.LIGHT),a=()=>{const s=window.matchMedia("(prefers-color-scheme: dark)");t.value=s.matches;const m=localStorage.getItem("themeMode");m&&Object.values(y).includes(m)?o.value=m:o.value=y.AUTO,n(),i()},n=()=>{const s=document.documentElement;e.value?s.classList.add("dark"):s.classList.remove("dark")},c=s=>{Object.values(y).includes(s)&&(o.value=s)},u=()=>{const s=[y.LIGHT,y.DARK,y.AUTO],f=(s.indexOf(o.value)+1)%s.length;o.value=s[f]};K(o,s=>{localStorage.setItem("themeMode",s),n()}),K(t,()=>{o.value===y.AUTO&&n()});const i=()=>{const s=window.matchMedia("(prefers-color-scheme: dark)"),m=f=>{t.value=f.matches};return t.value=s.matches,s.addEventListener("change",m),()=>{s.removeEventListener("change",m)}};return{themeMode:o,isDarkMode:e,currentTheme:r,systemPrefersDark:t,ThemeMode:y,initTheme:a,setThemeMode:c,cycleThemeMode:u,watchSystemTheme:i,toggleTheme:()=>{u()},setTheme:s=>{s==="dark"?c(y.DARK):s==="light"&&c(y.LIGHT)}}}),G=(o,t)=>{const e=o.__vccOpts||o;for(const[r,a]of t)e[r]=a;return e},De={class:"toast-container"},Ve=["onClick"],qe={class:"toast-content"},Ue={class:"toast-icon"},$e={class:"toast-body"},je={key:0,class:"toast-title"},Ne={class:"toast-message"},Me=["onClick"],Ge={__name:"ToastNotification",setup(o,{expose:t}){const e=p([]);let r=0;const a=d=>{const h={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return h[d]||h.info},n=(d,h="info",s=null,m=5e3)=>{const f=++r,T={id:f,message:d,type:h,title:s,duration:m,isVisible:!1};return e.value.push(T),setTimeout(()=>{T.isVisible=!0},10),m>0&&setTimeout(()=>{c(f)},m),f},c=d=>{const h=e.value.findIndex(s=>s.id===d);if(h>-1){const s=e.value[h];s.isVisible=!1,setTimeout(()=>{const m=e.value.findIndex(f=>f.id===d);m>-1&&e.value.splice(m,1)},300)}},u=()=>{e.value.forEach(d=>{d.isVisible=!1}),setTimeout(()=>{e.value.length=0},300)},i=(d,h="info",s=null,m=5e3)=>n(d,h,s,m);return M(()=>{window.showToast=i}),H(()=>{window.showToast===i&&delete window.showToast}),t({showToast:i,removeToast:c,clearAllToasts:u}),(d,h)=>(I(),W(F,{to:"body"},[v("div",De,[(I(!0),b(re,null,ne(e.value,s=>(I(),b("div",{key:s.id,class:N(["toast",`toast-${s.type}`,s.isVisible?"toast-show":"toast-hide"]),onClick:m=>c(s.id)},[v("div",qe,[v("div",Ue,[v("i",{class:N(a(s.type))},null,2)]),v("div",$e,[s.title?(I(),b("div",je,x(s.title),1)):D("",!0),v("div",Ne,x(s.message),1)]),v("button",{class:"toast-close",onClick:J(m=>c(s.id),["stop"])},[...h[0]||(h[0]=[v("i",{class:"fas fa-times"},null,-1)])],8,Me)]),s.duration>0?(I(),b("div",{key:0,class:"toast-progress",style:ie({animationDuration:`${s.duration}ms`})},null,4)):D("",!0)],10,Ve))),128))])]))}},Ke=G(Ge,[["__scopeId","data-v-c8b24ff5"]]),ze={class:"modal-content mx-auto w-full max-w-md p-6"},Be={class:"mb-6 flex items-start gap-4"},He={class:"flex-1"},We={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-white"},Fe={class:"whitespace-pre-line leading-relaxed text-gray-700 dark:text-gray-400"},Je={class:"flex items-center justify-end gap-3"},Qe=["disabled"],Xe=["disabled"],Ye={key:0,class:"loading-spinner mr-2"},Ze={__name:"ConfirmDialog",setup(o,{expose:t}){const e=p(!1),r=p(!1),a=p(""),n=p(""),c=p("确认"),u=p("取消");let i=null;const d=(f,T,U="确认",$="取消")=>new Promise(E=>{a.value=f,n.value=T,c.value=U,u.value=$,e.value=!0,r.value=!1,i=E}),h=()=>{r.value||(r.value=!0,setTimeout(()=>{e.value=!1,r.value=!1,i&&(i(!0),i=null)},200))},s=()=>{r.value||(e.value=!1,i&&(i(!1),i=null))},m=f=>{e.value&&(f.key==="Escape"?s():f.key==="Enter"&&!f.shiftKey&&!f.ctrlKey&&!f.altKey&&h())};return M(()=>{window.showConfirm=d,document.addEventListener("keydown",m)}),H(()=>{window.showConfirm===d&&delete window.showConfirm,document.removeEventListener("keydown",m)}),t({showConfirm:d}),(f,T)=>(I(),W(F,{to:"body"},[C(le,{appear:"",name:"modal"},{default:ce(()=>[e.value?(I(),b("div",{key:0,class:"modal fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:J(s,["self"])},[v("div",ze,[v("div",Be,[T[0]||(T[0]=v("div",{class:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-amber-600"},[v("i",{class:"fas fa-exclamation-triangle text-lg text-white"})],-1)),v("div",He,[v("h3",We,x(a.value),1),v("div",Fe,x(n.value),1)])]),v("div",Je,[v("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:r.value,onClick:s},x(u.value),9,Qe),v("button",{class:N(["btn btn-warning px-6 py-3",{"cursor-not-allowed opacity-50":r.value}]),disabled:r.value,onClick:h},[r.value?(I(),b("div",Ye)):D("",!0),ue(" "+x(c.value),1)],10,Xe)])])])):D("",!0)]),_:1})]))}},et=G(Ze,[["__scopeId","data-v-6b3390a6"]]),tt={id:"app"},st={__name:"App",setup(o){const t=X(),e=Ce(),r=p(),a=p();return M(()=>{e.initTheme(),e.watchSystemTheme(),t.checkAuth(),t.loadOemSettings()}),(n,c)=>{const u=de("router-view");return I(),b("div",tt,[C(u),C(Ke,{ref_key:"toastRef",ref:r},null,512),C(et,{ref_key:"confirmRef",ref:a},null,512)])}}},ot=G(st,[["__scopeId","data-v-dab04b7e"]]),q=he(ot),at=me();q.use(at);q.use(L);q.use(fe,{locale:pe});q.mount("#app");export{G as _,Ce as a,S as b,X as u};
