import{r as i,_ as J,c as R,q as X,x as r,z as e,L as k,O as c,K as v,aq as D,aW as I,Q as w,ac as h,P as n,Y as Z,y as o,C as $,al as ee}from"./vue-vendor-CcFZMz-v.js";import{s as d}from"./toast-BvwA7Mwb.js";import{_ as se,b as m}from"./index-DCzasIW1.js";import"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";const te={class:"space-y-6"},ae={class:"flex items-center justify-between"},le={class:"glass-strong rounded-xl p-4"},re={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},oe={class:"flex-1"},ne={class:"relative"},ie={class:"flex items-center gap-2"},de={class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},ue={key:0,class:"col-span-full"},ce={class:"mb-4 flex items-start justify-between"},me={class:"flex items-center gap-3"},ve={class:"font-bold text-gray-900 dark:text-gray-100"},xe={class:"text-sm text-gray-500 dark:text-gray-400"},ge={class:"mb-4 line-clamp-2 text-sm text-gray-600 dark:text-gray-400"},fe={key:0,class:"mb-4"},ye={class:"flex flex-wrap gap-1"},pe={key:0,class:"inline-block rounded bg-gray-100 px-2 py-1 text-xs text-gray-600 dark:bg-gray-700 dark:text-gray-400"},be={class:"mb-4 text-xs text-gray-500 dark:text-gray-400"},ke={class:"flex gap-2"},_e=["onClick"],we=["onClick"],he=["onClick"],Ce={key:2,class:"col-span-full"},Me={class:"glass-strong rounded-xl p-8 text-center"},$e={class:"mb-2 text-lg font-medium text-gray-900 dark:text-gray-100"},Ue={class:"text-gray-500 dark:text-gray-400"},je={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Ge={class:"modal-content w-full max-w-lg"},Ve={class:"mb-6 flex items-center justify-between"},Ee={class:"text-xl font-bold text-gray-900 dark:text-gray-100"},ze={class:"grid grid-cols-2 gap-2"},Le=["value"],qe={class:"text-sm text-gray-700 dark:text-gray-300"},De={class:"flex gap-3 pt-4"},Ie=["disabled"],Ae={key:0,class:"loading-spinner mr-2"},Fe={key:1,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Ne={class:"modal-content w-full max-w-2xl"},Pe={class:"mb-6 flex items-center justify-between"},Be={class:"text-xl font-bold text-gray-900 dark:text-gray-100"},Se={class:"space-y-4"},Te={class:"flex gap-2"},Qe=["value"],Ke=["disabled"],Oe={key:0,class:"loading-spinner mr-2"},We={class:"rounded-lg border border-gray-200 dark:border-gray-700"},Ye={class:"border-b border-gray-200 bg-gray-50 px-4 py-3 dark:border-gray-700 dark:bg-gray-800"},He={class:"font-medium text-gray-900 dark:text-gray-100"},Je={key:0,class:"p-4 text-center"},Re={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},Xe={class:"flex items-center gap-3"},Ze={class:"font-medium text-gray-900 dark:text-gray-100"},es={class:"text-xs text-gray-500 dark:text-gray-400"},ss=["onClick"],ts={key:2,class:"p-4 text-center text-gray-500 dark:text-gray-400"},as={__name:"UserGroups",setup(ls){const U=i(!1),_=i(!1),A=i([]),x=i(""),g=i(""),j=i(!1),f=i(!1),G=i(!1),V=i(null),y=i(null),C=i([]),F=i([]),p=i(""),E=i(!1),M=i(!1),l=J({name:"",description:"",status:"active",permissions:[]}),P=[{value:"read_users",label:"查看用户"},{value:"write_users",label:"管理用户"},{value:"read_groups",label:"查看用户组"},{value:"write_groups",label:"管理用户组"},{value:"read_api_keys",label:"查看API密钥"},{value:"write_api_keys",label:"管理API密钥"},{value:"read_accounts",label:"查看账户"},{value:"write_accounts",label:"管理账户"},{value:"system_admin",label:"系统管理"}],N=R(()=>{let t=A.value;if(x.value){const s=x.value.toLowerCase();t=t.filter(b=>b.name.toLowerCase().includes(s)||b.description&&b.description.toLowerCase().includes(s))}return g.value&&(t=t.filter(s=>s.status===g.value)),t}),B=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知",z=async()=>{U.value=!0;try{const t=await m.get("/admin/groups");t.success?A.value=t.data||[]:d("加载用户组列表失败","error")}catch(t){console.error("Error loading groups:",t),d("加载用户组列表失败","error")}finally{U.value=!1}},S=async()=>{try{const t=await m.get("/admin/users");t.success&&(F.value=t.data||[])}catch(t){console.error("Error loading users:",t)}},T=()=>{l.name="",l.description="",l.status="active",l.permissions=[]},L=()=>{j.value=!1,f.value=!1,V.value=null,T()},Q=t=>{V.value=t,l.name=t.name,l.description=t.description||"",l.status=t.status,l.permissions=t.permissions||[],f.value=!0},K=async()=>{_.value=!0;try{let t;f.value?t=await m.put(`/admin/groups/${V.value.id}`,{name:l.name,description:l.description||null,status:l.status,permissions:l.permissions}):t=await m.post("/admin/groups",{name:l.name,description:l.description||null,status:l.status,permissions:l.permissions}),t.success?(d(f.value?"用户组更新成功":"用户组创建成功","success"),L(),z()):d(t.message||"操作失败","error")}catch(t){console.error("Error saving group:",t),d("操作失败","error")}finally{_.value=!1}},O=async t=>{if(confirm(`确定要删除用户组 "${t.name}" 吗？此操作不可恢复。`))try{const s=await m.delete(`/admin/groups/${t.id}`);s.success?(d("用户组删除成功","success"),z()):d(s.message||"用户组删除失败","error")}catch(s){console.error("Error deleting group:",s),d("用户组删除失败","error")}},W=async t=>{y.value=t,G.value=!0,await q(t.id),await S()},q=async t=>{E.value=!0;try{const s=await m.get(`/admin/groups/${t}/members`);s.success&&(C.value=s.data||[])}catch(s){console.error("Error loading group members:",s),d("加载用户组成员失败","error")}finally{E.value=!1}},Y=async()=>{if(p.value){M.value=!0;try{const t=await m.post(`/admin/groups/${y.value.id}/members`,{userId:p.value});t.success?(d("成员添加成功","success"),p.value="",await q(y.value.id)):d(t.message||"添加成员失败","error")}catch(t){console.error("Error adding member:",t),d("添加成员失败","error")}finally{M.value=!1}}},H=async t=>{if(confirm("确定要移除这个成员吗？"))try{const s=await m.delete(`/admin/groups/${y.value.id}/members/${t}`);s.success?(d("成员移除成功","success"),await q(y.value.id)):d(s.message||"移除成员失败","error")}catch(s){console.error("Error removing member:",s),d("移除成员失败","error")}};return X(()=>{z()}),(t,s)=>{var b;return o(),r("div",te,[e("div",ae,[s[10]||(s[10]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},[e("i",{class:"fas fa-users mr-2 text-purple-500"}),c(" 用户组管理 ")],-1)),e("button",{class:"btn btn-primary flex items-center gap-2",onClick:s[0]||(s[0]=a=>j.value=!0)},[...s[9]||(s[9]=[e("i",{class:"fas fa-plus text-sm"},null,-1),e("span",null,"创建用户组",-1)])])]),e("div",le,[e("div",re,[e("div",oe,[e("div",ne,[s[11]||(s[11]=e("i",{class:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>x.value=a),class:"form-input w-full pl-10",placeholder:"搜索用户组名称或描述...",type:"text"},null,512),[[D,x.value]])])]),e("div",ie,[s[13]||(s[13]=e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"状态:",-1)),v(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>g.value=a),class:"form-select"},[...s[12]||(s[12]=[e("option",{value:""},"全部状态",-1),e("option",{value:"active"},"活跃",-1),e("option",{value:"inactive"},"不活跃",-1)])],512),[[I,g.value]])])])]),e("div",de,[U.value?(o(),r("div",ue,[...s[14]||(s[14]=[e("div",{class:"glass-strong rounded-xl p-8 text-center"},[e("div",{class:"loading-spinner mx-auto mb-4"}),e("p",{class:"text-gray-500 dark:text-gray-400"},"加载用户组数据中...")],-1)])])):N.value.length>0?(o(!0),r(w,{key:1},h(N.value,a=>(o(),r("div",{key:a.id,class:"glass-strong rounded-xl p-6 transition-all duration-300 hover:shadow-xl"},[e("div",ce,[e("div",me,[e("div",{class:$(["flex h-12 w-12 items-center justify-center rounded-xl",a.status==="active"?"bg-gradient-to-br from-purple-500 to-blue-500":"bg-gradient-to-br from-gray-400 to-gray-500"])},[...s[15]||(s[15]=[e("i",{class:"fas fa-users text-white"},null,-1)])],2),e("div",null,[e("h3",ve,n(a.name),1),e("p",xe,n(a.memberCount||0)+" 成员 ",1)])]),e("span",{class:$(["inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",a.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"])},[e("i",{class:$(a.status==="active"?"fas fa-check-circle":"fas fa-pause-circle")},null,2),c(" "+n(a.status==="active"?"活跃":"不活跃"),1)],2)]),e("p",ge,n(a.description||"暂无描述"),1),a.permissions&&a.permissions.length>0?(o(),r("div",fe,[s[16]||(s[16]=e("p",{class:"mb-2 text-xs font-medium text-gray-500 dark:text-gray-400"},"权限:",-1)),e("div",ye,[(o(!0),r(w,null,h(a.permissions.slice(0,3),u=>(o(),r("span",{key:u,class:"inline-block rounded bg-blue-100 px-2 py-1 text-xs text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},n(u),1))),128)),a.permissions.length>3?(o(),r("span",pe," +"+n(a.permissions.length-3),1)):k("",!0)])])):k("",!0),e("p",be," 创建于 "+n(B(a.createdAt)),1),e("div",ke,[e("button",{class:"btn-secondary flex-1 text-xs",onClick:u=>Q(a)},[...s[17]||(s[17]=[e("i",{class:"fas fa-edit mr-1"},null,-1),c(" 编辑 ",-1)])],8,_e),e("button",{class:"btn-secondary text-xs",onClick:u=>W(a)},[...s[18]||(s[18]=[e("i",{class:"fas fa-users-cog mr-1"},null,-1),c(" 成员 ",-1)])],8,we),e("button",{class:"btn-icon text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",title:"删除用户组",onClick:u=>O(a)},[...s[19]||(s[19]=[e("i",{class:"fas fa-trash text-xs"},null,-1)])],8,he)])]))),128)):(o(),r("div",Ce,[e("div",Me,[s[20]||(s[20]=e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700"},[e("i",{class:"fas fa-users text-2xl text-gray-400"})],-1)),e("h3",$e,n(x.value||g.value?"未找到匹配的用户组":"暂无用户组"),1),e("p",Ue,n(x.value||g.value?"请尝试调整搜索条件":"点击右上角按钮创建第一个用户组"),1)])]))]),j.value||f.value?(o(),r("div",je,[e("div",Ge,[e("div",Ve,[e("h3",Ee,[s[21]||(s[21]=e("i",{class:"fas fa-users mr-2 text-purple-500"},null,-1)),c(" "+n(f.value?"编辑用户组":"创建用户组"),1)]),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:L},[...s[22]||(s[22]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("form",{class:"space-y-4",onSubmit:Z(K,["prevent"])},[e("div",null,[s[23]||(s[23]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 用户组名称 * ",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>l.name=a),class:"form-input w-full",placeholder:"请输入用户组名称",required:"",type:"text"},null,512),[[D,l.name]])]),e("div",null,[s[24]||(s[24]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),v(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=a=>l.description=a),class:"form-input w-full resize-none",placeholder:"请输入用户组描述（可选）",rows:"3"},null,512),[[D,l.description]])]),e("div",null,[s[26]||(s[26]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态 * ",-1)),v(e("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>l.status=a),class:"form-select w-full",required:""},[...s[25]||(s[25]=[e("option",{value:""},"选择状态",-1),e("option",{value:"active"},"活跃",-1),e("option",{value:"inactive"},"不活跃",-1)])],512),[[I,l.status]])]),e("div",null,[s[27]||(s[27]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 权限设置 ",-1)),e("div",ze,[(o(),r(w,null,h(P,a=>e("label",{key:a.value,class:"flex cursor-pointer items-center gap-2 rounded border border-gray-200 p-2 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800/50"},[v(e("input",{"onUpdate:modelValue":s[6]||(s[6]=u=>l.permissions=u),class:"rounded border-gray-300 text-blue-600 focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-700",type:"checkbox",value:a.value},null,8,Le),[[ee,l.permissions]]),e("span",qe,n(a.label),1)])),64))])]),e("div",De,[e("button",{class:"btn btn-secondary flex-1",type:"button",onClick:L}," 取消 "),e("button",{class:"btn btn-primary flex-1",disabled:_.value,type:"submit"},[_.value?(o(),r("div",Ae)):k("",!0),c(" "+n(_.value?"保存中...":"保存"),1)],8,Ie)])],32)])])):k("",!0),G.value?(o(),r("div",Fe,[e("div",Ne,[e("div",Pe,[e("h3",Be,[s[28]||(s[28]=e("i",{class:"fas fa-users-cog mr-2 text-purple-500"},null,-1)),c(" 管理成员 - "+n((b=y.value)==null?void 0:b.name),1)]),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:s[7]||(s[7]=a=>G.value=!1)},[...s[29]||(s[29]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",Se,[e("div",null,[s[32]||(s[32]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 添加成员 ",-1)),e("div",Te,[v(e("select",{"onUpdate:modelValue":s[8]||(s[8]=a=>p.value=a),class:"form-select flex-1"},[s[30]||(s[30]=e("option",{value:""},"选择用户",-1)),(o(!0),r(w,null,h(F.value,a=>(o(),r("option",{key:a.id,value:a.id},n(a.username)+" ("+n(a.role==="admin"?"管理员":"普通用户")+") ",9,Qe))),128))],512),[[I,p.value]]),e("button",{class:"btn btn-primary",disabled:!p.value||M.value,onClick:Y},[M.value?(o(),r("div",Oe)):k("",!0),s[31]||(s[31]=c(" 添加 ",-1))],8,Ke)])]),e("div",We,[e("div",Ye,[e("h4",He," 当前成员 ("+n(C.value.length)+") ",1)]),E.value?(o(),r("div",Je,[...s[33]||(s[33]=[e("div",{class:"loading-spinner mx-auto mb-2"},null,-1),e("p",{class:"text-sm text-gray-500"},"加载成员中...",-1)])])):C.value.length>0?(o(),r("div",Re,[(o(!0),r(w,null,h(C.value,a=>(o(),r("div",{key:a.id,class:"flex items-center justify-between p-4"},[e("div",Xe,[e("div",{class:$(["flex h-8 w-8 items-center justify-center rounded-full",a.role==="admin"?"bg-purple-500":"bg-blue-500"])},[...s[34]||(s[34]=[e("i",{class:"fas fa-user text-xs text-white"},null,-1)])],2),e("div",null,[e("p",Ze,n(a.username),1),e("p",es,n(a.role==="admin"?"管理员":"普通用户"),1)])]),e("button",{class:"btn-icon text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",title:"移除成员",onClick:u=>H(a.id)},[...s[35]||(s[35]=[e("i",{class:"fas fa-times"},null,-1)])],8,ss)]))),128))])):(o(),r("div",ts,"暂无成员"))])])])])):k("",!0)])}}},us=se(as,[["__scopeId","data-v-25714d20"]]);export{us as default};
