import{_ as B,u as G,a as H}from"./index-CQzQO6ls.js";import{T as J}from"./ThemeToggle-ttUb9eOE.js";import{r as v,c as b,o as $,q as N,x as i,y as u,z as e,L as k,Q as ee,P as w,K as V,aq as te,O as h,aV as se,C as E,aW as ae,Y as O,V as oe,aX as re,R as D,u as T}from"./vue-vendor-CngTbNDx.js";import"./element-plus-dC9ox4YM.js";import"./vendor-yff5vP9v.js";const le={class:"w-full max-w-md space-y-6"},ne={class:"text-center"},ie={class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-gray-300/30 bg-gradient-to-br from-blue-500/20 to-purple-500/20 backdrop-blur-sm"},ue=["src"],de={key:1,class:"fas fa-cloud text-3xl text-gray-700 dark:text-gray-300"},ce={key:1,class:"h-12 w-12 animate-pulse rounded bg-gray-300/50"},me={class:"header-title mb-2 text-3xl font-bold text-white"},fe=["disabled"],ve={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400"},xe={class:"relative"},ge=["disabled","type"],he=["disabled"],pe={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400"},ye={key:0},be=["disabled"],we=["disabled"],ke={key:0,class:"loading-spinner mr-2"},Se={key:1,class:"fas fa-sign-in-alt mr-2"},Te={key:0,class:"mt-6 rounded-xl border border-red-500/30 bg-red-500/20 p-4 text-center text-sm text-red-800 backdrop-blur-sm dark:text-red-400"},$e={class:"text-center"},Me={__name:"LoginForm",props:{loading:{type:Boolean,default:!1},error:{type:String,default:""},oemSettings:{type:Object,default:()=>({siteName:"Claude Relay Service",siteIcon:"",siteIconData:""})},oemLoading:{type:Boolean,default:!1}},emits:["submit"],setup(n,{expose:c,emit:M}){const a=M,s=v({username:"",password:"",authMethod:"auto"}),p=v(!1),d=v(!1),o=v({username:"",password:""}),S=b(()=>s.value.username.length>=3&&s.value.password.length>=1&&!o.value.username&&!o.value.password),f=()=>(o.value.username="",s.value.username?s.value.username.length<3||s.value.username.length>50?(o.value.username="用户名长度必须在 3-50 个字符之间",!1):/^[a-zA-Z0-9_-]+$/.test(s.value.username)?!0:(o.value.username="用户名只能包含字母、数字、下划线和连字符",!1):(o.value.username="用户名不能为空",!1)),x=()=>(o.value.password="",s.value.password?!0:(o.value.password="密码不能为空",!1)),y=()=>{const g=f(),t=x();g&&t&&a("submit",{username:s.value.username.trim(),password:s.value.password,authMethod:s.value.authMethod})};return $(()=>s.value.username,()=>{o.value.username&&(o.value.username="")}),$(()=>s.value.password,()=>{o.value.password&&(o.value.password="")}),N(()=>{setTimeout(()=>{const g=document.querySelector('input[type="text"]');g&&g.focus()},100)}),c({resetForm:()=>{s.value={username:"",password:"",authMethod:"auto"},o.value={username:"",password:""},p.value=!1},focusUsername:()=>{const g=document.querySelector('input[type="text"]');g&&g.focus()}}),(g,t)=>(u(),i("div",le,[e("div",ne,[e("div",ie,[n.oemLoading?(u(),i("div",ce)):(u(),i(ee,{key:0},[n.oemSettings.siteIconData||n.oemSettings.siteIcon?(u(),i("img",{key:0,alt:"Logo",class:"h-12 w-12 object-contain",src:n.oemSettings.siteIconData||n.oemSettings.siteIcon,onError:t[0]||(t[0]=m=>m.target.style.display="none")},null,40,ue)):(u(),i("i",de))],64))]),e("h1",me,w(n.oemSettings.siteName||"Claude Relay Service"),1),t[6]||(t[6]=e("p",{class:"text-lg text-gray-600 dark:text-gray-400"},"管理后台",-1))]),e("form",{class:"space-y-6",onSubmit:O(y,["prevent"])},[e("div",null,[t[8]||(t[8]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 用户名 ",-1)),V(e("input",{"onUpdate:modelValue":t[1]||(t[1]=m=>s.value.username=m),class:"form-input w-full",disabled:n.loading,placeholder:"请输入用户名",required:"",type:"text",onBlur:f},null,40,fe),[[te,s.value.username]]),o.value.username?(u(),i("div",ve,[t[7]||(t[7]=e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),h(" "+w(o.value.username),1)])):k("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 密码 ",-1)),e("div",xe,[V(e("input",{"onUpdate:modelValue":t[2]||(t[2]=m=>s.value.password=m),class:"form-input w-full pr-12",disabled:n.loading,placeholder:"请输入密码",required:"",type:p.value?"text":"password",onBlur:x},null,40,ge),[[se,s.value.password]]),e("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",disabled:n.loading,type:"button",onClick:t[3]||(t[3]=m=>p.value=!p.value)},[e("i",{class:E(p.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,he)]),o.value.password?(u(),i("div",pe,[t[9]||(t[9]=e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),h(" "+w(o.value.password),1)])):k("",!0)]),d.value?(u(),i("div",ye,[t[12]||(t[12]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-900 dark:text-gray-100"}," 认证方式 ",-1)),V(e("select",{"onUpdate:modelValue":t[4]||(t[4]=m=>s.value.authMethod=m),class:"form-input w-full",disabled:n.loading},[...t[11]||(t[11]=[e("option",{value:"auto"},"自动检测",-1),e("option",{value:"local"},"本地认证",-1),e("option",{value:"ldap"},"LDAP认证",-1)])],8,be),[[ae,s.value.authMethod]])])):k("",!0),e("button",{class:"btn btn-primary w-full px-6 py-4 text-lg font-semibold",disabled:n.loading||!S.value,type:"submit"},[n.loading?(u(),i("div",ke)):(u(),i("i",Se)),h(" "+w(n.loading?"登录中...":"登录"),1)],8,we)],32),n.error?(u(),i("div",Te,[t[13]||(t[13]=e("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),h(" "+w(n.error),1)])):k("",!0),e("div",$e,[e("button",{class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",type:"button",onClick:t[5]||(t[5]=m=>d.value=!d.value)},[t[14]||(t[14]=e("i",{class:"fas fa-cog mr-1"},null,-1)),h(" "+w(d.value?"隐藏高级选项":"显示高级选项"),1)])])]))}},Re=B(Me,[["__scopeId","data-v-0eb3486d"]]),_e={class:"session-manager"},Ie={key:0,class:"ml-2 text-sm"},Ae={class:"glass-strong w-full max-w-md rounded-2xl p-6 shadow-2xl"},Ce={class:"mb-4 text-center"},Le={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Fe={class:"flex space-x-3"},Ve=["disabled"],De=["disabled"],Ee={key:0,class:"loading-spinner mr-2"},Be={key:1,class:"fas fa-refresh mr-2"},Ne={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},Ue={__name:"SessionManager",props:{sessionToken:{type:String,default:""},expiresAt:{type:[String,Number],default:null},autoRefresh:{type:Boolean,default:!0},refreshThreshold:{type:Number,default:5*60*1e3},showIndicator:{type:Boolean,default:!1},showStatusText:{type:Boolean,default:!1}},emits:["sessionRefreshed","sessionExpired","refreshFailed","logout"],setup(n,{expose:c,emit:M}){const a=n,s=M,p=re(),d=v(!1),o=v(!1),S=v(!1),f=v(Date.now()),x=v(null),y=v(null),g=v(0),t=b(()=>a.expiresAt?typeof a.expiresAt=="string"?new Date(a.expiresAt).getTime():a.expiresAt:null),m=b(()=>t.value?Math.max(0,t.value-f.value):0),I=b(()=>m.value<=0),U=b(()=>m.value>0&&m.value<=a.refreshThreshold),R=b(()=>a.sessionToken?I.value?"expired":U.value?"expiring":"active":"none"),K=b(()=>{const r="session-indicator";switch(R.value){case"active":return`${r} text-green-600 dark:text-green-400`;case"expiring":return`${r} text-yellow-600 dark:text-yellow-400`;case"expired":return`${r} text-red-600 dark:text-red-400`;default:return`${r} text-gray-500`}}),Q=b(()=>{switch(R.value){case"active":return"fas fa-check-circle";case"expiring":return"fas fa-clock";case"expired":return"fas fa-times-circle";default:return"fas fa-question-circle"}}),W=b(()=>{switch(R.value){case"active":return"会话正常";case"expiring":return`${A(m.value)}后过期`;case"expired":return"会话已过期";default:return"未登录"}}),A=r=>{const l=Math.floor(r/1e3),_=Math.floor(l/60),P=Math.floor(_/60);return P>0?`${P}小时${_%60}分钟`:_>0?`${_}分钟${l%60}秒`:`${l}秒`},q=()=>{y.value&&clearInterval(y.value),y.value=setInterval(()=>{f.value=Date.now()},1e3)},j=()=>{y.value&&(clearInterval(y.value),y.value=null)},C=()=>{if(x.value&&clearTimeout(x.value),!t.value||!a.autoRefresh)return;const r=Math.max(0,t.value-Date.now()-a.refreshThreshold);r>0&&(x.value=setTimeout(()=>{z()},r))},z=async()=>{if(d.value||I.value)return;const r=Date.now();if(!(r-g.value<3e4)){g.value=r;try{d.value=!0,await L()}catch(l){console.error("Auto refresh failed:",l),o.value=!0}finally{d.value=!1}}},L=async()=>{if(!a.sessionToken)throw new Error("No session token available");s("sessionRefreshed")},X=async()=>{try{d.value=!0,await L(),F()}catch(r){console.error("Manual refresh failed:",r),s("refreshFailed",r)}finally{d.value=!1}},F=()=>{o.value=!1},Y=()=>{F(),s("logout")},Z=()=>{S.value=!1,p.push("/login")};return $(()=>a.sessionToken,(r,l)=>{r!==l&&(r?(C(),y.value||q()):(j(),x.value&&clearTimeout(x.value)))},{immediate:!0}),$(()=>a.expiresAt,()=>{C()}),$(I,r=>{r&&a.sessionToken&&(S.value=!0,s("sessionExpired"))}),$(U,r=>{r&&a.autoRefresh&&!d.value&&z()}),N(()=>{a.sessionToken&&(q(),C())}),oe(()=>{j(),x.value&&clearTimeout(x.value)}),c({refreshSession:L,formatTime:A,timeUntilExpiry:m,sessionStatus:R}),(r,l)=>(u(),i("div",_e,[n.showIndicator?(u(),i("div",{key:0,class:E(["session-indicator",K.value])},[e("i",{class:E(["text-sm",Q.value])},null,2),n.showStatusText?(u(),i("span",Ie,w(W.value),1)):k("",!0)],2)):k("",!0),o.value?(u(),i("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:O(F,["self"])},[e("div",Ae,[e("div",Ce,[l[2]||(l[2]=e("i",{class:"fas fa-clock mb-3 text-3xl text-yellow-500"},null,-1)),l[3]||(l[3]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"会话即将过期",-1)),e("p",Le,[l[0]||(l[0]=h(" 您的会话将在 ",-1)),e("strong",null,w(A(m.value)),1),l[1]||(l[1]=h(" 后过期。 是否要刷新会话？ ",-1))])]),e("div",Fe,[e("button",{class:"btn btn-outline flex-1",disabled:d.value,onClick:Y},[...l[4]||(l[4]=[e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1),h(" 登出 ",-1)])],8,Ve),e("button",{class:"btn btn-primary flex-1",disabled:d.value,onClick:X},[d.value?(u(),i("div",Ee)):(u(),i("i",Be)),h(" "+w(d.value?"刷新中...":"刷新会话"),1)],8,De)])])])):k("",!0),S.value?(u(),i("div",Ne,[e("div",{class:"glass-strong w-full max-w-md rounded-2xl p-6 shadow-2xl"},[l[6]||(l[6]=e("div",{class:"mb-6 text-center"},[e("i",{class:"fas fa-exclamation-triangle mb-3 text-3xl text-red-500"}),e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"会话已过期"),e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},"您的会话已过期，请重新登录。")],-1)),e("button",{class:"btn btn-primary w-full",onClick:Z},[...l[5]||(l[5]=[e("i",{class:"fas fa-sign-in-alt mr-2"},null,-1),h(" 重新登录 ",-1)])])])])):k("",!0)]))}},qe=B(Ue,[["__scopeId","data-v-d50be828"]]),je={class:"flex min-h-screen items-center justify-center p-4 sm:p-6"},ze={class:"fixed right-4 top-4 z-50"},Pe={class:"glass-strong w-full max-w-md rounded-xl p-6 shadow-2xl sm:rounded-2xl sm:p-8 md:rounded-3xl md:p-10"},Oe={__name:"LoginView",setup(n){const c=G(),M=H(),a=v(null);N(()=>{M.initTheme(),c.loadOemSettings()});const s=async f=>{await c.login(f)},p=async()=>{try{await c.refreshSession()||console.warn("Session refresh failed")}catch(f){console.error("Session refresh error:",f)}},d=()=>{console.warn("Session expired"),c.clearAuthState(),a.value&&a.value.resetForm()},o=f=>{console.error("Session refresh failed:",f),c.clearAuthState(),a.value&&a.value.resetForm()},S=()=>{c.logout(),a.value&&a.value.resetForm()};return(f,x)=>(u(),i("div",je,[e("div",ze,[D(J,{mode:"dropdown"})]),D(qe,{"auto-refresh":!0,"expires-at":T(c).expiresAt,"session-token":T(c).sessionToken,"show-indicator":!1,onLogout:S,onRefreshFailed:o,onSessionExpired:d,onSessionRefreshed:p},null,8,["expires-at","session-token"]),e("div",Pe,[D(Re,{ref_key:"loginFormRef",ref:a,error:T(c).loginError,loading:T(c).loginLoading,"oem-loading":T(c).oemLoading,"oem-settings":T(c).oemSettings,onSubmit:s},null,8,["error","loading","oem-loading","oem-settings"])])]))}},Ze=B(Oe,[["__scopeId","data-v-2082a71c"]]);export{Ze as default};
