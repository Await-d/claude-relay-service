import{E as Mt}from"./element-plus-5SvmA99H.js";import{aT as gt,r as K,c as F,q as Ve,V as St,o as he,x as o,y as l,z as e,I as oe,C as q,P as g,R as ie,J as jt,L as v,B as Se,K as T,aq as ee,Q as N,ac as Y,T as Vt,a5 as ke,D as Rt,_ as De,Y as ce,an as ae,O as L,aa as je,aY as ye,al as ve}from"./vue-vendor-C9wZz30M.js";import{s as G}from"./toast-BvwA7Mwb.js";import{b as z,_ as fe}from"./index-DRCG_WRJ.js";import{_ as Ge}from"./WindowCountdown-Dvs-5H5J.js";import{C as ct}from"./CustomDropdown-oQzkw8Ea.js";import"./vendor-DeB155zE.js";const qe=gt("clients",{state:()=>({supportedClients:[],loading:!1,error:null}),actions:{async loadSupportedClients(){if(this.supportedClients.length>0)return this.supportedClients;this.loading=!0,this.error=null;try{const C=await z.get("/admin/supported-clients");return C.success?this.supportedClients=C.data||[]:(this.error=C.message||"加载支持的客户端失败",console.error("Failed to load supported clients:",this.error)),this.supportedClients}catch(C){return this.error=C.message||"加载支持的客户端失败",console.error("Error loading supported clients:",C),[]}finally{this.loading=!1}}}}),Be=gt("apiKeys",()=>{const C=K([]),Q=K(!1),m=K(null),S=K("all"),R=K(""),$=K("asc"),D=async()=>{Q.value=!0,m.value=null;try{const M=await z.get("/admin/api-keys");if(M.success)C.value=M.data||[];else throw new Error(M.message||"获取API Keys失败")}catch(M){throw m.value=M.message,M}finally{Q.value=!1}};return{apiKeys:C,loading:Q,error:m,statsTimeRange:S,sortBy:R,sortOrder:$,fetchApiKeys:D,createApiKey:async M=>{Q.value=!0,m.value=null;try{const I=await z.post("/admin/api-keys",M);if(I.success)return await D(),I.data;throw new Error(I.message||"创建API Key失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},updateApiKey:async(M,I)=>{Q.value=!0,m.value=null;try{const y=await z.put(`/admin/api-keys/${M}`,I);if(y.success)return await D(),y;throw new Error(y.message||"更新API Key失败")}catch(y){throw m.value=y.message,y}finally{Q.value=!1}},toggleApiKey:async M=>{Q.value=!0,m.value=null;try{const I=await z.put(`/admin/api-keys/${M}/toggle`);if(I.success)return await D(),I;throw new Error(I.message||"切换状态失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},renewApiKey:async(M,I)=>{Q.value=!0,m.value=null;try{const y=await z.put(`/admin/api-keys/${M}`,I);if(y.success)return await D(),y;throw new Error(y.message||"续期失败")}catch(y){throw m.value=y.message,y}finally{Q.value=!1}},deleteApiKey:async M=>{Q.value=!0,m.value=null;try{const I=await z.delete(`/admin/api-keys/${M}`);if(I.success)return await D(),I;throw new Error(I.message||"删除失败")}catch(I){throw m.value=I.message,I}finally{Q.value=!1}},fetchApiKeyStats:async(M,I="all")=>{try{const y=await z.get(`/admin/api-keys/${M}/stats`,{params:{timeRange:I}});if(y.success)return y.stats;throw new Error(y.message||"获取统计失败")}catch(y){return console.error("获取API Key统计失败:",y),null}},fetchTags:async()=>{try{const M=await z.get("/admin/api-keys/tags");if(M.success)return M.data||[];throw new Error(M.message||"获取标签失败")}catch(M){return console.error("获取标签失败:",M),[]}},sortApiKeys:M=>{R.value===M?$.value=$.value==="asc"?"desc":"asc":(R.value=M,$.value="asc")},reset:()=>{C.value=[],Q.value=!1,m.value=null,S.value="all",R.value="",$.value="asc"}}}),Pt={class:"flex-shrink-0 border-b border-gray-200 p-3 dark:border-gray-600"},Et={class:"relative"},Ut={class:"custom-scrollbar flex-1 overflow-y-auto"},Ot={class:"text-gray-700 dark:text-gray-300"},Gt={key:0},qt=["onClick"],Bt={class:"flex items-center justify-between"},Wt={class:"text-gray-700 dark:text-gray-300"},Ft={class:"text-xs text-gray-500 dark:text-gray-400"},zt={key:1},Ht={class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"},Nt=["onClick"],Yt={class:"flex items-center justify-between"},Qt={class:"text-gray-700 dark:text-gray-300"},Jt={class:"text-xs text-gray-400 dark:text-gray-500"},Xt={key:2},Zt=["onClick"],es={class:"flex items-center justify-between"},ts={class:"text-gray-700 dark:text-gray-300"},ss={class:"text-xs text-gray-400 dark:text-gray-500"},as={key:3,class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},ls={__name:"AccountSelector",props:{modelValue:{type:String,default:""},platform:{type:String,required:!0,validator:C=>["claude","gemini"].includes(C)},accounts:{type:Array,default:()=>[]},groups:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择账号"},defaultOptionText:{type:String,default:"使用共享账号池"}},emits:["update:modelValue"],setup(C,{emit:Q}){const m=C,S=Q,R=K(!1),$=K(""),D=K(null),U=K(null),_=K({}),W=K(null),j=K(""),A=F(()=>{if(!m.modelValue)return m.defaultOptionText;if(m.modelValue.startsWith("group:")){const x=m.modelValue.substring(6),w=m.groups.find(X=>X.id===x);return w?`${w.name} (${w.memberCount||0} 个成员)`:""}if(m.modelValue.startsWith("console:")){const x=m.modelValue.substring(8),w=m.accounts.find(X=>X.id===x&&X.platform==="claude-console");return w?`${w.name} (${P(w)})`:""}const r=m.accounts.find(x=>x.id===m.modelValue);return r?`${r.name} (${P(r)})`:""}),P=r=>{if(!r)return"未知";if(r.isActive===!1)switch(r.status){case"unauthorized":return"未授权";case"error":return"Token错误";case"created":return"待验证";case"rate_limited":return"限流中";default:return"异常"}return"正常"},p=F(()=>[...m.accounts].sort((r,x)=>{const w=new Date(r.createdAt||0);return new Date(x.createdAt||0)-w})),a=F(()=>{if(!$.value)return m.groups;const r=$.value.toLowerCase();return m.groups.filter(x=>x.name.toLowerCase().includes(r))}),d=F(()=>{let r=p.value.filter(x=>x.accountType==="dedicated"&&(m.platform==="claude"?x.platform==="claude-oauth":x.platform!=="claude-console"));if($.value){const x=$.value.toLowerCase();r=r.filter(w=>w.name.toLowerCase().includes(x))}return r}),M=F(()=>{if(m.platform!=="claude")return[];let r=p.value.filter(x=>x.accountType==="dedicated"&&x.platform==="claude-console");if($.value){const x=$.value.toLowerCase();r=r.filter(w=>w.name.toLowerCase().includes(x))}return r}),I=F(()=>a.value.length>0||d.value.length>0||M.value.length>0),y=r=>{if(!r)return"";const x=new Date(r),X=(new Date-x)/(1e3*60*60);return X<24?"今天创建":X<48?"昨天创建":X<168?`${Math.floor(X/24)} 天前`:x.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},f=()=>{if(!R.value||!U.value||!W.value)return;const r=W.value;if(!r)return;const x=r.getBoundingClientRect(),w=window.innerHeight,X=window.innerWidth,E=w-x.bottom,i=x.top,b=8,Z=E-b,J=i-b;let se=!1,be=Z;j.value==="above"&&J>=150?(se=!0,be=J):j.value==="below"&&Z>=150?(se=!1,be=Z):J>Z&&Z<200&&(se=!0,be=J),j.value=se?"above":"below";let ge=x.left;const we=x.width;ge+we>X-b&&(ge=X-we-b),ge<b&&(ge=b),_.value={position:"fixed",left:`${ge}px`,width:`${x.width}px`,maxHeight:`${Math.min(be,400)}px`,...se?{bottom:`${w-x.top}px`}:{top:`${x.bottom}px`}}},c=()=>{if(!R.value&&W.value){const r=W.value.getBoundingClientRect(),w=window.innerHeight-r.bottom,X=8;_.value={position:"fixed",left:`${r.left}px`,width:`${r.width}px`,maxHeight:`${Math.min(w-X,400)}px`,top:`${r.bottom}px`}}R.value=!R.value,R.value&&Rt(()=>{var r;f(),(r=D.value)==null||r.focus()})},n=r=>{S("update:modelValue",r||""),R.value=!1,$.value=""},h=()=>{},re=()=>{var r;$.value="",(r=D.value)==null||r.focus()},de=r=>{var x,w;!((x=W.value)!=null&&x.contains(r.target))&&!((w=U.value)!=null&&w.contains(r.target))&&(R.value=!1)},O=()=>{R.value&&f()};return Ve(()=>{document.addEventListener("click",de),window.addEventListener("scroll",O,!0),window.addEventListener("resize",f)}),St(()=>{document.removeEventListener("click",de),window.removeEventListener("scroll",O,!0),window.removeEventListener("resize",f)}),he(R,r=>{r||($.value="",j.value="")}),(r,x)=>(l(),o("div",{ref_key:"triggerRef",ref:W,class:"relative"},[e("div",{class:q(["form-input flex w-full cursor-pointer items-center justify-between dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",{"opacity-50":C.disabled}]),onClick:x[0]||(x[0]=w=>!C.disabled&&c())},[e("span",{class:q(C.modelValue?"text-gray-900 dark:text-gray-200":"text-gray-500 dark:text-gray-400")},g(A.value),3),e("i",{class:q(["fas fa-chevron-down text-gray-400 transition-transform duration-200 dark:text-gray-500",{"rotate-180":R.value}])},null,2)],2),(l(),oe(ke,{to:"body"},[ie(Vt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:jt(()=>[R.value?(l(),o("div",{key:0,ref_key:"dropdownRef",ref:U,class:"absolute z-50 flex flex-col rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-600 dark:bg-gray-800",style:Se(_.value)},[e("div",Pt,[e("div",Et,[T(e("input",{ref_key:"searchInput",ref:D,"onUpdate:modelValue":x[1]||(x[1]=w=>$.value=w),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"搜索账号名称...",style:{"padding-left":"40px","padding-right":"36px"},type:"text",onInput:h},null,544),[[ee,$.value]]),x[4]||(x[4]=e("i",{class:"fas fa-search pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-gray-400 dark:text-gray-500"},null,-1)),$.value?(l(),o("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400",type:"button",onClick:re},[...x[3]||(x[3]=[e("i",{class:"fas fa-times text-sm"},null,-1)])])):v("",!0)])]),e("div",Ut,[e("div",{class:q(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":!C.modelValue}]),onClick:x[2]||(x[2]=w=>n(null))},[e("span",Ot,g(C.defaultOptionText),1)],2),a.value.length>0?(l(),o("div",Gt,[x[5]||(x[5]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," 调度分组 ",-1)),(l(!0),o(N,null,Y(a.value,w=>(l(),o("div",{key:`group:${w.id}`,class:q(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===`group:${w.id}`}]),onClick:X=>n(`group:${w.id}`)},[e("div",Bt,[e("span",Wt,g(w.name),1),e("span",Ft,g(w.memberCount||0)+" 个成员",1)])],10,qt))),128))])):v("",!0),d.value.length>0?(l(),o("div",zt,[e("div",Ht,g(C.platform==="claude"?"Claude OAuth 专属账号":"OAuth 专属账号"),1),(l(!0),o(N,null,Y(d.value,w=>(l(),o("div",{key:w.id,class:q(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===w.id}]),onClick:X=>n(w.id)},[e("div",Yt,[e("div",null,[e("span",Qt,g(w.name),1),e("span",{class:q(["ml-2 rounded-full px-2 py-0.5 text-xs",w.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":w.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},g(P(w)),3)]),e("span",Jt,g(y(w.createdAt)),1)])],10,Nt))),128))])):v("",!0),C.platform==="claude"&&M.value.length>0?(l(),o("div",Xt,[x[6]||(x[6]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," Claude Console 专属账号 ",-1)),(l(!0),o(N,null,Y(M.value,w=>(l(),o("div",{key:w.id,class:q(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":C.modelValue===`console:${w.id}`}]),onClick:X=>n(`console:${w.id}`)},[e("div",es,[e("div",null,[e("span",ts,g(w.name),1),e("span",{class:q(["ml-2 rounded-full px-2 py-0.5 text-xs",w.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":w.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},g(P(w)),3)]),e("span",ss,g(y(w.createdAt)),1)])],10,Zt))),128))])):v("",!0),$.value&&!I.value?(l(),o("div",as,[...x[7]||(x[7]=[e("i",{class:"fas fa-search mb-2 text-2xl"},null,-1),e("p",{class:"text-sm"},"没有找到匹配的账号",-1)])])):v("",!0)])],4)):v("",!0)]),_:1})]))],512))}},Ie=fe(ls,[["__scopeId","data-v-7e9dcf0d"]]),rs={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},os={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6"},ns={class:"mb-4 flex items-center justify-between"},is={class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-3 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20 sm:p-4"},ds={class:"flex items-center gap-3 sm:gap-4"},us={class:"flex cursor-pointer items-center"},cs={class:"flex cursor-pointer items-center"},gs={key:0,class:"mt-3"},ms={class:"flex items-center gap-4"},xs={class:"flex-1"},ps={class:"flex items-center gap-2"},ys={class:"mt-2 flex items-start text-xs text-amber-600 dark:text-amber-400"},fs=["placeholder"],bs={key:0,class:"mt-1 text-xs text-red-500 dark:text-red-400"},vs={class:"space-y-4"},ks={key:0},ws={class:"flex flex-wrap gap-2"},hs=["onClick"],$s={key:1},As={class:"flex flex-wrap gap-2"},Cs=["onClick"],Is={class:"flex gap-2"},Ks=["onKeypress"],Ls={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},Ds={class:"space-y-2"},_s={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Ts={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-3 dark:border-green-700 dark:from-green-900/20 dark:to-emerald-900/20 sm:p-4"},Ms={class:"space-y-3"},Ss={class:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-6"},js=["onClick"],Vs={class:"flex items-center gap-1"},Rs={class:"text-xs font-bold sm:text-sm"},Ps={key:0,class:"fas fa-check text-xs text-green-600 dark:text-green-400"},Es={class:"text-xs text-gray-500 dark:text-gray-400"},Us={class:"flex items-center gap-1"},Os={key:0,class:"fas fa-check text-xs text-blue-600 dark:text-blue-400"},Gs={class:"flex items-center gap-1"},qs={key:0,class:"fas fa-check text-xs text-gray-600 dark:text-gray-400"},Bs={class:"relative"},Ws={key:0,class:"mt-3"},Fs=["min"],zs={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Hs={class:"flex gap-4"},Ns={class:"flex cursor-pointer items-center"},Ys={class:"flex cursor-pointer items-center"},Qs={class:"flex cursor-pointer items-center"},Js={class:"flex cursor-pointer items-center"},Xs={class:"mb-2 flex items-center justify-between"},Zs=["disabled"],ea={class:"grid grid-cols-1 gap-3"},ta={class:"mb-2 flex items-center"},sa={key:0,class:"space-y-3"},aa={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2"},la=["onClick"],ra={key:0,class:"text-sm text-gray-400"},oa={class:"space-y-3"},na={class:"flex flex-wrap gap-2"},ia=["onClick"],da={key:0,class:"text-sm italic text-gray-400"},ua={class:"flex gap-2"},ca=["onKeydown"],ga={class:"mb-2 flex items-center"},ma={key:0,class:"rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-700 dark:bg-green-900/20"},xa={class:"space-y-1"},pa=["id","value"],ya=["for"],fa={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ba={class:"block text-xs text-gray-500 dark:text-gray-400"},va={class:"flex gap-3 pt-2"},ka=["disabled"],wa={key:0,class:"loading-spinner mr-2"},ha={key:1,class:"fas fa-plus mr-2"},$a={__name:"CreateApiKeyModal",props:{accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success","batch-success"],setup(C,{emit:Q}){const m=C,S=Q,R=qe(),$=Be(),D=K(!1),U=K(!1),_=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),W=K({name:""}),j=K(""),A=K([]),P=F(()=>A.value.filter(E=>!d.tags.includes(E))),p=K([]),a=K([{value:"10",label:"轻度使用"},{value:"50",label:"中度使用"},{value:"100",label:"重度使用"},{value:"200",label:"企业级"}]),d=De({createType:"single",batchCount:10,name:"",description:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",expireDuration:"",customExpireDate:"",expiresAt:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[]});Ve(async()=>{p.value=await R.loadSupportedClients(),A.value=await $.fetchTags(),m.accounts&&(_.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]})});const M=async()=>{var E,i;U.value=!0;try{const[b,Z,J,se,be,ge]=await Promise.all([z.get("/admin/claude-accounts"),z.get("/admin/claude-console-accounts"),z.get("/admin/gemini-accounts"),z.get("/admin/openai-accounts"),z.get("/admin/bedrock-accounts"),z.get("/admin/account-groups")]),we=[];if(b.success&&((E=b.data)==null||E.forEach(le=>{we.push({...le,platform:"claude-oauth",isDedicated:le.accountType==="dedicated"})})),Z.success&&((i=Z.data)==null||i.forEach(le=>{we.push({...le,platform:"claude-console",isDedicated:le.accountType==="dedicated"})})),_.value.claude=we,J.success&&(_.value.gemini=(J.data||[]).map(le=>({...le,isDedicated:le.accountType==="dedicated"}))),se.success&&(_.value.openai=(se.data||[]).map(le=>({...le,isDedicated:le.accountType==="dedicated"}))),be.success&&(_.value.bedrock=(be.data||[]).map(le=>({...le,isDedicated:le.accountType==="dedicated"}))),ge.success){const le=ge.data||[];_.value.claudeGroups=le.filter(me=>me.platform==="claude"),_.value.geminiGroups=le.filter(me=>me.platform==="gemini"),_.value.openaiGroups=le.filter(me=>me.platform==="openai")}G("账号列表已刷新","success")}catch{G("刷新账号列表失败","error")}finally{U.value=!1}},I=F(()=>{const E=new Date;return E.setMinutes(E.getMinutes()+1),E.toISOString().slice(0,16)}),y=()=>{if(!d.expireDuration){d.expiresAt=null;return}if(d.expireDuration==="custom")return;const E=new Date,b=d.expireDuration.match(/(\d+)([dhmy])/);if(b){const[,Z,J]=b,se=parseInt(Z);switch(J){case"d":E.setDate(E.getDate()+se);break;case"h":E.setHours(E.getHours()+se);break;case"m":E.setMonth(E.getMonth()+se);break;case"y":E.setFullYear(E.getFullYear()+se);break}d.expiresAt=E.toISOString()}},f=()=>{d.customExpireDate&&(d.expiresAt=new Date(d.customExpireDate).toISOString())},c=E=>new Date(E).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),n=()=>{d.modelInput&&!d.restrictedModels.includes(d.modelInput)&&(d.restrictedModels.push(d.modelInput),d.modelInput="")},h=E=>{d.restrictedModels.splice(E,1)},re=K(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),de=F(()=>re.value.filter(E=>!d.restrictedModels.includes(E))),O=E=>{d.restrictedModels.includes(E)||d.restrictedModels.push(E)},r=()=>{if(j.value&&j.value.trim()){const E=j.value.trim();d.tags.includes(E)||d.tags.push(E),j.value=""}},x=E=>{d.tags.includes(E)||d.tags.push(E)},w=E=>{d.tags.splice(E,1)},X=async()=>{if(W.value.name="",!d.name||!d.name.trim()){W.value.name="请输入API Key名称";return}if(d.createType==="batch"&&(!d.batchCount||d.batchCount<2||d.batchCount>500)){G("批量创建数量必须在 2-500 之间","error");return}D.value=!0;try{const E={description:d.description||void 0,tokenLimit:d.tokenLimit!==""&&d.tokenLimit!==null?parseInt(d.tokenLimit):null,rateLimitWindow:d.rateLimitWindow!==""&&d.rateLimitWindow!==null?parseInt(d.rateLimitWindow):null,rateLimitRequests:d.rateLimitRequests!==""&&d.rateLimitRequests!==null?parseInt(d.rateLimitRequests):null,concurrencyLimit:d.concurrencyLimit!==""&&d.concurrencyLimit!==null?parseInt(d.concurrencyLimit):0,dailyCostLimit:d.dailyCostLimit!==""&&d.dailyCostLimit!==null?parseFloat(d.dailyCostLimit):0,expiresAt:d.expiresAt||void 0,permissions:d.permissions,tags:d.tags.length>0?d.tags:void 0,enableModelRestriction:d.enableModelRestriction,restrictedModels:d.restrictedModels,enableClientRestriction:d.enableClientRestriction,allowedClients:d.allowedClients};if(d.claudeAccountId&&(d.claudeAccountId.startsWith("console:")?(E.claudeConsoleAccountId=d.claudeAccountId.substring(8),delete E.claudeAccountId):(E.claudeAccountId=d.claudeAccountId,delete E.claudeConsoleAccountId)),d.geminiAccountId&&(E.geminiAccountId=d.geminiAccountId),d.openaiAccountId&&(E.openaiAccountId=d.openaiAccountId),d.bedrockAccountId&&(E.bedrockAccountId=d.bedrockAccountId),d.createType==="single"){const i={...E,name:d.name},b=await z.post("/admin/api-keys",i);b.success?(G("API Key 创建成功","success"),S("success",b.data),S("close")):G(b.message||"创建失败","error")}else{const i={...E,createType:"batch",baseName:d.name,count:d.batchCount},b=await z.post("/admin/api-keys/batch",i);b.success?(G(`成功创建 ${b.data.length} 个 API Key`,"success"),S("batch-success",b.data),S("close")):G(b.message||"批量创建失败","error")}}catch{G("创建失败","error")}finally{D.value=!1}};return(E,i)=>(l(),oe(ke,{to:"body"},[e("div",rs,[e("div",os,[e("div",ns,[i[31]||(i[31]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-key text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 创建新的 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:i[0]||(i[0]=b=>E.$emit("close"))},[...i[30]||(i[30]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4",onSubmit:ce(X,["prevent"])},[e("div",is,[e("div",{class:q(["flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",d.createType==="batch"?"mb-3":""])},[i[34]||(i[34]=e("label",{class:"flex h-full items-center text-xs font-semibold text-gray-700 dark:text-gray-300 sm:text-sm"},"创建类型",-1)),e("div",ds,[e("label",us,[T(e("input",{"onUpdate:modelValue":i[1]||(i[1]=b=>d.createType=b),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"single"},null,512),[[ae,d.createType]]),i[32]||(i[32]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-key mr-1 text-xs"}),L(" 单个创建 ")],-1))]),e("label",cs,[T(e("input",{"onUpdate:modelValue":i[2]||(i[2]=b=>d.createType=b),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"batch"},null,512),[[ae,d.createType]]),i[33]||(i[33]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-layer-group mr-1 text-xs"}),L(" 批量创建 ")],-1))])])],2),d.createType==="batch"?(l(),o("div",gs,[e("div",ms,[e("div",xs,[i[36]||(i[36]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"创建数量",-1)),e("div",ps,[T(e("input",{"onUpdate:modelValue":i[3]||(i[3]=b=>d.batchCount=b),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",max:"500",min:"2",placeholder:"输入数量 (2-500)",required:"",type:"number"},null,512),[[ee,d.batchCount,void 0,{number:!0}]]),i[35]||(i[35]=e("div",{class:"whitespace-nowrap text-xs text-gray-500 dark:text-gray-400"}," 最大支持 500 个 ",-1))])])]),e("p",ys,[i[37]||(i[37]=e("i",{class:"fas fa-info-circle mr-1 mt-0.5 flex-shrink-0"},null,-1)),e("span",null,"批量创建时，每个 Key 的名称会自动添加序号后缀，例如："+g(d.name||"MyKey")+"_1, "+g(d.name||"MyKey")+"_2 ...",1)])])):v("",!0)]),e("div",null,[i[38]||(i[38]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-2 sm:text-sm"},[L("名称 "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{"onUpdate:modelValue":i[4]||(i[4]=b=>d.name=b),class:q(["form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",{"border-red-500":W.value.name}]),placeholder:d.createType==="batch"?"输入基础名称（将自动添加序号）":"为您的 API Key 取一个名称",required:"",type:"text",onInput:i[5]||(i[5]=b=>W.value.name="")},null,42,fs),[[ee,d.name]]),W.value.name?(l(),o("p",bs,g(W.value.name),1)):v("",!0)]),e("div",null,[i[46]||(i[46]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"标签",-1)),e("div",vs,[d.tags.length>0?(l(),o("div",ks,[i[40]||(i[40]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",ws,[(l(!0),o(N,null,Y(d.tags,(b,Z)=>(l(),o("span",{key:"selected-"+Z,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[L(g(b)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:J=>w(Z)},[...i[39]||(i[39]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,hs)]))),128))])])):v("",!0),P.value.length>0?(l(),o("div",$s,[i[42]||(i[42]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",As,[(l(!0),o(N,null,Y(P.value,b=>(l(),o("button",{key:"available-"+b,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:Z=>x(b)},[i[41]||(i[41]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(b),1)],8,Cs))),128))])])):v("",!0),e("div",null,[i[44]||(i[44]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Is,[T(e("input",{"onUpdate:modelValue":i[6]||(i[6]=b=>j.value=b),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:je(ce(r,["prevent"]),["enter"])},null,40,Ks),[[ee,j.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:r},[...i[43]||(i[43]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),i[45]||(i[45]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",Ls,[i[54]||(i[54]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",Ds,[e("div",_s,[e("div",null,[i[47]||(i[47]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),T(e("input",{"onUpdate:modelValue":i[7]||(i[7]=b=>d.rateLimitWindow=b),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,d.rateLimitWindow]]),i[48]||(i[48]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[i[49]||(i[49]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":i[8]||(i[8]=b=>d.rateLimitRequests=b),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,d.rateLimitRequests]]),i[50]||(i[50]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[i[51]||(i[51]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":i[9]||(i[9]=b=>d.tokenLimit=b),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"无限制",type:"number"},null,512),[[ee,d.tokenLimit]]),i[52]||(i[52]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"}," 窗口内最大Token ",-1))])]),i[53]||(i[53]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),L(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),L(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),L(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",Ts,[i[63]||(i[63]=e("div",{class:"mb-3 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-green-500"},[e("i",{class:"fas fa-dollar-sign text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 每日费用限制 (可选) ")],-1)),e("div",Ms,[e("div",null,[i[59]||(i[59]=e("label",{class:"mb-2 block text-xs font-medium text-gray-600 dark:text-gray-400"},"选择预设限额",-1)),e("div",Ss,[(l(!0),o(N,null,Y(a.value,b=>(l(),o("button",{key:b.value,class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",d.dailyCostLimit==b.value?"border-green-500 bg-green-100 text-green-800 dark:border-green-400 dark:bg-green-900/30 dark:text-green-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:Z=>d.dailyCostLimit=b.value},[e("div",Vs,[e("span",Rs,"$"+g(b.value),1),d.dailyCostLimit==b.value?(l(),o("i",Ps)):v("",!0)]),e("span",Es,g(b.label),1)],10,js))),128)),e("button",{class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",!a.value.find(b=>b.value==d.dailyCostLimit)&&d.dailyCostLimit&&d.dailyCostLimit!="0"?"border-blue-500 bg-blue-100 text-blue-800 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:i[10]||(i[10]=b=>d.dailyCostLimit="")},[e("div",Us,[i[55]||(i[55]=e("i",{class:"fas fa-edit text-xs sm:text-sm"},null,-1)),!a.value.find(b=>b.value==d.dailyCostLimit)&&d.dailyCostLimit&&d.dailyCostLimit!="0"?(l(),o("i",Os)):v("",!0)]),i[56]||(i[56]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"自定义",-1))],2),e("button",{class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-2 text-center transition-all duration-200 hover:shadow-md sm:p-3",!d.dailyCostLimit||d.dailyCostLimit=="0"?"border-gray-500 bg-gray-100 text-gray-800 dark:border-gray-400 dark:bg-gray-700 dark:text-gray-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:i[11]||(i[11]=b=>d.dailyCostLimit="0")},[e("div",Gs,[i[57]||(i[57]=e("i",{class:"fas fa-infinity text-xs sm:text-sm"},null,-1)),!d.dailyCostLimit||d.dailyCostLimit=="0"?(l(),o("i",qs)):v("",!0)]),i[58]||(i[58]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"无限制",-1))],2)])]),e("div",null,[i[61]||(i[61]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"自定义金额 (美元)",-1)),e("div",Bs,[i[60]||(i[60]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 dark:text-gray-400"},"$")],-1)),T(e("input",{"onUpdate:modelValue":i[12]||(i[12]=b=>d.dailyCostLimit=b),class:"form-input w-full pl-8 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"输入自定义金额或0表示无限制",step:"0.01",type:"number"},null,512),[[ee,d.dailyCostLimit]])])]),i[62]||(i[62]=e("div",{class:"rounded-lg bg-green-100 p-3 dark:bg-green-900/30"},[e("div",{class:"mb-2 flex items-start gap-2"},[e("i",{class:"fas fa-lightbulb mt-0.5 text-xs text-green-600 dark:text-green-400"}),e("div",{class:"flex-1"},[e("h5",{class:"text-xs font-semibold text-green-800 dark:text-green-300"}," 费用控制说明 "),e("div",{class:"mt-1 space-y-1 text-xs text-green-700 dark:text-green-300"},[e("p",null,"• 达到限制后，新请求将被拒绝并返回 402 错误"),e("p",null,"• 费用统计每分钟更新一次，可能存在轻微延迟"),e("p",null,"• 建议根据使用场景设置合理的限制金额")])])]),e("div",{class:"mt-2 border-t border-green-200 pt-2 dark:border-green-800"},[e("div",{class:"text-xs font-medium text-green-800 dark:text-green-300"}," 参考费用 (Claude)： "),e("div",{class:"mt-1 grid grid-cols-1 gap-x-4 text-xs text-green-700 dark:text-green-300 sm:grid-cols-2"},[e("div",null,"• Haiku: ~$0.25/1M tokens"),e("div",null,"• Sonnet: ~$3/1M tokens"),e("div",null,"• Opus: ~$15/1M tokens"),e("div",null,"• 1万字约1.5K tokens")])])],-1))])]),e("div",null,[i[64]||(i[64]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制 (可选)",-1)),T(e("input",{"onUpdate:modelValue":i[13]||(i[13]=b=>d.concurrencyLimit=b),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[ee,d.concurrencyLimit]]),i[65]||(i[65]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数，0 或留空表示无限制 ",-1))]),e("div",null,[i[66]||(i[66]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注 (可选)",-1)),T(e("textarea",{"onUpdate:modelValue":i[14]||(i[14]=b=>d.description=b),class:"form-input w-full resize-none text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"描述此 API Key 的用途...",rows:"2"},null,512),[[ee,d.description]])]),e("div",null,[i[68]||(i[68]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"有效期限",-1)),T(e("select",{"onUpdate:modelValue":i[15]||(i[15]=b=>d.expireDuration=b),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",onChange:y},[...i[67]||(i[67]=[e("option",{value:""},"永不过期",-1),e("option",{value:"1d"},"1 天",-1),e("option",{value:"7d"},"7 天",-1),e("option",{value:"30d"},"30 天",-1),e("option",{value:"90d"},"90 天",-1),e("option",{value:"180d"},"180 天",-1),e("option",{value:"365d"},"365 天",-1),e("option",{value:"custom"},"自定义日期",-1)])],544),[[ye,d.expireDuration]]),d.expireDuration==="custom"?(l(),o("div",Ws,[T(e("input",{"onUpdate:modelValue":i[16]||(i[16]=b=>d.customExpireDate=b),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:I.value,type:"datetime-local",onChange:f},null,40,Fs),[[ee,d.customExpireDate]])])):v("",!0),d.expiresAt?(l(),o("p",zs," 将于 "+g(c(d.expiresAt))+" 过期 ",1)):v("",!0)]),e("div",null,[i[73]||(i[73]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",Hs,[e("label",Ns,[T(e("input",{"onUpdate:modelValue":i[17]||(i[17]=b=>d.permissions=b),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[ae,d.permissions]]),i[69]||(i[69]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",Ys,[T(e("input",{"onUpdate:modelValue":i[18]||(i[18]=b=>d.permissions=b),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[ae,d.permissions]]),i[70]||(i[70]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",Qs,[T(e("input",{"onUpdate:modelValue":i[19]||(i[19]=b=>d.permissions=b),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[ae,d.permissions]]),i[71]||(i[71]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",Js,[T(e("input",{"onUpdate:modelValue":i[20]||(i[20]=b=>d.permissions=b),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[ae,d.permissions]]),i[72]||(i[72]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))])]),i[74]||(i[74]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",Xs,[i[75]||(i[75]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定 (可选)",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:U.value,title:"刷新账号列表",type:"button",onClick:M},[e("i",{class:q(["fas",U.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(U.value?"刷新中...":"刷新账号"),1)],8,Zs)]),e("div",ea,[e("div",null,[i[76]||(i[76]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),ie(Ie,{modelValue:d.claudeAccountId,"onUpdate:modelValue":i[21]||(i[21]=b=>d.claudeAccountId=b),accounts:_.value.claude,"default-option-text":"使用共享账号池",disabled:d.permissions==="gemini"||d.permissions==="openai",groups:_.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[i[77]||(i[77]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),ie(Ie,{modelValue:d.geminiAccountId,"onUpdate:modelValue":i[22]||(i[22]=b=>d.geminiAccountId=b),accounts:_.value.gemini,"default-option-text":"使用共享账号池",disabled:d.permissions==="claude"||d.permissions==="openai",groups:_.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[i[78]||(i[78]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),ie(Ie,{modelValue:d.openaiAccountId,"onUpdate:modelValue":i[23]||(i[23]=b=>d.openaiAccountId=b),accounts:_.value.openai,"default-option-text":"使用共享账号池",disabled:d.permissions==="claude"||d.permissions==="gemini",groups:_.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[i[79]||(i[79]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),ie(Ie,{modelValue:d.bedrockAccountId,"onUpdate:modelValue":i[24]||(i[24]=b=>d.bedrockAccountId=b),accounts:_.value.bedrock,"default-option-text":"使用共享账号池",disabled:d.permissions==="gemini"||d.permissions==="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])])]),i[80]||(i[80]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择专属账号后，此API Key将只使用该账号，不选择则使用共享账号池 ",-1))]),e("div",null,[e("div",ta,[T(e("input",{id:"enableModelRestriction","onUpdate:modelValue":i[25]||(i[25]=b=>d.enableModelRestriction=b),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ve,d.enableModelRestriction]]),i[81]||(i[81]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableModelRestriction"}," 启用模型限制 ",-1))]),d.enableModelRestriction?(l(),o("div",sa,[e("div",null,[i[84]||(i[84]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600"},"限制的模型列表",-1)),e("div",aa,[(l(!0),o(N,null,Y(d.restrictedModels,(b,Z)=>(l(),o("span",{key:Z,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800"},[L(g(b)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800",type:"button",onClick:J=>h(Z)},[...i[82]||(i[82]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,la)]))),128)),d.restrictedModels.length===0?(l(),o("span",ra," 暂无限制的模型 ")):v("",!0)]),e("div",oa,[e("div",na,[(l(!0),o(N,null,Y(de.value,b=>(l(),o("button",{key:b,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 sm:text-sm",type:"button",onClick:Z=>O(b)},g(b),9,ia))),128)),de.value.length===0?(l(),o("span",da," 所有常用模型已在限制列表中 ")):v("",!0)]),e("div",ua,[T(e("input",{"onUpdate:modelValue":i[26]||(i[26]=b=>d.modelInput=b),class:"form-input flex-1",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:je(ce(n,["prevent"]),["enter"])},null,40,ca),[[ee,d.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:n},[...i[83]||(i[83]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),i[85]||(i[85]=e("p",{class:"mt-2 text-xs text-gray-500"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):v("",!0)]),e("div",null,[e("div",ga,[T(e("input",{id:"enableClientRestriction","onUpdate:modelValue":i[27]||(i[27]=b=>d.enableClientRestriction=b),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ve,d.enableClientRestriction]]),i[86]||(i[86]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableClientRestriction"}," 启用客户端限制 ",-1))]),d.enableClientRestriction?(l(),o("div",ma,[e("div",null,[i[87]||(i[87]=e("label",{class:"mb-2 block text-xs font-medium text-gray-700 dark:text-gray-300"},"允许的客户端",-1)),e("div",xa,[(l(!0),o(N,null,Y(p.value,b=>(l(),o("div",{key:b.id,class:"flex items-start"},[T(e("input",{id:`client_${b.id}`,"onUpdate:modelValue":i[28]||(i[28]=Z=>d.allowedClients=Z),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:b.id},null,8,pa),[[ve,d.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`client_${b.id}`},[e("span",fa,g(b.name),1),e("span",ba,g(b.description),1)],8,ya)]))),128))])])])):v("",!0)]),e("div",va,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:i[29]||(i[29]=b=>E.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 text-sm font-semibold",disabled:D.value,type:"submit"},[D.value?(l(),o("div",wa)):(l(),o("i",ha)),L(" "+g(D.value?"创建中...":"创建"),1)],8,ka)])],32)])])]))}},Aa=fe($a,[["__scopeId","data-v-46e27c90"]]),Ca={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Ia={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},Ka={class:"mb-4 flex items-center justify-between sm:mb-6"},La=["value"],Da={class:"space-y-4"},_a={key:0},Ta={class:"flex flex-wrap gap-2"},Ma=["onClick"],Sa={key:1},ja={class:"flex flex-wrap gap-2"},Va=["onClick"],Ra={class:"flex gap-2"},Pa=["onKeypress"],Ea={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},Ua={class:"space-y-2"},Oa={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Ga={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:border-green-700 dark:from-green-900/20 dark:to-emerald-900/20"},qa={class:"space-y-3"},Ba={class:"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:flex lg:gap-2"},Wa=["onClick"],Fa={class:"flex items-center gap-1"},za={class:"text-sm font-bold"},Ha={key:0,class:"fas fa-check text-xs text-green-600 dark:text-green-400"},Na={class:"text-xs text-gray-500 dark:text-gray-400"},Ya={class:"flex items-center gap-1"},Qa={key:0,class:"fas fa-check text-xs text-blue-600 dark:text-blue-400"},Ja={class:"flex items-center gap-1"},Xa={key:0,class:"fas fa-check text-xs text-gray-600 dark:text-gray-400"},Za={class:"relative"},el={class:"mb-3 flex items-center"},tl={class:"flex gap-4"},sl={class:"flex cursor-pointer items-center"},al={class:"flex cursor-pointer items-center"},ll={class:"flex cursor-pointer items-center"},rl={class:"flex cursor-pointer items-center"},ol={class:"mb-3 flex items-center justify-between"},nl=["disabled"],il={class:"grid grid-cols-1 gap-3"},dl={class:"mb-3 flex items-center"},ul={key:0,class:"space-y-3"},cl={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2 dark:border-gray-600 dark:bg-gray-700"},gl=["onClick"],ml={key:0,class:"text-sm text-gray-400 dark:text-gray-500"},xl={class:"space-y-3"},pl={class:"flex flex-wrap gap-2"},yl=["onClick"],fl={key:0,class:"text-sm italic text-gray-400 dark:text-gray-500"},bl={class:"flex gap-2"},vl=["onKeydown"],kl={class:"mb-3 flex items-center"},wl={key:0,class:"space-y-3"},hl={class:"space-y-2"},$l=["id","value"],Al=["for"],Cl={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Il={class:"block text-xs text-gray-500 dark:text-gray-400"},Kl={class:"flex gap-3 pt-4"},Ll=["disabled"],Dl={key:0,class:"loading-spinner mr-2"},_l={key:1,class:"fas fa-save mr-2"},Tl={__name:"EditApiKeyModal",props:{apiKey:{type:Object,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success"],setup(C,{emit:Q}){const m=C,S=Q,R=qe(),$=Be(),D=K(!1),U=K(!1),_=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),W=K([]),j=K([{value:"10",label:"轻度使用"},{value:"50",label:"中度使用"},{value:"100",label:"重度使用"},{value:"200",label:"企业级"}]),A=K(""),P=K([]),p=F(()=>P.value.filter(O=>!a.tags.includes(O))),a=De({name:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[],isActive:!0}),d=()=>{a.modelInput&&!a.restrictedModels.includes(a.modelInput)&&(a.restrictedModels.push(a.modelInput),a.modelInput="")},M=O=>{a.restrictedModels.splice(O,1)},I=K(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),y=F(()=>I.value.filter(O=>!a.restrictedModels.includes(O))),f=O=>{a.restrictedModels.includes(O)||a.restrictedModels.push(O)},c=()=>{if(A.value&&A.value.trim()){const O=A.value.trim();a.tags.includes(O)||a.tags.push(O),A.value=""}},n=O=>{a.tags.includes(O)||a.tags.push(O)},h=O=>{a.tags.splice(O,1)},re=async()=>{D.value=!0;try{const O={tokenLimit:a.tokenLimit!==""&&a.tokenLimit!==null?parseInt(a.tokenLimit):0,rateLimitWindow:a.rateLimitWindow!==""&&a.rateLimitWindow!==null?parseInt(a.rateLimitWindow):0,rateLimitRequests:a.rateLimitRequests!==""&&a.rateLimitRequests!==null?parseInt(a.rateLimitRequests):0,concurrencyLimit:a.concurrencyLimit!==""&&a.concurrencyLimit!==null?parseInt(a.concurrencyLimit):0,dailyCostLimit:a.dailyCostLimit!==""&&a.dailyCostLimit!==null?parseFloat(a.dailyCostLimit):0,permissions:a.permissions,tags:a.tags};a.claudeAccountId?a.claudeAccountId.startsWith("console:")?(O.claudeConsoleAccountId=a.claudeAccountId.substring(8),O.claudeAccountId=null):(a.claudeAccountId.startsWith("group:"),O.claudeAccountId=a.claudeAccountId,O.claudeConsoleAccountId=null):(O.claudeAccountId=null,O.claudeConsoleAccountId=null),a.geminiAccountId?O.geminiAccountId=a.geminiAccountId:O.geminiAccountId=null,a.openaiAccountId?O.openaiAccountId=a.openaiAccountId:O.openaiAccountId=null,a.bedrockAccountId?O.bedrockAccountId=a.bedrockAccountId:O.bedrockAccountId=null,O.enableModelRestriction=a.enableModelRestriction,O.restrictedModels=a.restrictedModels,O.enableClientRestriction=a.enableClientRestriction,O.allowedClients=a.allowedClients,O.isActive=a.isActive;const r=await z.put(`/admin/api-keys/${m.apiKey.id}`,O);r.success?(S("success"),S("close")):G(r.message||"更新失败","error")}catch{G("更新失败","error")}finally{D.value=!1}},de=async()=>{var O,r;U.value=!0;try{const[x,w,X,E,i,b]=await Promise.all([z.get("/admin/claude-accounts"),z.get("/admin/claude-console-accounts"),z.get("/admin/gemini-accounts"),z.get("/admin/openai-accounts"),z.get("/admin/bedrock-accounts"),z.get("/admin/account-groups")]),Z=[];if(x.success&&((O=x.data)==null||O.forEach(J=>{Z.push({...J,platform:"claude-oauth",isDedicated:J.accountType==="dedicated"})})),w.success&&((r=w.data)==null||r.forEach(J=>{Z.push({...J,platform:"claude-console",isDedicated:J.accountType==="dedicated"})})),_.value.claude=Z,X.success&&(_.value.gemini=(X.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),E.success&&(_.value.openai=(E.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),i.success&&(_.value.bedrock=(i.data||[]).map(J=>({...J,isDedicated:J.accountType==="dedicated"}))),b.success){const J=b.data||[];_.value.claudeGroups=J.filter(se=>se.platform==="claude"),_.value.geminiGroups=J.filter(se=>se.platform==="gemini"),_.value.openaiGroups=J.filter(se=>se.platform==="openai")}G("账号列表已刷新","success")}catch{G("刷新账号列表失败","error")}finally{U.value=!1}};return Ve(async()=>{W.value=await R.loadSupportedClients(),P.value=await $.fetchTags(),m.accounts&&(_.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]}),a.name=m.apiKey.name,a.tokenLimit=m.apiKey.tokenLimit||"",a.rateLimitWindow=m.apiKey.rateLimitWindow||"",a.rateLimitRequests=m.apiKey.rateLimitRequests||"",a.concurrencyLimit=m.apiKey.concurrencyLimit||"",a.dailyCostLimit=m.apiKey.dailyCostLimit||"",a.permissions=m.apiKey.permissions||"all",m.apiKey.claudeConsoleAccountId?a.claudeAccountId=`console:${m.apiKey.claudeConsoleAccountId}`:a.claudeAccountId=m.apiKey.claudeAccountId||"",a.geminiAccountId=m.apiKey.geminiAccountId||"",a.openaiAccountId=m.apiKey.openaiAccountId||"",a.bedrockAccountId=m.apiKey.bedrockAccountId||"",a.restrictedModels=m.apiKey.restrictedModels||[],a.allowedClients=m.apiKey.allowedClients||[],a.tags=m.apiKey.tags||[],a.enableModelRestriction=m.apiKey.enableModelRestriction||!1,a.enableClientRestriction=m.apiKey.enableClientRestriction||!1,a.isActive=m.apiKey.isActive!==void 0?m.apiKey.isActive:!0}),(O,r)=>(l(),oe(ke,{to:"body"},[e("div",Ca,[e("div",Ia,[e("div",Ka,[r[24]||(r[24]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 编辑 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:r[0]||(r[0]=x=>O.$emit("close"))},[...r[23]||(r[23]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:ce(re,["prevent"])},[e("div",null,[r[25]||(r[25]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"名称",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400",disabled:"",type:"text",value:a.name},null,8,La),r[26]||(r[26]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400 sm:mt-2"},"名称不可修改",-1))]),e("div",null,[r[34]||(r[34]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"标签",-1)),e("div",Da,[a.tags.length>0?(l(),o("div",_a,[r[28]||(r[28]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",Ta,[(l(!0),o(N,null,Y(a.tags,(x,w)=>(l(),o("span",{key:"selected-"+w,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[L(g(x)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:X=>h(w)},[...r[27]||(r[27]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,Ma)]))),128))])])):v("",!0),p.value.length>0?(l(),o("div",Sa,[r[30]||(r[30]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",ja,[(l(!0),o(N,null,Y(p.value,x=>(l(),o("button",{key:"available-"+x,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:w=>n(x)},[r[29]||(r[29]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(x),1)],8,Va))),128))])])):v("",!0),e("div",null,[r[32]||(r[32]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Ra,[T(e("input",{"onUpdate:modelValue":r[1]||(r[1]=x=>A.value=x),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:je(ce(c,["prevent"]),["enter"])},null,40,Pa),[[ee,A.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:c},[...r[31]||(r[31]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),r[33]||(r[33]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",Ea,[r[42]||(r[42]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",Ua,[e("div",Oa,[e("div",null,[r[35]||(r[35]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),T(e("input",{"onUpdate:modelValue":r[2]||(r[2]=x=>a.rateLimitWindow=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,a.rateLimitWindow]]),r[36]||(r[36]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[r[37]||(r[37]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":r[3]||(r[3]=x=>a.rateLimitRequests=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[ee,a.rateLimitRequests]]),r[38]||(r[38]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[r[39]||(r[39]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":r[4]||(r[4]=x=>a.tokenLimit=x),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"无限制",type:"number"},null,512),[[ee,a.tokenLimit]]),r[40]||(r[40]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"}," 窗口内最大Token ",-1))])]),r[41]||(r[41]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),L(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),L(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),L(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",Ga,[r[51]||(r[51]=e("div",{class:"mb-3 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-green-500"},[e("i",{class:"fas fa-dollar-sign text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 每日费用限制 (可选) ")],-1)),e("div",qa,[e("div",null,[r[47]||(r[47]=e("label",{class:"mb-2 block text-xs font-medium text-gray-600 dark:text-gray-400"},"选择预设限额",-1)),e("div",Ba,[(l(!0),o(N,null,Y(j.value,x=>(l(),o("button",{key:x.value,class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",a.dailyCostLimit==x.value?"border-green-500 bg-green-100 text-green-800 dark:border-green-400 dark:bg-green-900/30 dark:text-green-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:w=>a.dailyCostLimit=x.value},[e("div",Fa,[e("span",za,"$"+g(x.value),1),a.dailyCostLimit==x.value?(l(),o("i",Ha)):v("",!0)]),e("span",Na,g(x.label),1)],10,Wa))),128)),e("button",{class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",!j.value.find(x=>x.value==a.dailyCostLimit)&&a.dailyCostLimit?"border-blue-500 bg-blue-100 text-blue-800 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:r[5]||(r[5]=x=>a.dailyCostLimit="")},[e("div",Ya,[r[43]||(r[43]=e("i",{class:"fas fa-edit text-sm"},null,-1)),!j.value.find(x=>x.value==a.dailyCostLimit)&&a.dailyCostLimit?(l(),o("i",Qa)):v("",!0)]),r[44]||(r[44]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"自定义",-1))],2),e("button",{class:q(["group relative flex flex-col items-center justify-center rounded-lg border-2 p-3 text-center transition-all duration-200 hover:shadow-md",!a.dailyCostLimit||a.dailyCostLimit=="0"?"border-gray-500 bg-gray-100 text-gray-800 dark:border-gray-400 dark:bg-gray-700 dark:text-gray-300":"border-gray-200 bg-white hover:border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]),type:"button",onClick:r[6]||(r[6]=x=>a.dailyCostLimit="0")},[e("div",Ja,[r[45]||(r[45]=e("i",{class:"fas fa-infinity text-sm"},null,-1)),!a.dailyCostLimit||a.dailyCostLimit=="0"?(l(),o("i",Xa)):v("",!0)]),r[46]||(r[46]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"无限制",-1))],2)])]),e("div",null,[r[49]||(r[49]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"自定义金额 (美元)",-1)),e("div",Za,[r[48]||(r[48]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 dark:text-gray-400"},"$")],-1)),T(e("input",{"onUpdate:modelValue":r[7]||(r[7]=x=>a.dailyCostLimit=x),class:"form-input w-full pl-8 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"输入自定义金额或0表示无限制",step:"0.01",type:"number"},null,512),[[ee,a.dailyCostLimit]])])]),r[50]||(r[50]=e("div",{class:"rounded-lg bg-green-100 p-3 dark:bg-green-900/30"},[e("div",{class:"mb-2 flex items-start gap-2"},[e("i",{class:"fas fa-lightbulb mt-0.5 text-xs text-green-600 dark:text-green-400"}),e("div",{class:"flex-1"},[e("h5",{class:"text-xs font-semibold text-green-800 dark:text-green-300"}," 费用控制说明 "),e("div",{class:"mt-1 space-y-1 text-xs text-green-700 dark:text-green-300"},[e("p",null,"• 达到限制后，新请求将被拒绝并返回 402 错误"),e("p",null,"• 费用统计每分钟更新一次，可能存在轻微延迟"),e("p",null,"• 建议根据使用场景设置合理的限制金额")])])]),e("div",{class:"mt-2 border-t border-green-200 pt-2 dark:border-green-800"},[e("div",{class:"text-xs font-medium text-green-800 dark:text-green-300"}," 参考费用 (Claude)： "),e("div",{class:"mt-1 grid grid-cols-2 gap-x-4 text-xs text-green-700 dark:text-green-300"},[e("div",null,"• Haiku: ~$0.25/1M tokens"),e("div",null,"• Sonnet: ~$3/1M tokens"),e("div",null,"• Opus: ~$15/1M tokens"),e("div",null,"• 1万字约1.5K tokens")])])],-1))])]),e("div",null,[r[52]||(r[52]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),T(e("input",{"onUpdate:modelValue":r[8]||(r[8]=x=>a.concurrencyLimit=x),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[ee,a.concurrencyLimit]]),r[53]||(r[53]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数 ",-1))]),e("div",null,[e("div",el,[T(e("input",{id:"editIsActive","onUpdate:modelValue":r[9]||(r[9]=x=>a.isActive=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[ve,a.isActive]]),r[54]||(r[54]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editIsActive"}," 激活账号 ",-1))]),r[55]||(r[55]=e("p",{class:"mb-4 text-xs text-gray-500 dark:text-gray-400"}," 取消勾选将禁用此 API Key，暂停所有请求，客户端返回 401 错误 ",-1))]),e("div",null,[r[60]||(r[60]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",tl,[e("label",sl,[T(e("input",{"onUpdate:modelValue":r[10]||(r[10]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[ae,a.permissions]]),r[56]||(r[56]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",al,[T(e("input",{"onUpdate:modelValue":r[11]||(r[11]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[ae,a.permissions]]),r[57]||(r[57]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",ll,[T(e("input",{"onUpdate:modelValue":r[12]||(r[12]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[ae,a.permissions]]),r[58]||(r[58]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",rl,[T(e("input",{"onUpdate:modelValue":r[13]||(r[13]=x=>a.permissions=x),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[ae,a.permissions]]),r[59]||(r[59]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))])]),r[61]||(r[61]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",ol,[r[62]||(r[62]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:U.value,title:"刷新账号列表",type:"button",onClick:de},[e("i",{class:q(["fas",U.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(U.value?"刷新中...":"刷新账号"),1)],8,nl)]),e("div",il,[e("div",null,[r[63]||(r[63]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),ie(Ie,{modelValue:a.claudeAccountId,"onUpdate:modelValue":r[14]||(r[14]=x=>a.claudeAccountId=x),accounts:_.value.claude,"default-option-text":"使用共享账号池",disabled:a.permissions==="gemini"||a.permissions==="openai",groups:_.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[64]||(r[64]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),ie(Ie,{modelValue:a.geminiAccountId,"onUpdate:modelValue":r[15]||(r[15]=x=>a.geminiAccountId=x),accounts:_.value.gemini,"default-option-text":"使用共享账号池",disabled:a.permissions==="claude"||a.permissions==="openai",groups:_.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[65]||(r[65]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),ie(Ie,{modelValue:a.openaiAccountId,"onUpdate:modelValue":r[16]||(r[16]=x=>a.openaiAccountId=x),accounts:_.value.openai,"default-option-text":"使用共享账号池",disabled:a.permissions==="claude"||a.permissions==="gemini",groups:_.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[r[66]||(r[66]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),ie(Ie,{modelValue:a.bedrockAccountId,"onUpdate:modelValue":r[17]||(r[17]=x=>a.bedrockAccountId=x),accounts:_.value.bedrock,"default-option-text":"使用共享账号池",disabled:a.permissions==="gemini"||a.permissions==="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])])]),r[67]||(r[67]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 修改绑定账号将影响此API Key的请求路由 ",-1))]),e("div",null,[e("div",dl,[T(e("input",{id:"editEnableModelRestriction","onUpdate:modelValue":r[18]||(r[18]=x=>a.enableModelRestriction=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[ve,a.enableModelRestriction]]),r[68]||(r[68]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableModelRestriction"}," 启用模型限制 ",-1))]),a.enableModelRestriction?(l(),o("div",ul,[e("div",null,[r[71]||(r[71]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"限制的模型列表",-1)),e("div",cl,[(l(!0),o(N,null,Y(a.restrictedModels,(x,w)=>(l(),o("span",{key:w,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800 dark:bg-red-900/30 dark:text-red-400"},[L(g(x)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",type:"button",onClick:X=>M(w)},[...r[69]||(r[69]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,gl)]))),128)),a.restrictedModels.length===0?(l(),o("span",ml," 暂无限制的模型 ")):v("",!0)]),e("div",xl,[e("div",pl,[(l(!0),o(N,null,Y(y.value,x=>(l(),o("button",{key:x,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 sm:text-sm",type:"button",onClick:w=>f(x)},g(x),9,yl))),128)),y.value.length===0?(l(),o("span",fl," 所有常用模型已在限制列表中 ")):v("",!0)]),e("div",bl,[T(e("input",{"onUpdate:modelValue":r[19]||(r[19]=x=>a.modelInput=x),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:je(ce(d,["prevent"]),["enter"])},null,40,vl),[[ee,a.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:d},[...r[70]||(r[70]=[e("i",{class:"fas fa-plus"},null,-1)])])])]),r[72]||(r[72]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):v("",!0)]),e("div",null,[e("div",kl,[T(e("input",{id:"editEnableClientRestriction","onUpdate:modelValue":r[20]||(r[20]=x=>a.enableClientRestriction=x),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[ve,a.enableClientRestriction]]),r[73]||(r[73]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableClientRestriction"}," 启用客户端限制 ",-1))]),a.enableClientRestriction?(l(),o("div",wl,[e("div",null,[r[74]||(r[74]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"允许的客户端",-1)),r[75]||(r[75]=e("p",{class:"mb-3 text-xs text-gray-500 dark:text-gray-400"}," 勾选允许使用此API Key的客户端 ",-1)),e("div",hl,[(l(!0),o(N,null,Y(W.value,x=>(l(),o("div",{key:x.id,class:"flex items-start"},[T(e("input",{id:`edit_client_${x.id}`,"onUpdate:modelValue":r[21]||(r[21]=w=>a.allowedClients=w),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:x.id},null,8,$l),[[ve,a.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`edit_client_${x.id}`},[e("span",Cl,g(x.name),1),e("span",Il,g(x.description),1)],8,Al)]))),128))])])])):v("",!0)]),e("div",Kl,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:r[22]||(r[22]=x=>O.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:D.value,type:"submit"},[D.value?(l(),o("div",Dl)):(l(),o("i",_l)),L(" "+g(D.value?"保存中...":"保存修改"),1)],8,Ll)])],32)])])]))}},Ml=fe(Tl,[["__scopeId","data-v-0c07e640"]]),Sl={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},jl={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-8"},Vl={class:"mb-6 flex items-center justify-between"},Rl={class:"modal-scroll-content custom-scrollbar flex-1 space-y-6"},Pl={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},El={class:"flex items-start gap-3"},Ul={class:"text-sm text-gray-700"},Ol={class:"mt-1 text-xs text-gray-600"},Gl={key:0,class:"mt-3"},ql=["min"],Bl={key:1,class:"mt-2 text-xs text-gray-500"},Wl={class:"flex gap-3 pt-4"},Fl=["disabled"],zl={key:0,class:"loading-spinner mr-2"},Hl={key:1,class:"fas fa-clock mr-2"},Nl={__name:"RenewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close","success"],setup(C,{emit:Q}){const m=C,S=Q,R=K(!1),$=De({renewDuration:"30d",customExpireDate:"",newExpiresAt:null}),D=F(()=>{const A=new Date;return m.apiKey.expiresAt&&new Date(m.apiKey.expiresAt)>A?new Date(m.apiKey.expiresAt).toISOString().slice(0,16):(A.setMinutes(A.getMinutes()+1),A.toISOString().slice(0,16))}),U=A=>new Date(A).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),_=()=>{if(!$.renewDuration){$.newExpiresAt=null;return}if($.renewDuration==="permanent"){$.newExpiresAt=null;return}if($.renewDuration==="custom")return;const A=m.apiKey.expiresAt&&new Date(m.apiKey.expiresAt)>new Date?new Date(m.apiKey.expiresAt):new Date,p=$.renewDuration.match(/(\d+)([dhmy])/);if(p){const[,a,d]=p,M=parseInt(a);switch(d){case"d":A.setDate(A.getDate()+M);break;case"h":A.setHours(A.getHours()+M);break;case"m":A.setMonth(A.getMonth()+M);break;case"y":A.setFullYear(A.getFullYear()+M);break}$.newExpiresAt=A.toISOString()}},W=()=>{$.customExpireDate&&($.newExpiresAt=new Date($.customExpireDate).toISOString())},j=async()=>{R.value=!0;try{const A={expiresAt:$.renewDuration==="permanent"?null:$.newExpiresAt},P=await z.put(`/admin/api-keys/${m.apiKey.id}`,A);P.success?(G("API Key 续期成功","success"),S("success"),S("close")):G(P.message||"续期失败","error")}catch{G("续期失败","error")}finally{R.value=!1}};return _(),(A,P)=>(l(),oe(ke,{to:"body"},[e("div",Sl,[e("div",jl,[e("div",Vl,[P[5]||(P[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-clock text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900"},"续期 API Key")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",onClick:P[0]||(P[0]=p=>A.$emit("close"))},[...P[4]||(P[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",Rl,[e("div",Pl,[e("div",El,[P[7]||(P[7]=e("div",{class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-blue-500"},[e("i",{class:"fas fa-info text-sm text-white"})],-1)),e("div",null,[P[6]||(P[6]=e("h4",{class:"mb-1 font-semibold text-gray-800"},"API Key 信息",-1)),e("p",Ul,g(C.apiKey.name),1),e("p",Ol," 当前过期时间："+g(C.apiKey.expiresAt?U(C.apiKey.expiresAt):"永不过期"),1)])])]),e("div",null,[P[9]||(P[9]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"续期时长",-1)),T(e("select",{"onUpdate:modelValue":P[1]||(P[1]=p=>$.renewDuration=p),class:"form-input w-full",onChange:_},[...P[8]||(P[8]=[e("option",{value:"7d"},"延长 7 天",-1),e("option",{value:"30d"},"延长 30 天",-1),e("option",{value:"90d"},"延长 90 天",-1),e("option",{value:"180d"},"延长 180 天",-1),e("option",{value:"365d"},"延长 365 天",-1),e("option",{value:"custom"},"自定义日期",-1),e("option",{value:"permanent"},"设为永不过期",-1)])],544),[[ye,$.renewDuration]]),$.renewDuration==="custom"?(l(),o("div",Gl,[T(e("input",{"onUpdate:modelValue":P[2]||(P[2]=p=>$.customExpireDate=p),class:"form-input w-full",min:D.value,type:"datetime-local",onChange:W},null,40,ql),[[ee,$.customExpireDate]])])):v("",!0),$.newExpiresAt?(l(),o("p",Bl," 新的过期时间："+g(U($.newExpiresAt)),1)):v("",!0)])]),e("div",Wl,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:P[3]||(P[3]=p=>A.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:R.value||!$.renewDuration,type:"button",onClick:j},[R.value?(l(),o("div",zl)):(l(),o("i",Hl)),L(" "+g(R.value?"续期中...":"确认续期"),1)],8,Fl)])])])]))}},Yl=fe(Nl,[["__scopeId","data-v-2fba52a3"]]),Ql={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Jl={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-lg overflow-y-auto p-8"},Xl={class:"mb-6 space-y-4"},Zl={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},er={class:"font-medium text-gray-900 dark:text-gray-100"},tr={key:0},sr={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},ar={class:"text-gray-700 dark:text-gray-300"},lr={class:"relative"},rr={class:"flex min-h-[60px] items-center break-all rounded-lg border border-gray-700 bg-gray-900 p-4 pr-14 font-mono text-sm text-white dark:border-gray-600 dark:bg-gray-900"},or={class:"absolute right-3 top-3"},nr=["title"],ir={__name:"NewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,S=Q,R=K(!1),$=()=>{R.value=!R.value},D=()=>{const j=m.apiKey.apiKey||m.apiKey.key||"";return j?R.value||j.length<=12?j:j.substring(0,8)+"●".repeat(Math.max(0,j.length-12))+j.substring(j.length-4):""},U=async()=>{const j=m.apiKey.apiKey||m.apiKey.key||"";if(!j){G("API Key 不存在","error");return}try{await navigator.clipboard.writeText(j),G("API Key 已复制到剪贴板","success")}catch(A){console.error("Failed to copy:",A);const P=document.createElement("textarea");P.value=j,document.body.appendChild(P),P.select();try{document.execCommand("copy"),G("API Key 已复制到剪贴板","success")}catch{G("复制失败，请手动复制","error")}finally{document.body.removeChild(P)}}},_=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`,"确定关闭","取消")&&S("close"):confirm(`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`)&&S("close")},W=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有保存API Key，关闭后将无法再次查看。

建议您先复制API Key再关闭。`,"仍然关闭","返回复制")&&S("close"):confirm(`您还没有保存API Key，关闭后将无法再次查看。

确定要关闭吗？`)&&S("close")};return(j,A)=>(l(),oe(ke,{to:"body"},[e("div",Ql,[e("div",Jl,[e("div",{class:"mb-6 flex items-center justify-between"},[A[1]||(A[1]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-check text-lg text-white"})]),e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"API Key 创建成功"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"请妥善保存您的 API Key")])],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"直接关闭（不推荐）",onClick:W},[...A[0]||(A[0]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),A[7]||(A[7]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4 dark:border-amber-500 dark:bg-amber-900/20"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400 dark:bg-amber-500"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900 dark:text-amber-400"},"重要提醒"),e("p",{class:"text-sm text-amber-800 dark:text-amber-300"}," 这是您唯一能看到完整 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即复制并妥善保存。 ")])])],-1)),e("div",Xl,[e("div",null,[A[2]||(A[2]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key 名称",-1)),e("div",Zl,[e("span",er,g(C.apiKey.name),1)])]),C.apiKey.description?(l(),o("div",tr,[A[3]||(A[3]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注",-1)),e("div",sr,[e("span",ar,g(C.apiKey.description||"无描述"),1)])])):v("",!0),e("div",null,[A[4]||(A[4]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key",-1)),e("div",lr,[e("div",rr,g(D()),1),e("div",or,[e("button",{class:"btn-icon-sm bg-gray-700 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",title:R.value?"隐藏API Key":"显示完整API Key",type:"button",onClick:$},[e("i",{class:q(["fas",R.value?"fa-eye-slash":"fa-eye","text-gray-300"])},null,2)],8,nr)])]),A[5]||(A[5]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 点击眼睛图标切换显示模式，使用下方按钮复制完整 API Key ",-1))])]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:U},[...A[6]||(A[6]=[e("i",{class:"fas fa-copy"},null,-1),L(" 复制 API Key ",-1)])]),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:_}," 我已保存 ")])])])]))}},dr=fe(ir,[["__scopeId","data-v-aa36c8d5"]]),ur={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},cr={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-2xl overflow-y-auto p-8"},gr={class:"mb-6 flex items-center justify-between"},mr={class:"flex items-center gap-3"},xr={class:"text-sm text-gray-600"},pr={class:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4"},yr={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},fr={class:"flex items-center justify-between"},br={class:"mt-1 text-2xl font-bold text-blue-900"},vr={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},kr={class:"flex items-center justify-between"},wr={class:"mt-1 truncate text-lg font-bold text-green-900"},hr={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},$r={class:"flex items-center justify-between"},Ar={class:"mt-1 text-lg font-bold text-purple-900"},Cr={class:"rounded-lg border border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 p-4"},Ir={class:"flex items-center justify-between"},Kr={class:"mt-1 text-lg font-bold text-orange-900"},Lr={class:"mb-6"},Dr={class:"mb-3 flex items-center justify-between"},_r={class:"flex items-center gap-2"},Tr={key:0,class:"custom-scrollbar max-h-48 overflow-y-auto rounded-lg bg-gray-900 p-4"},Mr={class:"font-mono text-xs text-gray-300"},Sr={__name:"BatchApiKeyModal",props:{apiKeys:{type:Array,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,S=Q,R=K(!1),$=F(()=>{if(m.apiKeys.length>0){const p=m.apiKeys[0],a=p.name.match(/^(.+)_\d+$/);return a?a[1]:p.name}return""}),D=()=>{if(m.apiKeys.length===0)return"未知";const p=m.apiKeys[0].permissions;return{all:"全部服务",claude:"仅 Claude",gemini:"仅 Gemini"}[p]||p},U=()=>{if(m.apiKeys.length===0)return"未知";const p=m.apiKeys[0].expiresAt;if(!p)return"永不过期";const a=new Date(p),M=Math.ceil((a-new Date)/(1e3*60*60*24));return M<=7?`${M}天`:M<=30?`${Math.ceil(M/7)}周`:M<=365?`${Math.ceil(M/30)}个月`:`${Math.ceil(M/365)}年`},_=()=>{R.value=!R.value},W=()=>{const a=m.apiKeys.slice(0,10).map(d=>`${d.name}: ${d.apiKey||d.key||""}`);return m.apiKeys.length>10&&a.push(`... 还有 ${m.apiKeys.length-10} 个 API Key`),a.join(`
`)},j=()=>{const p=m.apiKeys.map(y=>`${y.name}: ${y.apiKey||y.key||""}`).join(`
`),a=new Blob([p],{type:"text/plain;charset=utf-8"}),d=URL.createObjectURL(a),M=document.createElement("a");M.href=d;const I=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);M.download=`api-keys-${$.value}-${I}.txt`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(d),G("API Keys 文件已下载","success")},A=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`,"确定关闭","返回下载")&&S("close"):confirm(`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`)&&S("close")},P=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有下载 API Keys，关闭后将无法再次查看。

强烈建议您先下载保存。`,"仍然关闭","返回下载")&&S("close"):confirm(`您还没有下载 API Keys，关闭后将无法再次查看。

确定要关闭吗？`)&&S("close")};return(p,a)=>(l(),oe(ke,{to:"body"},[e("div",ur,[e("div",cr,[e("div",gr,[e("div",mr,[a[1]||(a[1]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-layer-group text-lg text-white"})],-1)),e("div",null,[a[0]||(a[0]=e("h3",{class:"text-xl font-bold text-gray-900"},"批量创建成功",-1)),e("p",xr,"成功创建 "+g(C.apiKeys.length)+" 个 API Key",1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"直接关闭（不推荐）",onClick:P},[...a[2]||(a[2]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),a[14]||(a[14]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900"},"重要提醒"),e("p",{class:"text-sm text-amber-800"}," 这是您唯一能看到所有 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即下载并妥善保存。 ")])])],-1)),e("div",pr,[e("div",yr,[e("div",fr,[e("div",null,[a[3]||(a[3]=e("p",{class:"text-xs font-medium text-blue-600"},"创建数量",-1)),e("p",br,g(C.apiKeys.length),1)]),a[4]||(a[4]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500 bg-opacity-20"},[e("i",{class:"fas fa-key text-blue-600"})],-1))])]),e("div",vr,[e("div",kr,[e("div",null,[a[5]||(a[5]=e("p",{class:"text-xs font-medium text-green-600"},"基础名称",-1)),e("p",wr,g($.value),1)]),a[6]||(a[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500 bg-opacity-20"},[e("i",{class:"fas fa-tag text-green-600"})],-1))])]),e("div",hr,[e("div",$r,[e("div",null,[a[7]||(a[7]=e("p",{class:"text-xs font-medium text-purple-600"},"权限范围",-1)),e("p",Ar,g(D()),1)]),a[8]||(a[8]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500 bg-opacity-20"},[e("i",{class:"fas fa-shield-alt text-purple-600"})],-1))])]),e("div",Cr,[e("div",Ir,[e("div",null,[a[9]||(a[9]=e("p",{class:"text-xs font-medium text-orange-600"},"过期时间",-1)),e("p",Kr,g(U()),1)]),a[10]||(a[10]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-500 bg-opacity-20"},[e("i",{class:"fas fa-clock text-orange-600"})],-1))])])]),e("div",Lr,[e("div",Dr,[a[12]||(a[12]=e("label",{class:"text-sm font-semibold text-gray-700"},"API Keys 预览",-1)),e("div",_r,[e("button",{class:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",type:"button",onClick:_},[e("i",{class:q(["fas",R.value?"fa-eye-slash":"fa-eye"])},null,2),L(" "+g(R.value?"隐藏":"显示")+"预览 ",1)]),a[11]||(a[11]=e("span",{class:"text-xs text-gray-500"},"（最多显示前10个）",-1))])]),R.value?(l(),o("div",Tr,[e("pre",Mr,g(W()),1)])):v("",!0)]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:j},[...a[13]||(a[13]=[e("i",{class:"fas fa-download"},null,-1),L(" 下载所有 API Keys ",-1)])]),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:A}," 我已保存 ")]),a[15]||(a[15]=e("div",{class:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-3"},[e("p",{class:"flex items-start text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-2 mt-0.5 flex-shrink-0"}),e("span",null," 下载的文件格式为文本文件（.txt），每行包含一个 API Key。 请将文件保存在安全的位置，避免泄露。 ")])],-1))])])]))}},jr=fe(Sr,[["__scopeId","data-v-b0b904b9"]]),Vr={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Rr={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},Pr={class:"mb-4 flex items-center justify-between sm:mb-6"},Er={class:"flex items-center gap-2 sm:gap-3"},Ur={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},Or={class:"rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20"},Gr={class:"flex items-start gap-3"},qr={class:"mt-1 text-sm text-blue-700 dark:text-blue-400"},Br={class:"space-y-4"},Wr={class:"flex flex-wrap gap-4"},Fr={class:"flex cursor-pointer items-center"},zr={class:"flex cursor-pointer items-center"},Hr={class:"flex cursor-pointer items-center"},Nr={class:"flex cursor-pointer items-center"},Yr={key:0,class:"space-y-3"},Qr={key:0},Jr={class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"},Xr={class:"flex flex-wrap gap-2"},Zr=["onClick"],eo={key:1},to={class:"flex flex-wrap gap-2"},so=["onClick"],ao={class:"flex gap-2"},lo=["onKeypress"],ro={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},oo={class:"space-y-2"},no={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},io={class:"mb-3 flex items-center gap-4"},uo={class:"flex gap-4"},co={class:"flex cursor-pointer items-center"},go={class:"flex cursor-pointer items-center"},mo={class:"flex cursor-pointer items-center"},xo={class:"flex flex-wrap gap-4"},po={class:"flex cursor-pointer items-center"},yo={class:"flex cursor-pointer items-center"},fo={class:"flex cursor-pointer items-center"},bo={class:"flex cursor-pointer items-center"},vo={class:"flex cursor-pointer items-center"},ko={class:"mb-3 flex items-center justify-between"},wo=["disabled"],ho={class:"grid grid-cols-1 gap-3"},$o=["disabled"],Ao={key:0,label:"账号分组"},Co=["value"],Io={key:1,label:"专属账号"},Ko=["value"],Lo=["disabled"],Do={key:0,label:"账号分组"},_o=["value"],To={key:1,label:"专属账号"},Mo=["value"],So=["disabled"],jo={key:0,label:"账号分组"},Vo=["value"],Ro={key:1,label:"专属账号"},Po=["value"],Eo=["disabled"],Uo={key:0,label:"专属账号"},Oo=["value"],Go={class:"flex gap-3 pt-4"},qo=["disabled"],Bo={key:0,class:"loading-spinner mr-2"},Wo={key:1,class:"fas fa-save mr-2"},Fo={__name:"BatchEditApiKeyModal",props:{selectedKeys:{type:Array,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[]})}},emits:["close","success"],setup(C,{emit:Q}){const m=C,S=Q,R=Be(),$=K(!1),D=K(!1),U=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),_=K(""),W=K([]),j=K("none"),A=F(()=>m.selectedKeys.length),P=F(()=>W.value.filter(f=>!p.tags.includes(f))),p=De({tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",permissions:"",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",tags:[],isActive:null}),a=()=>{if(_.value&&_.value.trim()){const f=_.value.trim();p.tags.includes(f)||p.tags.push(f),_.value=""}},d=f=>{p.tags.includes(f)||p.tags.push(f)},M=f=>{p.tags.splice(f,1)},I=async()=>{var f,c;D.value=!0;try{const[n,h,re,de,O,r]=await Promise.all([z.get("/admin/claude-accounts"),z.get("/admin/claude-console-accounts"),z.get("/admin/gemini-accounts"),z.get("/admin/openai-accounts"),z.get("/admin/bedrock-accounts"),z.get("/admin/account-groups")]),x=[];if(n.success&&((f=n.data)==null||f.forEach(w=>{x.push({...w,platform:"claude-oauth",isDedicated:w.accountType==="dedicated"})})),h.success&&((c=h.data)==null||c.forEach(w=>{x.push({...w,platform:"claude-console",isDedicated:w.accountType==="dedicated"})})),U.value.claude=x,re.success&&(U.value.gemini=(re.data||[]).map(w=>({...w,isDedicated:w.accountType==="dedicated"}))),de.success&&(U.value.openai=(de.data||[]).map(w=>({...w,isDedicated:w.accountType==="dedicated"}))),O.success&&(U.value.bedrock=(O.data||[]).map(w=>({...w,isDedicated:w.accountType==="dedicated"}))),r.success){const w=r.data||[];U.value.claudeGroups=w.filter(X=>X.platform==="claude"),U.value.geminiGroups=w.filter(X=>X.platform==="gemini"),U.value.openaiGroups=w.filter(X=>X.platform==="openai")}G("账号列表已刷新","success")}catch{G("刷新账号列表失败","error")}finally{D.value=!1}},y=async()=>{$.value=!0;try{const f={};p.tokenLimit!==""&&p.tokenLimit!==null&&(f.tokenLimit=parseInt(p.tokenLimit)),p.rateLimitWindow!==""&&p.rateLimitWindow!==null&&(f.rateLimitWindow=parseInt(p.rateLimitWindow)),p.rateLimitRequests!==""&&p.rateLimitRequests!==null&&(f.rateLimitRequests=parseInt(p.rateLimitRequests)),p.concurrencyLimit!==""&&p.concurrencyLimit!==null&&(f.concurrencyLimit=parseInt(p.concurrencyLimit)),p.dailyCostLimit!==""&&p.dailyCostLimit!==null&&(f.dailyCostLimit=parseFloat(p.dailyCostLimit)),p.permissions!==""&&(f.permissions=p.permissions),p.claudeAccountId!==""&&(p.claudeAccountId==="SHARED_POOL"?(f.claudeAccountId=null,f.claudeConsoleAccountId=null):p.claudeAccountId.startsWith("console:")?(f.claudeConsoleAccountId=p.claudeAccountId.substring(8),f.claudeAccountId=null):(p.claudeAccountId.startsWith("group:"),f.claudeAccountId=p.claudeAccountId,f.claudeConsoleAccountId=null)),p.geminiAccountId!==""&&(p.geminiAccountId==="SHARED_POOL"?f.geminiAccountId=null:f.geminiAccountId=p.geminiAccountId),p.openaiAccountId!==""&&(p.openaiAccountId==="SHARED_POOL"?f.openaiAccountId=null:f.openaiAccountId=p.openaiAccountId),p.bedrockAccountId!==""&&(p.bedrockAccountId==="SHARED_POOL"?f.bedrockAccountId=null:f.bedrockAccountId=p.bedrockAccountId),p.isActive!==null&&(f.isActive=p.isActive),j.value!=="none"&&(f.tags=p.tags,f.tagOperation=j.value);const c=await z.put("/admin/api-keys/batch",{keyIds:m.selectedKeys,updates:f});if(c.success){const{successCount:n,failedCount:h,errors:re}=c.data;if(n>0){if(G(`成功批量编辑 ${n} 个 API Keys`,"success"),h>0){const de=re.map(O=>`${O.keyId}: ${O.error}`).join(`
`);G(`${h} 个编辑失败:
${de}`,"warning")}}else G("所有 API Keys 编辑失败","error");S("success"),S("close")}else G(c.message||"批量编辑失败","error")}catch(f){G("批量编辑失败","error"),console.error("批量编辑 API Keys 失败:",f)}finally{$.value=!1}};return Ve(async()=>{W.value=await R.fetchTags(),m.accounts&&(U.value={claude:m.accounts.claude||[],gemini:m.accounts.gemini||[],openai:m.accounts.openai||[],bedrock:m.accounts.bedrock||[],claudeGroups:m.accounts.claudeGroups||[],geminiGroups:m.accounts.geminiGroups||[],openaiGroups:m.accounts.openaiGroups||[]})}),(f,c)=>(l(),oe(ke,{to:"body"},[e("div",Vr,[e("div",Rr,[e("div",Pr,[e("div",Er,[c[24]||(c[24]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})],-1)),e("h3",Ur," 批量编辑 API Keys ("+g(A.value)+" 个) ",1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:c[0]||(c[0]=n=>f.$emit("close"))},[...c[25]||(c[25]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:ce(y,["prevent"])},[e("div",Or,[e("div",Gr,[c[27]||(c[27]=e("i",{class:"fas fa-info-circle mt-1 text-blue-500"},null,-1)),e("div",null,[c[26]||(c[26]=e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-300"},"批量编辑说明",-1)),e("p",qr," 以下设置将应用到所选的 "+g(A.value)+" 个 API Key。只有填写或修改的字段才会被更新，空白字段将保持原值不变。 ",1)])])]),e("div",null,[c[37]||(c[37]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"}," 标签 (批量操作) ",-1)),e("div",Br,[e("div",Wr,[e("label",Fr,[T(e("input",{"onUpdate:modelValue":c[1]||(c[1]=n=>j.value=n),class:"mr-2",type:"radio",value:"replace"},null,512),[[ae,j.value]]),c[28]||(c[28]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"替换标签",-1))]),e("label",zr,[T(e("input",{"onUpdate:modelValue":c[2]||(c[2]=n=>j.value=n),class:"mr-2",type:"radio",value:"add"},null,512),[[ae,j.value]]),c[29]||(c[29]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"添加标签",-1))]),e("label",Hr,[T(e("input",{"onUpdate:modelValue":c[3]||(c[3]=n=>j.value=n),class:"mr-2",type:"radio",value:"remove"},null,512),[[ae,j.value]]),c[30]||(c[30]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"移除标签",-1))]),e("label",Nr,[T(e("input",{"onUpdate:modelValue":c[4]||(c[4]=n=>j.value=n),class:"mr-2",type:"radio",value:"none"},null,512),[[ae,j.value]]),c[31]||(c[31]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改标签",-1))])]),j.value!=="none"?(l(),o("div",Yr,[p.tags.length>0?(l(),o("div",Qr,[e("div",Jr,g(j.value==="replace"?"新标签列表:":j.value==="add"?"要添加的标签:":"要移除的标签:"),1),e("div",Xr,[(l(!0),o(N,null,Y(p.tags,(n,h)=>(l(),o("span",{key:"selected-"+h,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},[L(g(n)+" ",1),e("button",{class:"ml-1 hover:text-blue-900",type:"button",onClick:re=>M(h)},[...c[32]||(c[32]=[e("i",{class:"fas fa-times text-xs"},null,-1)])],8,Zr)]))),128))])])):v("",!0),P.value.length>0?(l(),o("div",eo,[c[34]||(c[34]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",to,[(l(!0),o(N,null,Y(P.value,n=>(l(),o("button",{key:"available-"+n,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-300",type:"button",onClick:h=>d(n)},[c[33]||(c[33]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),L(" "+g(n),1)],8,so))),128))])])):v("",!0),e("div",null,[c[36]||(c[36]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",ao,[T(e("input",{"onUpdate:modelValue":c[5]||(c[5]=n=>_.value=n),class:"form-input flex-1 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"输入新标签名称",type:"text",onKeypress:je(ce(a,["prevent"]),["enter"])},null,40,lo),[[ee,_.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",type:"button",onClick:a},[...c[35]||(c[35]=[e("i",{class:"fas fa-plus"},null,-1)])])])])])):v("",!0)])]),e("div",ro,[c[41]||(c[41]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},"速率限制设置")],-1)),e("div",oo,[e("div",no,[e("div",null,[c[38]||(c[38]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 时间窗口 (分钟) ",-1)),T(e("input",{"onUpdate:modelValue":c[6]||(c[6]=n=>p.rateLimitWindow=n),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[ee,p.rateLimitWindow]])]),e("div",null,[c[39]||(c[39]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),T(e("input",{"onUpdate:modelValue":c[7]||(c[7]=n=>p.rateLimitRequests=n),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[ee,p.rateLimitRequests]])]),e("div",null,[c[40]||(c[40]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"Token 限制",-1)),T(e("input",{"onUpdate:modelValue":c[8]||(c[8]=n=>p.tokenLimit=n),class:"form-input w-full text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"不修改",type:"number"},null,512),[[ee,p.tokenLimit]])])])])]),e("div",null,[c[42]||(c[42]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"}," 每日费用限制 (美元) ",-1)),T(e("input",{"onUpdate:modelValue":c[9]||(c[9]=n=>p.dailyCostLimit=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",step:"0.01",type:"number"},null,512),[[ee,p.dailyCostLimit]])]),e("div",null,[c[43]||(c[43]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),T(e("input",{"onUpdate:modelValue":c[10]||(c[10]=n=>p.concurrencyLimit=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",type:"number"},null,512),[[ee,p.concurrencyLimit]])]),e("div",null,[e("div",io,[c[47]||(c[47]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"激活状态",-1)),e("div",uo,[e("label",co,[T(e("input",{"onUpdate:modelValue":c[11]||(c[11]=n=>p.isActive=n),class:"mr-2",type:"radio",value:!0},null,512),[[ae,p.isActive]]),c[44]||(c[44]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"激活",-1))]),e("label",go,[T(e("input",{"onUpdate:modelValue":c[12]||(c[12]=n=>p.isActive=n),class:"mr-2",type:"radio",value:!1},null,512),[[ae,p.isActive]]),c[45]||(c[45]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"禁用",-1))]),e("label",mo,[T(e("input",{"onUpdate:modelValue":c[13]||(c[13]=n=>p.isActive=n),class:"mr-2",type:"radio",value:null},null,512),[[ae,p.isActive]]),c[46]||(c[46]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改",-1))])])])]),e("div",null,[c[53]||(c[53]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",xo,[e("label",po,[T(e("input",{"onUpdate:modelValue":c[14]||(c[14]=n=>p.permissions=n),class:"mr-2",type:"radio",value:""},null,512),[[ae,p.permissions]]),c[48]||(c[48]=e("span",{class:"text-sm text-gray-700"},"不修改",-1))]),e("label",yo,[T(e("input",{"onUpdate:modelValue":c[15]||(c[15]=n=>p.permissions=n),class:"mr-2",type:"radio",value:"all"},null,512),[[ae,p.permissions]]),c[49]||(c[49]=e("span",{class:"text-sm text-gray-700"},"全部服务",-1))]),e("label",fo,[T(e("input",{"onUpdate:modelValue":c[16]||(c[16]=n=>p.permissions=n),class:"mr-2",type:"radio",value:"claude"},null,512),[[ae,p.permissions]]),c[50]||(c[50]=e("span",{class:"text-sm text-gray-700"},"仅 Claude",-1))]),e("label",bo,[T(e("input",{"onUpdate:modelValue":c[17]||(c[17]=n=>p.permissions=n),class:"mr-2",type:"radio",value:"gemini"},null,512),[[ae,p.permissions]]),c[51]||(c[51]=e("span",{class:"text-sm text-gray-700"},"仅 Gemini",-1))]),e("label",vo,[T(e("input",{"onUpdate:modelValue":c[18]||(c[18]=n=>p.permissions=n),class:"mr-2",type:"radio",value:"openai"},null,512),[[ae,p.permissions]]),c[52]||(c[52]=e("span",{class:"text-sm text-gray-700"},"仅 OpenAI",-1))])])]),e("div",null,[e("div",ko,[c[54]||(c[54]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:D.value,title:"刷新账号列表",type:"button",onClick:I},[e("i",{class:q(["fas",D.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,g(D.value?"刷新中...":"刷新账号"),1)],8,wo)]),e("div",ho,[e("div",null,[c[57]||(c[57]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),T(e("select",{"onUpdate:modelValue":c[19]||(c[19]=n=>p.claudeAccountId=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="gemini"||p.permissions==="openai"},[c[55]||(c[55]=e("option",{value:""},"不修改",-1)),c[56]||(c[56]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.claudeGroups.length>0?(l(),o("optgroup",Ao,[(l(!0),o(N,null,Y(U.value.claudeGroups,n=>(l(),o("option",{key:n.id,value:`group:${n.id}`}," 分组 - "+g(n.name),9,Co))),128))])):v("",!0),U.value.claude.length>0?(l(),o("optgroup",Io,[(l(!0),o(N,null,Y(U.value.claude,n=>(l(),o("option",{key:n.id,value:n.platform==="claude-console"?`console:${n.id}`:n.id},g(n.name)+" ("+g(n.platform==="claude-console"?"Console":"OAuth")+") ",9,Ko))),128))])):v("",!0)],8,$o),[[ye,p.claudeAccountId]])]),e("div",null,[c[60]||(c[60]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),T(e("select",{"onUpdate:modelValue":c[20]||(c[20]=n=>p.geminiAccountId=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="claude"||p.permissions==="openai"},[c[58]||(c[58]=e("option",{value:""},"不修改",-1)),c[59]||(c[59]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.geminiGroups.length>0?(l(),o("optgroup",Do,[(l(!0),o(N,null,Y(U.value.geminiGroups,n=>(l(),o("option",{key:n.id,value:`group:${n.id}`}," 分组 - "+g(n.name),9,_o))),128))])):v("",!0),U.value.gemini.length>0?(l(),o("optgroup",To,[(l(!0),o(N,null,Y(U.value.gemini,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name),9,Mo))),128))])):v("",!0)],8,Lo),[[ye,p.geminiAccountId]])]),e("div",null,[c[63]||(c[63]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),T(e("select",{"onUpdate:modelValue":c[21]||(c[21]=n=>p.openaiAccountId=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="claude"||p.permissions==="gemini"},[c[61]||(c[61]=e("option",{value:""},"不修改",-1)),c[62]||(c[62]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.openaiGroups.length>0?(l(),o("optgroup",jo,[(l(!0),o(N,null,Y(U.value.openaiGroups,n=>(l(),o("option",{key:n.id,value:`group:${n.id}`}," 分组 - "+g(n.name),9,Vo))),128))])):v("",!0),U.value.openai.length>0?(l(),o("optgroup",Ro,[(l(!0),o(N,null,Y(U.value.openai,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name),9,Po))),128))])):v("",!0)],8,So),[[ye,p.openaiAccountId]])]),e("div",null,[c[66]||(c[66]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),T(e("select",{"onUpdate:modelValue":c[22]||(c[22]=n=>p.bedrockAccountId=n),class:"form-input w-full dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:p.permissions==="gemini"||p.permissions==="openai"},[c[64]||(c[64]=e("option",{value:""},"不修改",-1)),c[65]||(c[65]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),U.value.bedrock.length>0?(l(),o("optgroup",Uo,[(l(!0),o(N,null,Y(U.value.bedrock,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name),9,Oo))),128))])):v("",!0)],8,Eo),[[ye,p.bedrockAccountId]])])])]),e("div",Go,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:c[23]||(c[23]=n=>f.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:$.value,type:"submit"},[$.value?(l(),o("div",Bo)):(l(),o("i",Wo)),L(" "+g($.value?"保存中...":"批量保存"),1)],8,qo)])],32)])])]))}},zo=fe(Fo,[["__scopeId","data-v-be660ab9"]]),Ho={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},No={class:"modal-content relative mx-auto w-full max-w-lg p-8"},Yo={class:"mb-6 flex items-center justify-between"},Qo={class:"flex items-center gap-3"},Jo={class:"text-sm text-gray-600 dark:text-gray-400"},Xo={class:"space-y-6"},Zo={class:"rounded-lg border border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 p-4 dark:border-gray-600 dark:from-gray-700 dark:to-gray-800"},en={class:"flex items-center justify-between"},tn={class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},sn={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},an={class:"mb-3 grid grid-cols-3 gap-2"},ln=["onClick"],rn={key:0,class:"animate-fadeIn"},on=["min"],nn={key:1,class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20"},dn={class:"flex items-center justify-between"},un={class:"text-sm font-semibold text-blue-900 dark:text-blue-200"},cn={class:"flex gap-3 pt-2"},gn=["disabled"],mn={key:0,class:"loading-spinner mr-2"},xn={key:1,class:"fas fa-save mr-2"},pn={__name:"ExpiryEditModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close","save"],setup(C,{expose:Q,emit:m}){const S=C,R=m,$=K(!1),D=De({expireDuration:"",customExpireDate:"",expiresAt:null}),U=[{value:"",label:"永不过期"},{value:"1d",label:"1 天"},{value:"7d",label:"7 天"},{value:"30d",label:"30 天"},{value:"90d",label:"90 天"},{value:"180d",label:"180 天"},{value:"365d",label:"1 年"},{value:"730d",label:"2 年"}],_=F(()=>{const I=new Date;return I.setMinutes(I.getMinutes()+1),I.toISOString().slice(0,16)});he(()=>S.show,I=>{I&&W()}),he(()=>{var I;return(I=S.apiKey)==null?void 0:I.id},I=>{I&&S.show&&W()});const W=()=>{$.value=!1,S.apiKey.expiresAt?(D.expireDuration="custom",D.customExpireDate=new Date(S.apiKey.expiresAt).toISOString().slice(0,16),D.expiresAt=S.apiKey.expiresAt):(D.expireDuration="",D.customExpireDate="",D.expiresAt=null)},j=I=>{if(D.expireDuration=I,!I){D.expiresAt=null;return}if(I==="custom")return;const y=new Date,f=I.match(/(\d+)([dhmy])/);if(f){const[,c,n]=f,h=parseInt(c);switch(n){case"d":y.setDate(y.getDate()+h);break;case"h":y.setHours(y.getHours()+h);break;case"m":y.setMonth(y.getMonth()+h);break;case"y":y.setFullYear(y.getFullYear()+h);break}D.expiresAt=y.toISOString()}},A=()=>{D.customExpireDate&&(D.expiresAt=new Date(D.customExpireDate).toISOString())},P=I=>I?new Date(I).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",p=I=>I?new Date(I)<new Date:!1,a=I=>{if(!I)return null;const y=new Date,c=new Date(I)-y,n=Math.ceil(c/(1e3*60*60*24));return c<0?{text:"已过期",class:"text-red-600"}:n<=7?{text:`${n} 天后过期`,class:"text-orange-600"}:n<=30?{text:`${n} 天后过期`,class:"text-yellow-600"}:{text:`${Math.ceil(n/30)} 个月后过期`,class:"text-green-600"}},d=()=>{$.value=!0,R("save",{keyId:S.apiKey.id,expiresAt:D.expiresAt})};return Q({resetSaving:()=>{$.value=!1}}),(I,y)=>(l(),oe(ke,{to:"body"},[C.show?(l(),o("div",Ho,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:y[0]||(y[0]=f=>I.$emit("close"))}),e("div",No,[e("div",Yo,[e("div",Qo,[y[6]||(y[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-orange-600"},[e("i",{class:"fas fa-clock text-white"})],-1)),e("div",null,[y[5]||(y[5]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改过期时间",-1)),e("p",Jo,' 为 "'+g(C.apiKey.name||"API Key")+'" 设置新的过期时间 ',1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:y[1]||(y[1]=f=>I.$emit("close"))},[...y[7]||(y[7]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",Xo,[e("div",Zo,[e("div",en,[e("div",null,[y[10]||(y[10]=e("p",{class:"mb-1 text-xs font-medium text-gray-600 dark:text-gray-400"}," 当前过期时间 ",-1)),e("p",tn,[C.apiKey.expiresAt?(l(),o(N,{key:0},[L(g(P(C.apiKey.expiresAt))+" ",1),a(C.apiKey.expiresAt)?(l(),o("span",{key:0,class:q(["ml-2 text-xs font-normal",a(C.apiKey.expiresAt).class])}," ("+g(a(C.apiKey.expiresAt).text)+") ",3)):v("",!0)],64)):(l(),o(N,{key:1},[y[8]||(y[8]=e("i",{class:"fas fa-infinity mr-1 text-gray-500"},null,-1)),y[9]||(y[9]=L(" 永不过期 ",-1))],64))])]),e("div",sn,[e("i",{class:q(["fas fa-hourglass-half text-lg",C.apiKey.expiresAt&&p(C.apiKey.expiresAt)?"text-red-500":"text-gray-400"])},null,2)])])]),e("div",null,[y[12]||(y[12]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择新的期限",-1)),e("div",an,[(l(),o(N,null,Y(U,f=>e("button",{key:f.value,class:q(["rounded-lg px-3 py-2 text-sm font-medium transition-all",D.expireDuration===f.value?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:c=>j(f.value)},g(f.label),11,ln)),64)),e("button",{class:q(["rounded-lg px-3 py-2 text-sm font-medium transition-all",D.expireDuration==="custom"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:y[2]||(y[2]=f=>j("custom"))},[...y[11]||(y[11]=[e("i",{class:"fas fa-calendar-alt mr-1"},null,-1),L(" 自定义 ",-1)])],2)])]),D.expireDuration==="custom"?(l(),o("div",rn,[y[13]||(y[13]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择日期和时间",-1)),T(e("input",{"onUpdate:modelValue":y[3]||(y[3]=f=>D.customExpireDate=f),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:_.value,type:"datetime-local",onChange:A},null,40,on),[[ee,D.customExpireDate]]),y[14]||(y[14]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择一个未来的日期和时间作为过期时间 ",-1))])):v("",!0),D.expiresAt!==C.apiKey.expiresAt?(l(),o("div",nn,[e("div",dn,[e("div",null,[y[17]||(y[17]=e("p",{class:"mb-1 text-xs font-medium text-blue-700 dark:text-blue-400"},[e("i",{class:"fas fa-arrow-right mr-1"}),L(" 新的过期时间 ")],-1)),e("p",un,[D.expiresAt?(l(),o(N,{key:0},[L(g(P(D.expiresAt))+" ",1),a(D.expiresAt)?(l(),o("span",{key:0,class:q(["ml-2 text-xs font-normal",a(D.expiresAt).class])}," ("+g(a(D.expiresAt).text)+") ",3)):v("",!0)],64)):(l(),o(N,{key:1},[y[15]||(y[15]=e("i",{class:"fas fa-infinity mr-1"},null,-1)),y[16]||(y[16]=L(" 永不过期 ",-1))],64))])]),y[18]||(y[18]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},[e("i",{class:"fas fa-check text-lg text-green-500"})],-1))])])):v("",!0),e("div",cn,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",onClick:y[4]||(y[4]=f=>I.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 font-semibold",disabled:$.value||D.expiresAt===C.apiKey.expiresAt,onClick:d},[$.value?(l(),o("div",mn)):(l(),o("i",xn)),L(" "+g($.value?"保存中...":"保存更改"),1)],8,gn)])])])])):v("",!0)]))}},yn=fe(pn,[["__scopeId","data-v-ce7524cf"]]),fn={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},bn={class:"modal-content relative mx-auto flex max-h-[90vh] w-[95%] max-w-2xl flex-col p-4 sm:w-full sm:max-w-3xl sm:p-6 md:p-8"},vn={class:"mb-4 flex items-center justify-between sm:mb-6"},kn={class:"flex items-center gap-2 sm:gap-3"},wn={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},hn={class:"modal-scroll-content custom-scrollbar flex-1 overflow-y-auto"},$n={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2"},An={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-blue-800/20"},Cn={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},In={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Kn={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4 dark:border-green-700 dark:from-green-900/20 dark:to-green-800/20"},Ln={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Dn={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},_n={class:"rounded-lg border border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 dark:border-yellow-700 dark:from-yellow-900/20 dark:to-yellow-800/20"},Tn={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Mn={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Sn={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4 dark:border-purple-700 dark:from-purple-900/20 dark:to-purple-800/20"},jn={class:"space-y-1 text-sm"},Vn={class:"flex justify-between"},Rn={class:"font-semibold text-gray-900 dark:text-gray-100"},Pn={class:"flex justify-between"},En={class:"font-semibold text-gray-900 dark:text-gray-100"},Un={class:"mb-6"},On={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},Gn={class:"flex items-center justify-between"},qn={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Bn={class:"flex items-center justify-between"},Wn={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Fn={key:0,class:"flex items-center justify-between"},zn={class:"text-sm font-semibold text-purple-600"},Hn={key:1,class:"flex items-center justify-between"},Nn={class:"text-sm font-semibold text-purple-600"},Yn={key:0,class:"mb-6"},Qn={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},Jn={key:0,class:"space-y-2"},Xn={class:"flex items-center justify-between text-sm"},Zn={class:"font-semibold text-gray-900 dark:text-gray-100"},ei={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-600"},ti={class:"text-right text-xs text-gray-500 dark:text-gray-400"},si={key:1,class:"flex items-center justify-between text-sm"},ai={class:"font-semibold text-purple-600"},li={key:2,class:"space-y-2"},ri={__name:"UsageDetailModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close"],setup(C,{emit:Q}){const m=C,S=Q,R=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.requests)||0}),$=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.daily)==null?void 0:h.requests)||0}),D=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.tokens)||0}),U=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.daily)==null?void 0:h.tokens)||0}),_=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.cost)||0}),W=F(()=>m.apiKey.dailyCost||0),j=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.inputTokens)||0}),A=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.outputTokens)||0}),P=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.cacheCreateTokens)||0}),p=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.total)==null?void 0:h.cacheReadTokens)||0}),a=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.averages)==null?void 0:h.rpm)||0}),d=F(()=>{var n,h;return((h=(n=m.apiKey.usage)==null?void 0:n.averages)==null?void 0:h.tpm)||0}),M=F(()=>m.apiKey.dailyCostLimit>0||m.apiKey.concurrencyLimit>0||m.apiKey.rateLimitWindow>0||m.apiKey.tokenLimit>0),I=F(()=>!m.apiKey.dailyCostLimit||m.apiKey.dailyCostLimit===0?0:W.value/m.apiKey.dailyCostLimit*100),y=n=>!n&&n!==0?"0":n.toLocaleString("zh-CN"),f=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString(),c=()=>{S("close")};return(n,h)=>(l(),oe(ke,{to:"body"},[C.show?(l(),o("div",fn,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:c}),e("div",bn,[e("div",vn,[e("div",kn,[h[0]||(h[0]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-chart-line text-sm text-white sm:text-base"})],-1)),e("h3",wn," 使用统计详情 - "+g(C.apiKey.name),1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:c},[...h[1]||(h[1]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("div",hn,[e("div",$n,[e("div",An,[h[2]||(h[2]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总请求数"),e("i",{class:"fas fa-paper-plane text-blue-500"})],-1)),e("div",Cn,g(y(R.value)),1),e("div",In," 今日: "+g(y($.value))+" 次 ",1)]),e("div",Kn,[h[3]||(h[3]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总Token数"),e("i",{class:"fas fa-coins text-green-500"})],-1)),e("div",Ln,g(f(D.value)),1),e("div",Dn," 今日: "+g(f(U.value)),1)]),e("div",_n,[h[4]||(h[4]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总费用"),e("i",{class:"fas fa-dollar-sign text-yellow-600"})],-1)),e("div",Tn," $"+g(_.value.toFixed(4)),1),e("div",Mn," 今日: $"+g(W.value.toFixed(4)),1)]),e("div",Sn,[h[7]||(h[7]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"平均速率"),e("i",{class:"fas fa-tachometer-alt text-purple-500"})],-1)),e("div",jn,[e("div",Vn,[h[5]||(h[5]=e("span",{class:"text-gray-600 dark:text-gray-400"},"RPM:",-1)),e("span",Rn,g(a.value),1)]),e("div",Pn,[h[6]||(h[6]=e("span",{class:"text-gray-600 dark:text-gray-400"},"TPM:",-1)),e("span",En,g(d.value),1)])])])]),e("div",Un,[h[12]||(h[12]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),L(" Token 使用分布 ")],-1)),e("div",On,[e("div",Gn,[h[8]||(h[8]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-2 text-green-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入 Token")],-1)),e("span",qn,g(f(j.value)),1)]),e("div",Bn,[h[9]||(h[9]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-2 text-blue-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出 Token")],-1)),e("span",Wn,g(f(A.value)),1)]),P.value>0?(l(),o("div",Fn,[h[10]||(h[10]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存创建 Token")],-1)),e("span",zn,g(f(P.value)),1)])):v("",!0),p.value>0?(l(),o("div",Hn,[h[11]||(h[11]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存读取 Token")],-1)),e("span",Nn,g(f(p.value)),1)])):v("",!0)])]),M.value?(l(),o("div",Yn,[h[16]||(h[16]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-red-500"}),L(" 限制设置 ")],-1)),e("div",Qn,[C.apiKey.dailyCostLimit>0?(l(),o("div",Jn,[e("div",Xn,[h[13]||(h[13]=e("span",{class:"text-gray-600 dark:text-gray-400"},"每日费用限制",-1)),e("span",Zn," $"+g(C.apiKey.dailyCostLimit.toFixed(2)),1)]),e("div",ei,[e("div",{class:q(["h-2 rounded-full transition-all duration-300",I.value>=100?"bg-red-500":I.value>=80?"bg-yellow-500":"bg-green-500"]),style:Se({width:Math.min(I.value,100)+"%"})},null,6)]),e("div",ti," 已使用 "+g(I.value.toFixed(1))+"% ",1)])):v("",!0),C.apiKey.concurrencyLimit>0?(l(),o("div",si,[h[14]||(h[14]=e("span",{class:"text-gray-600 dark:text-gray-400"},"并发限制",-1)),e("span",ai,g(C.apiKey.currentConcurrency||0)+" / "+g(C.apiKey.concurrencyLimit),1)])):v("",!0),C.apiKey.rateLimitWindow>0?(l(),o("div",li,[h[15]||(h[15]=e("h5",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-clock mr-1 text-blue-500"}),L(" 时间窗口限制 ")],-1)),ie(Ge,{"current-requests":C.apiKey.currentWindowRequests,"current-tokens":C.apiKey.currentWindowTokens,label:"窗口状态","rate-limit-window":C.apiKey.rateLimitWindow,"request-limit":C.apiKey.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":C.apiKey.tokenLimit,"window-end-time":C.apiKey.windowEndTime,"window-remaining-seconds":C.apiKey.windowRemainingSeconds,"window-start-time":C.apiKey.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])])):v("",!0)])])):v("",!0)]),e("div",{class:"mt-4 flex justify-end gap-2 sm:mt-6 sm:gap-3"},[e("button",{class:"btn btn-secondary px-4 py-2 text-sm",type:"button",onClick:c}," 关闭 ")])])])):v("",!0)]))}},oi=fe(ri,[["__scopeId","data-v-6679d647"]]),ni={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},ii={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-lg flex-col p-4 sm:p-6"},di={class:"mb-4 flex items-center justify-between sm:mb-6"},ui={class:"mb-4 rounded-lg bg-gray-50 p-3 dark:bg-gray-800 sm:mb-6"},ci={class:"flex items-center gap-2"},gi={class:"font-medium text-gray-700 dark:text-gray-300"},mi=["disabled"],xi={key:0,label:"OAuth 账户"},pi=["value"],yi={key:1,label:"Console 账户"},fi=["value"],bi=["disabled"],vi=["value"],ki=["disabled"],wi=["value"],hi=["disabled"],$i=["value"],Ai={class:"flex gap-3 pt-4"},Ci=["disabled"],Ii={key:0,class:"loading-spinner mr-2"},Ki={key:1,class:"fas fa-save mr-2"},Li={__name:"QuickBindModal",props:{apiKey:{type:Object,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[]})},show:{type:Boolean,default:!1}},emits:["close","success"],setup(C,{emit:Q}){const m=C,S=Q,R=K(!1),$=De({claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:""}),D=F(()=>(m.accounts.claude||[]).filter(y=>y.accountType==="dedicated"&&y.platform==="claude-oauth")),U=F(()=>(m.accounts.claude||[]).filter(y=>y.accountType==="dedicated"&&y.platform==="claude-console")),_=F(()=>(m.accounts.gemini||[]).filter(y=>y.accountType==="dedicated")),W=F(()=>(m.accounts.openai||[]).filter(y=>y.accountType==="dedicated")),j=F(()=>(m.accounts.bedrock||[]).filter(y=>y.accountType==="dedicated")),A=F(()=>D.value.length>0||U.value.length>0),P=F(()=>_.value.length>0),p=F(()=>W.value.length>0),a=F(()=>j.value.length>0),d=y=>{if(!y)return"未知";if(y.isActive===!1)switch(y.status){case"unauthorized":return"未授权";case"error":return"Token错误";case"created":return"待验证";case"rate_limited":return"限流中";default:return"异常"}return"正常"},M=()=>{m.apiKey&&(m.apiKey.claudeConsoleAccountId?$.claudeAccountId=`console:${m.apiKey.claudeConsoleAccountId}`:$.claudeAccountId=m.apiKey.claudeAccountId||"",$.geminiAccountId=m.apiKey.geminiAccountId||"",$.openaiAccountId=m.apiKey.openaiAccountId||"",$.bedrockAccountId=m.apiKey.bedrockAccountId||"")},I=async()=>{R.value=!0;try{const y={};$.claudeAccountId?$.claudeAccountId.startsWith("console:")?(y.claudeConsoleAccountId=$.claudeAccountId.substring(8),y.claudeAccountId=null):(y.claudeAccountId=$.claudeAccountId,y.claudeConsoleAccountId=null):(y.claudeAccountId=null,y.claudeConsoleAccountId=null),y.geminiAccountId=$.geminiAccountId||null,y.openaiAccountId=$.openaiAccountId||null,y.bedrockAccountId=$.bedrockAccountId||null;const f=await z.put(`/admin/api-keys/${m.apiKey.id}`,y);f.success?(G("专属账号绑定已更新","success"),S("success"),S("close")):G(f.message||"更新失败","error")}catch(y){console.error("保存绑定失败:",y),G("保存失败，请稍后重试","error")}finally{R.value=!1}};return he(()=>m.show,y=>{y&&M()},{immediate:!0}),he(()=>m.apiKey,()=>{m.show&&M()},{immediate:!0}),(y,f)=>{var c;return l(),oe(ke,{to:"body"},[C.show?(l(),o("div",ni,[e("div",ii,[e("div",di,[f[7]||(f[7]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-link text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 快速绑定专属账号 ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:f[0]||(f[0]=n=>y.$emit("close"))},[...f[6]||(f[6]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)])])]),e("div",ui,[e("div",ci,[f[8]||(f[8]=e("i",{class:"fas fa-key text-gray-400"},null,-1)),e("span",gi,g(((c=C.apiKey)==null?void 0:c.name)||"API Key"),1)])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4",onSubmit:ce(I,["prevent"])},[e("div",null,[f[10]||(f[10]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded bg-orange-500"},[e("i",{class:"fas fa-robot text-xs text-white"})]),e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," Claude 专属账号 ")],-1)),T(e("select",{"onUpdate:modelValue":f[1]||(f[1]=n=>$.claudeAccountId=n),class:"form-select w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",disabled:R.value||!A.value},[f[9]||(f[9]=e("option",{value:""},"使用共享池",-1)),D.value.length>0?(l(),o("optgroup",xi,[(l(!0),o(N,null,Y(D.value,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name)+" (专属) - "+g(d(n)),9,pi))),128))])):v("",!0),U.value.length>0?(l(),o("optgroup",yi,[(l(!0),o(N,null,Y(U.value,n=>(l(),o("option",{key:n.id,value:`console:${n.id}`},g(n.name)+" (专属) - "+g(d(n)),9,fi))),128))])):v("",!0)],8,mi),[[ye,$.claudeAccountId]])]),e("div",null,[f[12]||(f[12]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-gem text-xs text-white"})]),e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," Gemini 专属账号 ")],-1)),T(e("select",{"onUpdate:modelValue":f[2]||(f[2]=n=>$.geminiAccountId=n),class:"form-select w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",disabled:R.value||!P.value},[f[11]||(f[11]=e("option",{value:""},"使用共享池",-1)),(l(!0),o(N,null,Y(_.value,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name)+" (专属) - "+g(d(n)),9,vi))),128))],8,bi),[[ye,$.geminiAccountId]])]),e("div",null,[f[14]||(f[14]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded bg-green-500"},[e("i",{class:"fas fa-brain text-xs text-white"})]),e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," OpenAI 专属账号 ")],-1)),T(e("select",{"onUpdate:modelValue":f[3]||(f[3]=n=>$.openaiAccountId=n),class:"form-select w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",disabled:R.value||!p.value},[f[13]||(f[13]=e("option",{value:""},"使用共享池",-1)),(l(!0),o(N,null,Y(W.value,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name)+" (专属) - "+g(d(n)),9,wi))),128))],8,ki),[[ye,$.openaiAccountId]])]),e("div",null,[f[16]||(f[16]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded bg-amber-500"},[e("i",{class:"fas fa-aws text-xs text-white"})]),e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," Bedrock 专属账号 ")],-1)),T(e("select",{"onUpdate:modelValue":f[4]||(f[4]=n=>$.bedrockAccountId=n),class:"form-select w-full text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",disabled:R.value||!a.value},[f[15]||(f[15]=e("option",{value:""},"使用共享池",-1)),(l(!0),o(N,null,Y(j.value,n=>(l(),o("option",{key:n.id,value:n.id},g(n.name)+" (专属) - "+g(d(n)),9,$i))),128))],8,hi),[[ye,$.bedrockAccountId]])]),f[17]||(f[17]=e("div",{class:"rounded-lg bg-blue-50 p-3 dark:bg-blue-900/20"},[e("div",{class:"flex items-start gap-2"},[e("i",{class:"fas fa-info-circle mt-0.5 text-sm text-blue-500"}),e("div",{class:"text-xs text-blue-700 dark:text-blue-300"},[e("p",{class:"font-medium"},"绑定说明："),e("ul",{class:"mt-1 space-y-0.5"},[e("li",null,"• 绑定专属账号后，该API Key的请求将只使用指定账号"),e("li",null,'• 选择"使用共享池"则使用系统的共享账号池'),e("li",null,'• 只有"专属"类型的账号才会显示在选项中')])])])],-1)),e("div",Ai,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:f[5]||(f[5]=n=>y.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:R.value,type:"submit"},[R.value?(l(),o("div",Ii)):(l(),o("i",Ki)),L(" "+g(R.value?"保存中...":"保存绑定"),1)],8,Ci)])],32)])])):v("",!0)])}}},Di=fe(Li,[["__scopeId","data-v-23fe584d"]]),_i={class:"tab-content"},Ti={class:"card p-4 sm:p-6"},Mi={class:"mb-4 flex flex-col gap-4 sm:mb-6"},Si={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ji={class:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center sm:gap-3"},Vi={class:"group relative min-w-[140px]"},Ri={class:"group relative min-w-[140px]"},Pi={class:"relative"},Ei={key:0,class:"absolute -right-2 -top-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-purple-500 text-xs text-white shadow-sm"},Ui={class:"group relative min-w-[200px]"},Oi={class:"relative flex items-center"},Gi=["disabled"],qi={class:"relative"},Bi={class:"relative"},Wi={key:0,class:"py-12 text-center"},Fi={key:1,class:"py-12 text-center"},zi={key:2,class:"table-container hidden md:block"},Hi={class:"w-full table-fixed"},Ni={class:"bg-gray-50/80 backdrop-blur-sm dark:bg-gray-700/80"},Yi={class:"w-[50px] px-3 py-4 text-left"},Qi={class:"flex items-center"},Ji=["indeterminate"],Xi={key:1,class:"fas fa-sort ml-1 text-gray-400"},Zi={key:1,class:"fas fa-sort ml-1 text-gray-400"},ed={class:"w-[17%] min-w-[140px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"},td={key:1,class:"fas fa-sort ml-1 text-gray-400"},sd={key:1,class:"fas fa-sort ml-1 text-gray-400"},ad={key:1,class:"fas fa-sort ml-1 text-gray-400"},ld={class:"divide-y divide-gray-200/50 dark:divide-gray-600/50"},rd={class:"table-row"},od={class:"px-3 py-4"},nd={class:"flex items-center"},id=["value"],dd={class:"px-3 py-4"},ud={class:"flex items-center"},cd={class:"min-w-0"},gd=["title"],md=["title"],xd={class:"mt-1.5 space-y-1"},pd={key:0,class:"flex items-center gap-1 text-xs"},yd={class:"truncate text-gray-600 dark:text-gray-400"},fd={key:1,class:"flex items-center gap-1 text-xs"},bd={class:"truncate text-gray-600 dark:text-gray-400"},vd={key:2,class:"flex items-center gap-1 text-xs"},kd={class:"truncate text-gray-600 dark:text-gray-400"},wd={key:3,class:"flex items-center gap-1 text-xs"},hd={class:"truncate text-gray-600"},$d={key:4,class:"text-xs text-gray-500"},Ad={class:"px-3 py-4"},Cd={class:"flex flex-wrap gap-1"},Id={key:0,class:"text-xs text-gray-400"},Kd={class:"whitespace-nowrap px-3 py-4"},Ld={class:"px-3 py-4"},Dd={class:"space-y-2"},_d={class:"mb-2"},Td={class:"mb-1 flex items-center justify-between text-sm"},Md={class:"font-semibold text-gray-900 dark:text-gray-100"},Sd={class:"flex items-center justify-between text-sm"},jd={class:"font-semibold text-green-600"},Vd={class:"flex items-center justify-between text-sm"},Rd={class:"font-medium text-gray-700 dark:text-gray-300"},Pd={key:0,class:"space-y-2"},Ed={class:"rounded-lg border border-green-200 bg-green-50 p-2 dark:border-green-700 dark:bg-green-900/20"},Ud={class:"mb-1 flex items-center justify-between"},Od={class:"relative"},Gd={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-600"},qd={class:"absolute inset-0 flex items-center justify-center"},Bd={class:"text-xs font-medium text-white drop-shadow-sm"},Wd={key:0,class:"mt-1 flex items-center gap-1"},Fd={class:"pt-1"},zd=["onClick"],Hd={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},Nd={class:"whitespace-nowrap px-3 py-4 text-sm"},Yd={class:"inline-flex items-center gap-1.5"},Qd={key:0},Jd={key:0,class:"inline-flex items-center text-red-600"},Xd={key:1,class:"inline-flex items-center text-orange-600"},Zd={key:2,class:"text-gray-600"},e0={key:1,class:"inline-flex items-center text-gray-400"},t0=["onClick"],s0={class:"whitespace-nowrap px-3 py-4 text-sm"},a0={class:"flex gap-1"},l0=["onClick"],r0=["onClick"],o0=["onClick"],n0=["onClick"],i0=["onClick"],d0=["title","onClick"],u0={class:"ml-1 hidden xl:inline"},c0=["onClick"],g0={key:0},m0={class:"bg-gray-50 px-3 py-4 dark:bg-gray-700",colspan:"8"},x0={key:0,class:"py-4 text-center"},p0={class:"space-y-4"},y0={class:"mb-4 flex items-center justify-between"},f0={class:"flex items-center gap-2"},b0={key:0,class:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-500 dark:bg-gray-700 dark:text-gray-400"},v0={class:"flex items-center gap-1"},k0={class:"flex gap-1 rounded bg-gray-100 p-1 dark:bg-gray-700"},w0=["onClick"],h0={key:0,class:"py-8 text-center"},$0={class:"mb-3 flex items-center justify-center gap-2"},A0=["onClick"],C0={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},I0={class:"mb-3 flex items-start justify-between"},K0={class:"flex-1"},L0={class:"mb-1 block text-sm font-semibold text-gray-800 dark:text-gray-200"},D0={class:"rounded-full bg-blue-50 px-2 py-1 text-xs text-gray-500 dark:bg-blue-900/30 dark:text-gray-400"},_0={class:"mb-3 space-y-2"},T0={class:"flex items-center justify-between text-sm"},M0={class:"font-semibold text-gray-900 dark:text-gray-100"},S0={class:"flex items-center justify-between text-sm"},j0={class:"font-semibold text-green-600"},V0={class:"mt-2 border-t border-gray-100 pt-2 dark:border-gray-600"},R0={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},P0={class:"font-medium"},E0={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},U0={class:"font-medium"},O0={key:0,class:"flex items-center justify-between text-xs text-purple-600"},G0={class:"font-medium"},q0={key:1,class:"flex items-center justify-between text-xs text-purple-600"},B0={class:"font-medium"},W0={class:"mt-3 h-2 w-full rounded-full bg-gray-200"},F0={class:"mt-1 text-right"},z0={class:"text-xs font-medium text-indigo-600"},H0={key:2,class:"mt-4 rounded-lg border border-indigo-100 bg-gradient-to-r from-indigo-50 to-purple-50 p-3 dark:border-indigo-700 dark:from-indigo-900/20 dark:to-purple-900/20"},N0={class:"flex items-center justify-between text-sm"},Y0={class:"flex gap-4 text-xs"},Q0={class:"text-gray-600 dark:text-gray-400"},J0={class:"font-semibold text-gray-800 dark:text-gray-200"},X0={class:"text-gray-600 dark:text-gray-400"},Z0={class:"font-semibold text-gray-800 dark:text-gray-200"},eu={key:3,class:"space-y-3 md:hidden"},tu={class:"mb-3 flex items-start justify-between"},su={class:"flex items-center gap-3"},au=["value"],lu={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},ru={class:"mt-0.5 text-xs text-gray-500 dark:text-gray-400"},ou={class:"mb-3 space-y-1.5"},nu={key:0,class:"flex flex-wrap items-center gap-1 text-xs"},iu={class:"text-gray-600"},du={key:1,class:"flex flex-wrap items-center gap-1 text-xs"},uu={class:"text-gray-600"},cu={key:2,class:"flex flex-wrap items-center gap-1 text-xs"},gu={class:"text-gray-600"},mu={key:3,class:"flex flex-wrap items-center gap-1 text-xs"},xu={class:"text-gray-600"},pu={key:4,class:"text-xs text-gray-500"},yu={class:"mb-3 space-y-2"},fu={class:"rounded-lg bg-gray-50 p-3"},bu={class:"mb-2 flex items-center justify-between"},vu=["onClick"],ku={class:"grid grid-cols-2 gap-3"},wu={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},hu={class:"text-sm font-semibold text-green-600"},$u={class:"mt-2 flex items-center justify-between"},Au={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Cu={key:0,class:"space-y-2"},Iu={class:"rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-700 dark:bg-green-900/20"},Ku={class:"mb-2 flex items-center justify-between"},Lu={class:"relative"},Du={class:"h-2.5 w-full rounded-full bg-gray-200 dark:bg-gray-600"},_u={class:"absolute inset-0 flex items-center justify-center"},Tu={class:"text-xs font-medium text-white drop-shadow-sm"},Mu={key:0,class:"mt-2 flex items-start gap-1"},Su={class:"mb-3 text-xs text-gray-500"},ju={class:"mb-1 flex justify-between"},Vu={class:"flex items-center justify-between"},Ru={class:"flex items-center gap-1"},Pu=["onClick"],Eu={key:0,class:"mb-3 flex flex-wrap gap-1"},Uu={class:"mt-3 flex gap-2 border-t border-gray-100 pt-3"},Ou=["onClick"],Gu=["onClick"],qu=["onClick"],Bu=["onClick"],Wu=["onClick"],Fu=["onClick"],zu={key:4,class:"mt-4 flex flex-col items-center justify-between gap-4 sm:mt-6 sm:flex-row"},Hu={class:"flex w-full flex-col items-center gap-3 sm:w-auto sm:flex-row"},Nu={class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},Yu={class:"flex items-center gap-2"},Qu=["value"],Ju={class:"flex items-center gap-2"},Xu=["disabled"],Zu={class:"flex items-center gap-1"},ec={key:1,class:"hidden px-2 text-gray-500 dark:text-gray-400 sm:inline"},tc=["onClick"],sc={key:2,class:"hidden px-2 text-gray-500 dark:text-gray-400 sm:inline"},ac=["disabled"],lc={__name:"ApiKeysView",setup(C){const Q=qe(),m=K([]),S=K([]),R=K(!1),$=K(!1),D=K(!1),U=K("today"),_=K(""),W=K("asc"),j=K({}),A=K({}),P=K({}),p=K([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),a=K({claude:[],gemini:[],openai:[],bedrock:[],claudeGroups:[],geminiGroups:[],openaiGroups:[]}),d=K(null),M=K(null),I=K(!1),y=K(null),f=K(!1),c=K(null),n=K(""),h=K([]),re=K(""),de=K([{value:"today",label:"今日",icon:"fa-clock"},{value:"7days",label:"最近7天",icon:"fa-calendar-week"},{value:"monthly",label:"本月",icon:"fa-calendar"},{value:"all",label:"全部时间",icon:"fa-infinity"}]),O=F(()=>{const u=[{value:"",label:"所有标签",icon:"fa-asterisk"}];return h.value.forEach(t=>{u.push({value:t,label:t,icon:"fa-tag"})}),u}),r=F(()=>n.value?m.value.filter(u=>u.tags&&u.tags.includes(n.value)).length:0),x=K(1),w=K(10),X=[10,20,50,100],E=K(!1),i=K(!1),b=K(!1),Z=K(!1),J=K(!1),se=K(!1),be=K(null),ge=K(null),we=K(null),le=K([]),me=F(()=>{let u=m.value;if(n.value&&(u=m.value.filter(k=>k.tags&&k.tags.includes(n.value))),re.value){const k=re.value.toLowerCase().trim();u=u.filter(s=>s.name&&s.name.toLowerCase().includes(k))}return _.value?[...u].sort((k,s)=>{let B=k[_.value],H=s[_.value];return _.value==="status"?(B=k.isActive?1:0,H=s.isActive?1:0):_.value==="cost"?(B=parseFloat(Fe(k.usage).replace("$","")),H=parseFloat(Fe(s.usage).replace("$",""))):(_.value==="createdAt"||_.value==="expiresAt")&&(B=B?new Date(B).getTime():0,H=H?new Date(H).getTime():0),B<H?W.value==="asc"?-1:1:B>H?W.value==="asc"?1:-1:0}):u}),$e=F(()=>{const u=me.value.length;return Math.ceil(u/w.value)||0}),mt=F(()=>{const u=[],t=x.value,k=$e.value;if(k<=7)for(let s=1;s<=k;s++)u.push(s);else{let s=Math.max(1,t-2),B=Math.min(k,t+2);t<=3?B=5:t>=k-2&&(s=k-4);for(let H=s;H<=B;H++)u.push(H)}return u}),Ke=F(()=>{const u=(x.value-1)*w.value,t=u+w.value;return me.value.slice(u,t)}),_e=async()=>{var u,t;try{const[k,s,B,H,V,ne]=await Promise.all([z.get("/admin/claude-accounts"),z.get("/admin/claude-console-accounts"),z.get("/admin/gemini-accounts"),z.get("/admin/openai-accounts"),z.get("/admin/bedrock-accounts"),z.get("/admin/account-groups")]),Ce=[];if(k.success&&((u=k.data)==null||u.forEach(te=>{Ce.push({...te,platform:"claude-oauth",isDedicated:te.accountType==="dedicated"})})),s.success&&((t=s.data)==null||t.forEach(te=>{Ce.push({...te,platform:"claude-console",isDedicated:te.accountType==="dedicated"})})),a.value.claude=Ce,B.success&&(a.value.gemini=(B.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),H.success&&(a.value.openai=(H.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),V.success&&(a.value.bedrock=(V.data||[]).map(te=>({...te,isDedicated:te.accountType==="dedicated"}))),ne.success){const te=ne.data||[];a.value.claudeGroups=te.filter(Me=>Me.platform==="claude"),a.value.geminiGroups=te.filter(Me=>Me.platform==="gemini"),a.value.openaiGroups=te.filter(Me=>Me.platform==="openai")}}catch(k){console.error("加载账户列表失败:",k)}},xe=async()=>{D.value=!0;try{const u=await z.get(`/admin/api-keys?timeRange=${U.value}`);if(u.success){m.value=u.data||[];const t=new Set;m.value.forEach(k=>{k.tags&&Array.isArray(k.tags)&&k.tags.forEach(s=>t.add(s))}),h.value=Array.from(t).sort()}}catch{G("加载 API Keys 失败","error")}finally{D.value=!1}},Te=u=>{_.value===u?W.value=W.value==="asc"?"desc":"asc":(_.value=u,W.value="asc")},We=u=>!u&&u!==0?"0":u.toLocaleString("zh-CN"),Fe=u=>!u||!u.total?"$0.0000":`$${(u.total.cost||0).toFixed(4)}`,Re=u=>{if(!u)return"未知账户";if(u.startsWith("group:")){const H=u.substring(6),V=a.value.claudeGroups.find(te=>te.id===H);if(V)return`分组-${V.name}`;const ne=a.value.geminiGroups.find(te=>te.id===H);if(ne)return`分组-${ne.name}`;const Ce=a.value.openaiGroups.find(te=>te.id===H);return Ce?`分组-${Ce.name}`:`分组-${H.substring(0,8)}`}const t=a.value.claude.find(H=>H.id===u);if(t)return`${t.name}`;const k=a.value.gemini.find(H=>H.id===u);if(k)return`${k.name}`;const s=a.value.openai.find(H=>H.id===u);if(s)return`${s.name}`;const B=a.value.bedrock.find(H=>H.id===u);return B?`${B.name}`:`${u.substring(0,8)}`},ze=u=>{if(u.claudeAccountId){const t=Re(u.claudeAccountId);if(u.claudeAccountId.startsWith("group:"))return t;const k=a.value.claude.find(s=>s.id===u.claudeAccountId);return k?k.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}if(u.claudeConsoleAccountId){const t=a.value.claude.find(k=>k.id===u.claudeConsoleAccountId&&k.platform==="claude-console");return t?`Console-${t.name}`:"⚠️ Console账户不存在"}return""},He=u=>{if(u.geminiAccountId){const t=Re(u.geminiAccountId);if(u.geminiAccountId.startsWith("group:"))return t;const k=a.value.gemini.find(s=>s.id===u.geminiAccountId);return k?k.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},Ne=u=>{if(u.openaiAccountId){const t=Re(u.openaiAccountId);if(u.openaiAccountId.startsWith("group:"))return t;const k=a.value.openai.find(s=>s.id===u.openaiAccountId);return k?k.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},Ye=u=>{if(u.bedrockAccountId){const t=Re(u.bedrockAccountId);if(u.bedrockAccountId.startsWith("group:"))return t;const k=a.value.bedrock.find(s=>s.id===u.bedrockAccountId);return k?k.accountType==="dedicated"?`🔒 专属-${t}`:t:`⚠️ ${t} (账户不存在)`}return""},Pe=u=>u?new Date(u)<new Date:!1,Ee=u=>!u||Pe(u)?!1:(new Date(u)-new Date)/(1e3*60*60*24)<=7,Qe=u=>u?new Date(u).toLocaleDateString("zh-CN"):"",xt=async u=>{j.value[u]?j.value[u]=!1:(j.value[u]=!0,P.value[u]||Xe(u),await Ue(u,!0))},Ue=async(u,t=!1)=>{if(!t&&A.value[u]&&A.value[u].length>0)return;const k=Ae(u);try{let s=`/admin/api-keys/${u}/model-stats`;const B=new URLSearchParams;if(k.customStart&&k.customEnd)B.append("startDate",k.customStart),B.append("endDate",k.customEnd),B.append("period","custom");else{const V=k.preset==="today"||k.preset==="7days"?"daily":"monthly";B.append("period",V)}s+="?"+B.toString();const H=await z.get(s);H.success&&(A.value[u]=H.data||[])}catch{G("加载模型统计失败","error"),A.value[u]=[]}},Je=(u,t)=>{const k=t.reduce((s,B)=>s+(B.allTokens||0),0);return k===0?0:Math.round(u/k*100)},pt=u=>u.formatted&&u.formatted.total?u.formatted.total:u.cost!==void 0?`$${u.cost.toFixed(6)}`:"$0.000000",Xe=u=>{const t=new Date,k=new Date(t);k.setDate(t.getDate()-6),P.value[u]={type:"preset",preset:"7days",customStart:k.toISOString().split("T")[0],customEnd:t.toISOString().split("T")[0],customRange:null,presetOptions:[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}]}},Ae=u=>(P.value[u]||Xe(u),P.value[u]),Ze=(u,t)=>{const k=Ae(t);k.type="preset",k.preset=u;const s=k.presetOptions.find(B=>B.value===u);if(s){const B=new Date,H=new Date(B);H.setDate(B.getDate()-(s.days-1)),k.customStart=H.toISOString().split("T")[0],k.customEnd=B.toISOString().split("T")[0];const V=ne=>ne.getFullYear()+"-"+String(ne.getMonth()+1).padStart(2,"0")+"-"+String(ne.getDate()).padStart(2,"0")+" 00:00:00";k.customRange=[V(H),V(B)]}Ue(t,!0)},yt=(u,t)=>{const k=Ae(u);t&&t.length===2?(k.type="custom",k.preset="",k.customRange=t,k.customStart=t[0].split(" ")[0],k.customEnd=t[1].split(" ")[0],Ue(u,!0)):t===null&&Ze("7days",u)},ft=u=>u>new Date,bt=u=>{const t=Ae(u);t.type="preset",t.preset="7days";const k=new Date,s=new Date(k);s.setDate(k.getDate()-6),t.customStart=s.toISOString().split("T")[0],t.customEnd=k.toISOString().split("T")[0],t.customRange=null,Ue(u,!0),G("已重置筛选条件并刷新数据","info")},vt=async()=>{await _e(),E.value=!0},et=async u=>{await _e(),be.value=u,i.value=!0},tt=u=>{ge.value=u,b.value=!0},kt=u=>{E.value=!1,we.value=u,Z.value=!0,xe()},wt=u=>{E.value=!1,le.value=u,J.value=!0,xe()},ht=async()=>{if(S.value.length===0){G("请先选择要编辑的 API Keys","warning");return}await _e(),se.value=!0},$t=()=>{se.value=!1,S.value=[],pe(),xe()},At=()=>{i.value=!1,G("API Key 更新成功","success"),xe()},Ct=()=>{b.value=!1,G("API Key 续期成功","success"),xe()},st=async u=>{let t=!0;if(u.isActive&&(window.showConfirm?t=await window.showConfirm("禁用 API Key",`确定要禁用 API Key "${u.name}" 吗？禁用后所有使用此 Key 的请求将返回 401 错误。`,"确定禁用","取消"):t=confirm(`确定要禁用 API Key "${u.name}" 吗？禁用后所有使用此 Key 的请求将返回 401 错误。`)),!!t)try{const k=await z.put(`/admin/api-keys/${u.id}`,{isActive:!u.isActive});if(k.success){G(`API Key 已${u.isActive?"禁用":"激活"}`,"success");const s=m.value.find(B=>B.id===u.id);s&&(s.isActive=!u.isActive)}else G(k.message||"操作失败","error")}catch{G("操作失败","error")}},at=async u=>{let t=!1;if(window.showConfirm?t=await window.showConfirm("删除 API Key","确定要删除这个 API Key 吗？此操作不可恢复。","确定删除","取消"):t=confirm("确定要删除这个 API Key 吗？此操作不可恢复。"),!!t)try{const k=await z.delete(`/admin/api-keys/${u}`);if(k.success){G("API Key 已删除","success");const s=S.value.indexOf(u);s>-1&&S.value.splice(s,1),pe(),xe()}else G(k.message||"删除失败","error")}catch{G("删除失败","error")}},It=async()=>{const u=S.value.length;if(u===0){G("请先选择要删除的 API Keys","warning");return}let t=!1;const k=`确定要删除选中的 ${u} 个 API Key 吗？此操作不可恢复。`;if(window.showConfirm?t=await window.showConfirm("批量删除 API Keys",k,"确定删除","取消"):t=confirm(k),!t)return;const s=[...S.value];try{const B=await z.delete("/admin/api-keys/batch",{data:{keyIds:s}});if(B.success){const{successCount:H,failedCount:V,errors:ne}=B.data;if(H>0){if(G(`成功删除 ${H} 个 API Keys`,"success"),V>0){const Ce=ne.map(te=>`${te.keyId}: ${te.error}`).join(`
`);G(`${V} 个删除失败:
${Ce}`,"warning")}}else G("所有 API Keys 删除失败","error");S.value=[],pe(),xe()}else G(B.message||"批量删除失败","error")}catch(B){G("批量删除失败","error"),console.error("批量删除 API Keys 失败:",B)}},Kt=()=>{if(R.value)Ke.value.forEach(u=>{S.value.includes(u.id)||S.value.push(u.id)});else{const u=new Set(Ke.value.map(t=>t.id));S.value=S.value.filter(t=>!u.has(t))}pe()},pe=()=>{const u=Ke.value.length,t=Ke.value.filter(k=>S.value.includes(k.id)).length;t===0?(R.value=!1,$.value=!1):t===u?(R.value=!0,$.value=!1):(R.value=!1,$.value=!0)},Lt=u=>{const k=`${window.location.origin}/admin-next/api-stats?apiId=${u.id}`,s=document.createElement("textarea");s.value=k,s.style.position="fixed",s.style.opacity="0",s.style.left="-9999px",document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999);try{document.execCommand("copy")?G("已复制统计页面链接","success"):(G("复制失败，请手动复制","error"),console.log("统计页面链接:",k))}catch(B){G("复制失败，请手动复制","error"),console.error("复制错误:",B),console.log("统计页面链接:",k)}finally{document.body.removeChild(s)}},lt=u=>{d.value=u},rt=()=>{d.value=null},Dt=async({keyId:u,expiresAt:t})=>{try{const k=await z.put(`/admin/api-keys/${u}`,{expiresAt:t||null});if(k.success){G("过期时间已更新","success");const s=m.value.find(B=>B.id===u);s&&(s.expiresAt=t||null),rt()}else G(k.message||"更新失败","error"),M.value&&M.value.resetSaving()}catch{G("更新失败","error"),M.value&&M.value.resetSaving()}},ot=u=>u?new Date(u).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"):"",ue=u=>{if(!u.dailyCostLimit||u.dailyCostLimit===0)return 0;const t=(u.dailyCost||0)/u.dailyCostLimit*100;return Math.min(t,100)},nt=u=>{const t=ue(u);return t>=100?"bg-gradient-to-r from-red-500 to-red-600":t>=90?"bg-gradient-to-r from-red-400 to-red-500":t>=80?"bg-gradient-to-r from-yellow-400 to-orange-500":t>=60?"bg-gradient-to-r from-yellow-400 to-yellow-500":"bg-gradient-to-r from-green-400 to-green-500"},it=u=>{const t=ue(u);return t>=100?"text-red-600 dark:text-red-400":t>=80?"text-yellow-600 dark:text-yellow-400":"text-gray-700 dark:text-gray-300"},Oe=u=>{y.value=u,I.value=!0},dt=async u=>{await _e(),c.value=u,f.value=!0},_t=()=>{f.value=!1,G("账户绑定更新成功","success"),xe()},Le=u=>u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toString(),ut=u=>{if(!u)return"从未使用";const t=new Date(u),s=new Date-t;return s<6e4?"刚刚":s<36e5?`${Math.floor(s/6e4)} 分钟前`:s<864e5?`${Math.floor(s/36e5)} 小时前`:s<6048e5?`${Math.floor(s/864e5)} 天前`:t.toLocaleDateString("zh-CN")},Tt=()=>{re.value="",x.value=1};return he([n,U],()=>{x.value=1,S.value=[],pe()}),he(re,()=>{x.value=1,pe()}),he([x,w],()=>{pe()}),he(m,()=>{const u=new Set(m.value.map(t=>t.id));S.value=S.value.filter(t=>u.has(t)),pe()}),Ve(async()=>{await Promise.all([Q.loadSupportedClients(),_e(),xe()]),pe()}),(u,t)=>{const k=Mt;return l(),o("div",_i,[e("div",Ti,[e("div",Mi,[t[43]||(t[43]=e("div",null,[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," API Keys 管理 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"}," 管理和监控您的 API 密钥 ")],-1)),e("div",Si,[e("div",ji,[e("div",Vi,[t[31]||(t[31]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),ie(ct,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=s=>U.value=s),icon:"fa-calendar-alt","icon-color":"text-blue-500",options:de.value,placeholder:"选择时间范围",onChange:t[1]||(t[1]=s=>xe())},null,8,["modelValue","options"])]),e("div",Ri,[t[32]||(t[32]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("div",Pi,[ie(ct,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=s=>n.value=s),icon:"fa-tags","icon-color":"text-purple-500",options:O.value,placeholder:"所有标签",onChange:t[3]||(t[3]=s=>x.value=1)},null,8,["modelValue","options"]),n.value?(l(),o("span",Ei,g(r.value),1)):v("",!0)])]),e("div",Ui,[t[35]||(t[35]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-cyan-500 to-teal-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("div",Oi,[T(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>re.value=s),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 pl-9 text-sm text-gray-700 placeholder-gray-400 shadow-sm transition-all duration-200 hover:border-gray-300 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 dark:placeholder-gray-500 dark:hover:border-gray-500",placeholder:"搜索名称...",type:"text",onInput:t[5]||(t[5]=s=>x.value=1)},null,544),[[ee,re.value]]),t[34]||(t[34]=e("i",{class:"fas fa-search absolute left-3 text-sm text-cyan-500"},null,-1)),re.value?(l(),o("button",{key:0,class:"absolute right-2 flex h-5 w-5 items-center justify-center rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:Tt},[...t[33]||(t[33]=[e("i",{class:"fas fa-times text-xs"},null,-1)])])):v("",!0)])]),e("button",{class:"group relative flex items-center justify-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition-all duration-200 hover:border-gray-300 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 dark:hover:border-gray-500 sm:w-auto",disabled:D.value,onClick:t[6]||(t[6]=s=>xe())},[t[36]||(t[36]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-green-500 to-teal-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),e("i",{class:q(["fas relative text-green-500",D.value?"fa-spinner fa-spin":"fa-sync-alt"])},null,2),t[37]||(t[37]=e("span",{class:"relative"},"刷新",-1))],8,Gi),S.value.length>0?(l(),o("button",{key:0,class:"group relative flex items-center justify-center gap-2 rounded-lg border border-blue-200 bg-blue-50 px-4 py-2 text-sm font-medium text-blue-700 shadow-sm transition-all duration-200 hover:border-blue-300 hover:bg-blue-100 hover:shadow-md sm:w-auto",onClick:t[7]||(t[7]=s=>ht())},[t[38]||(t[38]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),t[39]||(t[39]=e("i",{class:"fas fa-edit relative text-blue-600"},null,-1)),e("span",qi,"编辑选中 ("+g(S.value.length)+")",1)])):v("",!0),S.value.length>0?(l(),o("button",{key:1,class:"group relative flex items-center justify-center gap-2 rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-sm font-medium text-red-700 shadow-sm transition-all duration-200 hover:border-red-300 hover:bg-red-100 hover:shadow-md sm:w-auto",onClick:t[8]||(t[8]=s=>It())},[t[40]||(t[40]=e("div",{class:"absolute -inset-0.5 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 opacity-0 blur transition duration-300 group-hover:opacity-20"},null,-1)),t[41]||(t[41]=e("i",{class:"fas fa-trash relative text-red-600"},null,-1)),e("span",Bi,"删除选中 ("+g(S.value.length)+")",1)])):v("",!0)]),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 px-5 py-2.5 text-sm font-medium text-white shadow-md transition-all duration-200 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg sm:w-auto",onClick:ce(vt,["stop"])},[...t[42]||(t[42]=[e("i",{class:"fas fa-plus"},null,-1),e("span",null,"创建新 Key",-1)])])])]),D.value?(l(),o("div",Wi,[...t[44]||(t[44]=[e("div",{class:"loading-spinner mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500"},"正在加载 API Keys...",-1)])])):m.value.length===0?(l(),o("div",Fi,[...t[45]||(t[45]=[e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100"},[e("i",{class:"fas fa-key text-xl text-gray-400"})],-1),e("p",{class:"text-lg text-gray-500"},"暂无 API Keys",-1),e("p",{class:"mt-2 text-sm text-gray-400"},"点击上方按钮创建您的第一个 API Key",-1)])])):(l(),o("div",zi,[e("table",Hi,[e("thead",Ni,[e("tr",null,[e("th",Yi,[e("div",Qi,[T(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>R.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",indeterminate:$.value,type:"checkbox",onChange:Kt},null,40,Ji),[[ve,R.value]])])]),e("th",{class:"w-[25%] min-w-[200px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[10]||(t[10]=s=>Te("name"))},[t[46]||(t[46]=L(" 名称 ",-1)),_.value==="name"?(l(),o("i",{key:0,class:q(["fas",W.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),o("i",Xi))]),t[53]||(t[53]=e("th",{class:"w-[10%] min-w-[80px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 标签 ",-1)),e("th",{class:"w-[8%] min-w-[70px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[11]||(t[11]=s=>Te("status"))},[t[47]||(t[47]=L(" 状态 ",-1)),_.value==="status"?(l(),o("i",{key:0,class:q(["fas",W.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),o("i",Zi))]),e("th",ed,[t[50]||(t[50]=L(" 使用统计 ",-1)),e("span",{class:"cursor-pointer rounded px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-600",onClick:t[12]||(t[12]=s=>Te("cost"))},[t[48]||(t[48]=L(" (费用 ",-1)),_.value==="cost"?(l(),o("i",{key:0,class:q(["fas",W.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),o("i",td)),t[49]||(t[49]=L(") ",-1))])]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[13]||(t[13]=s=>Te("createdAt"))},[t[51]||(t[51]=L(" 创建时间 ",-1)),_.value==="createdAt"?(l(),o("i",{key:0,class:q(["fas",W.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),o("i",sd))]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600",onClick:t[14]||(t[14]=s=>Te("expiresAt"))},[t[52]||(t[52]=L(" 过期时间 ",-1)),_.value==="expiresAt"?(l(),o("i",{key:0,class:q(["fas",W.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(l(),o("i",ad))]),t[54]||(t[54]=e("th",{class:"w-[20%] min-w-[180px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 操作 ",-1))])]),e("tbody",ld,[(l(!0),o(N,null,Y(Ke.value,s=>{var B,H;return l(),o(N,{key:s.id},[e("tr",rd,[e("td",od,[e("div",nd,[T(e("input",{"onUpdate:modelValue":t[15]||(t[15]=V=>S.value=V),class:"mr-3 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox",value:s.id,onChange:pe},null,40,id),[[ve,S.value]])])]),e("td",dd,[e("div",ud,[t[60]||(t[60]=e("div",{class:"mr-2 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-xs text-white"})],-1)),e("div",cd,[e("div",{class:"truncate text-sm font-semibold text-gray-900 dark:text-gray-100",title:s.name},g(s.name),9,gd),e("div",{class:"truncate text-xs text-gray-500 dark:text-gray-400",title:s.id},g(s.id),9,md),e("div",xd,[s.claudeAccountId||s.claudeConsoleAccountId?(l(),o("div",pd,[t[55]||(t[55]=e("span",{class:"inline-flex items-center rounded bg-indigo-100 px-1.5 py-0.5 text-indigo-700"},[e("i",{class:"fas fa-brain mr-1 text-[10px]"}),L(" Claude ")],-1)),e("span",yd,g(ze(s)),1)])):v("",!0),s.geminiAccountId?(l(),o("div",fd,[t[56]||(t[56]=e("span",{class:"inline-flex items-center rounded bg-yellow-100 px-1.5 py-0.5 text-yellow-700"},[e("i",{class:"fas fa-robot mr-1 text-[10px]"}),L(" Gemini ")],-1)),e("span",bd,g(He(s)),1)])):v("",!0),s.openaiAccountId?(l(),o("div",vd,[t[57]||(t[57]=e("span",{class:"inline-flex items-center rounded bg-gray-100 px-1.5 py-0.5 text-gray-700"},[e("i",{class:"fa-openai mr-1 text-[10px]"}),L(" OpenAI ")],-1)),e("span",kd,g(Ne(s)),1)])):v("",!0),s.bedrockAccountId?(l(),o("div",wd,[t[58]||(t[58]=e("span",{class:"inline-flex items-center rounded bg-orange-100 px-1.5 py-0.5 text-orange-700"},[e("i",{class:"fas fa-cloud mr-1 text-[10px]"}),L(" Bedrock ")],-1)),e("span",hd,g(Ye(s)),1)])):v("",!0),!s.claudeAccountId&&!s.claudeConsoleAccountId&&!s.geminiAccountId&&!s.openaiAccountId&&!s.bedrockAccountId?(l(),o("div",$d,[...t[59]||(t[59]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),L(" 使用共享池 ",-1)])])):v("",!0)])])])]),e("td",Ad,[e("div",Cd,[(l(!0),o(N,null,Y(s.tags||[],V=>(l(),o("span",{key:V,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},g(V),1))),128)),!s.tags||s.tags.length===0?(l(),o("span",Id,"无标签")):v("",!0)])]),e("td",Kd,[e("span",{class:q(["inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:q(["mr-2 h-2 w-2 rounded-full",s.isActive?"bg-green-500":"bg-red-500"])},null,2),L(" "+g(s.isActive?"活跃":"禁用"),1)],2)]),e("td",Ld,[e("div",Dd,[e("div",_d,[e("div",Td,[t[61]||(t[61]=e("span",{class:"text-gray-600 dark:text-gray-400"},"今日请求",-1)),e("span",Md,g(We(((H=(B=s.usage)==null?void 0:B.daily)==null?void 0:H.requests)||0))+"次",1)]),e("div",Sd,[t[62]||(t[62]=e("span",{class:"text-gray-600 dark:text-gray-400"},"今日费用",-1)),e("span",jd,"$"+g((s.dailyCost||0).toFixed(4)),1)]),e("div",Vd,[t[63]||(t[63]=e("span",{class:"text-gray-600 dark:text-gray-400"},"最后使用",-1)),e("span",Rd,g(ut(s.lastUsedAt)),1)])]),s.dailyCostLimit>0?(l(),o("div",Pd,[e("div",Ed,[e("div",Ud,[t[64]||(t[64]=e("div",{class:"flex items-center gap-1"},[e("i",{class:"fas fa-dollar-sign text-xs text-green-600 dark:text-green-400"}),e("span",{class:"text-xs font-medium text-green-700 dark:text-green-300"},"费用限额")],-1)),e("span",{class:q(["text-xs font-semibold",it(s)])}," $"+g((s.dailyCost||0).toFixed(2))+" / $"+g(s.dailyCostLimit.toFixed(2)),3)]),e("div",Od,[e("div",Gd,[e("div",{class:q(["h-2 rounded-full transition-all duration-300 ease-in-out",nt(s)]),style:Se({width:ue(s)+"%"})},null,6)]),e("div",qd,[e("span",Bd,g(Math.round(ue(s)))+"% ",1)])]),ue(s)>=80?(l(),o("div",Wd,[e("i",{class:q(["fas fa-exclamation-triangle text-xs",ue(s)>=100?"text-red-500":"text-yellow-500"])},null,2),e("span",{class:q(["text-xs",ue(s)>=100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},g(ue(s)>=100?"已超过限额":"接近限额"),3)])):v("",!0)])])):v("",!0),s.rateLimitWindow>0?(l(),oe(Ge,{key:1,"current-requests":s.currentWindowRequests,"current-tokens":s.currentWindowTokens,"rate-limit-window":s.rateLimitWindow,"request-limit":s.rateLimitRequests,"show-progress":!0,"show-tooltip":!1,"token-limit":s.tokenLimit,"window-end-time":s.windowEndTime,"window-remaining-seconds":s.windowRemainingSeconds,"window-start-time":s.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])):v("",!0),e("div",Fd,[e("button",{class:"flex w-full items-center justify-center gap-1 rounded py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:hover:bg-blue-900/20 dark:hover:text-blue-400",onClick:V=>Oe(s)},[...t[65]||(t[65]=[e("i",{class:"fas fa-chart-line"},null,-1),L(" 查看详细统计 ",-1)])],8,zd)])])]),e("td",Hd,g(new Date(s.createdAt).toLocaleDateString()),1),e("td",Nd,[e("div",Yd,[s.expiresAt?(l(),o("span",Qd,[Pe(s.expiresAt)?(l(),o("span",Jd,[...t[66]||(t[66]=[e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),L(" 已过期 ",-1)])])):Ee(s.expiresAt)?(l(),o("span",Xd,[t[67]||(t[67]=e("i",{class:"fas fa-clock mr-1"},null,-1)),L(" "+g(Qe(s.expiresAt)),1)])):(l(),o("span",Zd,g(Qe(s.expiresAt)),1))])):(l(),o("span",e0,[...t[68]||(t[68]=[e("i",{class:"fas fa-infinity mr-1"},null,-1),L(" 永不过期 ",-1)])])),e("button",{class:"inline-flex h-6 w-6 items-center justify-center rounded-md text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:ce(V=>lt(s),["stop"])},[...t[69]||(t[69]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])],8,t0)])]),e("td",s0,[e("div",a0,[s&&s.id?(l(),o("button",{key:0,class:"rounded px-2 py-1 text-xs font-medium text-indigo-600 transition-colors hover:bg-indigo-50 hover:text-indigo-900",title:"模型使用分布",onClick:V=>xt(s.id)},[e("i",{class:q(["fas",j.value[s.id]?"fa-chevron-up":"fa-chevron-down"])},null,2),t[70]||(t[70]=e("span",{class:"ml-1 hidden xl:inline"},"模型",-1))],8,l0)):v("",!0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-purple-600 transition-colors hover:bg-purple-50 hover:text-purple-900",title:"复制统计页面链接",onClick:V=>Lt(s)},[...t[71]||(t[71]=[e("i",{class:"fas fa-chart-bar"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"统计",-1)])],8,r0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-cyan-600 transition-colors hover:bg-cyan-50 hover:text-cyan-900",title:"快速绑定",onClick:V=>dt(s)},[...t[72]||(t[72]=[e("i",{class:"fas fa-link"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"绑定",-1)])],8,o0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-900",title:"编辑",onClick:V=>et(s)},[...t[73]||(t[73]=[e("i",{class:"fas fa-edit"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"编辑",-1)])],8,n0),s.expiresAt&&(Pe(s.expiresAt)||Ee(s.expiresAt))?(l(),o("button",{key:1,class:"rounded px-2 py-1 text-xs font-medium text-green-600 transition-colors hover:bg-green-50 hover:text-green-900",title:"续期",onClick:V=>tt(s)},[...t[74]||(t[74]=[e("i",{class:"fas fa-clock"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"续期",-1)])],8,i0)):v("",!0),e("button",{class:q([s.isActive?"text-orange-600 hover:bg-orange-50 hover:text-orange-900":"text-green-600 hover:bg-green-50 hover:text-green-900","rounded px-2 py-1 text-xs font-medium transition-colors"]),title:s.isActive?"禁用":"激活",onClick:V=>st(s)},[e("i",{class:q(["fas",s.isActive?"fa-ban":"fa-check-circle"])},null,2),e("span",u0,g(s.isActive?"禁用":"激活"),1)],10,d0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",title:"删除",onClick:V=>at(s.id)},[...t[75]||(t[75]=[e("i",{class:"fas fa-trash"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"删除",-1)])],8,c0)])])]),s&&s.id&&j.value[s.id]?(l(),o("tr",g0,[e("td",m0,[A.value[s.id]?v("",!0):(l(),o("div",x0,[...t[76]||(t[76]=[e("div",{class:"loading-spinner mx-auto"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500"},"加载模型统计...",-1)])])),e("div",p0,[e("div",y0,[t[77]||(t[77]=e("h5",{class:"flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),L(" 模型使用分布 ")],-1)),e("div",f0,[A.value[s.id]&&A.value[s.id].length>0?(l(),o("span",b0,g(A.value[s.id].length)+" 个模型 ",1)):v("",!0),e("div",v0,[e("div",k0,[(l(!0),o(N,null,Y(Ae(s.id).presetOptions,V=>(l(),o("button",{key:V.value,class:q(["rounded px-2 py-1 text-xs font-medium transition-colors",Ae(s.id).preset===V.value&&Ae(s.id).type==="preset"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200"]),onClick:ne=>Ze(V.value,s.id)},g(V.label),11,w0))),128))]),ie(k,{class:"api-key-date-picker",clearable:!0,"default-time":p.value,"disabled-date":ft,"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","model-value":Ae(s.id).customRange,"range-separator":"至",size:"small","start-placeholder":"开始日期",style:{width:"280px"},type:"datetimerange","unlink-panels":!1,"value-format":"YYYY-MM-DD HH:mm:ss","onUpdate:modelValue":V=>yt(s.id,V)},null,8,["default-time","model-value","onUpdate:modelValue"])])])]),A.value[s.id]&&A.value[s.id].length===0?(l(),o("div",h0,[e("div",$0,[t[79]||(t[79]=e("i",{class:"fas fa-chart-line text-lg text-gray-400"},null,-1)),t[80]||(t[80]=e("p",{class:"text-sm text-gray-500"},"暂无模型使用数据",-1)),e("button",{class:"ml-2 flex items-center gap-1 text-sm text-blue-500 transition-colors hover:text-blue-700",title:"重置筛选条件并刷新",onClick:V=>bt(s.id)},[...t[78]||(t[78]=[e("i",{class:"fas fa-sync-alt text-xs"},null,-1),e("span",{class:"text-xs"},"刷新",-1)])],8,A0)]),t[81]||(t[81]=e("p",{class:"text-xs text-gray-400"},"尝试调整时间范围或点击刷新重新加载数据",-1))])):A.value[s.id]&&A.value[s.id].length>0?(l(),o("div",C0,[(l(!0),o(N,null,Y(A.value[s.id],V=>(l(),o("div",{key:V.model,class:"rounded-xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-4 transition-all duration-200 hover:border-indigo-300 hover:shadow-lg dark:border-gray-600 dark:from-gray-800 dark:to-gray-700 dark:hover:border-indigo-500"},[e("div",I0,[e("div",K0,[e("span",L0,g(V.model),1),e("span",D0,g(V.requests)+" 次请求",1)])]),e("div",_0,[e("div",T0,[t[82]||(t[82]=e("span",{class:"flex items-center text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-coins mr-1 text-xs text-yellow-500"}),L(" 总Token: ")],-1)),e("span",M0,g(Le(V.allTokens)),1)]),e("div",S0,[t[83]||(t[83]=e("span",{class:"flex items-center text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-dollar-sign mr-1 text-xs text-green-500"}),L(" 费用: ")],-1)),e("span",j0,g(pt(V)),1)]),e("div",V0,[e("div",R0,[t[84]||(t[84]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-1 text-green-500"}),L(" 输入: ")],-1)),e("span",P0,g(Le(V.inputTokens)),1)]),e("div",E0,[t[85]||(t[85]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-1 text-blue-500"}),L(" 输出: ")],-1)),e("span",U0,g(Le(V.outputTokens)),1)]),V.cacheCreateTokens>0?(l(),o("div",O0,[t[86]||(t[86]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-1"}),L(" 缓存创建: ")],-1)),e("span",G0,g(Le(V.cacheCreateTokens)),1)])):v("",!0),V.cacheReadTokens>0?(l(),o("div",q0,[t[87]||(t[87]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-1"}),L(" 缓存读取: ")],-1)),e("span",B0,g(Le(V.cacheReadTokens)),1)])):v("",!0)])]),e("div",W0,[e("div",{class:"h-2 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-500",style:Se({width:Je(V.allTokens,A.value[s.id])+"%"})},null,4)]),e("div",F0,[e("span",z0,g(Je(V.allTokens,A.value[s.id]))+"% ",1)])]))),128))])):v("",!0),A.value[s.id]&&A.value[s.id].length>0?(l(),o("div",H0,[e("div",N0,[t[90]||(t[90]=e("span",{class:"flex items-center font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-calculator mr-2 text-indigo-500"}),L(" 总计统计 ")],-1)),e("div",Y0,[e("span",Q0,[t[88]||(t[88]=L(" 总请求: ",-1)),e("span",J0,g(A.value[s.id].reduce((V,ne)=>V+ne.requests,0)),1)]),e("span",X0,[t[89]||(t[89]=L(" 总Token: ",-1)),e("span",Z0,g(Le(A.value[s.id].reduce((V,ne)=>V+ne.allTokens,0))),1)])])])])):v("",!0)])])])):v("",!0)],64)}),128))])])])),!D.value&&me.value.length>0?(l(),o("div",eu,[(l(!0),o(N,null,Y(Ke.value,s=>{var B,H;return l(),o("div",{key:s.id,class:"card p-4 transition-shadow hover:shadow-lg"},[e("div",tu,[e("div",su,[T(e("input",{"onUpdate:modelValue":t[16]||(t[16]=V=>S.value=V),class:"mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox",value:s.id,onChange:pe},null,40,au),[[ve,S.value]]),t[91]||(t[91]=e("div",{class:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-sm text-white"})],-1)),e("div",null,[e("h4",lu,g(s.name),1),e("p",ru,g(s.id),1)])]),e("span",{class:q(["inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold",s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:q(["mr-1.5 h-1.5 w-1.5 rounded-full",s.isActive?"bg-green-500":"bg-red-500"])},null,2),L(" "+g(s.isActive?"活跃":"已停用"),1)],2)]),e("div",ou,[s.claudeAccountId||s.claudeConsoleAccountId?(l(),o("div",nu,[t[92]||(t[92]=e("span",{class:"inline-flex items-center rounded bg-indigo-100 px-2 py-0.5 text-indigo-700"},[e("i",{class:"fas fa-brain mr-1"}),L(" Claude ")],-1)),e("span",iu,g(ze(s)),1)])):v("",!0),s.geminiAccountId?(l(),o("div",du,[t[93]||(t[93]=e("span",{class:"inline-flex items-center rounded bg-yellow-100 px-2 py-0.5 text-yellow-700"},[e("i",{class:"fas fa-robot mr-1"}),L(" Gemini ")],-1)),e("span",uu,g(He(s)),1)])):v("",!0),s.openaiAccountId?(l(),o("div",cu,[t[94]||(t[94]=e("span",{class:"inline-flex items-center rounded bg-gray-100 px-2 py-0.5 text-gray-700"},[e("i",{class:"fa-openai mr-1"}),L(" OpenAI ")],-1)),e("span",gu,g(Ne(s)),1)])):v("",!0),s.bedrockAccountId?(l(),o("div",mu,[t[95]||(t[95]=e("span",{class:"inline-flex items-center rounded bg-orange-100 px-2 py-0.5 text-orange-700"},[e("i",{class:"fas fa-cloud mr-1"}),L(" Bedrock ")],-1)),e("span",xu,g(Ye(s)),1)])):v("",!0),!s.claudeAccountId&&!s.claudeConsoleAccountId&&!s.geminiAccountId&&!s.openaiAccountId&&!s.bedrockAccountId?(l(),o("div",pu,[...t[96]||(t[96]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),L(" 使用共享池 ",-1)])])):v("",!0)]),e("div",yu,[e("div",fu,[e("div",bu,[t[98]||(t[98]=e("span",{class:"text-xs text-gray-600"},"今日使用",-1)),e("button",{class:"text-xs text-blue-600 hover:text-blue-800",onClick:V=>Oe(s)},[...t[97]||(t[97]=[e("i",{class:"fas fa-chart-line mr-1"},null,-1),L("详情 ",-1)])],8,vu)]),e("div",ku,[e("div",null,[e("p",wu,g(We(((H=(B=s.usage)==null?void 0:B.daily)==null?void 0:H.requests)||0))+" 次 ",1),t[99]||(t[99]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"请求",-1))]),e("div",null,[e("p",hu," $"+g((s.dailyCost||0).toFixed(4)),1),t[100]||(t[100]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"费用",-1))])]),e("div",$u,[t[101]||(t[101]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"最后使用",-1)),e("span",Au,g(ut(s.lastUsedAt)),1)])]),s.dailyCostLimit>0?(l(),o("div",Cu,[e("div",Iu,[e("div",Ku,[t[102]||(t[102]=e("div",{class:"flex items-center gap-1"},[e("i",{class:"fas fa-dollar-sign text-xs text-green-600 dark:text-green-400"}),e("span",{class:"text-xs font-medium text-green-700 dark:text-green-300"},"每日费用限额")],-1)),e("span",{class:q(["text-xs font-semibold",it(s)])}," $"+g((s.dailyCost||0).toFixed(2))+" / $"+g(s.dailyCostLimit.toFixed(2)),3)]),e("div",Lu,[e("div",Du,[e("div",{class:q(["h-2.5 rounded-full transition-all duration-300 ease-in-out",nt(s)]),style:Se({width:ue(s)+"%"})},null,6)]),e("div",_u,[e("span",Tu,g(Math.round(ue(s)))+"% ",1)])]),ue(s)>=80?(l(),o("div",Mu,[e("i",{class:q(["fas fa-exclamation-triangle mt-0.5 text-xs",ue(s)>=100?"text-red-500":"text-yellow-500"])},null,2),e("span",{class:q(["text-xs",ue(s)>=100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},g(ue(s)>=100?"已超过费用限额，新请求将被拒绝":"费用即将达到限额，请注意控制"),3)])):v("",!0)])])):v("",!0),s.rateLimitWindow>0&&(s.rateLimitRequests>0||s.tokenLimit>0)?(l(),oe(Ge,{key:1,"current-requests":s.currentWindowRequests,"current-tokens":s.currentWindowTokens,"rate-limit-window":s.rateLimitWindow,"request-limit":s.rateLimitRequests,"show-progress":!0,"show-tooltip":!1,"token-limit":s.tokenLimit,"window-end-time":s.windowEndTime,"window-remaining-seconds":s.windowRemainingSeconds,"window-start-time":s.windowStartTime},null,8,["current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])):v("",!0)]),e("div",Su,[e("div",ju,[t[103]||(t[103]=e("span",null,"创建时间",-1)),e("span",null,g(ot(s.createdAt)),1)]),e("div",Vu,[t[105]||(t[105]=e("span",null,"过期时间",-1)),e("div",Ru,[e("span",{class:q(Ee(s.expiresAt)?"font-semibold text-orange-600":"")},g(s.expiresAt?ot(s.expiresAt):"永不过期"),3),e("button",{class:"inline-flex h-5 w-5 items-center justify-center rounded text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:ce(V=>lt(s),["stop"])},[...t[104]||(t[104]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])],8,Pu)])])]),s.tags&&s.tags.length>0?(l(),o("div",Eu,[(l(!0),o(N,null,Y(s.tags,V=>(l(),o("span",{key:V,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},g(V),1))),128))])):v("",!0),e("div",Uu,[e("button",{class:"flex flex-1 items-center justify-center gap-1 rounded-lg bg-blue-50 px-3 py-2 text-xs text-blue-600 transition-colors hover:bg-blue-100",onClick:V=>Oe(s)},[...t[106]||(t[106]=[e("i",{class:"fas fa-chart-line"},null,-1),L(" 查看详情 ",-1)])],8,Ou),e("button",{class:"flex-1 rounded-lg bg-cyan-50 px-3 py-2 text-xs text-cyan-600 transition-colors hover:bg-cyan-100",onClick:V=>dt(s)},[...t[107]||(t[107]=[e("i",{class:"fas fa-link mr-1"},null,-1),L(" 绑定 ",-1)])],8,Gu),e("button",{class:"flex-1 rounded-lg bg-gray-50 px-3 py-2 text-xs text-gray-600 transition-colors hover:bg-gray-100",onClick:V=>et(s)},[...t[108]||(t[108]=[e("i",{class:"fas fa-edit mr-1"},null,-1),L(" 编辑 ",-1)])],8,qu),s.expiresAt&&(Pe(s.expiresAt)||Ee(s.expiresAt))?(l(),o("button",{key:0,class:"flex-1 rounded-lg bg-orange-50 px-3 py-2 text-xs text-orange-600 transition-colors hover:bg-orange-100",onClick:V=>tt(s)},[...t[109]||(t[109]=[e("i",{class:"fas fa-clock mr-1"},null,-1),L(" 续期 ",-1)])],8,Bu)):v("",!0),e("button",{class:q([s.isActive?"bg-orange-50 text-orange-600 hover:bg-orange-100":"bg-green-50 text-green-600 hover:bg-green-100","rounded-lg px-3 py-2 text-xs transition-colors"]),onClick:V=>st(s)},[e("i",{class:q(["fas",s.isActive?"fa-ban":"fa-check-circle","mr-1"])},null,2),L(" "+g(s.isActive?"禁用":"激活"),1)],10,Wu),e("button",{class:"rounded-lg bg-red-50 px-3 py-2 text-xs text-red-600 transition-colors hover:bg-red-100",onClick:V=>at(s.id)},[...t[110]||(t[110]=[e("i",{class:"fas fa-trash"},null,-1)])],8,Fu)])])}),128))])):v("",!0),me.value.length>0?(l(),o("div",zu,[e("div",Hu,[e("span",Nu," 共 "+g(me.value.length)+" 条记录 ",1),e("div",Yu,[t[111]||(t[111]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},"每页显示",-1)),T(e("select",{"onUpdate:modelValue":t[17]||(t[17]=s=>w.value=s),class:"rounded-md border border-gray-200 bg-white px-2 py-1 text-xs text-gray-700 transition-colors hover:border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-gray-500 sm:text-sm",onChange:t[18]||(t[18]=s=>x.value=1)},[(l(),o(N,null,Y(X,s=>e("option",{key:s,value:s},g(s),9,Qu)),64))],544),[[ye,w.value]]),t[112]||(t[112]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},"条",-1))])]),e("div",Ju,[e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:py-1 sm:text-sm",disabled:x.value===1,onClick:t[19]||(t[19]=s=>x.value--)},[...t[113]||(t[113]=[e("i",{class:"fas fa-chevron-left"},null,-1)])],8,Xu),e("div",Zu,[x.value>3?(l(),o("button",{key:0,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:block",onClick:t[20]||(t[20]=s=>x.value=1)}," 1 ")):v("",!0),x.value>4?(l(),o("span",ec,"...")):v("",!0),(l(!0),o(N,null,Y(mt.value,s=>(l(),o("button",{key:s,class:q(["rounded-md px-2 py-1 text-xs font-medium sm:px-3 sm:text-sm",s===x.value?"bg-blue-600 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"]),onClick:B=>x.value=s},g(s),11,tc))),128)),x.value<$e.value-3?(l(),o("span",sc,"...")):v("",!0),$e.value>1&&x.value<$e.value-2?(l(),o("button",{key:3,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:block",onClick:t[21]||(t[21]=s=>x.value=$e.value)},g($e.value),1)):v("",!0)]),e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 sm:py-1 sm:text-sm",disabled:x.value===$e.value||$e.value===0,onClick:t[22]||(t[22]=s=>x.value++)},[...t[114]||(t[114]=[e("i",{class:"fas fa-chevron-right"},null,-1)])],8,ac)])])):v("",!0)]),E.value?(l(),oe(Aa,{key:0,accounts:a.value,onBatchSuccess:wt,onClose:t[23]||(t[23]=s=>E.value=!1),onSuccess:kt},null,8,["accounts"])):v("",!0),i.value?(l(),oe(Ml,{key:1,accounts:a.value,"api-key":be.value,onClose:t[24]||(t[24]=s=>i.value=!1),onSuccess:At},null,8,["accounts","api-key"])):v("",!0),b.value?(l(),oe(Yl,{key:2,"api-key":ge.value,onClose:t[25]||(t[25]=s=>b.value=!1),onSuccess:Ct},null,8,["api-key"])):v("",!0),Z.value?(l(),oe(dr,{key:3,"api-key":we.value,onClose:t[26]||(t[26]=s=>Z.value=!1)},null,8,["api-key"])):v("",!0),J.value?(l(),oe(jr,{key:4,"api-keys":le.value,onClose:t[27]||(t[27]=s=>J.value=!1)},null,8,["api-keys"])):v("",!0),se.value?(l(),oe(zo,{key:5,accounts:a.value,"selected-keys":S.value,onClose:t[28]||(t[28]=s=>se.value=!1),onSuccess:$t},null,8,["accounts","selected-keys"])):v("",!0),ie(yn,{ref_key:"expiryEditModalRef",ref:M,"api-key":d.value||{id:null,expiresAt:null,name:""},show:!!d.value,onClose:rt,onSave:Dt},null,8,["api-key","show"]),ie(oi,{"api-key":y.value||{},show:I.value,onClose:t[29]||(t[29]=s=>I.value=!1)},null,8,["api-key","show"]),f.value?(l(),oe(Di,{key:6,accounts:a.value,"api-key":c.value,onClose:t[30]||(t[30]=s=>f.value=!1),onSuccess:_t},null,8,["accounts","api-key"])):v("",!0)])}}},gc=fe(lc,[["__scopeId","data-v-45068d52"]]);export{gc as default};
