import{aT as vt,r as u,aZ as Te,o as kt,q as wt,Z as ht,x as o,z as e,L as v,C as D,O as c,u as i,K as g,S as te,aq as S,P as b,a_ as G,aW as ce,al as O,Q as fe,ac as Ce,R as Le,J as Re,ax as Ct,T as _t,Y as St,y as n}from"./vue-vendor-CcFZMz-v.js";import{s as d}from"./toast-BvwA7Mwb.js";import{b as m,_ as At}from"./index-DvkLsalG.js";import{u as Dt}from"./requestLogs-BHJexRhU.js";import"./element-plus-C-1FTG0y.js";import"./vendor-B90ziCBp.js";const Ft=vt("settings",()=>{const F=u({siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",updatedAt:null}),I=u(!1),K=u(!1),M=async()=>{I.value=!0;try{const s=await m.get("/admin/oem-settings");return s&&s.success&&(F.value={...F.value,...s.data},y()),s}catch(s){throw console.error("Failed to load OEM settings:",s),s}finally{I.value=!1}},C=async s=>{K.value=!0;try{const f=await m.put("/admin/oem-settings",s);return f&&f.success&&(F.value={...F.value,...f.data},y()),f}catch(f){throw console.error("Failed to save OEM settings:",f),f}finally{K.value=!1}},H=async()=>{const s={siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",updatedAt:null};return F.value={...s},await C(s)},y=()=>{if(F.value.siteName&&(document.title=`${F.value.siteName} - 管理后台`),F.value.siteIconData||F.value.siteIcon){const s=document.querySelector('link[rel="icon"]')||document.createElement("link");s.rel="icon",s.href=F.value.siteIconData||F.value.siteIcon,document.querySelector('link[rel="icon"]')||document.head.appendChild(s)}};return{oemSettings:F,loading:I,saving:K,loadOemSettings:M,saveOemSettings:C,resetOemSettings:H,applyOemSettings:y,formatDateTime:s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",validateIconFile:s=>{const f=[];return s.size>350*1024&&f.push("图标文件大小不能超过 350KB"),["image/x-icon","image/png","image/jpeg","image/jpg","image/svg+xml"].includes(s.type)||f.push("不支持的文件类型，请选择 .ico, .png, .jpg 或 .svg 文件"),{isValid:f.length===0,errors:f}},fileToBase64:s=>new Promise((f,j)=>{const E=new FileReader;E.onload=L=>f(L.target.result),E.onerror=j,E.readAsDataURL(s)})}}),Ot={class:"settings-container"},jt={class:"card p-4 sm:p-6"},It={class:"mb-6"},Et={class:"flex space-x-8"},Ut={key:0,class:"py-12 text-center"},Vt={key:1},Tt={class:"table-container hidden sm:block"},Lt={class:"min-w-full"},Rt={class:"divide-y divide-gray-200/50 dark:divide-gray-600/50"},Mt={class:"table-row"},qt={class:"px-6 py-4"},Wt={class:"table-row"},$t={class:"px-6 py-4"},Bt={class:"space-y-3"},Nt={key:0,class:"inline-flex items-center gap-3 rounded-lg bg-gray-50 p-3 dark:bg-gray-700"},Pt=["src"],zt={class:"px-6 py-6",colspan:"2"},Gt={class:"flex items-center justify-between"},Kt={class:"flex gap-3"},Ht=["disabled"],Qt={key:0,class:"loading-spinner mr-2"},Zt={key:1,class:"fas fa-save mr-2"},Jt=["disabled"],Yt={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Xt={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},er={class:"mb-4 flex items-center justify-between"},tr={class:"text-xs text-gray-500 dark:text-gray-400"},rr={class:"space-y-4"},ar={class:"rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-700 dark:bg-blue-900/30"},sr={class:"flex items-start gap-2"},lr={class:"text-sm text-blue-700 dark:text-blue-300"},or={class:"mb-1 font-medium"},nr={key:0,class:"space-y-2"},dr={key:1,class:"space-y-2"},ir={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},ur={class:"space-y-4"},gr={class:"flex items-center justify-between"},br={class:"relative inline-flex cursor-pointer items-center"},cr={class:"flex items-center justify-between"},fr={class:"relative inline-flex cursor-pointer items-center"},yr={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},xr={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},pr={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},mr={class:"flex items-center justify-between"},vr={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},kr={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},wr={class:"flex items-center justify-between"},hr={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Cr={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},_r={class:"flex items-center justify-between"},Sr={class:"text-2xl font-bold text-purple-600 dark:text-purple-400"},Ar={class:"flex items-center justify-between"},Dr={class:"flex gap-3"},Fr=["disabled"],Or={key:0,class:"loading-spinner mr-2"},jr={key:1,class:"fas fa-save mr-2"},Ir=["disabled"],Er={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Ur={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Vr={class:"flex items-center justify-between"},Tr={class:"relative inline-flex cursor-pointer items-center"},Lr={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Rr={class:"space-y-3"},Mr={class:"font-medium text-gray-700 dark:text-gray-300"},qr={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},Wr={class:"relative inline-flex cursor-pointer items-center"},$r=["onUpdate:modelValue"],Br={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Nr={class:"mb-4 flex items-center justify-between"},Pr={key:0,class:"space-y-4"},zr={class:"flex items-start justify-between"},Gr={class:"flex-1"},Kr={class:"flex items-center"},Hr={class:"font-semibold text-gray-800 dark:text-gray-200"},Qr={class:"text-sm text-gray-500 dark:text-gray-400"},Zr={class:"mt-3 space-y-1 text-sm"},Jr={class:"flex items-center text-gray-600 dark:text-gray-400"},Yr={class:"truncate"},Xr={key:0,class:"flex items-center text-gray-600 dark:text-gray-400"},ea={class:"ml-4 flex items-center space-x-2"},ta={class:"relative inline-flex cursor-pointer items-center"},ra=["checked","onChange"],aa=["onClick"],sa=["onClick"],la=["onClick"],oa={key:1,class:"py-8 text-center text-gray-500 dark:text-gray-400"},na={class:"rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},da={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},ia={class:"overview-section mb-6 rounded-lg bg-white p-6 dark:bg-gray-800"},ua={class:"grid grid-cols-2 gap-4 md:grid-cols-4"},ga={class:"stat-card"},ba={class:"text-2xl font-bold text-blue-600"},ca={class:"stat-card"},fa={class:"text-2xl font-bold text-green-600"},ya={class:"stat-card"},xa={class:"text-2xl font-bold text-purple-600"},pa={class:"stat-card"},ma={class:"text-2xl font-bold text-orange-600"},va={class:"mt-4 border-t border-gray-200 pt-4 dark:border-gray-700"},ka={class:"flex items-center justify-between"},wa={class:"flex items-center space-x-4"},ha={class:"flex items-center"},Ca={class:"text-sm text-gray-600 dark:text-gray-400"},_a={key:0,class:"text-sm text-gray-500"},Sa={key:0,class:"mb-6"},Aa={class:"grid grid-cols-1 gap-6 md:grid-cols-3"},Da={class:"feature-card"},Fa={class:"mb-4 space-y-3"},Oa={class:"flex items-center"},ja=["disabled"],Ia={key:0},Ea={key:1},Ua={class:"feature-card"},Va={class:"mb-4 space-y-3"},Ta=["disabled"],La={key:0},Ra={key:1},Ma={class:"feature-card"},qa={class:"mb-4 space-y-3"},Wa={class:"flex items-center"},$a=["disabled"],Ba={key:0},Na={key:1},Pa={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},za={class:"flex items-center justify-between"},Ga={class:"relative inline-flex cursor-pointer items-center"},Ka={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Ha={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Qa={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Za={class:"space-y-4"},Ja={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ya={class:"flex items-center justify-between"},Xa={class:"relative inline-flex cursor-pointer items-center"},es={class:"flex items-center justify-between"},ts={class:"relative inline-flex cursor-pointer items-center"},rs={class:"flex items-center justify-between"},as={class:"relative inline-flex cursor-pointer items-center"},ss={class:"flex items-center justify-between"},ls={class:"relative inline-flex cursor-pointer items-center"},os={class:"mt-6 space-y-3"},ns={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},ds={class:"flex items-center justify-between"},is={class:"flex cursor-pointer items-center"},us={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},gs={class:"grid grid-cols-1 gap-4 md:grid-cols-4"},bs={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},cs={class:"flex items-center justify-between"},fs={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},ys={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},xs={class:"flex items-center justify-between"},ps={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ms={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},vs={class:"flex items-center justify-between"},ks={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},ws={class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},hs={class:"flex items-center justify-between"},Cs={class:"text-2xl font-bold text-red-600 dark:text-red-400"},_s={class:"flex items-center justify-between"},Ss={class:"flex gap-3"},As=["disabled"],Ds={key:0,class:"loading-spinner mr-2"},Fs={key:1,class:"fas fa-save mr-2"},Os=["disabled"],js={key:0,class:"loading-spinner mr-2"},Is={key:1,class:"fas fa-broom mr-2"},Es={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Us={class:"dark:to-gray-750 relative border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-5 dark:border-gray-700 dark:from-gray-800"},Vs={class:"flex items-center justify-between"},Ts={class:"flex items-center space-x-3"},Ls={class:"text-xl font-semibold text-gray-900 dark:text-white"},Rs={class:"mt-0.5 text-sm text-gray-600 dark:text-gray-400"},Ms={class:"p-6"},qs={class:"space-y-5"},Ws={class:"relative"},$s=["disabled"],Bs={key:0,class:"mt-1 text-xs text-amber-600 dark:text-amber-400"},Ns={class:"relative"},Ps={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3"},zs={key:1,class:"absolute inset-y-0 right-0 flex items-center pr-3"},Gs={key:0,class:"mt-2 flex items-start rounded-lg bg-blue-50 p-3 dark:bg-blue-900/20"},Ks={class:"text-sm text-blue-700 dark:text-blue-300"},Hs={key:0,class:"rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900/50"},Qs={class:"space-y-4"},Zs={class:"flex items-center justify-between"},Js={class:"flex cursor-pointer items-center",for:"enableSign"},Ys={key:0,class:"rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-700 dark:bg-green-900/50 dark:text-green-400"},Xs={key:0},el={class:"border-t border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-700 dark:bg-gray-900/50"},tl={class:"flex items-center justify-between"},rl={class:"flex space-x-3"},al=["disabled"],sl=["disabled"],ll={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ol={class:"mx-4 w-full max-w-md rounded-lg bg-white p-6 dark:bg-gray-800"},nl={class:"mb-4 flex items-center justify-between"},dl={key:0},il={key:0,class:"mb-4 text-center"},ul=["src"],gl={key:1,class:"mb-4"},bl={class:"rounded bg-gray-100 px-2 py-1 text-sm dark:bg-gray-700"},cl={key:1},fl={class:"flex space-x-3"},yl=["disabled"],xl={key:2},pl={class:"mb-4 rounded-md bg-gray-100 p-4 dark:bg-gray-700"},ml={class:"grid grid-cols-2 gap-2 font-mono text-sm"},vl={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},kl={class:"mx-4 w-full max-w-md rounded-lg bg-white p-6 dark:bg-gray-800"},wl={class:"mb-4 flex items-center justify-between"},hl={class:"space-y-4"},Cl={class:"flex space-x-3 pt-4"},_l=["disabled"],Sl={key:0},Al={key:1},Dl=Object.assign({name:"SettingsView"},{__name:"SettingsView",setup(F){const I=Ft(),{loading:K,saving:M,oemSettings:C}=Te(I),H=Dt(),{config:y,configSaving:Q}=Te(H),_e=u(),w=u("branding"),s=u(!0),f=u(new AbortController),j=u(!1),E=u(!1),L=u(!1),$=u(!1),_=u({enabled:!1,platforms:[],notificationTypes:{accountAnomaly:!0,quotaWarning:!0,systemError:!0,securityAlert:!0},retrySettings:{maxRetries:3,retryDelay:1e3,timeout:1e4}}),B=u(!1),U=u(null),p=u({type:"wechat_work",name:"",url:"",enableSign:!1,secret:""}),k=u({globalDefaultStrategy:"least_recent",globalDefaultWeight:5,globalDefaultOrder:1,enableAccountOverride:!0,enableGroupOverride:!0,updatedAt:null}),re=u({globalStrategyCount:0,customStrategyCount:0,groupStrategyCount:0}),T=u(!1),Se=kt(w,async r=>{s.value&&(r==="webhook"?await Z():r==="scheduling"?await Fe():r==="data-management"?await be():r==="request-logging"&&await Ue())});wt(async()=>{try{await I.loadOemSettings(),w.value==="webhook"?await Z():w.value==="scheduling"?await Fe():w.value==="data-management"?await be():w.value==="request-logging"&&await Ue()}catch{d("加载设置失败","error")}}),ht(()=>{s.value=!1,f.value&&f.value.abort(),Se&&Se(),B.value&&(B.value=!1,U.value=null)});const Z=async()=>{if(s.value)try{const r=await m.get("/admin/webhook/config",{signal:f.value.signal});r.success&&s.value&&(_.value=r.config)}catch(r){if(r.name==="AbortError"||!s.value)return;d("获取webhook配置失败","error"),console.error(r)}},J=async()=>{if(s.value)try{(await m.post("/admin/webhook/config",_.value,{signal:f.value.signal})).success&&s.value&&d("配置已保存","success")}catch(r){if(r.name==="AbortError"||!s.value)return;d("保存配置失败","error"),console.error(r)}},Me=()=>{const r=p.value.url;if(!r){j.value=!1,E.value=!1;return}try{new URL(r),r.startsWith("http://")||r.startsWith("https://")?(j.value=!1,E.value=!0):(j.value=!0,E.value=!1)}catch{j.value=!0,E.value=!1}},qe=async()=>{if(s.value){if(!p.value.url){d("请输入Webhook URL","error");return}if(j.value){d("请输入有效的Webhook URL","error");return}$.value=!0;try{let r;U.value?r=await m.put(`/admin/webhook/platforms/${U.value.id}`,p.value,{signal:f.value.signal}):r=await m.post("/admin/webhook/platforms",p.value,{signal:f.value.signal}),r.success&&s.value&&(d(U.value?"平台已更新":"平台已添加","success"),await Z(),ae())}catch(r){if(r.name==="AbortError"||!s.value)return;d(r.message||"操作失败","error"),console.error(r)}finally{s.value&&($.value=!1)}}},We=r=>{U.value=r,p.value={...r},B.value=!0},$e=async r=>{if(s.value&&confirm("确定要删除这个平台吗？"))try{(await m.delete(`/admin/webhook/platforms/${r}`,{signal:f.value.signal})).success&&s.value&&(d("平台已删除","success"),await Z())}catch(t){if(t.name==="AbortError"||!s.value)return;d("删除失败","error"),console.error(t)}},Be=async r=>{if(s.value)try{const t=await m.post(`/admin/webhook/platforms/${r}/toggle`,{},{signal:f.value.signal});t.success&&s.value&&(d(t.message,"success"),await Z())}catch(t){if(t.name==="AbortError"||!s.value)return;d("操作失败","error"),console.error(t)}},Ne=async r=>{if(s.value)try{(await m.post("/admin/webhook/test",{url:r.url,type:r.type,secret:r.secret,enableSign:r.enableSign},{signal:f.value.signal})).success&&s.value&&d("测试成功，webhook连接正常","success")}catch(t){if(t.name==="AbortError"||!s.value)return;d(t.error||t.message||"测试失败","error"),console.error(t)}},Pe=async()=>{if(s.value){if(!p.value.url){d("请先输入Webhook URL","error");return}if(j.value){d("请输入有效的Webhook URL","error");return}L.value=!0;try{(await m.post("/admin/webhook/test",p.value,{signal:f.value.signal})).success&&s.value&&d("测试成功，webhook连接正常","success")}catch(r){if(r.name==="AbortError"||!s.value)return;d(r.error||r.message||"测试失败","error"),console.error(r)}finally{s.value&&(L.value=!1)}}},ze=async()=>{if(s.value)try{(await m.post("/admin/webhook/test-notification",{},{signal:f.value.signal})).success&&s.value&&d("测试通知已发送","success")}catch(r){if(r.name==="AbortError"||!s.value)return;d("发送失败","error"),console.error(r)}},ae=()=>{s.value&&(B.value=!1,setTimeout(()=>{s.value&&(U.value=null,p.value={type:"wechat_work",name:"",url:"",enableSign:!1,secret:""},j.value=!1,E.value=!1,L.value=!1,$.value=!1)},0))},Ae=r=>({wechat_work:"企业微信",dingtalk:"钉钉",feishu:"飞书",slack:"Slack",discord:"Discord",custom:"自定义"})[r]||r,Ge=r=>({wechat_work:"fab fa-weixin text-green-600",dingtalk:"fas fa-comment-dots text-blue-500",feishu:"fas fa-dove text-blue-600",slack:"fab fa-slack text-purple-600",discord:"fab fa-discord text-indigo-600",custom:"fas fa-webhook text-gray-600"})[r]||"fas fa-bell",De=r=>({wechat_work:"请在企业微信群机器人设置中获取Webhook地址",dingtalk:"请在钉钉群机器人设置中获取Webhook地址",feishu:"请在飞书群机器人设置中获取Webhook地址",slack:"请在Slack应用的Incoming Webhooks中获取地址",discord:"请在Discord服务器的集成设置中创建Webhook",custom:"请输入完整的Webhook接收地址"})[r]||"",Ke=r=>({accountAnomaly:"账号异常",quotaWarning:"配额警告",systemError:"系统错误",securityAlert:"安全警报"})[r]||r,He=r=>({accountAnomaly:"账号状态异常、认证失败等",quotaWarning:"API调用配额不足警告",systemError:"系统运行错误和故障",securityAlert:"安全相关的警报通知"})[r]||"",Qe=async()=>{try{const r={siteName:C.value.siteName,siteIcon:C.value.siteIcon,siteIconData:C.value.siteIconData},t=await I.saveOemSettings(r);t&&t.success?d("OEM设置保存成功","success"):d((t==null?void 0:t.message)||"保存失败","error")}catch{d("保存OEM设置失败","error")}},Ze=async()=>{if(confirm(`确定要重置为默认设置吗？

这将清除所有自定义的网站名称和图标设置。`))try{const r=await I.resetOemSettings();r&&r.success?d("已重置为默认设置","success"):d("重置失败","error")}catch{d("重置失败","error")}},Je=async r=>{const t=r.target.files[0];if(!t)return;const l=I.validateIconFile(t);if(!l.isValid){l.errors.forEach(a=>d(a,"error"));return}try{const a=await I.fileToBase64(t);C.value.siteIconData=a}catch{d("文件读取失败","error")}r.target.value=""},Ye=()=>{C.value.siteIcon="",C.value.siteIconData=""},Xe=()=>{console.warn("Icon failed to load")},Fe=async()=>{if(s.value)try{const r=await m.get("/admin/scheduling/config",{signal:f.value.signal});if(r.success&&s.value){const t=r.data;k.value={globalDefaultStrategy:(t==null?void 0:t.defaultStrategy)||"least_recent",globalDefaultWeight:parseInt((t==null?void 0:t.globalDefaultWeight)||5),globalDefaultOrder:parseInt((t==null?void 0:t.globalDefaultOrder)||1),enableAccountOverride:(t==null?void 0:t.enableAccountOverride)==="true",enableGroupOverride:(t==null?void 0:t.enableGroupOverride)==="true",updatedAt:t==null?void 0:t.updatedAt},await ye()}}catch(r){if(r.name==="AbortError"||!s.value)return;console.error("加载调度配置失败:",r)}},N=async()=>{if(s.value){T.value=!0;try{(await m.post("/admin/scheduling/config",k.value,{signal:f.value.signal})).success&&s.value&&(k.value.updatedAt=new Date().toISOString(),d("调度策略配置已保存","success"),await ye())}catch(r){if(r.name==="AbortError"||!s.value)return;d("保存配置失败","error"),console.error(r)}finally{s.value&&(T.value=!1)}}},et=async()=>{if(confirm("确定要重置调度策略配置为默认设置吗？")){T.value=!0;try{(await m.post("/admin/scheduling/config/reset",{},{signal:f.value.signal})).success&&s.value&&(k.value={globalDefaultStrategy:"least_recent",globalDefaultWeight:5,globalDefaultOrder:1,enableAccountOverride:!0,enableGroupOverride:!0,updatedAt:new Date().toISOString()},d("调度策略配置已重置","success"),await ye())}catch(r){if(r.name==="AbortError"||!s.value)return;d("重置配置失败","error"),console.error(r)}finally{s.value&&(T.value=!1)}}},ye=async()=>{if(s.value)try{const r=await m.get("/admin/scheduling/stats",{signal:f.value.signal});r.success&&s.value&&(re.value=r.stats)}catch(r){if(r.name==="AbortError"||!s.value)return;console.error("加载使用统计失败:",r)}},tt=()=>Oe(k.value.globalDefaultStrategy),rt=r=>({round_robin:"fas fa-sync-alt text-blue-500",least_used:"fas fa-chart-bar text-green-500",least_recent:"fas fa-clock text-orange-500",random:"fas fa-random text-purple-500",weighted_random:"fas fa-balance-scale text-amber-500",sequential:"fas fa-list-ol text-indigo-500"})[r]||"fas fa-clock text-orange-500",Oe=r=>({round_robin:"轮询调度",least_used:"最少使用",least_recent:"最近最少使用",random:"随机调度",weighted_random:"加权随机",sequential:"顺序调度"})[r]||"最近最少使用",at=r=>({round_robin:"按顺序循环选择账户，确保每个账户被平均使用",least_used:"优先选择使用次数最少的账户，实现负载均衡",least_recent:"优先选择最长时间未被使用的账户，适合大部分场景",random:"随机选择可用账户，分布相对均匀",weighted_random:"根据权重随机选择，权重越高被选中概率越大",sequential:"按配置顺序逐一使用账户，适合有优先级要求的场景"})[r]||"优先选择最长时间未被使用的账户",A=u({apiKeys:0,claudeAccounts:0,openaiAccounts:0,systemConfig:0,is2FAEnabled:!1,lastExport:null}),se=u(!1),R=u(1),xe=u(""),pe=u(""),me=u(null),P=u(""),q=u(!1),h=u({password:"",token:"",sessionToken:""}),le=u(!1);let z=null;const ve=u({includeStats:!0}),oe=u(!1),ke=u({conflictStrategy:"skip"}),ne=u(!1),de=u(null),st=u(),ie=u({validateOnly:!1}),ue=u(!1),ge=u(null),lt=u(),Y=u({todayLogs:0,totalLogs:0,storageUsed:0,errorLogs:0}),X=u(!1),be=async()=>{var r,t;try{const l=await m.get("/admin/data/overview");Object.assign(A.value,l.data)}catch(l){d("获取数据概览失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}},ot=async()=>{var r,t;try{const a=(await m.post("/admin/data/2fa/generate")).data;xe.value=a.qrCode,pe.value=a.manualEntryKey,me.value=a.backupCodes,se.value=!0,R.value=1}catch(l){d("生成2FA密钥失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}},nt=async()=>{var r,t;try{await m.post("/admin/data/2fa/enable",{token:P.value}),R.value=3,d("2FA启用成功","success")}catch(l){d("2FA启用失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}},dt=()=>{se.value=!1,R.value=1,P.value="",A.value.is2FAEnabled=!0},it=async()=>{var r,t;le.value=!0;try{const l=await m.post("/admin/data/2fa/verify",{password:h.value.password,token:h.value.token});h.value.sessionToken=l.data.sessionToken,q.value=!1,z&&(await z(),z=null),h.value.password="",h.value.token=""}catch(l){d("验证失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}finally{le.value=!1}},ut=()=>{if(!h.value.sessionToken){z=je,q.value=!0;return}je()},je=async()=>{var r,t;oe.value=!0;try{const l=await m.post("/admin/data/export",{sessionToken:h.value.sessionToken,includeStats:ve.value.includeStats},{responseType:"blob",timeout:6e4});if(!l.data||l.data.size===0)throw new Error("下载的文件为空");const a=l.headers["content-type"]||((t=(r=l.headers).get)==null?void 0:t.call(r,"content-type"));if(a&&!a.includes("application/zip")){const mt=await l.data.text();try{const Ve=JSON.parse(mt);throw new Error(Ve.error||"导出失败")}catch{throw new Error("导出文件格式错误")}}const x=new Blob([l.data],{type:"application/zip"}),W=window.URL.createObjectURL(x),ee=document.createElement("a");ee.href=W,ee.download=`claude-relay-data-${Date.now()}.zip`,document.body.appendChild(ee),ee.click(),setTimeout(()=>{document.body.removeChild(ee),window.URL.revokeObjectURL(W)},100),d("数据导出成功","success"),be()}catch(l){console.error("导出错误:",l);let a="导出失败";if(l.response){if(l.response.data)try{if(l.response.data instanceof Blob){const x=await l.response.data.text();a=JSON.parse(x).error||"导出失败"}else a=l.response.data.error||"导出失败"}catch{a=`导出失败 (状态码: ${l.response.status})`}}else l.message&&(a=l.message);d("数据导出失败: "+a,"error")}finally{oe.value=!1,h.value.sessionToken=""}},gt=r=>{de.value=r.target.files[0]},bt=()=>{if(!h.value.sessionToken){z=Ie,q.value=!0;return}Ie()},Ie=async()=>{var r,t;ne.value=!0;try{const l=new FormData;l.append("dataFile",de.value),l.append("sessionToken",h.value.sessionToken),l.append("conflictStrategy",ke.value.conflictStrategy);const x=(await m.post("/admin/data/import",l)).data;d(`数据导入成功: 导入${x.importedRecords}条记录，跳过${x.skippedRecords}条记录`,"success"),be()}catch(l){d("数据导入失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}finally{ne.value=!1,h.value.sessionToken="",de.value=null}},ct=r=>{ge.value=r.target.files[0]},ft=()=>{if(!h.value.sessionToken){z=Ee,q.value=!0;return}Ee()},Ee=async()=>{var r,t;ue.value=!0;try{const l=new FormData;l.append("configFile",ge.value),l.append("sessionToken",h.value.sessionToken),l.append("validateOnly",ie.value.validateOnly);const x=(await m.post("/admin/data/migrate",l)).data,W=ie.value.validateOnly?`迁移验证完成: ${x.sourceDatabase} → ${x.targetDatabase}`:`数据库迁移完成: ${x.totalRecords}条记录`;d(W,"success")}catch(l){d("迁移操作失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),"error")}finally{ue.value=!1,h.value.sessionToken="",ge.value=null}},yt=r=>new Date(r).toLocaleString("zh-CN"),Ue=async()=>{if(s.value)try{await H.loadConfig(),await we()}catch(r){if(r.name==="AbortError"||!s.value)return}},V=async()=>{if(s.value)try{await H.saveConfig(y.value),s.value&&(d("请求日志配置已保存","success"),await we())}catch(r){if(r.name==="AbortError"||!s.value)return;d("保存配置失败","error"),console.error(r)}},we=async()=>{if(s.value)try{const r=await m.get("/admin/request-logs/stats",{signal:f.value.signal});if(r.success&&s.value&&r.data){const t=r.data,l={todayLogs:t.todayLogs||0,totalLogs:t.totalRequests||t.totalLogs||0,storageUsed:t.storageUsed||0,errorLogs:t.errorLogs?t.errorLogs:t.statusCodes?Object.entries(t.statusCodes).filter(([a])=>{const x=parseInt(a);return x>=400&&x<600}).reduce((a,[,x])=>a+x,0):0};Object.assign(Y.value,l)}}catch(r){if(r.name==="AbortError"||!s.value)return}},xt=async()=>{if(s.value&&confirm(`确定要清理过期的日志文件吗？

这将删除超过保留期限的所有日志记录。`)){X.value=!0;try{const r=await m.post("/admin/request-logs/cleanup",{},{signal:f.value.signal});r.success&&s.value&&(d(`清理完成，删除了 ${r.data.deletedFiles} 个文件`,"success"),await we())}catch(r){if(r.name==="AbortError"||!s.value)return;d("清理失败","error"),console.error(r)}finally{s.value&&(X.value=!1)}}},pt=r=>{if(r===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,a)).toFixed(2))+" "+l[a]},he=I.formatDateTime;return(r,t)=>{const l=Ct("router-link");return n(),o(fe,null,[e("div",Ot,[e("div",jt,[t[152]||(t[152]=e("div",{class:"mb-4 sm:mb-6"},[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," 系统设置 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"网站定制和通知配置")],-1)),e("div",It,[e("nav",Et,[e("button",{class:D(["border-b-2 pb-2 text-sm font-medium transition-colors",w.value==="branding"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:t[0]||(t[0]=a=>w.value="branding")},[...t[44]||(t[44]=[e("i",{class:"fas fa-palette mr-2"},null,-1),c(" 品牌设置 ",-1)])],2),e("button",{class:D(["border-b-2 pb-2 text-sm font-medium transition-colors",w.value==="scheduling"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:t[1]||(t[1]=a=>w.value="scheduling")},[...t[45]||(t[45]=[e("i",{class:"fas fa-route mr-2"},null,-1),c(" 调度策略配置 ",-1)])],2),e("button",{class:D(["border-b-2 pb-2 text-sm font-medium transition-colors",w.value==="webhook"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:t[2]||(t[2]=a=>w.value="webhook")},[...t[46]||(t[46]=[e("i",{class:"fas fa-bell mr-2"},null,-1),c(" 通知设置 ",-1)])],2),e("button",{class:D(["border-b-2 pb-2 text-sm font-medium transition-colors",w.value==="data-management"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:t[3]||(t[3]=a=>w.value="data-management")},[...t[47]||(t[47]=[e("i",{class:"fas fa-database mr-2"},null,-1),c(" 数据管理 ",-1)])],2),e("button",{class:D(["border-b-2 pb-2 text-sm font-medium transition-colors",w.value==="request-logging"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:t[4]||(t[4]=a=>w.value="request-logging")},[...t[48]||(t[48]=[e("i",{class:"fas fa-file-alt mr-2"},null,-1),c(" 请求日志 ",-1)])],2)])]),i(K)?(n(),o("div",Ut,[...t[49]||(t[49]=[e("div",{class:"loading-spinner mx-auto mb-4"},[e("p",{class:"text-gray-500 dark:text-gray-400"},"正在加载设置...")],-1)])])):(n(),o("div",Vt,[g(e("div",null,[e("div",Tt,[e("table",Lt,[e("tbody",Rt,[e("tr",Mt,[t[51]||(t[51]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-font text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"}," 网站名称 "),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"品牌标识")])])],-1)),e("td",qt,[g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>i(C).siteName=a),class:"form-input w-full max-w-md dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",maxlength:"100",placeholder:"Claude Relay Service",type:"text"},null,512),[[S,i(C).siteName]]),t[50]||(t[50]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 将显示在浏览器标题和页面头部 ",-1))])]),e("tr",Wt,[t[56]||(t[56]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-purple-500 to-purple-600"},[e("i",{class:"fas fa-image text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"}," 网站图标 "),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"Favicon")])])],-1)),e("td",$t,[e("div",Bt,[i(C).siteIconData||i(C).siteIcon?(n(),o("div",Nt,[e("img",{alt:"图标预览",class:"h-8 w-8",src:i(C).siteIconData||i(C).siteIcon,onError:Xe},null,40,Pt),t[53]||(t[53]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"当前图标",-1)),e("button",{class:"rounded-lg px-3 py-1 font-medium text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",onClick:Ye},[...t[52]||(t[52]=[e("i",{class:"fas fa-trash mr-1"},null,-1),c("删除 ",-1)])])])):v("",!0),e("div",null,[e("input",{ref_key:"iconFileInput",ref:_e,accept:".ico,.png,.jpg,.jpeg,.svg",class:"hidden",type:"file",onChange:Je},null,544),e("button",{class:"btn btn-success px-4 py-2",onClick:t[6]||(t[6]=a=>r.$refs.iconFileInput.click())},[...t[54]||(t[54]=[e("i",{class:"fas fa-upload mr-2"},null,-1),c(" 上传图标 ",-1)])]),t[55]||(t[55]=e("span",{class:"ml-3 text-xs text-gray-500 dark:text-gray-400"},"支持 .ico, .png, .jpg, .svg 格式，最大 350KB",-1))])])])]),e("tr",null,[e("td",zt,[e("div",Gt,[e("div",Kt,[e("button",{class:D(["btn btn-primary px-6 py-3",{"cursor-not-allowed opacity-50":i(M)}]),disabled:i(M),onClick:Qe},[i(M)?(n(),o("div",Qt)):(n(),o("i",Zt)),c(" "+b(i(M)?"保存中...":"保存设置"),1)],10,Ht),e("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:i(M),onClick:Ze},[...t[57]||(t[57]=[e("i",{class:"fas fa-undo mr-2"},null,-1),c(" 重置为默认 ",-1)])],8,Jt)]),i(C).updatedAt?(n(),o("div",Yt,[t[58]||(t[58]=e("i",{class:"fas fa-clock mr-1"},null,-1)),c(" 最后更新："+b(i(he)(i(C).updatedAt)),1)])):v("",!0)])])])])])]),t[59]||(t[59]=e("div",{class:"space-y-4 sm:hidden"},null,-1))],512),[[te,w.value==="branding"]]),g(e("div",null,[e("div",Xt,[e("div",er,[t[60]||(t[60]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},[e("i",{class:"fas fa-route mr-2 text-blue-500"}),c(" 全局默认调度策略 ")]),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 设置系统的默认调度策略，影响所有未单独配置的账户和分组 ")],-1)),e("div",tr," 当前生效："+b(tt()),1)]),e("div",rr,[e("div",null,[t[62]||(t[62]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 默认策略 ",-1)),g(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>k.value.globalDefaultStrategy=a),class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",onChange:N},[...t[61]||(t[61]=[G('<option value="round_robin" data-v-1fb3dfb6>轮询调度 (Round Robin)</option><option value="least_used" data-v-1fb3dfb6>最少使用 (Least Used)</option><option value="least_recent" data-v-1fb3dfb6>最近最少使用 (Least Recent)</option><option value="random" data-v-1fb3dfb6>随机调度 (Random)</option><option value="weighted_random" data-v-1fb3dfb6>加权随机 (Weighted Random)</option><option value="sequential" data-v-1fb3dfb6>顺序调度 (Sequential)</option>',6)])],544),[[ce,k.value.globalDefaultStrategy]])]),e("div",ar,[e("div",sr,[e("i",{class:D(rt(k.value.globalDefaultStrategy))},null,2),e("div",lr,[e("p",or,b(Oe(k.value.globalDefaultStrategy))+"策略说明： ",1),e("p",null,b(at(k.value.globalDefaultStrategy)),1)])])]),k.value.globalDefaultStrategy==="weighted_random"?(n(),o("div",nr,[t[63]||(t[63]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-weight-hanging mr-2 text-amber-500"}),c(" 全局默认权重 (1-10) ")],-1)),g(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>k.value.globalDefaultWeight=a),class:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"10",min:"1",type:"number",onChange:N},null,544),[[S,k.value.globalDefaultWeight,void 0,{number:!0}]]),t[64]||(t[64]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 权重越高的账户被选中的概率越大 ",-1))])):k.value.globalDefaultStrategy==="sequential"?(n(),o("div",dr,[t[65]||(t[65]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-sort-numeric-down mr-2 text-indigo-500"}),c(" 全局默认起始位置 ")],-1)),g(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>k.value.globalDefaultOrder=a),class:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",type:"number",onChange:N},null,544),[[S,k.value.globalDefaultOrder,void 0,{number:!0}]]),t[66]||(t[66]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"数字越小的账户优先被选择",-1))])):v("",!0)])]),e("div",ir,[t[71]||(t[71]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},[e("i",{class:"fas fa-cogs mr-2 text-green-500"}),c(" 策略覆盖设置 ")],-1)),e("div",ur,[e("div",gr,[t[68]||(t[68]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"账户级别覆盖"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 允许单个账户覆盖全局调度策略 ")],-1)),e("label",br,[g(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>k.value.enableAccountOverride=a),class:"peer sr-only",type:"checkbox",onChange:N},null,544),[[O,k.value.enableAccountOverride]]),t[67]||(t[67]=e("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-blue-800"},null,-1))])]),e("div",cr,[t[70]||(t[70]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"分组级别覆盖"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"允许分组覆盖全局调度策略")],-1)),e("label",fr,[g(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>k.value.enableGroupOverride=a),class:"peer sr-only",type:"checkbox",onChange:N},null,544),[[O,k.value.enableGroupOverride]]),t[69]||(t[69]=e("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-blue-800"},null,-1))])])])]),e("div",yr,[t[81]||(t[81]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},[e("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),c(" 当前使用统计 ")],-1)),e("div",xr,[e("div",pr,[e("div",mr,[e("div",null,[t[72]||(t[72]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"使用全局策略",-1)),e("p",vr,b(re.value.globalStrategyCount||0),1)]),t[73]||(t[73]=e("i",{class:"fas fa-globe text-xl text-blue-500"},null,-1))]),t[74]||(t[74]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"账户数量",-1))]),e("div",kr,[e("div",wr,[e("div",null,[t[75]||(t[75]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"自定义策略",-1)),e("p",hr,b(re.value.customStrategyCount||0),1)]),t[76]||(t[76]=e("i",{class:"fas fa-cog text-xl text-green-500"},null,-1))]),t[77]||(t[77]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"账户数量",-1))]),e("div",Cr,[e("div",_r,[e("div",null,[t[78]||(t[78]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"分组策略",-1)),e("p",Sr,b(re.value.groupStrategyCount||0),1)]),t[79]||(t[79]=e("i",{class:"fas fa-layer-group text-xl text-purple-500"},null,-1))]),t[80]||(t[80]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"分组数量",-1))])])]),e("div",Ar,[e("div",Dr,[e("button",{class:D(["btn btn-primary px-6 py-3",{"cursor-not-allowed opacity-50":T.value}]),disabled:T.value,onClick:N},[T.value?(n(),o("div",Or)):(n(),o("i",jr)),c(" "+b(T.value?"保存中...":"保存配置"),1)],10,Fr),e("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:T.value,onClick:et},[...t[82]||(t[82]=[e("i",{class:"fas fa-undo mr-2"},null,-1),c(" 重置为默认 ",-1)])],8,Ir)]),k.value.updatedAt?(n(),o("div",Er,[t[83]||(t[83]=e("i",{class:"fas fa-clock mr-1"},null,-1)),c(" 最后更新："+b(i(he)(k.value.updatedAt)),1)])):v("",!0)])],512),[[te,w.value==="scheduling"]]),g(e("div",null,[e("div",Ur,[e("div",Vr,[t[85]||(t[85]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"}," 启用 Webhook 通知 "),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 开启后，系统将按配置发送通知到指定平台 ")],-1)),e("label",Tr,[g(e("input",{"onUpdate:modelValue":t[12]||(t[12]=a=>_.value.enabled=a),class:"peer sr-only",type:"checkbox",onChange:J},null,544),[[O,_.value.enabled]]),t[84]||(t[84]=e("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-blue-800"},null,-1))])])]),e("div",Lr,[t[87]||(t[87]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"通知类型",-1)),e("div",Rr,[(n(!0),o(fe,null,Ce(_.value.notificationTypes,(a,x)=>(n(),o("div",{key:x,class:"flex items-center justify-between"},[e("div",null,[e("span",Mr,b(Ke(x)),1),e("span",qr,b(He(x)),1)]),e("label",Wr,[g(e("input",{"onUpdate:modelValue":W=>_.value.notificationTypes[x]=W,class:"peer sr-only",type:"checkbox",onChange:J},null,40,$r),[[O,_.value.notificationTypes[x]]]),t[86]||(t[86]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))])]))),128))])]),e("div",Br,[e("div",Nr,[t[89]||(t[89]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"通知平台",-1)),e("button",{class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700",onClick:t[13]||(t[13]=a=>B.value=!0)},[...t[88]||(t[88]=[e("i",{class:"fas fa-plus mr-2"},null,-1),c(" 添加平台 ",-1)])])]),_.value.platforms&&_.value.platforms.length>0?(n(),o("div",Pr,[(n(!0),o(fe,null,Ce(_.value.platforms,a=>(n(),o("div",{key:a.id,class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},[e("div",zr,[e("div",Gr,[e("div",Kr,[e("i",{class:D(["mr-3 text-xl",Ge(a.type)])},null,2),e("div",null,[e("h3",Hr,b(a.name||Ae(a.type)),1),e("p",Qr,b(Ae(a.type)),1)])]),e("div",Zr,[e("div",Jr,[t[90]||(t[90]=e("i",{class:"fas fa-link mr-2"},null,-1)),e("span",Yr,b(a.url),1)]),a.enableSign?(n(),o("div",Xr,[...t[91]||(t[91]=[e("i",{class:"fas fa-shield-alt mr-2"},null,-1),e("span",null,"已启用签名验证",-1)])])):v("",!0)])]),e("div",ea,[e("label",ta,[e("input",{checked:a.enabled,class:"peer sr-only",type:"checkbox",onChange:x=>Be(a.id)},null,40,ra),t[92]||(t[92]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))]),e("button",{class:"rounded-lg bg-blue-100 p-2 text-blue-600 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-400 dark:hover:bg-blue-800",title:"测试连接",onClick:x=>Ne(a)},[...t[93]||(t[93]=[e("i",{class:"fas fa-vial"},null,-1)])],8,aa),e("button",{class:"rounded-lg bg-gray-100 p-2 text-gray-600 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600",title:"编辑",onClick:x=>We(a)},[...t[94]||(t[94]=[e("i",{class:"fas fa-edit"},null,-1)])],8,sa),e("button",{class:"rounded-lg bg-red-100 p-2 text-red-600 transition-colors hover:bg-red-200 dark:bg-red-900 dark:text-red-400 dark:hover:bg-red-800",title:"删除",onClick:x=>$e(a.id)},[...t[95]||(t[95]=[e("i",{class:"fas fa-trash"},null,-1)])],8,la)])])]))),128))])):(n(),o("div",oa,' 暂无配置的通知平台，请点击"添加平台"按钮添加 '))]),e("div",na,[t[99]||(t[99]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"高级设置",-1)),e("div",da,[e("div",null,[t[96]||(t[96]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 最大重试次数 ",-1)),g(e("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>_.value.retrySettings.maxRetries=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",max:"10",min:"0",type:"number",onChange:J},null,544),[[S,_.value.retrySettings.maxRetries,void 0,{number:!0}]])]),e("div",null,[t[97]||(t[97]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 重试延迟 (毫秒) ",-1)),g(e("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>_.value.retrySettings.retryDelay=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",max:"10000",min:"100",step:"100",type:"number",onChange:J},null,544),[[S,_.value.retrySettings.retryDelay,void 0,{number:!0}]])]),e("div",null,[t[98]||(t[98]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 超时时间 (毫秒) ",-1)),g(e("input",{"onUpdate:modelValue":t[16]||(t[16]=a=>_.value.retrySettings.timeout=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",max:"30000",min:"1000",step:"1000",type:"number",onChange:J},null,544),[[S,_.value.retrySettings.timeout,void 0,{number:!0}]])])])]),e("div",{class:"mt-6 text-center"},[e("button",{class:"rounded-lg bg-green-600 px-6 py-3 text-white shadow-lg transition-all hover:bg-green-700 hover:shadow-xl",onClick:ze},[...t[100]||(t[100]=[e("i",{class:"fas fa-paper-plane mr-2"},null,-1),c(" 发送测试通知 ",-1)])])])],512),[[te,w.value==="webhook"]]),g(e("div",null,[e("div",ia,[t[105]||(t[105]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"数据概览",-1)),e("div",ua,[e("div",ga,[e("div",ba,b(A.value.apiKeys),1),t[101]||(t[101]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Keys",-1))]),e("div",ca,[e("div",fa,b(A.value.claudeAccounts),1),t[102]||(t[102]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Claude账户",-1))]),e("div",ya,[e("div",xa,b(A.value.openaiAccounts),1),t[103]||(t[103]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"OpenAI账户",-1))]),e("div",pa,[e("div",ma,b(A.value.systemConfig),1),t[104]||(t[104]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"系统配置",-1))])]),e("div",va,[e("div",ka,[e("div",wa,[e("div",ha,[e("div",{class:D(["mr-2 h-3 w-3 rounded-full",A.value.is2FAEnabled?"bg-green-500":"bg-red-500"])},null,2),e("span",Ca," 2FA状态: "+b(A.value.is2FAEnabled?"已启用":"未启用"),1)])]),A.value.lastExport?(n(),o("div",_a," 最后导出: "+b(yt(A.value.lastExport)),1)):v("",!0)])])]),A.value.is2FAEnabled?v("",!0):(n(),o("div",Sa,[e("div",{class:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-800 dark:bg-yellow-900/20"},[t[106]||(t[106]=G('<div class="flex items-center" data-v-1fb3dfb6><svg class="mr-3 h-5 w-5 text-yellow-600" fill="currentColor" viewBox="0 0 20 20" data-v-1fb3dfb6><path clip-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" fill-rule="evenodd" data-v-1fb3dfb6></path></svg><div data-v-1fb3dfb6><h3 class="font-medium text-yellow-800 dark:text-yellow-200" data-v-1fb3dfb6>需要启用2FA</h3><p class="mt-1 text-sm text-yellow-700 dark:text-yellow-300" data-v-1fb3dfb6> 数据导出等敏感操作需要双因素认证保护，请先设置2FA。 </p></div></div>',1)),e("div",{class:"mt-3"},[e("button",{class:"rounded-md bg-yellow-600 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-700",onClick:ot}," 设置2FA ")])])])),e("div",Aa,[e("div",Da,[t[108]||(t[108]=G('<div class="mb-4 flex items-center" data-v-1fb3dfb6><svg class="mr-3 h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1fb3dfb6><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" data-v-1fb3dfb6></path></svg><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200" data-v-1fb3dfb6>数据导出</h3></div><p class="mb-4 text-sm text-gray-600 dark:text-gray-400" data-v-1fb3dfb6> 将当前数据库中的所有数据导出为加密的ZIP文件 </p>',2)),e("div",Fa,[e("label",Oa,[g(e("input",{"onUpdate:modelValue":t[17]||(t[17]=a=>ve.value.includeStats=a),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[O,ve.value.includeStats]]),t[107]||(t[107]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},"包含使用统计",-1))])]),e("button",{class:"w-full rounded-md bg-blue-600 px-4 py-2 font-medium text-white transition-colors hover:bg-blue-700 disabled:bg-gray-400",disabled:!A.value.is2FAEnabled||oe.value,onClick:ut},[oe.value?(n(),o("span",Ia,"导出中...")):(n(),o("span",Ea,"开始导出"))],8,ja)]),e("div",Ua,[t[112]||(t[112]=G('<div class="mb-4 flex items-center" data-v-1fb3dfb6><svg class="mr-3 h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1fb3dfb6><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" data-v-1fb3dfb6></path></svg><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200" data-v-1fb3dfb6>数据导入</h3></div><p class="mb-4 text-sm text-gray-600 dark:text-gray-400" data-v-1fb3dfb6> 从导出的ZIP文件恢复数据到当前数据库 </p>',2)),e("div",Va,[e("div",null,[t[110]||(t[110]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 冲突处理策略 ",-1)),g(e("select",{"onUpdate:modelValue":t[18]||(t[18]=a=>ke.value.conflictStrategy=a),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100"},[...t[109]||(t[109]=[e("option",{value:"skip"},"跳过已存在的记录",-1),e("option",{value:"overwrite"},"覆盖已存在的记录",-1),e("option",{value:"merge"},"智能合并记录",-1)])],512),[[ce,ke.value.conflictStrategy]])]),e("div",null,[t[111]||(t[111]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 选择文件 ",-1)),e("input",{ref_key:"importFileInput",ref:st,accept:".zip,.json",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",type:"file",onChange:gt},null,544)])]),e("button",{class:"w-full rounded-md bg-green-600 px-4 py-2 font-medium text-white transition-colors hover:bg-green-700 disabled:bg-gray-400",disabled:!A.value.is2FAEnabled||!de.value||ne.value,onClick:bt},[ne.value?(n(),o("span",La,"导入中...")):(n(),o("span",Ra,"开始导入"))],8,Ta)]),e("div",Ma,[t[115]||(t[115]=G('<div class="mb-4 flex items-center" data-v-1fb3dfb6><svg class="mr-3 h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1fb3dfb6><path d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" data-v-1fb3dfb6></path></svg><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200" data-v-1fb3dfb6>数据库迁移</h3></div><p class="mb-4 text-sm text-gray-600 dark:text-gray-400" data-v-1fb3dfb6> 将数据迁移到其他数据库系统（MongoDB、MySQL、PostgreSQL） </p>',2)),e("div",qa,[e("label",Wa,[g(e("input",{"onUpdate:modelValue":t[19]||(t[19]=a=>ie.value.validateOnly=a),class:"rounded border-gray-300 text-purple-600 focus:ring-purple-500",type:"checkbox"},null,512),[[O,ie.value.validateOnly]]),t[113]||(t[113]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},"仅验证（不执行迁移）",-1))]),e("div",null,[t[114]||(t[114]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 目标数据库配置文件 ",-1)),e("input",{ref_key:"migrationConfigInput",ref:lt,accept:".json",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",type:"file",onChange:ct},null,544)])]),e("button",{class:"w-full rounded-md bg-purple-600 px-4 py-2 font-medium text-white transition-colors hover:bg-purple-700 disabled:bg-gray-400",disabled:!A.value.is2FAEnabled||!ge.value||ue.value,onClick:ft},[ue.value?(n(),o("span",Ba,"迁移中...")):(n(),o("span",Na,"开始迁移"))],8,$a)])])],512),[[te,w.value==="data-management"]]),g(e("div",null,[e("div",Pa,[e("div",za,[t[117]||(t[117]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"}," 启用请求日志记录 "),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 记录所有API请求的详细信息，便于监控和调试 ")],-1)),e("label",Ga,[g(e("input",{"onUpdate:modelValue":t[20]||(t[20]=a=>i(y).enabled=a),class:"peer sr-only",type:"checkbox",onChange:V},null,544),[[O,i(y).enabled]]),t[116]||(t[116]=e("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-blue-800"},null,-1))])])]),e("div",Ka,[t[124]||(t[124]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"日志配置",-1)),e("div",Ha,[e("div",null,[t[119]||(t[119]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 日志级别 ",-1)),g(e("select",{"onUpdate:modelValue":t[21]||(t[21]=a=>i(y).level=a),class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",onChange:V},[...t[118]||(t[118]=[e("option",{value:"error"},"错误 (Error)",-1),e("option",{value:"warn"},"警告 (Warning)",-1),e("option",{value:"info"},"信息 (Info)",-1),e("option",{value:"debug"},"调试 (Debug)",-1)])],544),[[ce,i(y).level]])]),e("div",null,[t[120]||(t[120]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 日志保留天数 ",-1)),g(e("input",{"onUpdate:modelValue":t[22]||(t[22]=a=>i(y).retentionDays=a),class:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"365",min:"1",type:"number",onChange:V},null,544),[[S,i(y).retentionDays,void 0,{number:!0}]]),t[121]||(t[121]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 超过指定天数的日志将被自动清理 ",-1))]),e("div",null,[t[122]||(t[122]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 单个日志文件最大大小 (MB) ",-1)),g(e("input",{"onUpdate:modelValue":t[23]||(t[23]=a=>i(y).maxFileSize=a),class:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"1000",min:"1",type:"number",onChange:V},null,544),[[S,i(y).maxFileSize,void 0,{number:!0}]])]),e("div",null,[t[123]||(t[123]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 最大日志文件数 ",-1)),g(e("input",{"onUpdate:modelValue":t[24]||(t[24]=a=>i(y).maxFiles=a),class:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"100",min:"1",type:"number",onChange:V},null,544),[[S,i(y).maxFiles,void 0,{number:!0}]])])])]),e("div",Qa,[t[136]||(t[136]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"}," 记录内容配置 ",-1)),e("div",Za,[e("div",Ja,[e("div",Ya,[t[126]||(t[126]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"请求头"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"记录HTTP请求头信息")],-1)),e("label",Xa,[g(e("input",{"onUpdate:modelValue":t[25]||(t[25]=a=>i(y).includeHeaders=a),class:"peer sr-only",type:"checkbox",onChange:V},null,544),[[O,i(y).includeHeaders]]),t[125]||(t[125]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))])]),e("div",es,[t[128]||(t[128]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"请求体"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"记录请求体内容")],-1)),e("label",ts,[g(e("input",{"onUpdate:modelValue":t[26]||(t[26]=a=>i(y).includeBody=a),class:"peer sr-only",type:"checkbox",onChange:V},null,544),[[O,i(y).includeBody]]),t[127]||(t[127]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))])]),e("div",rs,[t[130]||(t[130]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"响应数据"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"记录API响应内容")],-1)),e("label",as,[g(e("input",{"onUpdate:modelValue":t[27]||(t[27]=a=>i(y).includeResponse=a),class:"peer sr-only",type:"checkbox",onChange:V},null,544),[[O,i(y).includeResponse]]),t[129]||(t[129]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))])]),e("div",ss,[t[132]||(t[132]=e("div",null,[e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"错误详情"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"记录错误堆栈信息")],-1)),e("label",ls,[g(e("input",{"onUpdate:modelValue":t[28]||(t[28]=a=>i(y).includeErrors=a),class:"peer sr-only",type:"checkbox",onChange:V},null,544),[[O,i(y).includeErrors]]),t[131]||(t[131]=e("div",{class:"peer h-5 w-9 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"},null,-1))])])]),e("div",os,[t[135]||(t[135]=e("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"敏感数据过滤",-1)),e("div",ns,[e("div",ds,[e("label",is,[g(e("input",{"onUpdate:modelValue":t[29]||(t[29]=a=>i(y).filterSensitiveData=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0",type:"checkbox",onChange:V},null,544),[[O,i(y).filterSensitiveData]]),t[133]||(t[133]=e("span",{class:"ml-3 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-gray-400"}),c(" 启用敏感数据过滤 ")],-1))])]),t[134]||(t[134]=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 自动过滤或脱敏API密钥、令牌、密码等敏感信息 ",-1))])])])]),e("div",us,[t[149]||(t[149]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"}," 日志统计信息 ",-1)),e("div",gs,[e("div",bs,[e("div",cs,[e("div",null,[t[137]||(t[137]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"今日日志",-1)),e("p",fs,b(Y.value.todayLogs||0),1)]),t[138]||(t[138]=e("i",{class:"fas fa-calendar-day text-xl text-blue-500"},null,-1))]),t[139]||(t[139]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"条记录",-1))]),e("div",ys,[e("div",xs,[e("div",null,[t[140]||(t[140]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"总日志数",-1)),e("p",ps,b(Y.value.totalLogs||0),1)]),t[141]||(t[141]=e("i",{class:"fas fa-file-alt text-xl text-green-500"},null,-1))]),t[142]||(t[142]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"条记录",-1))]),e("div",ms,[e("div",vs,[e("div",null,[t[143]||(t[143]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"存储占用",-1)),e("p",ks,b(pt(Y.value.storageUsed||0)),1)]),t[144]||(t[144]=e("i",{class:"fas fa-hdd text-xl text-orange-500"},null,-1))]),t[145]||(t[145]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"磁盘使用",-1))]),e("div",ws,[e("div",hs,[e("div",null,[t[146]||(t[146]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"错误日志",-1)),e("p",Cs,b(Y.value.errorLogs||0),1)]),t[147]||(t[147]=e("i",{class:"fas fa-exclamation-triangle text-xl text-red-500"},null,-1))]),t[148]||(t[148]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"条错误",-1))])])]),e("div",_s,[e("div",Ss,[e("button",{class:D(["btn btn-primary px-6 py-3",{"cursor-not-allowed opacity-50":i(Q)}]),disabled:i(Q),onClick:V},[i(Q)?(n(),o("div",Ds)):(n(),o("i",Fs)),c(" "+b(i(Q)?"保存中...":"保存配置"),1)],10,As),Le(l,{class:"btn bg-green-600 px-6 py-3 text-white hover:bg-green-700 focus:ring-green-500",to:"/request-logs"},{default:Re(()=>[...t[150]||(t[150]=[e("i",{class:"fas fa-eye mr-2"},null,-1),c(" 查看日志 ",-1)])]),_:1}),e("button",{class:"btn bg-yellow-600 px-6 py-3 text-white hover:bg-yellow-700 focus:ring-yellow-500",disabled:X.value,onClick:xt},[X.value?(n(),o("div",js)):(n(),o("i",Is)),c(" "+b(X.value?"清理中...":"清理旧日志"),1)],8,Os)]),i(y).updatedAt?(n(),o("div",Es,[t[151]||(t[151]=e("i",{class:"fas fa-clock mr-1"},null,-1)),c(" 最后更新："+b(i(he)(i(y).updatedAt)),1)])):v("",!0)])],512),[[te,w.value==="request-logging"]])]))])]),B.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-all duration-300 ease-out",onClick:ae},[e("div",{class:"relative mx-4 w-full max-w-2xl overflow-hidden rounded-2xl bg-white shadow-2xl transition-all duration-300 ease-out dark:bg-gray-800",onClick:t[35]||(t[35]=St(()=>{},["stop"]))},[e("div",Us,[e("div",Vs,[e("div",Ts,[t[153]||(t[153]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg"},[e("i",{class:"fas fa-bell"})],-1)),e("div",null,[e("h3",Ls,b(U.value?"编辑":"添加")+"通知平台 ",1),e("p",Rs," 配置"+b(U.value?"并更新":"新的")+"Webhook通知渠道 ",1)])]),e("button",{class:"rounded-lg p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:ae},[...t[154]||(t[154]=[e("i",{class:"fas fa-times text-lg"},null,-1)])])])]),e("div",Ms,[e("div",qs,[e("div",null,[t[158]||(t[158]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-layer-group mr-2 text-gray-400"}),c(" 平台类型 ")],-1)),e("div",Ws,[g(e("select",{"onUpdate:modelValue":t[30]||(t[30]=a=>p.value.type=a),class:"w-full appearance-none rounded-xl border border-gray-300 bg-white px-4 py-3 pr-10 text-gray-900 shadow-sm transition-all focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white",disabled:U.value},[...t[155]||(t[155]=[G('<option value="wechat_work" data-v-1fb3dfb6>🟢 企业微信</option><option value="dingtalk" data-v-1fb3dfb6>🔵 钉钉</option><option value="feishu" data-v-1fb3dfb6>🟦 飞书</option><option value="slack" data-v-1fb3dfb6>🟣 Slack</option><option value="discord" data-v-1fb3dfb6>🟪 Discord</option><option value="custom" data-v-1fb3dfb6>⚙️ 自定义</option>',6)])],8,$s),[[ce,p.value.type]]),t[156]||(t[156]=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("i",{class:"fas fa-chevron-down text-gray-400"})],-1))]),U.value?(n(),o("p",Bs,[...t[157]||(t[157]=[e("i",{class:"fas fa-info-circle mr-1"},null,-1),c(" 编辑模式下不能更改平台类型 ",-1)])])):v("",!0)]),e("div",null,[t[159]||(t[159]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-tag mr-2 text-gray-400"}),c(" 名称 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),g(e("input",{"onUpdate:modelValue":t[31]||(t[31]=a=>p.value.name=a),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"例如：运维群通知、开发测试群",type:"text"},null,512),[[S,p.value.name]])]),e("div",null,[t[163]||(t[163]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-link mr-2 text-gray-400"}),c(" Webhook URL "),e("span",{class:"ml-1 text-xs text-red-500"},"*")],-1)),e("div",Ns,[g(e("input",{"onUpdate:modelValue":t[32]||(t[32]=a=>p.value.url=a),class:D(["w-full rounded-xl border border-gray-300 bg-white px-4 py-3 pr-10 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",{"border-red-500 focus:border-red-500 focus:ring-red-500/20":j.value,"border-green-500 focus:border-green-500 focus:ring-green-500/20":E.value}]),placeholder:"https://...",required:"",type:"url",onInput:Me},null,34),[[S,p.value.url]]),E.value?(n(),o("div",Ps,[...t[160]||(t[160]=[e("i",{class:"fas fa-check-circle text-green-500"},null,-1)])])):v("",!0),j.value?(n(),o("div",zs,[...t[161]||(t[161]=[e("i",{class:"fas fa-exclamation-circle text-red-500"},null,-1)])])):v("",!0)]),De(p.value.type)?(n(),o("div",Gs,[t[162]||(t[162]=e("i",{class:"fas fa-info-circle mr-2 mt-0.5 text-blue-600 dark:text-blue-400"},null,-1)),e("p",Ks,b(De(p.value.type)),1)])):v("",!0)]),p.value.type==="dingtalk"||p.value.type==="feishu"?(n(),o("div",Hs,[e("div",Qs,[e("div",Zs,[e("label",Js,[g(e("input",{id:"enableSign","onUpdate:modelValue":t[33]||(t[33]=a=>p.value.enableSign=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0",type:"checkbox"},null,512),[[O,p.value.enableSign]]),t[164]||(t[164]=e("span",{class:"ml-3 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-gray-400"}),c(" 启用签名验证 ")],-1))]),p.value.enableSign?(n(),o("span",Ys," 已启用 ")):v("",!0)]),Le(_t,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:Re(()=>[p.value.enableSign?(n(),o("div",Xs,[t[165]||(t[165]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 签名密钥 ",-1)),g(e("input",{"onUpdate:modelValue":t[34]||(t[34]=a=>p.value.secret=a),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500",placeholder:"SEC...",type:"text"},null,512),[[S,p.value.secret]])])):v("",!0)]),_:1})])])):v("",!0)])]),e("div",el,[e("div",tl,[t[167]||(t[167]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},[e("i",{class:"fas fa-asterisk mr-1 text-red-500"}),c(" 必填项 ")],-1)),e("div",rl,[e("button",{class:"group flex items-center rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition-all hover:bg-gray-50 hover:shadow-md dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",onClick:ae},[...t[166]||(t[166]=[e("i",{class:"fas fa-times mr-2 transition-transform group-hover:scale-110"},null,-1),c(" 取消 ",-1)])]),e("button",{class:"group flex items-center rounded-xl border border-blue-200 bg-blue-50 px-4 py-2.5 text-sm font-medium text-blue-700 shadow-sm transition-all hover:bg-blue-100 hover:shadow-md dark:border-blue-800 dark:bg-blue-900/50 dark:text-blue-300 dark:hover:bg-blue-900/70",disabled:L.value,onClick:Pe},[e("i",{class:D(["mr-2 transition-transform",L.value?"fas fa-spinner fa-spin":"fas fa-vial group-hover:scale-110"])},null,2),c(" "+b(L.value?"测试中...":"测试连接"),1)],8,al),e("button",{class:"group flex items-center rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-5 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-blue-700 hover:to-indigo-700 hover:shadow-lg disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-500",disabled:!p.value.url||$.value,onClick:qe},[e("i",{class:D(["mr-2 transition-transform",$.value?"fas fa-spinner fa-spin":"fas fa-save group-hover:scale-110"])},null,2),c(" "+b($.value?"保存中...":U.value?"保存修改":"添加平台"),1)],8,sl)])])])])])):v("",!0),se.value?(n(),o("div",ll,[e("div",ol,[e("div",nl,[t[169]||(t[169]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"设置双因素认证",-1)),e("button",{class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",onClick:t[36]||(t[36]=a=>se.value=!1)},[...t[168]||(t[168]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])])]),R.value===1?(n(),o("div",dl,[t[171]||(t[171]=e("p",{class:"mb-4 text-gray-600 dark:text-gray-400"}," 使用Google Authenticator或Authy扫描二维码： ",-1)),xe.value?(n(),o("div",il,[e("img",{alt:"2FA QR Code",class:"mx-auto rounded border",src:xe.value},null,8,ul)])):v("",!0),pe.value?(n(),o("div",gl,[t[170]||(t[170]=e("p",{class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},"手动输入密钥：",-1)),e("code",bl,b(pe.value),1)])):v("",!0),e("button",{class:"w-full rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",onClick:t[37]||(t[37]=a=>R.value=2)}," 下一步 ")])):v("",!0),R.value===2?(n(),o("div",cl,[t[172]||(t[172]=e("p",{class:"mb-4 text-gray-600 dark:text-gray-400"},"输入应用显示的6位验证码：",-1)),g(e("input",{"onUpdate:modelValue":t[38]||(t[38]=a=>P.value=a),class:"mb-4 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-center font-mono text-2xl text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",maxlength:"6",placeholder:"000000",type:"text"},null,512),[[S,P.value]]),e("div",fl,[e("button",{class:"flex-1 rounded-md bg-gray-500 px-4 py-2 text-white hover:bg-gray-600",onClick:t[39]||(t[39]=a=>R.value=1)}," 上一步 "),e("button",{class:"flex-1 rounded-md bg-green-600 px-4 py-2 text-white hover:bg-green-700 disabled:bg-gray-400",disabled:!P.value||P.value.length!==6,onClick:nt}," 启用2FA ",8,yl)])])):v("",!0),R.value===3&&me.value?(n(),o("div",xl,[t[173]||(t[173]=e("p",{class:"mb-4 text-gray-600 dark:text-gray-400"},"2FA设置成功！请保存以下备份码：",-1)),e("div",pl,[e("div",ml,[(n(!0),o(fe,null,Ce(me.value,a=>(n(),o("div",{key:a,class:"text-center"},b(a),1))),128))])]),e("button",{class:"w-full rounded-md bg-green-600 px-4 py-2 text-white hover:bg-green-700",onClick:dt}," 完成设置 ")])):v("",!0)])])):v("",!0),q.value?(n(),o("div",vl,[e("div",kl,[e("div",wl,[t[175]||(t[175]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"敏感操作验证",-1)),e("button",{class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",onClick:t[40]||(t[40]=a=>q.value=!1)},[...t[174]||(t[174]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)])])]),e("div",hl,[e("div",null,[t[176]||(t[176]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 管理员密码 ",-1)),g(e("input",{"onUpdate:modelValue":t[41]||(t[41]=a=>h.value.password=a),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",type:"password"},null,512),[[S,h.value.password]])]),e("div",null,[t[177]||(t[177]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 2FA验证码 ",-1)),g(e("input",{"onUpdate:modelValue":t[42]||(t[42]=a=>h.value.token=a),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-center font-mono text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",maxlength:"8",placeholder:"6位验证码或8位备份码",type:"text"},null,512),[[S,h.value.token]])]),e("div",Cl,[e("button",{class:"flex-1 rounded-md bg-gray-500 px-4 py-2 text-white hover:bg-gray-600",onClick:t[43]||(t[43]=a=>q.value=!1)}," 取消 "),e("button",{class:"flex-1 rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:bg-gray-400",disabled:!h.value.password||!h.value.token||le.value,onClick:it},[le.value?(n(),o("span",Sl,"验证中...")):(n(),o("span",Al,"验证"))],8,_l)])])])])):v("",!0)],64)}}}),Vl=At(Dl,[["__scopeId","data-v-1fb3dfb6"]]);export{Vl as default};
