import{c as m,r as C,_ as de,q as ue,V as ce,o as E,x as r,y as n,z as e,L as _,R as I,J as F,P as v,C as P,Y as J,O as T,T as ge,K as N,aq as D,Q as K,aX as Q,ac as H,ax as me,aZ as pe,D as xe}from"./vue-vendor-CngTbNDx.js";import{_ as q,u as O,c as G,s as U}from"./index-CQzQO6ls.js";import{L as fe}from"./LogoTitle-CGW7ekC6.js";import{T as ve}from"./ThemeToggle-ttUb9eOE.js";import"./element-plus-dC9ox4YM.js";import"./vendor-yff5vP9v.js";const ye={class:"glass-strong mb-4 rounded-xl p-3 shadow-xl sm:mb-6 sm:rounded-2xl sm:p-4 md:mb-8 md:rounded-3xl md:p-6",style:{"z-index":"10",position:"relative"}},be={class:"flex flex-col items-center justify-between gap-3 sm:flex-row sm:gap-4"},ke={class:"flex w-full items-center justify-center gap-2 sm:w-auto sm:justify-start sm:gap-3 md:gap-4"},he={class:"flex items-center gap-1 sm:gap-2"},we={class:"font-mono text-xs text-gray-400 dark:text-gray-500 sm:text-sm"},_e=["href"],Te={class:"flex items-center gap-2 sm:gap-4"},Ue={class:"flex items-center"},Ce=["title"],Pe={class:"hidden text-xs font-medium md:inline"},Ie={class:"user-menu-container relative"},Se={class:"hidden sm:inline"},Me={key:0,class:"hidden text-xs opacity-75 lg:inline"},$e={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},Ae={class:"mb-3 flex items-center gap-3"},Ne={class:"font-semibold text-gray-900 dark:text-gray-100"},De={class:"text-xs text-gray-500 dark:text-gray-400"},je={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},Le={class:"flex items-center justify-between text-sm"},Ve={class:"font-mono text-gray-700 dark:text-gray-300"},Ee={key:0,class:"mt-2"},Ke={class:"mb-2 flex items-center justify-between text-sm"},qe={class:"font-mono text-green-600 dark:text-green-400"},Oe=["href"],ze={key:1,class:"mt-2 text-center text-xs text-gray-500 dark:text-gray-400"},Be={key:2,class:"mt-2 text-center"},Re={key:"message",class:"inline-block rounded-lg border border-green-200 bg-green-100 px-3 py-1.5 dark:border-green-800 dark:bg-green-900/30"},Fe={key:0,class:"border-b border-gray-200 dark:border-gray-700"},Je={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},He={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-4 sm:p-6 md:p-8"},Ge=["value"],Qe={class:"flex gap-3 pt-4"},Xe=["disabled"],Ye={key:0,class:"loading-spinner mr-2"},Ze={key:1,class:"fas fa-save mr-2"},We=5*60*1e3,et={__name:"AppHeader",props:{sessionToken:{type:String,default:""},expiresAt:{type:[String,Number],default:null}},emits:["logout"],setup(w,{emit:h}){const g=w,b=h,o=Q(),s=O(),f=m(()=>s.user||{username:"Admin"}),S=m(()=>s.oemSettings||{}),p=m(()=>s.oemLoading),i=C(Date.now()),d=m(()=>g.expiresAt?typeof g.expiresAt=="string"?new Date(g.expiresAt).getTime():g.expiresAt:null),k=m(()=>d.value?Math.max(0,d.value-i.value):0),X=m(()=>k.value<=0),Y=m(()=>k.value>0&&k.value<=We),A=m(()=>g.sessionToken?X.value?"expired":Y.value?"expiring":"active":"none"),Z=m(()=>{switch(A.value){case"active":return"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400";case"expiring":return"bg-yellow-50 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400";case"expired":return"bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400";default:return"bg-gray-50 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}}),W=m(()=>{switch(A.value){case"active":return"fas fa-check-circle";case"expiring":return"fas fa-clock";case"expired":return"fas fa-times-circle";default:return"fas fa-question-circle"}}),ee=m(()=>{switch(A.value){case"active":return"会话正常";case"expiring":return`会话即将过期 (${se(k.value)})`;case"expired":return"会话已过期";default:return"未登录"}}),te=m(()=>{switch(A.value){case"active":return"已连接";case"expiring":return"即将过期";case"expired":return"已过期";default:return"离线"}}),se=u=>{const t=Math.floor(u/1e3),x=Math.floor(t/60),c=Math.floor(x/60);return c>0?`${c}小时${x%60}分钟`:x>0?`${x}分钟`:`${t}秒`},a=C({current:"...",latest:"",hasUpdate:!1,checkingUpdate:!1,lastChecked:null,releaseInfo:null,noUpdateMessage:!1}),y=C(!1),j=C(!1),M=C(!1),l=de({currentPassword:"",newPassword:"",confirmPassword:"",newUsername:""}),L=async()=>{if(!a.value.checkingUpdate){a.value.checkingUpdate=!0;try{const u=await G.get("/admin/check-updates");if(u.success){const t=u.data;a.value.current=t.current,a.value.latest=t.latest,a.value.hasUpdate=t.hasUpdate,a.value.releaseInfo=t.releaseInfo,a.value.lastChecked=new Date,localStorage.setItem("versionInfo",JSON.stringify({current:t.current,latest:t.latest,lastChecked:a.value.lastChecked,hasUpdate:t.hasUpdate,releaseInfo:t.releaseInfo})),t.hasUpdate||(a.value.noUpdateMessage=!0,setTimeout(()=>{a.value.noUpdateMessage=!1},3e3))}}catch(u){console.error("Error checking for updates:",u);const t=localStorage.getItem("versionInfo");if(t){const x=JSON.parse(t);a.value.current=x.current||a.value.current,a.value.latest=x.latest,a.value.hasUpdate=x.hasUpdate,a.value.releaseInfo=x.releaseInfo,a.value.lastChecked=new Date(x.lastChecked)}}finally{a.value.checkingUpdate=!1}}},ae=()=>{l.currentPassword="",l.newPassword="",l.confirmPassword="",l.newUsername="",j.value=!0,y.value=!1},V=()=>{j.value=!1},re=async()=>{if(l.newPassword!==l.confirmPassword){U("两次输入的密码不一致","error");return}if(l.newPassword.length<8){U("新密码长度至少8位","error");return}M.value=!0;try{const u=await G.post("/web/auth/change-password",{currentPassword:l.currentPassword,newPassword:l.newPassword,newUsername:l.newUsername||void 0});if(u.success){const t=l.newUsername?"账户信息修改成功，请重新登录":"密码修改成功，请重新登录";U(t,"success"),V(),setTimeout(()=>{s.logout(),o.push("/login")},1500)}else U(u.message||"修改失败","error")}catch{U("修改密码失败","error")}finally{M.value=!1}},ne=()=>{confirm("确定要退出登录吗？")&&(s.logout(),o.push("/login"),U("已安全退出","success"),b("logout")),y.value=!1},oe=()=>{o.push("/users"),y.value=!1},le=()=>{o.push("/user-groups"),y.value=!1},ie=()=>{o.push("/settings"),y.value=!1},z=u=>{!u.target.closest(".user-menu-container")&&y.value&&(y.value=!1)};let $=null;const B=()=>{$||($=setInterval(()=>{i.value=Date.now()},1e3))},R=()=>{$&&(clearInterval($),$=null)};return ue(()=>{L(),setInterval(()=>{L()},36e5),g.sessionToken&&B(),document.addEventListener("click",z)}),ce(()=>{R(),document.removeEventListener("click",z)}),E(()=>g.sessionToken,u=>{u?B():R()}),E(()=>g.expiresAt,()=>{g.sessionToken&&(i.value=Date.now())}),(u,t)=>{var x;return n(),r(K,null,[e("div",ye,[e("div",be,[e("div",ke,[I(fe,{loading:p.value,"logo-src":S.value.siteIconData||S.value.siteIcon,subtitle:"管理后台",title:S.value.siteName,"title-class":"text-white dark:text-gray-100"},{"after-title":F(()=>{var c;return[e("div",he,[e("span",we,"v"+v(a.value.current||"..."),1),a.value.hasUpdate?(n(),r("a",{key:0,class:"inline-flex animate-pulse items-center gap-1 rounded-full border border-green-600 bg-green-500 px-2 py-0.5 text-xs text-white transition-colors hover:bg-green-600",href:((c=a.value.releaseInfo)==null?void 0:c.htmlUrl)||"#",target:"_blank",title:"有新版本可用"},[...t[7]||(t[7]=[e("i",{class:"fas fa-arrow-up text-[10px]"},null,-1),e("span",null,"新版本",-1)])],8,_e)):_("",!0)])]}),_:1},8,["loading","logo-src","title"])]),e("div",Te,[e("div",Ue,[I(ve,{mode:"dropdown"})]),w.sessionToken?(n(),r("div",{key:0,class:P(["hidden items-center gap-1.5 rounded-lg px-2 py-1 sm:flex",Z.value]),title:ee.value},[e("i",{class:P(["text-xs",W.value])},null,2),e("span",Pe,v(te.value),1)],10,Ce)):_("",!0),t[23]||(t[23]=e("div",{class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},null,-1)),e("div",Ie,[e("button",{class:"user-menu-button flex items-center gap-2 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 sm:px-4 sm:py-2.5",onClick:t[0]||(t[0]=c=>y.value=!y.value)},[t[8]||(t[8]=e("i",{class:"fas fa-user-circle text-sm sm:text-base"},null,-1)),e("span",Se,v(f.value.username||"Admin"),1),f.value.role?(n(),r("span",Me," ("+v(f.value.role==="admin"?"管理员":"用户")+") ",1)):_("",!0),e("i",{class:P(["fas fa-chevron-down ml-1 text-xs transition-transform duration-200",{"rotate-180":y.value}])},null,2)]),y.value?(n(),r("div",{key:0,class:"user-menu-dropdown absolute right-0 top-full mt-2 w-48 rounded-xl border border-gray-200 bg-white py-2 shadow-xl dark:border-gray-700 dark:bg-gray-800 sm:w-56",style:{"z-index":"999999"},onClick:t[2]||(t[2]=J(()=>{},["stop"]))},[e("div",$e,[e("div",Ae,[e("div",{class:P(["flex h-10 w-10 items-center justify-center rounded-full",f.value.role==="admin"?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[...t[9]||(t[9]=[e("i",{class:"fas fa-user text-sm text-white"},null,-1)])],2),e("div",null,[e("div",Ne,v(f.value.username||"Admin"),1),e("div",De,v(f.value.role==="admin"?"系统管理员":"普通用户"),1)])])]),e("div",je,[e("div",Le,[t[10]||(t[10]=e("span",{class:"text-gray-500 dark:text-gray-400"},"当前版本",-1)),e("span",Ve,"v"+v(a.value.current||"..."),1)]),a.value.hasUpdate?(n(),r("div",Ee,[e("div",Ke,[t[11]||(t[11]=e("span",{class:"font-medium text-green-600 dark:text-green-400"},[e("i",{class:"fas fa-arrow-up mr-1"}),T("有新版本 ")],-1)),e("span",qe,"v"+v(a.value.latest),1)]),e("a",{class:"block w-full rounded-lg bg-green-500 px-3 py-1.5 text-center text-sm text-white transition-colors hover:bg-green-600",href:((x=a.value.releaseInfo)==null?void 0:x.htmlUrl)||"#",target:"_blank"},[...t[12]||(t[12]=[e("i",{class:"fas fa-external-link-alt mr-1"},null,-1),T("查看更新 ",-1)])],8,Oe)])):a.value.checkingUpdate?(n(),r("div",ze,[...t[13]||(t[13]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),T("检查更新中... ",-1)])])):(n(),r("div",Be,[I(ge,{mode:"out-in",name:"fade"},{default:F(()=>[a.value.noUpdateMessage?(n(),r("div",Re,[...t[14]||(t[14]=[e("p",{class:"text-xs font-medium text-green-700 dark:text-green-400"},[e("i",{class:"fas fa-check-circle mr-1"}),T("当前已是最新版本 ")],-1)])])):(n(),r("button",{key:"button",class:"text-xs text-blue-500 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:t[1]||(t[1]=c=>L())},[...t[15]||(t[15]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),T("检查更新 ",-1)])]))]),_:1})]))]),f.value.role==="admin"?(n(),r("div",Fe,[e("div",{class:"px-4 py-2"},[t[19]||(t[19]=e("p",{class:"mb-2 text-xs font-medium text-gray-500 dark:text-gray-400"},"管理功能",-1)),e("div",{class:"space-y-1"},[e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:oe},[...t[16]||(t[16]=[e("i",{class:"fas fa-user-friends w-4 text-xs text-blue-500"},null,-1),e("span",null,"用户管理",-1)])]),e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:le},[...t[17]||(t[17]=[e("i",{class:"fas fa-users-cog w-4 text-xs text-purple-500"},null,-1),e("span",null,"用户组管理",-1)])]),e("button",{class:"flex w-full items-center gap-3 rounded-lg px-2 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:ie},[...t[18]||(t[18]=[e("i",{class:"fas fa-cogs w-4 text-xs text-gray-500"},null,-1),e("span",null,"系统设置",-1)])])])])])):_("",!0),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:ae},[...t[20]||(t[20]=[e("i",{class:"fas fa-key text-blue-500"},null,-1),e("span",null,"修改账户信息",-1)])]),t[22]||(t[22]=e("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1)),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:ne},[...t[21]||(t[21]=[e("i",{class:"fas fa-sign-out-alt text-red-500"},null,-1),e("span",null,"退出登录",-1)])])])):_("",!0)])])])]),j.value?(n(),r("div",Je,[e("div",He,[e("div",{class:"mb-6 flex items-center justify-between"},[t[25]||(t[25]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改账户信息")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:V},[...t[24]||(t[24]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-6",onSubmit:J(re,["prevent"])},[e("div",null,[t[26]||(t[26]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前用户名",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 dark:bg-gray-700 dark:text-gray-300",disabled:"",type:"text",value:f.value.username||"Admin"},null,8,Ge),t[27]||(t[27]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 当前用户名，输入新用户名以修改 ",-1))]),e("div",null,[t[28]||(t[28]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新用户名",-1)),N(e("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>l.newUsername=c),class:"form-input w-full",placeholder:"输入新用户名（留空保持不变）",type:"text"},null,512),[[D,l.newUsername]]),t[29]||(t[29]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"留空表示不修改用户名",-1))]),e("div",null,[t[30]||(t[30]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前密码",-1)),N(e("input",{"onUpdate:modelValue":t[4]||(t[4]=c=>l.currentPassword=c),class:"form-input w-full",placeholder:"请输入当前密码",required:"",type:"password"},null,512),[[D,l.currentPassword]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新密码",-1)),N(e("input",{"onUpdate:modelValue":t[5]||(t[5]=c=>l.newPassword=c),class:"form-input w-full",placeholder:"请输入新密码",required:"",type:"password"},null,512),[[D,l.newPassword]]),t[32]||(t[32]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"密码长度至少8位",-1))]),e("div",null,[t[33]||(t[33]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"确认新密码",-1)),N(e("input",{"onUpdate:modelValue":t[6]||(t[6]=c=>l.confirmPassword=c),class:"form-input w-full",placeholder:"请再次输入新密码",required:"",type:"password"},null,512),[[D,l.confirmPassword]])]),e("div",Qe,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:V}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:M.value,type:"submit"},[M.value?(n(),r("div",Ye)):(n(),r("i",Ze)),T(" "+v(M.value?"保存中...":"保存修改"),1)],8,Xe)])],32)])])):_("",!0)],64)}}},tt=q(et,[["__scopeId","data-v-9e1dfb1a"]]),st={class:"mb-4 sm:mb-6"},at={class:"block rounded-xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:hidden"},rt=["value"],nt=["value"],ot={class:"hidden flex-wrap gap-2 rounded-2xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:flex"},lt=["onClick"],it={class:"hidden md:inline"},dt={class:"md:hidden"},ut={__name:"TabBar",props:{activeTab:{type:String,required:!0}},emits:["tab-change"],setup(w){const h=O(),g=m(()=>{var o;const b=[{key:"dashboard",name:"仪表板",shortName:"仪表板",icon:"fas fa-tachometer-alt"},{key:"apiKeys",name:"API Keys",shortName:"API",icon:"fas fa-key"},{key:"accounts",name:"账户管理",shortName:"账户",icon:"fas fa-user-circle"}];return(o=h.oemSettings)!=null&&o.ldapEnabled&&b.push({key:"userManagement",name:"用户管理",shortName:"用户",icon:"fas fa-users"}),b.push({key:"tutorial",name:"使用教程",shortName:"教程",icon:"fas fa-graduation-cap"},{key:"settings",name:"系统设置",shortName:"设置",icon:"fas fa-cogs"}),b});return(b,o)=>(n(),r("div",st,[e("div",at,[e("select",{class:"focus:ring-primary-color w-full rounded-lg bg-white/90 px-4 py-3 font-semibold text-gray-700 focus:outline-none focus:ring-2 dark:bg-gray-800/90 dark:text-gray-200 dark:focus:ring-indigo-400",value:w.activeTab,onChange:o[0]||(o[0]=s=>b.$emit("tab-change",s.target.value))},[(n(!0),r(K,null,H(g.value,s=>(n(),r("option",{key:s.key,value:s.key},v(s.name),9,nt))),128))],40,rt)]),e("div",ot,[(n(!0),r(K,null,H(g.value,s=>(n(),r("button",{key:s.key,class:P(["tab-btn flex-1 px-3 py-2 text-xs font-semibold transition-all duration-300 sm:px-4 sm:py-3 sm:text-sm md:px-6",w.activeTab===s.key?"active":"text-gray-700 hover:bg-white/10 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700/30 dark:hover:text-gray-100"]),onClick:f=>b.$emit("tab-change",s.key)},[e("i",{class:P(s.icon+" mr-1 sm:mr-2")},null,2),e("span",it,v(s.name),1),e("span",dt,v(s.shortName||s.name),1)],10,lt))),128))])]))}},ct=q(ut,[["__scopeId","data-v-bc8f3d44"]]),gt={class:"min-h-screen p-3 sm:p-4 md:p-6"},mt={class:"glass-strong rounded-xl p-3 shadow-xl sm:rounded-2xl sm:p-4 md:rounded-3xl md:p-6",style:{"z-index":"1","min-height":"calc(100vh - 120px)"}},pt={class:"tab-content"},xt={__name:"MainLayout",setup(w){const h=pe(),g=Q(),b=O(),o=C("dashboard"),s=m(()=>{var i;const p={dashboard:"/dashboard",apiKeys:"/api-keys",accounts:"/accounts",tutorial:"/tutorial",settings:"/settings"};return(i=b.oemSettings)!=null&&i.ldapEnabled&&(p.userManagement="/user-management"),p}),f=()=>{const p=h.path,i=Object.keys(s.value).find(d=>s.value[d]===p);if(i)o.value=i;else{const d=h.name,k={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};d&&k[d]?o.value=k[d]:o.value="dashboard"}};f(),E(()=>h.path,p=>{const i=Object.keys(s.value).find(d=>s.value[d]===p);if(i)o.value=i;else{const d=h.name,k={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};d&&k[d]&&(o.value=k[d])}});const S=async p=>{if(s.value[p]!==h.path){o.value=p;try{await g.push(s.value[p]),await xe()}catch(i){i.name!=="NavigationDuplicated"&&(console.error("路由切换失败:",i),f())}}};return(p,i)=>{const d=me("router-view");return n(),r("div",gt,[I(tt),e("div",mt,[I(ct,{"active-tab":o.value,onTabChange:S},null,8,["active-tab"]),e("div",pt,[I(d)])])])}}},wt=q(xt,[["__scopeId","data-v-4d6bba6e"]]);export{wt as default};
