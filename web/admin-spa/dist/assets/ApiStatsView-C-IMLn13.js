import{aR as ht,r as P,c as U,a_ as Z,x as u,y as d,z as t,O as h,L as K,P as n,u as e,C as D,K as xt,aq as yt,aa as pt,f as vt,Y as _t,Q as J,ac as Q,B as rt,R as G,q as kt,aZ as wt,V as $t,o as St,I as mt,J as bt,ax as Ct}from"./vue-vendor-CngTbNDx.js";import{_ as X,a as Tt}from"./index-CQzQO6ls.js";import{L as Lt}from"./LogoTitle-CGW7ekC6.js";import{T as Kt}from"./ThemeToggle-ttUb9eOE.js";import{b as At}from"./vendor-yff5vP9v.js";import{_ as Pt}from"./WindowCountdown-DzdmYFMU.js";import Mt from"./TutorialView-BJRQcZVF.js";import"./element-plus-dC9ox4YM.js";class Dt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(v,s={}){try{this.isDev&&v.startsWith("/admin")&&(v="/webapi"+v);const x=await fetch(`${this.baseURL}${v}`,{headers:{"Content-Type":"application/json",...s.headers},...s}),f=await x.json();if(!x.ok)throw new Error(f.message||`请求失败: ${x.status}`);return f}catch(x){throw console.error("API Stats request error:",x),x}}async getKeyId(v){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:v})})}async getUserStats(v){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:v})})}async getUserModelStats(v,s="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:v,period:s})})}async getUserHourlyStats(v,s,x=24){return this.request("/apiStats/api/user-model-stats/hourly",{method:"POST",body:JSON.stringify({apiKey:v,date:s,hours:x})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(v){return console.error("Failed to load OEM settings:",v),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(v){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:v})})}async getBatchModelStats(v,s="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:v,period:s})})}}const H=new Dt,tt=ht("apistats",()=>{const R=P(""),v=P(null),s=P(!1),x=P(!1),f=P(!0),b=P(""),y=P("daily"),C=P(null),T=P([]),M=P(null),g=P(null),_=P([]),N=P(!1),k=P(""),m=P({selectedHours:24,selectedDate:new Date().toISOString().split("T")[0]}),l=P({siteName:"",siteIcon:"",siteIconData:""}),a=P(!1),S=P([]),A=P([]),j=P(null),F=P([]),W=P([]),q=U(()=>{const i={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return a.value&&j.value?y.value==="daily"?j.value.dailyUsage||i:j.value.monthlyUsage||i:y.value==="daily"?M.value||i:y.value==="monthly"?g.value||i:y.value==="hourly"&&$.value||i}),$=U(()=>{if(!_.value||_.value.length===0)return null;const i={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return _.value.forEach(p=>{var L;i.requests+=p.requests||0,i.inputTokens+=p.inputTokens||0,i.outputTokens+=p.outputTokens||0,i.cacheCreateTokens+=p.cacheCreateTokens||0,i.cacheReadTokens+=p.cacheReadTokens||0,i.allTokens+=p.allTokens||0,i.cost+=((L=p.costs)==null?void 0:L.total)||0}),i.formattedCost=w(i.cost),i}),et=U(()=>{if(!C.value||!q.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const i=q.value,p=C.value.limits;return{tokenUsage:p.tokenLimit>0?Math.min(i.allTokens/p.tokenLimit*100,100):0,costUsage:p.dailyCostLimit>0?Math.min(i.cost/p.dailyCostLimit*100,100):0,requestUsage:p.rateLimitRequests>0?Math.min(i.requests/p.rateLimitRequests*100,100):0}});async function V(){if(a.value)return B();const i=R.value.trim();if(!i){b.value="请输入 API Key";return}if(i.length<10||i.length>512){b.value="API Key 格式无效：长度应在 10-512 个字符之间";return}s.value=!0,b.value="",C.value=null,T.value=[],v.value=null;try{const p=await H.getKeyId(i);if(p.success){v.value=p.data.id;const L=await H.getUserStats(v.value);if(L.success)C.value=L.data,await lt(),b.value="",I();else throw new Error(L.message||"查询失败")}else throw new Error(p.message||"获取 API Key ID 失败")}catch(p){console.error("Query stats error:",p),b.value=p.message||"查询统计数据失败，请检查您的 API Key 是否正确",C.value=null,T.value=[],v.value=null}finally{s.value=!1}}async function lt(){v.value&&(await Promise.all([st("daily"),st("monthly")]),await it(y.value))}async function st(i){try{const p=await H.getUserModelStats(v.value,i);if(p.success){const L=p.data||[],E={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};L.forEach(O=>{var Y;E.requests+=O.requests||0,E.inputTokens+=O.inputTokens||0,E.outputTokens+=O.outputTokens||0,E.cacheCreateTokens+=O.cacheCreateTokens||0,E.cacheReadTokens+=O.cacheReadTokens||0,E.allTokens+=O.allTokens||0,E.cost+=((Y=O.costs)==null?void 0:Y.total)||0}),E.formattedCost=w(E.cost),i==="daily"?M.value=E:g.value=E}else console.warn(`Failed to load ${i} stats:`,p.message)}catch(p){console.error(`Load ${i} stats error:`,p)}}async function it(i="daily"){if(v.value){x.value=!0;try{const p=await H.getUserModelStats(v.value,i);if(p.success)T.value=p.data||[];else throw new Error(p.message||"加载模型统计失败")}catch(p){console.error("Load model stats error:",p),T.value=[]}finally{x.value=!1}}}async function ft(i){if(!(y.value===i||x.value)){if(y.value=i,a.value&&A.value.length>0){await at(i);return}i==="daily"&&!M.value||i==="monthly"&&!g.value?await st(i):i==="hourly"&&await ot(),await it(i)}}async function ot(){if(!R.value){k.value="请先输入 API Key";return}N.value=!0,k.value="";try{const i=await H.getUserHourlyStats(R.value,m.value.selectedDate,m.value.selectedHours);if(i.success)_.value=i.data||[],k.value="";else throw new Error(i.message||"加载小时统计失败")}catch(i){console.error("Load hourly stats error:",i),k.value=i.message||"加载小时统计失败",_.value=[]}finally{N.value=!1}}async function o(i){m.value={...m.value,...i},y.value==="hourly"&&await ot()}async function r(){var i,p;if(v.value){s.value=!0,b.value="",C.value=null,T.value=[];try{const L=await H.getUserStats(v.value);if(L.success)C.value=L.data,console.log("API Stats - Full response:",L.data),console.log("API Stats - limits data:",L.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(i=L.data.limits)==null?void 0:i.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(p=L.data.limits)==null?void 0:p.weeklyOpusCost),await lt(),b.value="";else throw new Error(L.message||"查询失败")}catch(L){console.error("Load stats with apiId error:",L),b.value=L.message||"查询统计数据失败",C.value=null,T.value=[]}finally{s.value=!1}}}async function c(){f.value=!0;try{const i=await H.getOemSettings();i&&i.success&&i.data&&(l.value={...l.value,...i.data})}catch(i){console.error("Error loading OEM settings:",i),l.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{f.value=!1}}function w(i){return typeof i!="number"||i===0?"$0.000000":i>=1?"$"+i.toFixed(2):i>=.01?"$"+i.toFixed(4):"$"+i.toFixed(6)}function I(){if(v.value){const i=new URL(window.location);i.searchParams.set("apiId",v.value),window.history.pushState({},"",i)}}async function B(){const i=dt();if(i.length===0){b.value="请输入至少一个有效的 API Key";return}s.value=!0,b.value="",j.value=null,F.value=[],W.value=[],T.value=[],S.value=i,A.value=[];try{const p=await Promise.allSettled(i.map(Y=>H.getKeyId(Y))),L=[],E=[];if(p.forEach((Y,gt)=>{Y.status==="fulfilled"&&Y.value.success?(L.push(Y.value.data.id),E.push(i[gt])):W.value.push(i[gt])}),L.length===0)throw new Error("所有 API Key 都无效");A.value=L,S.value=E;const O=await H.getBatchStats(L);if(O.success)j.value=O.data.aggregated,F.value=O.data.individual,C.value=O.data.aggregated,M.value=O.data.aggregated.dailyUsage||null,g.value=O.data.aggregated.monthlyUsage||null,await at(y.value),ut();else throw new Error(O.message||"批量查询失败")}catch(p){console.error("Batch query error:",p),b.value=p.message||"批量查询统计数据失败",j.value=null,F.value=[]}finally{s.value=!1}}async function at(i="daily"){if(A.value.length!==0){x.value=!0;try{const p=await H.getBatchModelStats(A.value,i);if(p.success)T.value=p.data||[];else throw new Error(p.message||"加载批量模型统计失败")}catch(p){console.error("Load batch model stats error:",p),T.value=[]}finally{x.value=!1}}}function dt(){if(!R.value)return[];const i=R.value.split(/[,\n]+/).map(L=>L.trim()).filter(L=>L.length>=10&&L.length<=512);return[...new Set(i)].slice(0,30)}function ut(){if(A.value.length>0){const i=new URL(window.location);i.searchParams.set("apiIds",A.value.join(",")),i.searchParams.set("batch","true"),window.history.pushState({},"",i)}}function z(){R.value=""}function nt(){C.value=null,T.value=[],M.value=null,g.value=null,_.value=[],k.value="",b.value="",y.value="daily",v.value=null,S.value=[],A.value=[],j.value=null,F.value=[],W.value=[]}function ct(){R.value="",a.value=!1,nt()}return{apiKey:R,apiId:v,loading:s,modelStatsLoading:x,oemLoading:f,error:b,statsPeriod:y,statsData:C,modelStats:T,dailyStats:M,monthlyStats:g,hourlyStats:_,hourlyLoading:N,hourlyError:k,hourlyConfig:m,oemSettings:l,multiKeyMode:a,apiKeys:S,apiIds:A,aggregatedStats:j,individualStats:F,invalidKeys:W,currentPeriodData:q,hourlyStatsSummary:$,usagePercentages:et,queryStats:V,queryBatchStats:B,loadAllPeriodStats:lt,loadPeriodStats:st,loadModelStats:it,loadBatchModelStats:at,switchPeriod:ft,loadHourlyStats:ot,updateHourlyConfig:o,loadStatsWithApiId:r,loadOemSettings:c,clearData:nt,clearInput:z,reset:ct}}),It={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},qt={class:"mx-auto max-w-4xl"},Ut={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Rt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Nt={class:"button-group flex items-center gap-2"},Ot={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},jt={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Et={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Ft={class:"lg:col-span-3"},Wt=["disabled"],Bt={key:1,class:"relative"},Ht=["disabled"],Vt={class:"lg:col-span-1"},zt=["disabled"],Jt={key:0,class:"fas fa-spinner loading-spinner"},Yt={key:1,class:"fas fa-search"},Gt={class:"security-notice mt-4"},Qt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Zt={__name:"ApiKeyInput",setup(R){const v=tt(),{apiKey:s,loading:x,multiKeyMode:f}=Z(v),{queryStats:b,clearInput:y}=v,C=U(()=>{if(!f.value||!s.value)return[];const M=s.value.split(/[,\n]+/).map(_=>_.trim()).filter(_=>_.length>0);return[...new Set(M)].slice(0,30)}),T=U(()=>f.value?C.value.length>0:s.value&&s.value.trim().length>0);return(M,g)=>(d(),u("div",It,[g[15]||(g[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),h(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",qt,[t("div",Ut,[t("label",Rt,[g[8]||(g[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),h(" "+n(e(f)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",Nt,[t("div",Ot,[t("button",{class:D(["mode-switch-btn",{active:!e(f)}]),title:"单一模式",onClick:g[0]||(g[0]=_=>f.value=!1)},[...g[9]||(g[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)])],2),t("button",{class:D(["mode-switch-btn",{active:e(f)}]),title:"聚合模式",onClick:g[1]||(g[1]=_=>f.value=!0)},[g[10]||(g[10]=t("i",{class:"fas fa-layer-group"},null,-1)),g[11]||(g[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(f)&&C.value.length>0?(d(),u("span",jt,n(C.value.length),1)):K("",!0)],2)])])]),t("div",Et,[t("div",Ft,[e(f)?(d(),u("div",Bt,[xt(t("textarea",{"onUpdate:modelValue":g[4]||(g[4]=_=>vt(s)?s.value=_:null),class:"wide-card-input w-full resize-y",disabled:e(x),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:g[5]||(g[5]=pt(_t((..._)=>e(b)&&e(b)(..._),["ctrl"]),["enter"]))},null,40,Ht),[[yt,e(s)]]),e(s)&&!e(x)?(d(),u("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:g[6]||(g[6]=(..._)=>e(y)&&e(y)(..._))},[...g[12]||(g[12]=[t("i",{class:"fas fa-times-circle"},null,-1)])])):K("",!0)])):xt((d(),u("input",{key:0,"onUpdate:modelValue":g[2]||(g[2]=_=>vt(s)?s.value=_:null),class:"wide-card-input w-full",disabled:e(x),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:g[3]||(g[3]=pt((..._)=>e(b)&&e(b)(..._),["enter"]))},null,40,Wt)),[[yt,e(s)]])]),t("div",Vt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(x)||!T.value,onClick:g[7]||(g[7]=(..._)=>e(b)&&e(b)(..._))},[e(x)?(d(),u("i",Jt)):(d(),u("i",Yt)),h(" "+n(e(x)?"查询中...":"查询统计"),1)],8,zt)])]),t("div",Gt,[g[13]||(g[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),h(" "+n(e(f)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(f)?(d(),u("div",Qt,[...g[14]||(g[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)])])):K("",!0)])]))}},Xt=X(Zt,[["__scopeId","data-v-fa2577f9"]]),te={class:"space-y-6 md:space-y-8"},ee={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},se={class:"card-section"},ae={class:"section-header"},re={class:"header-title"},le={key:0,class:"info-grid"},ie={class:"info-item"},oe={class:"info-value"},ne={class:"info-item"},de={class:"info-value text-green-600 dark:text-emerald-400"},ue={key:0,class:"info-item"},ce={class:"info-value text-red-500 dark:text-red-400"},me={class:"info-item"},fe={class:"info-value"},ge={class:"info-item"},xe={class:"info-value"},ye={class:"info-item"},pe={class:"info-value text-indigo-600 dark:text-indigo-300"},ve={key:1,class:"info-item xl:col-span-2"},be={class:"space-y-2"},he={class:"truncate"},_e={class:"font-semibold"},ke={key:1,class:"info-grid"},we={class:"info-item"},$e={class:"info-value break-all"},Se={class:"info-item"},Ce={class:"info-item"},Te={class:"info-value"},Le={class:"info-item"},Ke={class:"info-value break-all"},Ae={class:"info-item xl:col-span-2"},Pe={class:"info-value"},Me={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},De={key:0,class:"text-red-500 dark:text-red-400"},Ie={key:1,class:"text-orange-500 dark:text-orange-400"},qe={key:2},Ue={key:2,class:"text-gray-400 dark:text-gray-500"},Re={class:"card-section"},Ne={class:"section-header"},Oe={class:"header-tag"},je={class:"metric-grid"},Ee={class:"metric-card"},Fe={class:"metric-value text-green-600 dark:text-emerald-300"},We={class:"metric-label"},Be={class:"metric-card"},He={class:"metric-value text-blue-600 dark:text-sky-300"},Ve={class:"metric-label"},ze={class:"metric-card"},Je={class:"metric-value text-purple-600 dark:text-violet-300"},Ye={class:"metric-label"},Ge={class:"metric-card"},Qe={class:"metric-value text-amber-500 dark:text-amber-300"},Ze={class:"metric-label"},Xe={key:0,class:"card-section"},ts={class:"flex items-center justify-between gap-3"},es={class:"flex items-center gap-3"},ss={class:"account-name"},as={class:"account-sub"},rs={key:0,class:"mt-3 space-y-2"},ls={class:"progress-row"},is={class:"progress-track"},os={class:"progress-value"},ns={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},ds={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},us={key:1,class:"mt-3"},cs={key:0,class:"space-y-2"},ms={class:"quota-header"},fs={class:"quota-percent"},gs={class:"progress-track"},xs={class:"quota-foot"},ys={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},ps={__name:"StatsOverview",setup(R){const v=tt(),{statsData:s,statsPeriod:x,currentPeriodData:f,multiKeyMode:b,aggregatedStats:y,individualStats:C,invalidKeys:T}=Z(v),M=U(()=>!C.value||C.value.length===0?[]:[...C.value].sort((o,r)=>{var c,w;return(((c=r.usage)==null?void 0:c.allTokens)||0)-(((w=o.usage)==null?void 0:w.allTokens)||0)}).slice(0,3)),g=o=>{var c;return!y.value||!y.value.usage.allTokens?0:((((c=o.usage)==null?void 0:c.allTokens)||0)/y.value.usage.allTokens*100).toFixed(1)},_=o=>{if(!o)return"无";try{return At(o).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},N=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",k=o=>o?new Date(o)<new Date:!1,m=o=>{if(!o)return!1;const w=(new Date(o)-new Date)/(1e3*60*60*24);return w>0&&w<=7},l=o=>(typeof o!="number"&&(o=parseInt(o)||0),o===0?"0":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString()),a=o=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[o]||o||"未知",S=U(()=>{var c,w;const o=(w=(c=s.value)==null?void 0:c.accounts)==null?void 0:w.details;if(!o)return[];const r=[];return o.claude&&o.claude.accountType==="dedicated"&&r.push({key:"claude",...o.claude}),o.openai&&o.openai.accountType==="dedicated"&&r.push({key:"openai",...o.openai}),r}),A=U(()=>{const o=S.value.length;return o<=1?"md:grid-cols-1 lg:grid-cols-1":o===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),j=o=>o?o.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",F=o=>{if(!o||o<=0)return"";const r=Math.floor(o),c=Math.floor(r/1440),w=Math.floor(r%1440/60),I=r%60;return c>0?w>0?`${c}天${w}小时`:`${c}天`:w>0?I>0?`${w}小时${I}分钟`:`${w}小时`:`${I}分钟`},W=o=>{if(!o)return{text:"状态未知",class:"text-gray-400"};if(o.isRateLimited){const r=F(o.minutesRemaining);return{text:`限流中${r?` · 剩余约 ${r}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},q=(o,r)=>{if(!o||!r)return"暂无时间窗口信息";const c=new Date(o),w=new Date(r),I=B=>`${`${B.getHours()}`.padStart(2,"0")}:${`${B.getMinutes()}`.padStart(2,"0")}`;return`${I(c)} - ${I(w)}`},$=o=>{if(!o||o<=0)return"";const r=Math.floor(o/60),c=o%60;return r>0?`${r}小时${c}分钟`:`${c}分钟`},et=(o,r)=>{var w;if(!o)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((w=r==null?void 0:r.rateLimitStatus)!=null&&w.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const c=String(o).toLowerCase();return c==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":c==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},V=o=>{if(!o)return null;const r=typeof o.usedPercent=="number"&&!Number.isNaN(o.usedPercent)?o.usedPercent:null,c=typeof o.resetAfterSeconds=="number"&&!Number.isNaN(o.resetAfterSeconds)?o.resetAfterSeconds:null,w=typeof o.remainingSeconds=="number"?o.remainingSeconds:null,I=o.resetAt?Date.parse(o.resetAt):null;return c!==null&&(w!==null&&w<=0||I!==null&&!Number.isNaN(I)&&Date.now()>=I)?0:r===null?null:Math.max(0,Math.min(100,r))},lt=o=>{const r=V(o);return r===null?"bg-gradient-to-r from-gray-300 to-gray-400":r>=90?"bg-gradient-to-r from-red-500 to-red-600":r>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},st=o=>{const r=V(o);return r===null?"0%":`${r}%`},it=o=>{const r=V(o);return r===null?"--":`${r.toFixed(1)}%`},ft=o=>{if(!o)return"--";let r=o.remainingSeconds;if(r==null&&(r=o.resetAfterSeconds),r==null||Number.isNaN(Number(r)))return"--";r=Math.max(0,Math.floor(Number(r)));const c=Math.floor(r/86400),w=Math.floor(r%86400/3600),I=Math.floor(r%3600/60),B=r%60;return c>0?w>0?`${c}天${w}小时`:`${c}天`:w>0?I>0?`${w}小时${I}分钟`:`${w}小时`:I>0?`${I}分钟`:`${B}秒`},ot=o=>o==="secondary"?"周限":"5h";return(o,r)=>(d(),u("div",te,[t("div",ee,[t("div",se,[t("header",ae,[t("i",{class:D(["header-icon",e(b)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",re,n(e(b)?"批量查询概要":"API Key 信息"),1)]),e(b)&&e(y)?(d(),u("div",le,[t("div",ie,[r[0]||(r[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",oe,n(e(y).totalKeys)+" 个",1)]),t("div",ne,[r[2]||(r[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",de,[r[1]||(r[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),h(n(e(y).activeKeys)+" 个 ",1)])]),e(T).length>0?(d(),u("div",ue,[r[4]||(r[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ce,[r[3]||(r[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),h(n(e(T).length)+" 个 ",1)])])):K("",!0),t("div",me,[r[5]||(r[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",fe,n(l(e(y).usage.requests)),1)]),t("div",ge,[r[6]||(r[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",xe,n(l(e(y).usage.allTokens)),1)]),t("div",ye,[r[7]||(r[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",pe,n(e(y).usage.formattedCost),1)]),e(C).length>1?(d(),u("div",ve,[r[8]||(r[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",be,[(d(!0),u(J,null,Q(M.value,c=>(d(),u("div",{key:c.apiId,class:"contributor-item"},[t("span",he,n(c.name),1),t("span",_e,n(g(c))+"%",1)]))),128))])])):K("",!0)])):(d(),u("div",ke,[t("div",we,[r[9]||(r[9]=t("p",{class:"info-label"},"名称",-1)),t("p",$e,n(e(s).name),1)]),t("div",Se,[r[10]||(r[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:D(["info-value font-semibold",e(s).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:D(["mr-1",e(s).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),h(" "+n(e(s).isActive?"活跃":"已停用"),1)],2)]),t("div",Ce,[r[11]||(r[11]=t("p",{class:"info-label"},"权限",-1)),t("p",Te,n(a(e(s).permissions)),1)]),t("div",Le,[r[12]||(r[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Ke,n(_(e(s).createdAt)),1)]),t("div",Ae,[r[17]||(r[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Pe,[e(s).expirationMode==="activation"&&!e(s).isActivated?(d(),u(J,{key:0},[r[13]||(r[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),h("未激活 ")],-1)),t("span",Me," 首次使用后 "+n(e(s).activationDays||(e(s).activationUnit==="hours"?24:30))+" "+n(e(s).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(s).expiresAt?(d(),u(J,{key:1},[k(e(s).expiresAt)?(d(),u("span",De,[...r[14]||(r[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),h("已过期 ",-1)])])):m(e(s).expiresAt)?(d(),u("span",Ie,[r[15]||(r[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),h(n(N(e(s).expiresAt)),1)])):(d(),u("span",qe,n(N(e(s).expiresAt)),1))],64)):(d(),u("span",Ue,[...r[16]||(r[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),h("永不过期 ",-1)])]))])])]))]),t("div",Re,[t("header",Ne,[r[18]||(r[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),r[19]||(r[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",Oe,n(e(x)==="daily"?"今日":"本月"),1)]),t("div",je,[t("div",Ee,[t("p",Fe,n(l(e(f).requests)),1),t("p",We,n(e(x)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Be,[t("p",He,n(l(e(f).allTokens)),1),t("p",Ve,n(e(x)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",ze,[t("p",Je,n(e(f).formattedCost||"$0.000000"),1),t("p",Ye,n(e(x)==="daily"?"今日":"本月")+"费用",1)]),t("div",Ge,[t("p",Qe,n(l(e(f).inputTokens)),1),t("p",Ze,n(e(x)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(b)&&S.value.length>0?(d(),u("div",Xe,[r[21]||(r[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:D(["grid grid-cols-1 gap-4",A.value])},[(d(!0),u(J,null,Q(S.value,c=>{var w,I,B,at,dt,ut;return d(),u("div",{key:c.id||c.key,class:"account-card"},[t("div",ts,[t("div",es,[t("span",{class:D(["account-icon",c.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:D(c.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",ss,n(j(c)),1),t("p",as,n(c.platform==="claude"?"会话窗口":"额度窗口"),1)])]),W(c.rateLimitStatus)?(d(),u("div",{key:0,class:D(["rate-badge",W(c.rateLimitStatus).class])},[r[20]||(r[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),h(" "+n(W(c.rateLimitStatus).text),1)],2)):K("",!0)]),c.platform==="claude"?(d(),u("div",rs,[t("div",ls,[t("div",is,[t("div",{class:D(["progress-bar",et((w=c.sessionWindow)==null?void 0:w.sessionWindowStatus,c)]),style:rt({width:`${Math.min(100,Math.max(0,((I=c.sessionWindow)==null?void 0:I.progress)||0))}%`})},null,6)]),t("span",os,n(Math.min(100,Math.max(0,Math.round(((B=c.sessionWindow)==null?void 0:B.progress)||0))))+"% ",1)]),t("div",ns,[t("span",null,n(q((at=c.sessionWindow)==null?void 0:at.windowStart,(dt=c.sessionWindow)==null?void 0:dt.windowEnd)),1),((ut=c.sessionWindow)==null?void 0:ut.remainingTime)>0?(d(),u("span",ds," 剩余 "+n($(c.sessionWindow.remainingTime)),1)):K("",!0)])])):c.platform==="openai"?(d(),u("div",us,[c.codexUsage?(d(),u("div",cs,[(d(),u(J,null,Q(["primary","secondary"],z=>{var nt,ct,i,p;return t("div",{key:`${c.key}-${z}`,class:"quota-row"},[t("div",ms,[t("span",{class:D(["quota-tag",z==="primary"?"tag-indigo":"tag-blue"])},n(ot(z)),3),t("span",fs,n(it((nt=c.codexUsage)==null?void 0:nt[z])),1)]),t("div",gs,[t("div",{class:D(["progress-bar",lt((ct=c.codexUsage)==null?void 0:ct[z])]),style:rt({width:st((i=c.codexUsage)==null?void 0:i[z])})},null,6)]),t("div",xs," 重置剩余 "+n(ft((p=c.codexUsage)==null?void 0:p[z])),1)])}),64))])):(d(),u("p",ys," 暂无额度使用数据 "))])):K("",!0)])}),128))],2)])):K("",!0)]))}},vs=X(ps,[["__scopeId","data-v-b72df2cd"]]),bs={class:"card p-4 md:p-6"},hs={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},_s={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},ks={class:"space-y-2 md:space-y-3"},ws={class:"flex items-center justify-between"},$s={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ss={class:"flex items-center justify-between"},Cs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ts={class:"flex items-center justify-between"},Ls={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ks={class:"flex items-center justify-between"},As={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ps={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Ms={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Ds={class:"text-sm md:text-base"},Is={class:"text-lg md:text-xl"},qs={__name:"TokenDistribution",setup(R){const v=tt(),{statsPeriod:s,currentPeriodData:x}=Z(v),f=b=>(typeof b!="number"&&(b=parseInt(b)||0),b===0?"0":b>=1e6?(b/1e6).toFixed(1)+"M":b>=1e3?(b/1e3).toFixed(1)+"K":b.toLocaleString());return(b,y)=>(d(),u("div",bs,[t("h3",hs,[y[0]||(y[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),h(" Token 使用分布 ")],-1)),t("span",_s,"("+n(e(s)==="daily"?"今日":"本月")+")",1)]),t("div",ks,[t("div",ws,[y[1]||(y[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),h(" 输入 Token ")],-1)),t("span",$s,n(f(e(x).inputTokens)),1)]),t("div",Ss,[y[2]||(y[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),h(" 输出 Token ")],-1)),t("span",Cs,n(f(e(x).outputTokens)),1)]),t("div",Ts,[y[3]||(y[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),h(" 缓存创建 Token ")],-1)),t("span",Ls,n(f(e(x).cacheCreateTokens)),1)]),t("div",Ks,[y[4]||(y[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),h(" 缓存读取 Token ")],-1)),t("span",As,n(f(e(x).cacheReadTokens)),1)])]),t("div",Ps,[t("div",Ms,[t("span",Ds,n(e(s)==="daily"?"今日":"本月")+"总计",1),t("span",Is,n(f(e(x).allTokens)),1)])])]))}},Us=X(qs,[["__scopeId","data-v-d9e5c1dd"]]),Rs={class:"flex h-full flex-col gap-4 md:gap-6"},Ns={class:"card flex h-full flex-col p-4 md:p-6"},Os={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},js={key:0,class:"space-y-4"},Es={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Fs={class:"mb-3 flex items-center justify-between"},Ws={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Bs={class:"grid grid-cols-2 gap-3"},Hs={class:"text-center"},Vs={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},zs={class:"text-center"},Js={class:"text-lg font-bold text-green-600"},Ys={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Gs={class:"space-y-2"},Qs={class:"flex items-center justify-between"},Zs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Xs={class:"flex items-center justify-between"},ta={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ea={class:"flex items-center justify-between"},sa={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},aa={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ra={class:"text-red-700 dark:text-red-300"},la={key:1,class:"space-y-4 md:space-y-5"},ia={class:"mb-2 flex items-center justify-between"},oa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},na={key:0},da={key:1,class:"flex items-center gap-1"},ua={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ca={key:1,class:"h-2 w-full rounded-full bg-gray-200"},ma={class:"mb-2 flex items-center justify-between"},fa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ga={key:0},xa={key:1,class:"flex items-center gap-1"},ya={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},pa={key:1,class:"h-2 w-full rounded-full bg-gray-200"},va={key:0},ba={class:"mb-2 flex items-center justify-between"},ha={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},_a={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ka={key:1},wa={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},$a={key:0},Sa={key:1},Ca={key:2},Ta={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},La={class:"flex items-center justify-between"},Ka={class:"text-sm font-medium text-gray-900 md:text-base"},Aa={key:0},Pa={key:1,class:"flex items-center gap-1"},Ma={class:"flex items-center justify-between"},Da={class:"text-sm font-medium text-gray-900 md:text-base"},Ia={key:0,class:"text-orange-600"},qa={key:1,class:"text-green-600"},Ua={class:"space-y-2"},Ra={class:"flex items-center justify-between"},Na={class:"text-sm font-medium text-gray-900 md:text-base"},Oa={key:0,class:"text-orange-600"},ja={key:1,class:"text-green-600"},Ea={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},Fa={key:0,class:"card p-4 md:p-6"},Wa={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Ba={class:"space-y-1 md:space-y-2"},Ha={class:"break-all text-gray-800 dark:text-gray-200"},Va={__name:"LimitConfig",setup(R){const v=tt(),{statsData:s,multiKeyMode:x,aggregatedStats:f,invalidKeys:b}=Z(v),y=U(()=>{var a;const l=(a=s.value)==null?void 0:a.restrictions;return l?l.enableModelRestriction===!0&&Array.isArray(l.restrictedModels)&&l.restrictedModels.length>0:!1}),C=U(()=>{var a;const l=(a=s.value)==null?void 0:a.restrictions;return l?l.enableClientRestriction===!0&&Array.isArray(l.allowedClients)&&l.allowedClients.length>0:!1}),T=()=>{if(!s.value.limits.dailyCostLimit||s.value.limits.dailyCostLimit===0)return 0;const l=s.value.limits.currentDailyCost/s.value.limits.dailyCostLimit*100;return Math.min(l,100)},M=()=>{const l=T();return l>=100?"bg-red-500":l>=80?"bg-yellow-500":"bg-green-500"},g=()=>{if(!s.value.limits.totalCostLimit||s.value.limits.totalCostLimit===0)return 0;const l=s.value.limits.currentTotalCost/s.value.limits.totalCostLimit*100;return Math.min(l,100)},_=()=>{const l=g();return l>=100?"bg-red-500":l>=80?"bg-yellow-500":"bg-blue-500"},N=()=>{if(!s.value.limits.weeklyOpusCostLimit||s.value.limits.weeklyOpusCostLimit===0)return 0;const l=s.value.limits.weeklyOpusCost/s.value.limits.weeklyOpusCostLimit*100;return Math.min(l,100)},k=()=>{const l=N();return l>=100?"bg-red-500":l>=80?"bg-yellow-500":"bg-indigo-500"},m=l=>(typeof l!="number"&&(l=parseInt(l)||0),l===0?"0":l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(1)+"K":l.toLocaleString());return(l,a)=>(d(),u("div",Rs,[t("div",Ns,[t("h3",Os,[a[0]||(a[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),h(" "+n(e(x)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(x)&&e(f)?(d(),u("div",js,[t("div",Es,[t("div",Fs,[a[1]||(a[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),h(" API Keys 概况 ")],-1)),t("span",Ws,n(e(f).activeKeys)+"/"+n(e(f).totalKeys),1)]),t("div",Bs,[t("div",Hs,[t("div",Vs,n(e(f).totalKeys),1),a[2]||(a[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",zs,[t("div",Js,n(e(f).activeKeys),1),a[3]||(a[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",Ys,[a[7]||(a[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Gs,[t("div",Qs,[a[4]||(a[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),h(" 总请求数 ")],-1)),t("span",Zs,n(m(e(f).usage.requests)),1)]),t("div",Xs,[a[5]||(a[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),h(" 总 Tokens ")],-1)),t("span",ta,n(m(e(f).usage.allTokens)),1)]),t("div",ea,[a[6]||(a[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),h(" 总费用 ")],-1)),t("span",sa,n(e(f).usage.formattedCost),1)])])]),e(b)&&e(b).length>0?(d(),u("div",aa,[a[8]||(a[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",ra,n(e(b).length)+" 个无效的 API Key ",1)])):K("",!0),a[9]||(a[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),h(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):K("",!0),e(x)?K("",!0):(d(),u("div",la,[t("div",null,[t("div",ia,[a[11]||(a[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",oa,[e(s).limits.dailyCostLimit>0?(d(),u("span",na," $"+n(e(s).limits.currentDailyCost.toFixed(4))+" / $"+n(e(s).limits.dailyCostLimit.toFixed(2)),1)):(d(),u("span",da,[h(" $"+n(e(s).limits.currentDailyCost.toFixed(4))+" / ",1),a[10]||(a[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.dailyCostLimit>0?(d(),u("div",ua,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",M()]),style:rt({width:T()+"%"})},null,6)])):(d(),u("div",ca,[...a[12]||(a[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])]))]),t("div",null,[t("div",ma,[a[14]||(a[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",fa,[e(s).limits.totalCostLimit>0?(d(),u("span",ga," $"+n(e(s).limits.currentTotalCost.toFixed(4))+" / $"+n(e(s).limits.totalCostLimit.toFixed(2)),1)):(d(),u("span",xa,[h(" $"+n(e(s).limits.currentTotalCost.toFixed(4))+" / ",1),a[13]||(a[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.totalCostLimit>0?(d(),u("div",ya,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",_()]),style:rt({width:g()+"%"})},null,6)])):(d(),u("div",pa,[...a[15]||(a[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])]))]),e(s).limits.weeklyOpusCostLimit>0?(d(),u("div",va,[t("div",ba,[a[16]||(a[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",ha," $"+n(e(s).limits.weeklyOpusCost.toFixed(4))+" / $"+n(e(s).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",_a,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",k()]),style:rt({width:N()+"%"})},null,6)])])):K("",!0),e(s).limits.rateLimitWindow>0&&(e(s).limits.rateLimitRequests>0||e(s).limits.tokenLimit>0||e(s).limits.rateLimitCost>0)?(d(),u("div",ka,[G(Pt,{"cost-limit":e(s).limits.rateLimitCost,"current-cost":e(s).limits.currentWindowCost,"current-requests":e(s).limits.currentWindowRequests,"current-tokens":e(s).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(s).limits.rateLimitWindow,"request-limit":e(s).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(s).limits.tokenLimit,"window-end-time":e(s).limits.windowEndTime,"window-remaining-seconds":e(s).limits.windowRemainingSeconds,"window-start-time":e(s).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",wa,[a[17]||(a[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(s).limits.rateLimitCost>0?(d(),u("span",$a,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(s).limits.tokenLimit>0?(d(),u("span",Sa,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(d(),u("span",Ca," 仅限制请求次数 "))])])):K("",!0),t("div",Ta,[t("div",La,[a[19]||(a[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ka,[e(s).limits.concurrencyLimit>0?(d(),u("span",Aa,n(e(s).limits.concurrencyLimit),1)):(d(),u("span",Pa,[...a[18]||(a[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])]))])]),t("div",Ma,[a[22]||(a[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",Da,[y.value?(d(),u("span",Ia,[a[20]||(a[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),h(" 限制 "+n(e(s).restrictions.restrictedModels.length)+" 个模型 ",1)])):(d(),u("span",qa,[...a[21]||(a[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),h(" 允许所有模型 ",-1)])]))])]),t("div",Ua,[t("div",Ra,[a[25]||(a[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",Na,[C.value?(d(),u("span",Oa,[a[23]||(a[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),h(" 限 "+n(e(s).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(d(),u("span",ja,[...a[24]||(a[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),h(" 允许所有客户端 ",-1)])]))])]),C.value?(d(),u("div",Ea,[(d(!0),u(J,null,Q(e(s).restrictions.allowedClients,S=>(d(),u("span",{key:S,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[a[26]||(a[26]=t("i",{class:"fas fa-id-badge"},null,-1)),h(" "+n(S),1)]))),128))])):K("",!0)])])]))]),y.value?(d(),u("div",Fa,[a[30]||(a[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),h(" 详细限制信息 ")],-1)),t("div",Wa,[a[28]||(a[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),h(" 受限模型列表 ")],-1)),t("div",Ba,[(d(!0),u(J,null,Q(e(s).restrictions.restrictedModels,S=>(d(),u("div",{key:S,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[a[27]||(a[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Ha,n(S),1)]))),128))]),a[29]||(a[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),h(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):K("",!0)]))}},za=X(Va,[["__scopeId","data-v-4e85e423"]]),Ja={class:"card h-full p-4 md:p-6"},Ya={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Ga={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Qa={key:0,class:"space-y-2 md:space-y-3"},Za={class:"mb-1 flex items-center justify-between text-sm"},Xa={class:"truncate font-medium text-gray-700 dark:text-gray-300"},tr={class:"text-xs text-gray-600 dark:text-gray-400"},er={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},sr={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},ar={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},rr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},lr={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},ir={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},or={__name:"AggregatedStatsCard",setup(R){const v=tt(),{aggregatedStats:s,individualStats:x,statsPeriod:f,multiKeyMode:b}=Z(v),y=k=>k?f.value==="daily"?k.dailyUsage||k.usage:k.monthlyUsage||k.usage:null,C=U(()=>!x.value||x.value.length===0?[]:[...x.value].sort((k,m)=>{const l=y(k),a=y(m);return((a==null?void 0:a.cost)||0)-((l==null?void 0:l.cost)||0)}).slice(0,5)),T=U(()=>x.value?Math.max(0,x.value.length-5):0),M=U(()=>{var a,S;if(!x.value||!s.value)return 0;const k=C.value.reduce((A,j)=>{const F=y(j);return A+((F==null?void 0:F.cost)||0)},0),m=f.value==="daily"?((a=s.value.dailyUsage)==null?void 0:a.cost)||0:((S=s.value.monthlyUsage)==null?void 0:S.cost)||0;if(m===0)return 0;const l=m-k;return Math.max(0,Math.round(l/m*100))}),g=k=>{var S,A;if(!s.value)return 0;const m=f.value==="daily"?((S=s.value.dailyUsage)==null?void 0:S.cost)||0:((A=s.value.monthlyUsage)==null?void 0:A.cost)||0;if(m===0)return 0;const l=y(k),a=((l==null?void 0:l.cost)||0)/m*100;return Math.round(a)},_=k=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][k]||"bg-gray-400",N=k=>(typeof k!="number"&&(k=parseInt(k)||0),k===0?"0":k>=1e6?(k/1e6).toFixed(1)+"M":k>=1e3?(k/1e3).toFixed(1)+"K":k.toLocaleString());return(k,m)=>(d(),u("div",Ja,[t("h3",Ya,[m[0]||(m[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),h(" 使用占比 ")],-1)),t("span",Ga,"("+n(e(f)==="daily"?"今日":"本月")+")",1)]),e(s)&&e(x).length>0?(d(),u("div",Qa,[(d(!0),u(J,null,Q(C.value,(l,a)=>{var S,A;return d(),u("div",{key:l.apiId,class:"relative"},[t("div",Za,[t("span",Xa,n(l.name||`Key ${a+1}`),1),t("span",tr,n(g(l))+"% ",1)]),t("div",er,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",_(a)]),style:rt({width:g(l)+"%"})},null,6)]),t("div",sr,[t("span",null,n(N(((S=y(l))==null?void 0:S.requests)||0))+"次",1),t("span",null,n(((A=y(l))==null?void 0:A.formattedCost)||"$0.00"),1)])])}),128)),T.value>0?(d(),u("div",ar,[t("div",rr,[t("span",null,"其他 "+n(T.value)+" 个Keys",1),t("span",null,n(M.value)+"%",1)])])):K("",!0)])):e(b)?(d(),u("div",ir,[...m[2]||(m[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),h(" 暂无数据 ",-1)])])):(d(),u("div",lr,[...m[1]||(m[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])]))]))}},nr=X(or,[["__scopeId","data-v-39572a8e"]]),dr={class:"card p-4 md:p-6"},ur={class:"mb-4 md:mb-6"},cr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},mr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},fr={key:0,class:"py-6 text-center md:py-8"},gr={key:1,class:"space-y-3 md:space-y-4"},xr={class:"mb-2 flex items-start justify-between md:mb-3"},yr={class:"min-w-0 flex-1"},pr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},vr={key:0,class:"ml-2 text-sm font-normal text-blue-600 dark:text-blue-400"},br={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},hr={key:0,class:"ml-2"},_r={class:"ml-3 flex-shrink-0 text-right"},kr={class:"text-base font-bold text-green-600 md:text-lg"},wr={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},$r={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Sr={class:"font-medium text-gray-900 dark:text-gray-100"},Cr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Tr={class:"font-medium text-gray-900 dark:text-gray-100"},Lr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Kr={class:"font-medium text-gray-900 dark:text-gray-100"},Ar={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Pr={class:"font-medium text-gray-900 dark:text-gray-100"},Mr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Dr={class:"text-sm md:text-base"},Ir={__name:"ModelUsageStats",setup(R){const v=tt(),{statsPeriod:s,modelStats:x,modelStatsLoading:f,hourlyStats:b,hourlyLoading:y,hourlyConfig:C}=Z(v),T=U(()=>{switch(s.value){case"daily":return"今日";case"monthly":return"本月";case"hourly":return`${C.value.selectedHours}小时内`;default:return"当前时段"}}),M=U(()=>s.value==="hourly"?b.value||[]:x.value||[]),g=U(()=>s.value==="hourly"?y.value:f.value),_=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString()),N=m=>{if(typeof m=="string"&&m.includes(":"))return m;const l=parseInt(m);return isNaN(l)?m:`${l.toString().padStart(2,"0")}:00`},k=m=>{if(!m)return"";try{const l=new Date(m),a=new Date,S=new Date(a);return S.setDate(a.getDate()-1),l.toDateString()===a.toDateString()?"今天":l.toDateString()===S.toDateString()?"昨天":l.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}catch{return m}};return(m,l)=>(d(),u("div",dr,[t("div",ur,[t("h3",cr,[l[0]||(l[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),h(" 模型使用统计 ")],-1)),t("span",mr,"("+n(T.value)+")",1)])]),g.value?(d(),u("div",fr,[...l[1]||(l[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)])])):M.value.length>0?(d(),u("div",gr,[(d(!0),u(J,null,Q(M.value,(a,S)=>{var A;return d(),u("div",{key:S,class:"model-usage-item"},[t("div",xr,[t("div",yr,[t("h4",pr,[h(n(a.model)+" ",1),e(s)==="hourly"&&a.hour?(d(),u("span",vr,n(N(a.hour)),1)):K("",!0)]),t("p",br,[h(n(a.requests)+" 次请求 ",1),e(s)==="hourly"&&a.date?(d(),u("span",hr," · "+n(k(a.date)),1)):K("",!0)])]),t("div",_r,[t("div",kr,n(((A=a.formatted)==null?void 0:A.total)||"$0.000000"),1),l[2]||(l[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",wr,[t("div",$r,[l[3]||(l[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",Sr,n(_(a.inputTokens)),1)]),t("div",Cr,[l[4]||(l[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",Tr,n(_(a.outputTokens)),1)]),t("div",Lr,[l[5]||(l[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",Kr,n(_(a.cacheCreateTokens)),1)]),t("div",Ar,[l[6]||(l[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Pr,n(_(a.cacheReadTokens)),1)])])])}),128))])):(d(),u("div",Mr,[l[7]||(l[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Dr,"暂无"+n(T.value)+"模型使用数据",1)]))]))}},qr=X(Ir,[["__scopeId","data-v-d8f7bc09"]]),Ur={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},Rr={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},Nr={class:"flex items-center gap-2 md:gap-4"},Or={class:"flex items-center"},jr={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},Er={class:"mb-6 md:mb-8"},Fr={class:"flex justify-center"},Wr={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},Br={key:0,class:"tab-content"},Hr={key:0,class:"mb-6 md:mb-8"},Vr={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},zr={key:1,class:"fade-in"},Jr={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Yr={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},Gr={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},Qr={class:"flex w-full gap-2 md:w-auto"},Zr=["disabled"],Xr=["disabled"],tl={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},el={key:1,class:"tab-content"},sl={class:"glass-strong rounded-3xl shadow-xl"},al={__name:"ApiStatsView",setup(R){const v=wt(),s=tt(),x=Tt(),f=P("stats"),b=U(()=>x.isDarkMode),{apiKey:y,apiId:C,loading:T,modelStatsLoading:M,oemLoading:g,error:_,statsPeriod:N,statsData:k,oemSettings:m,multiKeyMode:l}=Z(s),{queryStats:a,switchPeriod:S,loadStatsWithApiId:A,loadOemSettings:j,reset:F}=s,W=q=>{(q.ctrlKey||q.metaKey)&&q.key==="Enter"&&(!T.value&&y.value.trim()&&a(),q.preventDefault()),q.key==="Escape"&&F()};return kt(()=>{x.initTheme(),j();const q=v.query.apiId,$=v.query.apiKey;q&&q.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(C.value=q,A()):$&&$.length>10&&(y.value=$),document.addEventListener("keydown",W)}),$t(()=>{document.removeEventListener("keydown",W)}),St(y,q=>{q||s.clearData()}),(q,$)=>{const et=Ct("router-link");return d(),u("div",{class:D(["min-h-screen p-4 md:p-6",b.value?"gradient-bg-dark":"gradient-bg"])},[t("div",Ur,[t("div",Rr,[G(Lt,{loading:e(g),"logo-src":e(m).siteIconData||e(m).siteIcon,subtitle:f.value==="stats"?"API Key 使用统计":"使用教程",title:e(m).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",Nr,[t("div",Or,[G(Kt,{mode:"dropdown"})]),e(m).ldapEnabled||e(m).showAdminButton!==!1?(d(),u("div",jr)):K("",!0),e(m).ldapEnabled?(d(),mt(et,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:bt(()=>[...$[4]||($[4]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])]),_:1})):K("",!0),e(m).showAdminButton!==!1?(d(),mt(et,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:bt(()=>[...$[5]||($[5]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])]),_:1})):K("",!0)])])]),t("div",Er,[t("div",Fr,[t("div",Wr,[t("button",{class:D(["tab-pill-button",f.value==="stats"?"active":""]),onClick:$[0]||($[0]=V=>f.value="stats")},[...$[6]||($[6]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)])],2),t("button",{class:D(["tab-pill-button",f.value==="tutorial"?"active":""]),onClick:$[1]||($[1]=V=>f.value="tutorial")},[...$[7]||($[7]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)])],2)])])]),f.value==="stats"?(d(),u("div",Br,[G(Xt),e(_)?(d(),u("div",Hr,[t("div",Vr,[$[8]||($[8]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),h(" "+n(e(_)),1)])])):K("",!0),e(k)?(d(),u("div",zr,[t("div",Jr,[t("div",Yr,[t("div",Gr,[$[11]||($[11]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",Qr,[t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(N)==="daily"}]]),disabled:e(T)||e(M),onClick:$[2]||($[2]=V=>e(S)("daily"))},[...$[9]||($[9]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),h(" 今日 ",-1)])],10,Zr),t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(N)==="monthly"}]]),disabled:e(T)||e(M),onClick:$[3]||($[3]=V=>e(S)("monthly"))},[...$[10]||($[10]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),h(" 本月 ",-1)])],10,Xr)])])]),G(vs),t("div",tl,[G(Us,{class:"h-full"}),e(l)?(d(),mt(nr,{key:0,class:"h-full"})):(d(),mt(za,{key:1,class:"h-full"}))]),G(qr)])])):K("",!0)])):K("",!0),f.value==="tutorial"?(d(),u("div",el,[t("div",sl,[G(Mt)])])):K("",!0)],2)}}},ml=X(al,[["__scopeId","data-v-4f94bab5"]]);export{ml as default};
