# 🚀 Claude Relay Service Configuration

# 🌐 服务器配置
PORT=3000
HOST=0.0.0.0
NODE_ENV=production

# 🔐 安全配置
JWT_SECRET=your-jwt-secret-here
ADMIN_SESSION_TIMEOUT=86400000
API_KEY_PREFIX=cr_
ENCRYPTION_KEY=your-encryption-key-here

# 👤 管理员凭据（可选，不设置则自动生成）
# ADMIN_USERNAME=cr_admin_custom
# ADMIN_PASSWORD=your-secure-password

# 🗄️ 数据库配置 (Database Configuration)
# 数据库类型选择：redis, mongodb, postgresql, mysql
# Database type selection: redis, mongodb, postgresql, mysql
DATABASE_TYPE=redis

# 📊 Redis 配置（当前默认数据库）
# Redis Configuration (Current Default Database)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_ENABLE_TLS=

# 🎯 Claude API 配置
CLAUDE_API_URL=https://api.anthropic.com/v1/messages
CLAUDE_API_VERSION=2023-06-01
CLAUDE_BETA_HEADER=claude-code-20250219,oauth-2025-04-20,interleaved-thinking-2025-05-14,fine-grained-tool-streaming-2025-05-14

# 🌐 代理配置
DEFAULT_PROXY_TIMEOUT=60000
MAX_PROXY_RETRIES=3
# IP协议族配置：true=IPv4, false=IPv6, 默认IPv4（兼容性更好）
PROXY_USE_IPV4=true

# 📈 使用限制
DEFAULT_TOKEN_LIMIT=1000000

# 📝 日志配置
LOG_LEVEL=info
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# 🔧 系统配置
CLEANUP_INTERVAL=3600000
TOKEN_USAGE_RETENTION=2592000000
HEALTH_CHECK_INTERVAL=60000
TIMEZONE_OFFSET=8  # UTC偏移小时数，默认+8（中国时区）
METRICS_WINDOW=5  # 实时指标统计窗口（分钟），可选1-60，默认5分钟

# 🎨 Web 界面配置
WEB_TITLE=Claude Relay Service
WEB_DESCRIPTION=Multi-account Claude API relay service with beautiful management interface
WEB_LOGO_URL=/assets/logo.png

# 🛠️ 开发配置
DEBUG=false
ENABLE_CORS=true
TRUST_PROXY=true

# 🔒 客户端限制（可选）
# ALLOW_CUSTOM_CLIENTS=false

# 📢 Webhook 通知配置
WEBHOOK_ENABLED=true
WEBHOOK_URLS=https://your-webhook-url.com/notify,https://backup-webhook.com/notify
WEBHOOK_TIMEOUT=10000
WEBHOOK_RETRIES=3

# 📊 API Key 请求日志记录配置
# Request Logging Configuration - 基于性能优先设计的日志记录系统
# ================================================================

# 🔧 基础配置 (Basic Configuration)
REQUEST_LOGGING_ENABLED=false                 # 启用请求日志记录 (默认禁用确保向后兼容)
REQUEST_LOGGING_MODE=basic                    # 记录模式: basic | detailed | debug

# 🎯 智能采样配置 (Smart Sampling Configuration)
REQUEST_LOGGING_SAMPLING_RATE=0.1             # 采样率 (0.0-1.0, 0.1=10%的请求)
REQUEST_LOGGING_ALWAYS_LOG_ERRORS=true        # 总是记录错误请求 (覆盖采样率)
REQUEST_LOGGING_SLOW_THRESHOLD=5000           # 慢请求阈值 (毫秒, 超过此值优先记录)
REQUEST_LOGGING_ALWAYS_LOG_SLOW=true          # 总是记录慢请求
REQUEST_LOGGING_PER_KEY_RATE_LIMIT=100        # 每个API Key每小时最大记录数
REQUEST_LOGGING_DYNAMIC_SAMPLING=false        # 启用基于系统负载的动态采样

# ⚡ 异步批量处理配置 (Async Batch Processing)
REQUEST_LOGGING_BATCH_SIZE=50                 # 批量写入大小
REQUEST_LOGGING_BATCH_TIMEOUT=5000            # 批量写入超时 (毫秒)
REQUEST_LOGGING_MAX_QUEUE_SIZE=1000           # 队列最大长度
REQUEST_LOGGING_QUEUE_FULL_STRATEGY=drop_oldest # 队列满时策略: drop_oldest | drop_newest | block
REQUEST_LOGGING_MAX_RETRIES=3                 # 写入失败重试次数
REQUEST_LOGGING_RETRY_DELAY=1000              # 重试间隔 (毫秒)

# 🗂️ 数据保留配置 (Data Retention Configuration)
REQUEST_LOGGING_RETENTION_DAYS=7              # 日志保留天数
REQUEST_LOGGING_CLEANUP_INTERVAL=21600000     # 自动清理间隔 (毫秒, 默认6小时)
REQUEST_LOGGING_MAX_LOGS_PER_KEY=10000        # 每个API Key最大日志数
REQUEST_LOGGING_MAX_TOTAL_LOGS=100000         # 总体最大日志数

# 💾 存储配置 (Storage Configuration)
REQUEST_LOGGING_KEY_PREFIX=request_log        # 日志键前缀
REQUEST_LOGGING_INDEX_KEY_PREFIX=request_log_index # 索引键前缀
REQUEST_LOGGING_STATS_KEY_PREFIX=request_log_stats # 统计键前缀
REQUEST_LOGGING_ENABLE_COMPRESSION=true       # 启用压缩存储
REQUEST_LOGGING_SERIALIZATION_FORMAT=json    # 序列化格式: json | msgpack

# 🛡️ 数据过滤配置 (Data Filtering Configuration)
REQUEST_LOGGING_MASK_IP=false                 # IP地址脱敏 (保留前三段)
REQUEST_LOGGING_MAX_UA_LENGTH=200             # User-Agent最大长度

# 📈 性能监控配置 (Performance Monitoring)
REQUEST_LOGGING_MONITORING_ENABLED=false     # 启用内部性能监控
REQUEST_LOGGING_METRICS_INTERVAL=60000       # 监控指标收集间隔 (毫秒)
REQUEST_LOGGING_METRICS_RETENTION=86400000   # 监控指标保留时间 (毫秒, 24小时)
REQUEST_LOGGING_QUEUE_WARNING_THRESHOLD=800  # 队列长度警告阈值
REQUEST_LOGGING_WRITE_WARNING_THRESHOLD=1000 # 写入延迟警告阈值 (毫秒)
REQUEST_LOGGING_MEMORY_WARNING_THRESHOLD=100 # 内存使用警告阈值 (MB)

# 🚀 高级功能配置 (Advanced Features Configuration)
REQUEST_LOGGING_ENABLE_REALTIME=false        # 启用实时日志流 (WebSocket)
REQUEST_LOGGING_ENABLE_EXPORT=true           # 启用日志导出功能
REQUEST_LOGGING_MAX_EXPORT_SIZE=50           # 导出文件大小限制 (MB)
REQUEST_LOGGING_ENABLE_SEARCH=true           # 启用日志搜索功能
REQUEST_LOGGING_SEARCH_INDEX_INTERVAL=300000 # 搜索索引更新频率 (毫秒, 5分钟)

# ===================================================================
# 🔧 未来数据库配置模板 (Future Database Configuration Templates)
# 以下配置为未来扩展预留，当前版本仅支持Redis
# The following configurations are reserved for future expansion, 
# current version only supports Redis
# ===================================================================

# 🍃 MongoDB 配置（未来支持）
# MongoDB Configuration (Future Support)
# MONGODB_URI=mongodb://localhost:27017
# MONGODB_DATABASE=claude_relay
# MONGODB_MAX_POOL_SIZE=10
# MONGODB_SERVER_SELECTION_TIMEOUT=5000
# MONGODB_SOCKET_TIMEOUT=45000
# # MongoDB 集合名称映射
# MONGODB_COLLECTION_API_KEYS=api_keys
# MONGODB_COLLECTION_CLAUDE_ACCOUNTS=claude_accounts
# MONGODB_COLLECTION_OPENAI_ACCOUNTS=openai_accounts
# MONGODB_COLLECTION_SESSIONS=sessions
# MONGODB_COLLECTION_USAGE_STATS=usage_stats
# MONGODB_COLLECTION_SYSTEM_STATS=system_stats
# MONGODB_COLLECTION_CONCURRENCY=concurrency

# 🐘 PostgreSQL 配置（未来支持）
# PostgreSQL Configuration (Future Support)
# POSTGRES_HOST=localhost
# POSTGRES_PORT=5432
# POSTGRES_DATABASE=claude_relay
# POSTGRES_USERNAME=claude_relay_user
# POSTGRES_PASSWORD=your-postgres-password
# POSTGRES_SSL=false
# # PostgreSQL 连接池配置
# POSTGRES_POOL_MAX=20
# POSTGRES_POOL_MIN=5
# POSTGRES_POOL_ACQUIRE=30000
# POSTGRES_POOL_IDLE=10000
# # PostgreSQL 表名映射
# POSTGRES_TABLE_API_KEYS=api_keys
# POSTGRES_TABLE_CLAUDE_ACCOUNTS=claude_accounts
# POSTGRES_TABLE_OPENAI_ACCOUNTS=openai_accounts
# POSTGRES_TABLE_SESSIONS=sessions
# POSTGRES_TABLE_USAGE_STATS=usage_stats
# POSTGRES_TABLE_SYSTEM_STATS=system_stats

# 🐬 MySQL 配置（未来支持）
# MySQL Configuration (Future Support)
# MYSQL_HOST=localhost
# MYSQL_PORT=3306
# MYSQL_DATABASE=claude_relay
# MYSQL_USERNAME=claude_relay_user
# MYSQL_PASSWORD=your-mysql-password
# MYSQL_CHARSET=utf8mb4
# # MySQL 连接池配置
# MYSQL_POOL_MAX=20
# MYSQL_POOL_MIN=5
# MYSQL_POOL_ACQUIRE=30000
# MYSQL_POOL_IDLE=10000
# # MySQL 表名映射
# MYSQL_TABLE_API_KEYS=api_keys
# MYSQL_TABLE_CLAUDE_ACCOUNTS=claude_accounts
# MYSQL_TABLE_OPENAI_ACCOUNTS=openai_accounts
# MYSQL_TABLE_SESSIONS=sessions
# MYSQL_TABLE_USAGE_STATS=usage_stats
# MYSQL_TABLE_SYSTEM_STATS=system_stats

# ===================================================================
# 📝 数据库配置说明 (Database Configuration Notes)
# ===================================================================
# 
# 1. 数据库类型选择 (Database Type Selection):
#    - redis: 当前默认，完全支持所有功能
#    - mongodb: 未来支持，适合大规模数据存储
#    - postgresql: 未来支持，适合复杂查询和事务
#    - mysql: 未来支持，适合传统关系型数据库需求
#
# 2. 配置优先级 (Configuration Priority):
#    - 环境变量 > 配置文件 > 默认值
#    - 向后兼容原有Redis配置
#
# 3. 生产环境建议 (Production Recommendations):
#    - 使用强密码和SSL/TLS连接
#    - 配置适当的连接池大小
#    - 定期备份数据库
#    - 监控数据库性能指标
#
# 4. 开发环境配置 (Development Configuration):
#    - 保持DATABASE_TYPE=redis使用默认配置
#    - 本地Redis实例无需密码
#    - 测试环境可使用内存数据库
# ===================================================================