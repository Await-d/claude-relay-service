# ç”¨æˆ·ç®¡ç†ç³»ç»Ÿè¿ç§»å¿«é€ŸæŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨å¿«é€Ÿå®Œæˆä»çº¯ API Key è®¤è¯åˆ°ç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„è¿ç§»ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿ç§»å‰å‡†å¤‡ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
# ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
npm run cli status

# è¯•è¿è¡Œè¿ç§»ï¼Œæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
node scripts/migrate-user-management.js --dry-run
```

### 2. æ‰§è¡Œè¿ç§»ï¼ˆ2-5åˆ†é’Ÿï¼‰
```bash
# æ‰§è¡Œå®Œæ•´è¿ç§»
node scripts/migrate-user-management.js

# é‡å¯æœåŠ¡ï¼ˆé‡è¦ï¼ï¼‰
npm restart
```

### 3. éªŒè¯è¿ç§»ï¼ˆ2åˆ†é’Ÿï¼‰
```bash
# éªŒè¯ç³»ç»ŸçŠ¶æ€
node scripts/verify-user-migration.js

# æ£€æŸ¥Webç•Œé¢
curl http://localhost:3000/web
```

## ğŸ“‹ è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1ï¼šç¯å¢ƒæ£€æŸ¥
ç¡®ä¿ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼š
- âœ… æœåŠ¡æ­£åœ¨è¿è¡Œ
- âœ… Redis è¿æ¥æ­£å¸¸
- âœ… é…ç½®æ–‡ä»¶å®Œæ•´
- âœ… ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®

### æ­¥éª¤2ï¼šè¯•è¿è¡Œæµ‹è¯•
```bash
node scripts/migrate-user-management.js --dry-run
```
é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ•°æ®è¿ç§»å·¥å…·
ğŸ” è¿è¡Œæ¨¡å¼: è¯•è¿è¡Œ (ä¸ä¼šä¿®æ”¹æ•°æ®)
[1/8] ç¯å¢ƒæ£€æŸ¥ âœ…
[2/8] æ•°æ®åº“è¿æ¥æ£€æŸ¥ âœ…
[3/8] ç°æœ‰æ•°æ®åˆ†æ âœ…
...
âœ… ç”¨æˆ·ç®¡ç†ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆï¼
```

### æ­¥éª¤3ï¼šæ‰§è¡Œå®é™…è¿ç§»
```bash
node scripts/migrate-user-management.js
```
è¿ç§»è¿‡ç¨‹åŒ…æ‹¬ï¼š
1. ğŸ” ç¯å¢ƒå’Œæ•°æ®åº“æ£€æŸ¥
2. ğŸ’¾ åˆ›å»ºæ•°æ®å¤‡ä»½
3. ğŸ“Š åˆ†æç°æœ‰API Key
4. ğŸ—ï¸ åˆ›å»ºç”¨æˆ·æ•°æ®ç»“æ„
5. ğŸ”„ è¿ç§»API Keyåˆ°ç”¨æˆ·ç³»ç»Ÿ
6. âœ… éªŒè¯è¿ç§»ç»“æœ
7. ğŸ“‹ ç”Ÿæˆè¿ç§»æŠ¥å‘Š

### æ­¥éª¤4ï¼šé‡å¯æœåŠ¡
**é‡è¦ï¼šå¿…é¡»é‡å¯æœåŠ¡ä»¥åŠ è½½æ–°åŠŸèƒ½**
```bash
npm restart
# æˆ–
npm run service:restart
```

### æ­¥éª¤5ï¼šéªŒè¯ç³»ç»Ÿ
```bash
node scripts/verify-user-migration.js
```
éªŒè¯é¡¹ç›®ï¼š
- âœ… ç¯å¢ƒé…ç½®
- âœ… æ•°æ®åº“è¿æ¥
- âœ… ç”¨æˆ·æ•°æ®ç»“æ„
- âœ… API Keyè¿ç§»
- âœ… ç³»ç»Ÿé…ç½®
- âœ… Webç•Œé¢
- âœ… APIç«¯ç‚¹

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
```bash
# æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -f logs/claude-relay-*.log

# å¦‚æœæ”¯æŒå›æ»š
node scripts/migrate-user-management.js --rollback

# æˆ–ä»å¤‡ä»½æ¢å¤
node scripts/migrate-user-management.js --rollback backups/xxx.json
```

### Q: éªŒè¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥Redisè¿æ¥
3. é‡æ–°è¿è¡Œè¿ç§»
4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q: ç°æœ‰API Keyè¿˜èƒ½ç”¨å—ï¼Ÿ
æ˜¯çš„ï¼è¿ç§»åç°æœ‰API Keyå®Œå…¨å…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚

### Q: å¦‚ä½•è®¿é—®æ–°çš„ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Ÿ
è®¿é—®ï¼š`http://localhost:3000/web/users`ï¼ˆéœ€è¦ç®¡ç†å‘˜ç™»å½•ï¼‰

## ğŸ“Š è¿ç§»ååŠŸèƒ½

### æ–°å¢åŠŸèƒ½
- ğŸ‘¤ ç”¨æˆ·ç®¡ç†ç•Œé¢
- ğŸ”‘ API Keyä¸ç”¨æˆ·å…³è”
- ğŸ“Š ç”¨æˆ·çº§åˆ«çš„ä½¿ç”¨ç»Ÿè®¡
- âš™ï¸ ç”¨æˆ·æƒé™ç®¡ç†
- ğŸ¨ ä¸ªäººé…ç½®å’Œåå¥½

### ä¿æŒå…¼å®¹
- ğŸ”‘ ç°æœ‰API Keyæ­£å¸¸ä½¿ç”¨
- ğŸ“¡ æ‰€æœ‰APIç«¯ç‚¹ä¿æŒä¸å˜
- ğŸ”’ è®¤è¯æœºåˆ¶å®Œå…¨å…¼å®¹
- ğŸ“Š ä½¿ç”¨ç»Ÿè®¡ç»§ç»­å·¥ä½œ

## ğŸ”§ é«˜çº§é€‰é¡¹

### è‡ªå®šä¹‰è¿ç§»
```bash
# å¼ºåˆ¶è¿ç§»ï¼ˆå¿½ç•¥è­¦å‘Šï¼‰
node scripts/migrate-user-management.js --force

# è·³è¿‡å¤‡ä»½ï¼ˆä¸æ¨èï¼‰
node scripts/migrate-user-management.js --skip-backup

# è°ƒæ•´æ‰¹å¤„ç†å¤§å°
node scripts/migrate-user-management.js --batch-size 100
```

### æµ‹è¯•å·¥å…·
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
node scripts/test-user-migration.js
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹å¸®åŠ©**: `node scripts/migrate-user-management.js --help`
2. **è¿è¡Œæµ‹è¯•**: `node scripts/test-user-migration.js`
3. **æ£€æŸ¥æ—¥å¿—**: `tail -f logs/claude-relay-*.log`
4. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**: `docs/USER_MANAGEMENT_MIGRATION_GUIDE.md`

---

**âš ï¸ é‡è¦æé†’**:
- ç”Ÿäº§ç¯å¢ƒå»ºè®®åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œ
- è¿ç§»å‰ç¡®ä¿æ•°æ®å¤‡ä»½
- è¿ç§»åå¿…é¡»é‡å¯æœåŠ¡
- éªŒè¯åŠŸèƒ½æ­£å¸¸åç»“æŸç»´æŠ¤çª—å£